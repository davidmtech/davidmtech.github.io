/*! Copyright (c) 2017 Melown Technologies SE
 *  For terms of use, see accompanying vts-browser.min.js.LICENSE file.
 *  For 3rd party libraries licenses, see 3rdpartylicenses.txt.
 */
var vts=function(e){function t(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=184)}([function(e,t,i){"use strict";i.d(t,"h",function(){return r}),i.d(t,"i",function(){return s}),i.d(t,"l",function(){return a}),i.d(t,"k",function(){return n}),i.d(t,"f",function(){return o}),i.d(t,"a",function(){return h}),i.d(t,"m",function(){return l}),i.d(t,"n",function(){return u}),i.d(t,"o",function(){return c}),i.d(t,"d",function(){return d}),i.d(t,"g",function(){return p}),i.d(t,"j",function(){return f}),i.d(t,"b",function(){return g}),i.d(t,"e",function(){return m}),i.d(t,"c",function(){return v});var r=1,s=2,a=4,n=5,o=484813681109536e-20,h=Math.PI/2,l=.16666666666666666,u=.04722222222222222,c=.022156084656084655,d=void 0===Number.EPSILON?1e-10:Number.EPSILON,p=.017453292519943295,f=57.29577951308232,g=Math.PI/4,m=2*Math.PI,v=3.14159265359},function(e,t,i){"use strict";i.d(t,"a",function(){return r}),i.d(t,"b",function(){return a}),i.d(t,"c",function(){return s}),i.d(t,"d",function(){return n}),i.d(t,"e",function(){return o});var r={};r.create=function(e){var t=new Array(2);return e&&(t[0]=e[0],t[1]=e[1]),t};var s={};s.create=function(e){var t=new Array(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},s.dot2=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},s.dot3=function(e,t,i,r,s,a){return e[0]*(t[i]-r)+e[1]*(t[i+1]-s)+e[2]*(t[i+2]-a)+e[3]};var a={};a.create=function(e){var t=new Array(3);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2]),t},a.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.add=function(e,t,i){return i&&e!=i?(i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},a.subtract=function(e,t,i){return i&&e!=i?(i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},a.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},a.scale=function(e,t,i){return i&&e!=i?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i):(e[0]*=t,e[1]*=t,e[2]*=t,e)},a.normalize=function(e,t){t||(t=e);var i=e[0],r=e[1],s=e[2],a=Math.sqrt(i*i+r*r+s*s);return a?1==a?(t[0]=i,t[1]=r,t[2]=s,t):(a=1/a,t[0]=i*a,t[1]=r*a,t[2]=s*a,t):(t[0]=0,t[1]=0,t[2]=0,t)},a.normalize2=function(e,t,i){var r=e[t],s=e[t+1],a=e[t+2],n=Math.sqrt(r*r+s*s+a*a);return n?1==n?(i[0]=r,i[1]=s,i[2]=a,i):(n=1/n,i[0]=r*n,i[1]=s*n,void(i[2]=a*n)):(i[0]=0,i[1]=0,i[2]=0,i)},a.normalize3=function(e,t,i,r){var s=e[t],a=e[t+1],n=e[t+2],o=Math.sqrt(s*s+a*a+n*n);return o?1==o?(i[r]=s,i[r+1]=a,i[r+2]=n,i):(o=1/o,i[r]=s*o,i[r+1]=a*o,void(i[r+2]=n*o)):(i[r]=0,i[r+1]=0,i[r+2]=0,i)},a.normalize4=function(e,t){t||(t=e);var i=e[0],r=e[1],s=e[2],a=Math.sqrt(i*i+r*r+s*s);if(!a)return t[0]=0,t[1]=0,t[2]=0,t;if(1==a)return t[0]=i,t[1]=r,t[2]=s,t;var n=a;return a=1/a,t[0]=i*a,t[1]=r*a,t[2]=s*a,n},a.cross=function(e,t,i){i||(i=e);var r=e[0],s=e[1];e=e[2];var a=t[0],n=t[1];return t=t[2],i[0]=s*t-e*n,i[1]=e*a-r*t,i[2]=r*n-s*a,i},a.length=function(e){var t=e[0],i=e[1];return e=e[2],Math.sqrt(t*t+i*i+e*e)},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.dot2=function(e,t,i){return e[0]*t[i]+e[1]*t[i+1]+e[2]*t[i+2]},a.dot3=function(e,t,i,r){return e[t]*i[r]+e[t+1]*i[r+1]+e[t+2]*i[r+2]},a.squareDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s},a.direction=function(e,t,i){i||(i=e);var r=e[0]-t[0],s=e[1]-t[1];return e=e[2]-t[2],(t=Math.sqrt(r*r+s*s+e*e))?(t=1/t,i[0]=r*t,i[1]=s*t,i[2]=e*t,i):(i[0]=0,i[1]=0,i[2]=0,i)},a.lerp=function(e,t,i,r){return r||(r=e),r[0]=e[0]+i*(t[0]-e[0]),r[1]=e[1]+i*(t[1]-e[1]),r[2]=e[2]+i*(t[2]-e[2]),r},a.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var n={};n.create=function(e){var t=new Array(9);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9]),t},n.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.transpose=function(e,t){if(!t||e==t){var i=e[1],r=e[2],s=e[5];return e[1]=e[3],e[2]=e[6],e[3]=i,e[5]=e[7],e[6]=r,e[7]=s,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},n.toMat4=function(e,t){return t||(t=o.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.multiplyVec3=function(e,t,i){i||(i=t);var r=t[0],s=t[1];return t=t[2],i[0]=e[0]*r+e[3]*s+e[6]*t,i[1]=e[1]*r+e[4]*s+e[7]*t,i[2]=e[2]*r+e[5]*s+e[8]*t,i},n.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var o={};o.create=function(e){var t=new Array(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},o.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},o.transpose=function(e,t){if(!t||e==t){var i=e[1],r=e[2],s=e[3],a=e[6],n=e[7],o=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=i,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=a,e[11]=e[14],e[12]=s,e[13]=n,e[14]=o,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},o.determinant=function(e){var t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],n=e[5],o=e[6],h=e[7],l=e[8],u=e[9],c=e[10],d=e[11],p=e[12],f=e[13],g=e[14];return e=e[15],p*u*o*s-l*f*o*s-p*n*c*s+a*f*c*s+l*n*g*s-a*u*g*s-p*u*r*h+l*f*r*h+p*i*c*h-t*f*c*h-l*i*g*h+t*u*g*h+p*n*r*d-a*f*r*d-p*i*o*d+t*f*o*d+a*i*g*d-t*n*g*d-l*n*r*e+a*u*r*e+l*i*o*e-t*u*o*e-a*i*c*e+t*n*c*e},o.inverse=function(e,t){t||(t=e);var i=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],y=i*o-r*n,b=i*h-s*n,x=i*l-a*n,w=r*h-s*o,S=r*l-a*o,M=s*l-a*h,A=u*g-c*f,C=u*m-d*f,T=u*v-p*f,P=c*m-d*g,F=c*v-p*g,L=d*v-p*m,E=1/(y*L-b*F+x*P+w*T-S*C+M*A);return t[0]=(o*L-h*F+l*P)*E,t[1]=(-r*L+s*F-a*P)*E,t[2]=(g*M-m*S+v*w)*E,t[3]=(-c*M+d*S-p*w)*E,t[4]=(-n*L+h*T-l*C)*E,t[5]=(i*L-s*T+a*C)*E,t[6]=(-f*M+m*x-v*b)*E,t[7]=(u*M-d*x+p*b)*E,t[8]=(n*F-o*T+l*A)*E,t[9]=(-i*F+r*T-a*A)*E,t[10]=(f*S-g*x+v*y)*E,t[11]=(-u*S+c*x-p*y)*E,t[12]=(-n*P+o*C-h*A)*E,t[13]=(i*P-r*C+s*A)*E,t[14]=(-f*w+g*b-m*y)*E,t[15]=(u*w-c*b+d*y)*E,t},o.toRotationMat=function(e,t){return t||(t=o.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.toMat3=function(e,t){return t||(t=n.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.toInverseMat3=function(e,t){var i=e[0],r=e[1],s=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],c=e[10],d=c*o-h*u,p=-c*a+h*l,f=u*a-o*l,g=i*d+r*p+s*f;return g?(g=1/g,t||(t=n.create()),t[0]=d*g,t[1]=(-c*r+s*u)*g,t[2]=(h*r-s*o)*g,t[3]=p*g,t[4]=(c*i-s*l)*g,t[5]=(-h*i+s*a)*g,t[6]=f*g,t[7]=(-u*i+r*l)*g,t[8]=(o*i-r*a)*g,t):null},o.multiply=function(e,t,i){i||(i=e);var r=e[0],s=e[1],a=e[2],n=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14];e=e[15];var y=t[0],b=t[1],x=t[2],w=t[3],S=t[4],M=t[5],A=t[6],C=t[7],T=t[8],P=t[9],F=t[10],L=t[11],E=t[12],k=t[13],N=t[14];return t=t[15],i[0]=y*r+b*o+x*c+w*g,i[1]=y*s+b*h+x*d+w*m,i[2]=y*a+b*l+x*p+w*v,i[3]=y*n+b*u+x*f+w*e,i[4]=S*r+M*o+A*c+C*g,i[5]=S*s+M*h+A*d+C*m,i[6]=S*a+M*l+A*p+C*v,i[7]=S*n+M*u+A*f+C*e,i[8]=T*r+P*o+F*c+L*g,i[9]=T*s+P*h+F*d+L*m,i[10]=T*a+P*l+F*p+L*v,i[11]=T*n+P*u+F*f+L*e,i[12]=E*r+k*o+N*c+t*g,i[13]=E*s+k*h+N*d+t*m,i[14]=E*a+k*l+N*p+t*v,i[15]=E*n+k*u+N*f+t*e,i},o.multiplyVec3=function(e,t,i){i||(i=t);var r=t[0],s=t[1];return t=t[2],i[0]=e[0]*r+e[4]*s+e[8]*t+e[12],i[1]=e[1]*r+e[5]*s+e[9]*t+e[13],i[2]=e[2]*r+e[6]*s+e[10]*t+e[14],i},o.multiplyVec4=function(e,t,i){i||(i=t);var r=t[0],s=t[1],a=t[2];return t=t[3],i[0]=e[0]*r+e[4]*s+e[8]*a+e[12]*t,i[1]=e[1]*r+e[5]*s+e[9]*a+e[13]*t,i[2]=e[2]*r+e[6]*s+e[10]*a+e[14]*t,i[3]=e[3]*r+e[7]*s+e[11]*a+e[15]*t,i},o.translate=function(e,t,i){var r=t[0],s=t[1];if(t=t[2],!i||e==i)return e[12]=e[0]*r+e[4]*s+e[8]*t+e[12],e[13]=e[1]*r+e[5]*s+e[9]*t+e[13],e[14]=e[2]*r+e[6]*s+e[10]*t+e[14],e[15]=e[3]*r+e[7]*s+e[11]*t+e[15],e;var a=e[0],n=e[1],o=e[2],h=e[3],l=e[4],u=e[5],c=e[6],d=e[7],p=e[8],f=e[9],g=e[10],m=e[11];return i[0]=a,i[1]=n,i[2]=o,i[3]=h,i[4]=l,i[5]=u,i[6]=c,i[7]=d,i[8]=p,i[9]=f,i[10]=g,i[11]=m,i[12]=a*r+l*s+p*t+e[12],i[13]=n*r+u*s+f*t+e[13],i[14]=o*r+c*s+g*t+e[14],i[15]=h*r+d*s+m*t+e[15],i},o.scale=function(e,t,i){var r=t[0],s=t[1];return t=t[2],i&&e!=i?(i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=e[7]*s,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i):(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=s,e[5]*=s,e[6]*=s,e[7]*=s,e[8]*=t,e[9]*=t,e[10]*=t,e[11]*=t,e)},o.rotate=function(e,t,i,r){var s=i[0],a=i[1];i=i[2];var n=Math.sqrt(s*s+a*a+i*i);if(!n)return null;1!=n&&(n=1/n,s*=n,a*=n,i*=n);var o=Math.sin(t),h=Math.cos(t),l=1-h;t=e[0],n=e[1];var u=e[2],c=e[3],d=e[4],p=e[5],f=e[6],g=e[7],m=e[8],v=e[9],y=e[10],b=e[11],x=s*s*l+h,w=a*s*l+i*o,S=i*s*l-a*o,M=s*a*l-i*o,A=a*a*l+h,C=i*a*l+s*o,T=s*i*l+a*o;return s=a*i*l-s*o,a=i*i*l+h,r?e!=r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=t*x+d*w+m*S,r[1]=n*x+p*w+v*S,r[2]=u*x+f*w+y*S,r[3]=c*x+g*w+b*S,r[4]=t*M+d*A+m*C,r[5]=n*M+p*A+v*C,r[6]=u*M+f*A+y*C,r[7]=c*M+g*A+b*C,r[8]=t*T+d*s+m*a,r[9]=n*T+p*s+v*a,r[10]=u*T+f*s+y*a,r[11]=c*T+g*s+b*a,r},o.rotateX=function(e,t,i){var r=Math.sin(t);t=Math.cos(t);var s=e[4],a=e[5],n=e[6],o=e[7],h=e[8],l=e[9],u=e[10],c=e[11];return i?e!=i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[4]=s*t+h*r,i[5]=a*t+l*r,i[6]=n*t+u*r,i[7]=o*t+c*r,i[8]=s*-r+h*t,i[9]=a*-r+l*t,i[10]=n*-r+u*t,i[11]=o*-r+c*t,i},o.rotateY=function(e,t,i){var r=Math.sin(t);t=Math.cos(t);var s=e[0],a=e[1],n=e[2],o=e[3],h=e[8],l=e[9],u=e[10],c=e[11];return i?e!=i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=s*t+h*-r,i[1]=a*t+l*-r,i[2]=n*t+u*-r,i[3]=o*t+c*-r,i[8]=s*r+h*t,i[9]=a*r+l*t,i[10]=n*r+u*t,i[11]=o*r+c*t,i},o.rotateZ=function(e,t,i){var r=Math.sin(t);t=Math.cos(t);var s=e[0],a=e[1],n=e[2],o=e[3],h=e[4],l=e[5],u=e[6],c=e[7];return i?e!=i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=s*t+h*r,i[1]=a*t+l*r,i[2]=n*t+u*r,i[3]=o*t+c*r,i[4]=s*-r+h*t,i[5]=a*-r+l*t,i[6]=n*-r+u*t,i[7]=o*-r+c*t,i},o.frustum=function(e,t,i,r,s,a,n){n||(n=o.create());var h=t-e,l=r-i,u=a-s;return n[0]=2*s/h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*s/l,n[6]=0,n[7]=0,n[8]=(t+e)/h,n[9]=(r+i)/l,n[10]=-(a+s)/u,n[11]=-1,n[12]=0,n[13]=0,n[14]=-a*s*2/u,n[15]=0,n},o.perspective=function(e,t,i,r,s){return e=i*Math.tan(e*Math.PI/360),t*=e,o.frustum(-t,t,-e,e,i,r,s)},o.ortho=function(e,t,i,r,s,a,n){n||(n=o.create());var h=t-e,l=r-i,u=a-s;return n[0]=2/h,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-2/u,n[11]=0,n[12]=-(e+t)/h,n[13]=-(r+i)/l,n[14]=-(a+s)/u,n[15]=1,n},o.lookAt=function(e,t,i,r){r||(r=o.create());var s=e[0],a=e[1];e=e[2];var n=i[0],h=i[1],l=i[2];i=t[1];var u=t[2];if(s==t[0]&&a==i&&e==u)return o.identity(r);var c,d,p,f;return i=s-t[0],u=a-t[1],t=e-t[2],f=1/Math.sqrt(i*i+u*u+t*t),i*=f,u*=f,t*=f,c=h*t-l*u,l=l*i-n*t,n=n*u-h*i,f=Math.sqrt(c*c+l*l+n*n),f?(f=1/f,c*=f,l*=f,n*=f):n=l=c=0,h=u*n-t*l,d=t*c-i*n,p=i*l-u*c,f=Math.sqrt(h*h+d*d+p*p),f?(f=1/f,h*=f,d*=f,p*=f):p=d=h=0,r[0]=c,r[1]=h,r[2]=i,r[3]=0,r[4]=l,r[5]=d,r[6]=u,r[7]=0,r[8]=n,r[9]=p,r[10]=t,r[11]=0,r[12]=-(c*s+l*a+n*e),r[13]=-(h*s+d*a+p*e),r[14]=-(i*s+u*a+t*e),r[15]=1,r},o.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var h={};h.create=function(e){var t=new Array(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},h.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},h.calculateW=function(e,t){var i=e[0],r=e[1],s=e[2];return t&&e!=t?(t[0]=i,t[1]=r,t[2]=s,t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t):(e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e)},h.inverse=function(e,t){return t&&e!=t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=1,e[1]*=1,e[2]*=1,e)},h.length=function(e){var t=e[0],i=e[1],r=e[2];return e=e[3],Math.sqrt(t*t+i*i+r*r+e*e)},h.normalize=function(e,t){t||(t=e);var i=e[0],r=e[1],s=e[2],a=e[3],n=Math.sqrt(i*i+r*r+s*s+a*a);return 0==n?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(n=1/n,t[0]=i*n,t[1]=r*n,t[2]=s*n,t[3]=a*n,t)},h.multiply=function(e,t,i){i||(i=e);var r=e[0],s=e[1],a=e[2];e=e[3];var n=t[0],o=t[1],h=t[2];return t=t[3],i[0]=r*t+e*n+s*h-a*o,i[1]=s*t+e*o+a*n-r*h,i[2]=a*t+e*h+r*o-s*n,i[3]=e*t-r*n-s*o-a*h,i},h.multiplyVec3=function(e,t,i){i||(i=t);var r=t[0],s=t[1],a=t[2];t=e[0];var n=e[1],o=e[2];e=e[3];var h=e*r+n*a-o*s,l=e*s+o*r-t*a,u=e*a+t*s-n*r;return r=-t*r-n*s-o*a,i[0]=h*e+r*-t+l*-o-u*-n,i[1]=l*e+r*-n+u*-t-h*-o,i[2]=u*e+r*-o+h*-n-l*-t,i},h.toMat3=function(e,t){t||(t=n.create());var i=e[0],r=e[1],s=e[2],a=e[3],o=i+i,h=r+r,l=s+s,u=i*o,c=i*h;i*=l;var d=r*h;return r*=l,s*=l,o*=a,h*=a,a*=l,t[0]=1-(d+s),t[1]=c-a,t[2]=i+h,t[3]=c+a,t[4]=1-(u+s),t[5]=r-o,t[6]=i-h,t[7]=r+o,t[8]=1-(u+d),t},h.toMat4=function(e,t){t||(t=o.create());var i=e[0],r=e[1],s=e[2],a=e[3],n=i+i,h=r+r,l=s+s,u=i*n,c=i*h;i*=l;var d=r*h;return r*=l,s*=l,n*=a,h*=a,a*=l,t[0]=1-(d+s),t[1]=c-a,t[2]=i+h,t[3]=0,t[4]=c+a,t[5]=1-(u+s),t[6]=r-n,t[7]=0,t[8]=i-h,t[9]=r+n,t[10]=1-(u+d),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.slerp=function(e,t,i,r){r||(r=e);var s=i;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]<0&&(s=-1*i),r[0]=1-i*e[0]+s*t[0],r[1]=1-i*e[1]+s*t[1],r[2]=1-i*e[2]+s*t[2],r[3]=1-i*e[3]+s*t[3],r},h.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}},function(e,t,i){"use strict";var r=i(4),s=i(9);i.d(t,"a",function(){return o});var a=r.a,n=s.a,o={};o.useCredentials=!1,o.instanceCounter=0,o.validateBool=function(e,t){return"boolean"==typeof e?e:t},o.validateNumber=function(e,t,i,r){return"number"==typeof e?a.clamp(e,t,i):r},o.validateNumberArray=function(e,t,i,r,s){if(Array.isArray(e)&&e.length==t){for(var n=0;n<t;n++)e[n]=a.clamp(e[n],i[n],r[n]);return e}return s},o.validateString=function(e,t){return"string"==typeof e?e:t},o.padNumber=function(e,t){return e<0?(e=-e+"",t--,e.length>=t?"-"+e:"-"+(new Array(t-e.length+1).join("0")+e)):(e+="",e.length>=t?e:new Array(t-e.length+1).join("0")+e)},o.decodeFloat16=function(e){var t=(31744&e)>>10,i=1023&e;return(e>>15?-1:1)*(t?31===t?i?NaN:1/0:Math.pow(2,t-15)*(1+i/1024):i/1024*6103515625e-14)},o.simpleFmtObj=function(e,t){return e&&""!=e?e.replace(/\{([$a-zA-Z0-9][$a-zA-Z0-9]*)\}/g,function(e,i){return i in t?t[i]:e}):""},o.simpleWikiLinks=function(e,t){return e&&""!=e?o.simpleFmtObj(e,{copy:"&copy;",Y:(new Date).getFullYear()}).replace(/\[([^\]]*)\]/g,function(e,i){i=i.trim();var r=i.split(" ");return-1!=r[0].indexOf("//")?t?r.length>1?""+i.substring(r[0].length):""+r[0]:r.length>1?"<a href="+r[0]+' target="blank">'+i.substring(r[0].length)+"</a>":"<a href="+r[0]+' target="blank">'+r[0]+"</a>":i}):""},o.simpleFmtObjOrCall=function(e,t,i){return e&&""!=e?e.replace(/\{([$a-zA-Z(-9][$a-zA-Z(-9]*)\}/g,function(e,r){return r in t?t[r]:i(r)}):""},o.getABGRFromHexaCode=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[4],16),parseInt(t[3],16),parseInt(t[2],16),parseInt(t[1],16)]:[0,0,0,255]},o.stringifyFunction=function(e){return"("+e+").call(self);"},o.isPowerOfTwo=function(e){return 0==(e&e-1)&&0!==e},o.nearestPowerOfTwo=function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},o.fitToPowerOfTwo=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},o.getHash=function(e){if(!e||0===e.length)return 0;for(var t,i=0,r=0,s=e.length;r<s;r++)t=e.charCodeAt(r),i=(i<<5)-i+t,i|=0;return i},o.convertRGB2YCbCr=function(e,t,i){return[.299*e+.587*t+.114*i+0,-.169*e+-.331*t+.5*i+128,.5*e+-.419*t+-.081*i+128]},o.convertYCbCr2RGB=function(e,t,i){return[1*e+0*(t-128)+1.4*(i-128),1*e+-.343*(t-128)+-.711*(i-128),1*e+1.765*(t-128)+0*(i-128)]},o.convertHSL2RGB=function(e,t,i){var r,s,a,n,o,h;return e/=60,e<0&&(e=6- -e%6),e%=6,t=Math.max(0,Math.min(1,t/100)),i=Math.max(0,Math.min(1,i/100)),o=(1-Math.abs(2*i-1))*t,h=o*(1-Math.abs(e%2-1)),e<1?(r=o,s=h,a=0):e<2?(r=h,s=o,a=0):e<3?(r=0,s=o,a=h):e<4?(r=0,s=h,a=o):e<5?(r=h,s=0,a=o):(r=o,s=0,a=h),n=i-o/2,[r+n,s+n,a+n]},o.getHashColor=function(e){var t=o.getHash(e),i=o.convertRGB2YCbCr(255&t,t>>8&255,t>>16&255);return i[0]=a.clamp(i[0],50,200),o.convertRGB2YCbCr(i[0],i[1],i[2])},o.getHashColor2=function(e){var t=Math.floor(e/18),i=50;return t>=1&&(i=t%2?50+10*i%30:50-10*(i-1)%30),t=e%18*20,o.convertHSL2RGB(t,100,i)},o.loadText=function(e,t,i,r,s){o.loadJSON(e,t,i,!0,r,s)},o.loadXML=function(e,t,i,r,s){var a=function(e){e=(new DOMParser).parseFromString(e,"text/xml"),t&&t(e)};o.loadJSON(e,a,i,!0,r,s)},o.loadJSON=function(e,t,i,r,s,a){var n=new XMLHttpRequest;n.onreadystatechange=function(){switch(n.readyState){case 0:case 1:case 2:case 3:break;case 4:if(n.status>=400||0==n.status){i&&i(n.status);break}var s=n.response,a=s;if(!r)try{a=JSON.parse(s)}catch(t){return console.log("JSON Parse Error ("+e+"): "+(t.message?t.message:"")),void(i&&i(n.status))}t&&t(a)}}.bind(this),n.open("GET",e,!0),n.withCredentials=s,a&&a.token&&n.setRequestHeader("Accept","token/"+a.token+", */*"),a&&a.charset&&n.overrideMimeType("text/xml; charset="+a.charset),n.send("")},o.loadBinary=function(e,t,i,r,s,a){var n=new XMLHttpRequest;n.onreadystatechange=function(){switch(n.readyState){case 0:case 1:case 2:case 3:break;case 4:if(n.status>=400||0==n.status){i&&i(n.status);break}var e=n.response;if(!e){i&&i();break}t&&t(e);break;default:i&&i()}}.bind(this),n.open("GET",e,!0),n.responseType=a||"arraybuffer",n.withCredentials=r,s&&s.token&&n.setRequestHeader("Accept","token/"+s.token+", */*"),n.send("")},o.headRequest=function(e,t,i,r,s){var a=new XMLHttpRequest;a.onreadystatechange=function(){switch(a.readyState){case 0:case 1:case 2:case 3:break;case 4:null!=t&&t(a.getAllResponseHeaders(),a.status);break;default:null!=i&&i()}}.bind(this),a.onerror=function(){null!=i&&i()}.bind(this),a.open("HEAD",e,!0),a.withCredentials=r,s&&s.token&&a.setRequestHeader("Accept","token/"+s.token+", */*"),a.send("")},o.loadImage=function(e,t,i,r,s){var a=new Image;return a.onerror=i,a.onload=t,s||(a.crossOrigin=r?"use-credentials":"anonymous"),a.src=e,a},o.getParamsFromUrl=function(e){return n.getParamsFromUrl(e)};var h="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;o.unint8ArrayToString=function(e){if(h)return h.decode(e);var t="",i=new Uint8Array(e.byteLength);i.set(e);for(var r=new Uint32Array(i.buffer),s=0,a=r.length;s<a;++s){var n=r[s];n<=65535?t+=String.fromCharCode(n):(n-=65536,t+=String.fromCharCode(55296+(n>>10),56320+(1023&n)))}return t}},function(e,t,i){"use strict";var r=i(0),s=i(12);t.a=function(e){return Math.abs(e)<=r.c?e:e-i.i(s.a)(e)*r.e}},function(e,t,i){"use strict";var r=i(1);i.d(t,"a",function(){return a});var s=r.e,a={};a.isEqual=function(e,t,i){return Math.abs(e-t)<i},a.clamp=function(e,t,i){return e<t?e=t:e>i&&(e=i),e},a.radians=function(e){return e*Math.PI/180},a.degrees=function(e){return e/Math.PI*180},a.mix=function(e,t,i){return e+(t-e)*i},a.frustumMatrix=function(e,t,i,r,a,n){var o=t-e,h=r-i,l=n-a,u=s.create([2*a/o,0,(t+e)/o,0,0,2*a/h,(r+i)/h,0,0,0,-(n+a)/l,-2*n*a/l,0,0,-1,0]);return s.transpose(u),u},a.perspectiveMatrix=function(e,t,i,r){var s=i*Math.tan(e*Math.PI/180),n=s*t;return a.frustumMatrix(-n,n,-s,s,i,r)},a.orthographicMatrix=function(e,t,i,r){var a=.5*e*t,n=.5*e,o=r-i,h=s.create([1/a,0,0,0,0,1/n,0,0,0,0,-2/o,-(r+i)/o,0,0,0,1]);return s.transpose(h),h},a.rotationMatrix=function(e,t){var i=Math.cos(t),r=Math.sin(t);switch(e){case 0:return[1,0,0,0,0,i,r,0,0,-r,i,0,0,0,0,1];case 1:return[i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1];default:return[i,r,0,0,-r,i,0,0,0,0,1,0,0,0,0,1]}},a.scaleMatrix=function(e,t,i){return[e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1]},a.scaleMatrixf=function(e){return a.scaleMatrix(e,e,e)},a.translationMatrix=function(e,t,i){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1]},a.translationMatrix2f=function(e){return a.translationMatrix(e[0],e[1],0)},a.translationMatrix3f=function(e){return a.translationMatrix(e[0],e[1],e[2])}},function(e,t,i){"use strict";var r=function(e,t,i,r,s,a){this.min=[],this.max=[],this.min[0]=null!=e?e:Number.POSITIVE_INFINITY,this.min[1]=null!=t?t:Number.POSITIVE_INFINITY,this.min[2]=null!=i?i:Number.POSITIVE_INFINITY,this.max[0]=null!=r?r:Number.NEGATIVE_INFINITY,this.max[1]=null!=s?s:Number.NEGATIVE_INFINITY,this.max[2]=null!=a?a:Number.NEGATIVE_INFINITY,this.updateMaxSize()};r.prototype.clone=function(){return new r(this.min[0],this.min[1],this.min[2],this.max[0],this.max[1],this.max[2])},r.prototype.side=function(e){return this.max[e]-this.min[e]},r.prototype.updateMaxSize=function(){this.maxSize=Math.abs(Math.max(this.max[0]-this.min[0],this.max[1]-this.min[1],this.max[2]-this.min[2]))},r.prototype.center=function(e){return null!=e?(e[0]=.5*(this.min[0]+this.max[0]),e[1]=.5*(this.min[1]+this.max[1]),e):(this.middle||(this.middle=[.5*(this.min[0]+this.max[0]),.5*(this.min[1]+this.max[1]),.5*(this.min[2]+this.max[2])],isNaN(this.middle[0])&&(this.middle[0]=0),isNaN(this.middle[1])&&(this.middle[1]=0),isNaN(this.middle[2])&&(this.middle[2]=0)),this.middle)},r.prototype.translateXY=function(e){return new r(this.min[0]-e[0],this.min[1]-e[1],this.min[2],this.max[0]-e[0],this.max[1]-e[1],this.max[2])},t.a=r},function(e,t,i){"use strict";var r=i(2),s=r.a,a=function(e,t,i,r,s,a,n,o,h,l){this.gpu=e,this.gl=e.gl,this.texture=null,this.framebuffer=null,this.size=0,this.fileSize=r,this.width=0,this.height=0,this.repeat=a||!1,this.filter=n||"linear",this.image=null,this.loaded=!1,this.trilinear=!1,this.core=i,null!=t&&this.load(t,h,l,s,o)};a.prototype.kill=function(){this.gl.deleteTexture(this.texture),this.texture=null},a.prototype.getSize=function(){return this.size},a.prototype.createFromData=function(e,t,i,r,s){var a=this.gl;this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),s?(s=a.REPEAT,this.repeat=!0):s=a.CLAMP_TO_EDGE,a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,s);var n=!1;switch(r){case"linear":a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case"trilinear":a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),n=!0;break;default:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)}a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,t,0,a.RGBA,a.UNSIGNED_BYTE,i),n&&a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null),this.width=e,this.height=t,this.size=e*t*4,this.loaded=!0},a.prototype.createFromImage=function(e,t,i,r){var a=this.gl,n=e.naturalWidth,o=e.naturalHeight,h=e;this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),i?(i=a.REPEAT,this.repeat=!0):i=a.CLAMP_TO_EDGE,a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i);var l=!1;switch(this.filter=t,t){case"linear":a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);break;case"trilinear":a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),l=!0;break;default:a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)}if((this.repeat||l)&&(!s.isPowerOfTwo(n)||!s.isPowerOfTwo(o))){n=s.nearestPowerOfTwo(n),o=s.nearestPowerOfTwo(o);var u=document.createElement("canvas");u.width=n,u.height=o;u.getContext("2d").drawImage(e,0,0,n,o),h=u}var c=this.gpu;c.anisoLevel&&a.texParameterf(a.TEXTURE_2D,c.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,c.anisoLevel),!0!==c.noTextures&&(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,h),l&&a.generateMipmap(a.TEXTURE_2D)),a.bindTexture(a.TEXTURE_2D,null),this.width=n,this.height=o,this.size=n*o*4,this.loaded=!0},a.prototype.load=function(e,t,i,r,a){this.image=s.loadImage(e,function(){null!=this.core&&this.core.killed||(this.createFromImage(this.image,this.filter,this.repeat),a||(this.image=null),t?t():this.core.map&&this.core.map.markDirty&&this.core.map.markDirty())}.bind(this),function(){null!=this.core&&this.core.killed||i&&i()}.bind(this),null,r)},a.prototype.createFramebufferFromData=function(e,t,i){var r=this.gl,s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),s.width=e,s.height=t;var a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,i);var n=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,n),this.width=e,this.height=t,this.size=e*t*4,this.texture=a,this.renderbuffer=n,this.framebuffer=s,r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null)},a.prototype.createFramebuffer=function(e,t){if(null!=this.texture){var i=this.gl,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),r.width=e,r.height=t,i.bindTexture(i.TEXTURE_2D,this.texture);var s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,s),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),this.framebuffer=r,this.renderbuffer=s}},a.prototype.readFramebufferPixels=function(e,t,i,r,s,a){if(null!=this.texture){this.gpu.bindTexture(this),s||this.gpu.setFramebuffer(this);var n=this.gl;return a||(a=new Uint8Array(i*r*4)),n.readPixels(e,t,i,r,n.RGBA,n.UNSIGNED_BYTE,a),s||this.gpu.setFramebuffer(null),a}},t.a=a},function(e,t,i){"use strict";t.a=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}},function(e,t,i){"use strict";t.a=function(e,t,i){var r=e*t;return i/Math.sqrt(1-r*r)}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r={};r.isSameOrigin=function(e){if("string"!=typeof e)return!1;var t=document.location.hostname;return r.parse(e).hostname===t},r.parse=function(e){if("string"!=typeof e)return null;var t=document.createElement("a");return t.href=e,t},r.getParamsFromUrl=function(e){var t=r.parse(e),i={},s=t.search.substring(1),a=s.split("&");if(1!=a.length||""!=a[0])for(var n=0;n<a.length;n++){var o=a[n].split("=");if(void 0===i[o[0]])i[o[0]]=o[1];else if("string"==typeof i[o[0]]){var h=[i[o[0]],o[1]];i[o[0]]=h}else i[o[0]].push(o[1])}return i},r.getHost=function(e){var t=document.createElement("a");return t.href=e,t.hostname},r.getSchema=function(e){if(-1!=e.indexOf("http://"))return"http:";if(-1!=e.indexOf("https://"))return"https:";var t=document.createElement("a");return t.href=e,t.protocol},r.getOrigin=function(e){var t=document.createElement("a");return t.href=e,t.origin?t.origin:t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")},r.getBase=function(e){return e.split("?")[0].split("/").slice(0,-1).join("/")+"/"},r.makeAbsolute=function(e){var t=document.createElement("a");return t.href=e,t.href},r.getProcessUrl=function(e,t){if(!e||!t)return e;e=e.trim(),t=t.trim();var i=r.getBase(t),s=r.getSchema(t),a=r.getOrigin(t);return-1!=e.indexOf("://")?e:0==e.indexOf("//")?s+e:0==e.indexOf("/")?a+e:i+e}},function(e,t,i){"use strict";var r=i(173),s=r.a,a={};a.hasClass=function(e,t){if(void 0!==e.classList)return e.classList.contains(t);var i=a.getClass(e);return i.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},a.addClass=function(e,t){if(void 0!==e.classList)for(var i=a.splitWords(t),r=0,s=i.length;r<s;r++)e.classList.add(i[r]);else if(!a.hasClass(e,t)){var n=a.getClass(e);a.setClass(e,(n?n+" ":"")+t)}},a.removeClass=function(e,t){void 0!==e.classList?e.classList.remove(t):a.setClass(e,(" "+a.getClass(e)+" ").replace(" "+t+" "," ").trim())},a.setClass=function(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t},a.getClass=function(e){return void 0===e.className.baseVal?e.className:e.className.baseVal},a.preventDefault=function(e){e=e instanceof s?e.event:e,e.preventDefault?e.preventDefault():e.returnValue=!1},a.stopPropagation=function(e){e=e instanceof s?e.event:e,e.stopPropagation()},a.disableTextSelection=function(){window.addEventListener("selectstart",a.preventDefault)},a.enableTextSelection=function(){window.removeEventListener("selectstart",a.preventDefault)},a.disableImageDrag=function(){window.addEventListener("dragstart",a.preventDefault)},a.enableImageDrag=function(){window.removeEventListener("dragstart",a.preventDefault)},a.disableContexMenu=function(e){e.addEventListener("contextmenu",a.preventDefault)},a.enableContexMenu=function(e){e.removeEventListener("contextmenu",a.preventDefault)},a.getSupportedProperty=function(e){for(var t=document.documentElement.style,i=0,r=e.length;i<r;i++)if(e[i]in t)return e[i];return!1},a.stampCounter=0,a.stamp=function(e){return e.vtsStamp=e.vtsStamp||++a.stampCounter,e.vtsStamp},a.TRANSFORM=a.getSupportedProperty(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),t.a=a},function(e,t,i){"use strict";var r=i(0),s=i(12);t.a=function(e){return Math.abs(e)<r.a?e:e-i.i(s.a)(e)*Math.PI}},function(e,t,i){"use strict";t.a=function(e){return e<0?-1:1}},function(e,t,i){"use strict";function r(e){return(e?"Core: ":"")+"2.23.0"}function s(){M.init();var e=document.createElement("canvas");if(null==e)return!1;if(e.width=1024,e.height=768,null==e.getContext)return!1;var t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){return!1}return!!t}var a=i(21),n=i(143),o=i(123),h=i(169),l=i(167),u=i(31),c=i(141),d=i(2),p=i(9),f=i(22);i.d(t,"c",function(){return A}),i.d(t,"a",function(){return r}),i.d(t,"b",function(){return s});var g=n.a,m=o.a,v=h.a,y=l.a,b=u.a,x=c.a,w=d.a,S=p.a,M=f.a,A=function(e,t,i){var r=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage;this.killed=!1,this.config={map:null,mapCache:1100,mapGPUCache:600,mapMetatileCache:60,mapTexelSizeFit:1.1,mapMaxHiresLodLevels:2,mapDownloadThreads:20,mapMaxProcessingTime:10,mapMaxGeodataProcessingTime:10,mapMobileMode:!1,mapMobileModeAutodect:!0,mapMobileDetailDegradation:1,mapNavSamplesPerViewExtent:4,mapIgnoreNavtiles:!1,mapVirtualSurfaces:!0,mapAllowHires:!0,mapAllowLowres:!0,mapAllowSmartSwitching:!0,mapDisableCulling:!1,mapPreciseCulling:!0,mapHeightLodBlend:!0,mapHeightNodeBlend:!0,mapBasicTileSequence:!1,mapPreciseBBoxTest:!1,mapPreciseDistanceTest:!1,mapHeightfiledWhenUnloaded:!0,mapForceMetatileV3:!1,mapSmartNodeParsing:!0,mapLoadErrorRetryTime:3e3,mapLoadErrorMaxRetryCount:3,mapLoadMode:"topdown",mapGeodataLoadMode:"fit",mapSplitMeshes:!0,mapGridMode:"linear",mapGridSurrogatez:!1,mapGridUnderSurface:0,mapGridTextureLevel:-1,mapGridTextureLayer:null,mapXhrImageLoad:!0,mapStoreLoadStats:!1,mapRefreshCycles:3,mapSoftViewSwitch:!0,mapSortHysteresis:!0,mapHysteresisWait:0,mapSeparateLoader:!0,mapGeodataBinaryLoad:!0,mapPackLoaderEvents:!0,mapParseMeshInWorker:!0,mapPackGeodataEvents:!0,mapCheckTextureSize:!1,mapFeatureStickMode:[1,1],map16bitMeshes:!0,mapOnlyOneUVs:!1,mapIndexBuffers:!0,mapAsyncImageDecode:!0,mapFeatureGridCells:31,mapFeaturesPerSquareInch:.25,mapFeaturesSortByTop:!1,mapFeaturesReduceMode:"scr-count1",mapFeaturesReduceParams:null,mapFeaturesReduceFactor:1,mapFeaturesReduceFactor2:1,mapDMapSize:1024,mapDMapMode:1,mapDegradeHorizon:!1,mapDegradeHorizonParams:[1,1500,97500,3500],mapDefaultFont:"//cdn.melown.com/libs/vtsjs/fonts/noto-basic/1.0.0/noto.fnt",mapFog:!0,mapNoTextures:!1,mapMetricUnits:!("en"==r||0==r.indexOf("en-")),mapLanguage:r,mapForceFrameTime:0,mapForcePipeline:0,mapLogGeodataStyles:!0,mapBenevolentMargins:!1,rendererAnisotropic:0,rendererAntialiasing:!0,rendererAllowScreenshots:!1,inspector:!0,authorization:null,mario:!1},this.configStorage={},this.element=e,this.coreInterface=i,this.ready=!1,this.listeners=[],this.listenerCounter=0,this.tokenCookieHost=null,this.tokenIFrame=null,this.xhrParams={},this.inspector=null!=m?new m(this):null,this.setConfigParams(t),this.map=null,this.mapInterface=null,this.renderer=new v(this,this.element,null,this.onResize.bind(this),this.config),this.rendererInterface=new y(this.renderer),this.proj4=a.a,this.contextLost=!1,M.init(),this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},window.performance=window.performance||{},performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}(),this.loadMap(this.config.map),this.requestAnimFrame.call(window,this.onUpdate.bind(this))};A.prototype.onResize=function(){null!=this.map&&this.map.markDirty()},A.prototype.loadMap=function(e){if(null!=this.map&&this.destroyMap(),null!=e){e=S.getProcessUrl(e,window.location.href),this.tokenCookieLoaded=!0,this.mapConfigData=null,this.tokenExpiration=null,this.tokenExpirationCallback=null,this.tokenExpirationLoop=!1,this.tokenCanBeSkiped=!0,this.mapRunnig=!1;var t=function(){if((this.tokenCookieLoaded||this.tokenCanBeSkiped)&&this.mapConfigData&&!this.mapRunnig){this.mapRunnig=!0;var t=this.mapConfigData;this.callListener("map-mapconfig-loaded",t),this.map=new g(this,t,e,this.config,this.configStorage),this.mapInterface=new x(this.map),this.setConfigParams(this.map.browserOptions,!0),this.setConfigParams(this.configStorage),this.config.position&&(this.map.setPosition(this.config.position),this.config.position=null),this.config.view&&(this.map.setView(this.config.view),this.config.view=null)}}.bind(this),i=function(e){this.mapConfigData=e,t()}.bind(this),r=function(){}.bind(this),s=function(t){if(!t||t&&t.status)return void(this.tokenCanBeSkiped&&o(e));this.tokenLoaded=!0,this.xhrParams.token=t.token,this.xhrParams.tokenHeader=t.header,this.tokenExpiration=1e3*t.expires,this.tokenExpirationCallback=function(){this.tokenExpiration=null,this.tokenExpirationLoop=!0,"string"==typeof this.config.authorization?w.loadJSON(this.config.authorization,s,a,null,w.useCredentials,this.xhrParams):this.config.authorization(s)}.bind(this),this.tokenExpirationLoop||o(e),"string"==typeof this.config.authorization?h(t.cookieInjector,this.config.authorization):h(t.cookieInjector,e)}.bind(this),a=function(){console.log("auth token not loaded"),this.tokenCanBeSkiped&&o(e)}.bind(this),n=function(){document.body.removeChild(this.tokenIFrame),this.tokenIFrame=null,this.tokenCookieLoaded=!0,t()}.bind(this),o=function(e){w.loadJSON(e,i,r,null,w.useCredentials,this.xhrParams)}.bind(this),h=function(e,t){e=S.getProcessUrl(e,t),this.tokenCookieHost=S.getHost(e);var i=document.createElement("iframe");this.tokenIFrame=i,i.onload=n,i.src=e,i.style.display="none",document.body.appendChild(i)}.bind(this);this.config.authorization?(this.tokenCookieLoaded=!1,"string"==typeof this.config.authorization?w.loadJSON(this.config.authorization,s,a,null,w.useCredentials,this.xhrParams):this.config.authorization(s)):o(e)}},A.prototype.destroy=function(){this.killed||(this.destroyMap(),this.renderer&&this.renderer.kill(),this.element=null,this.killed=!0)},A.prototype.destroyMap=function(){this.map&&(this.map.kill(),this.map=null,this.mapInterface=null,this.callListener("map-unloaded",{}))},A.prototype.getMap=function(){return this.map},A.prototype.getMapInterface=function(){return this.mapInterface},A.prototype.getRenderer=function(){return this.renderer},A.prototype.getRendererInterface=function(){return this.rendererInterface},A.prototype.getProj4=function(){return this.proj4},A.prototype.getOption=function(){},A.prototype.setOption=function(){},A.prototype.on=function(e,t,i,r){if(!this.killed&&null!=t)return this.listenerCounter++,this.listeners.push({name:e,listener:t,id:this.listenerCounter,once:r,wait:i||0}),function(e){this.removeListener(e)}.bind(this,this.listenerCounter)},A.prototype.once=function(e,t,i){this.on(e,t,i,!0)},A.prototype.callListener=function(e,t,i){for(var r=0;r<this.listeners.length;r++)if(this.listeners[r].name==e){var s=this.listeners[r];s.wait>0?s.wait--:(s.listener(t),s.once&&(this.listeners.splice(r,1),r--))}i&&console.log("event "+e+": "+JSON.stringify(t))},A.prototype.removeListener=function(e){for(var t=0;t<this.listeners.length;t++)if(this.listeners[t].id==e)return void this.listeners.splice(t,1)},A.prototype.markDirty=function(){null!=this.map&&this.map.markDirty()},A.prototype.onUpdate=function(){this.killed||this.contextLost||(null!=this.map&&(!this.map.srsReady&&this.map.isReferenceFrameReady()&&(this.map.srsReady=!0,this.callListener("map-loaded",{browserOptions:this.map.browserOptions})),this.map.update()),this.callListener("tick",{}),this.requestAnimFrame.call(window,this.onUpdate.bind(this)))},A.prototype.setConfigParams=function(e,t){if("object"==typeof e&&null!==e)for(var i in e)this.setConfigParam(i,e[i],t)},A.prototype.setConfigParam=function(e,t,i){switch(e){case"pos":case"position":case"view":this.getMap()?("view"==e?this.getMap().setView(t):this.getMap().setPosition(new b(t)),this.configStorage[e]&&delete this.configStorage[e]):this.configStorage[e]=t;break;case"map":this.config.map=w.validateString(t,null);break;case"mapVirtualSurfaces":this.config.mapVirtualSurfaces=w.validateBool(t,!0);break;case"mapForcePipeline":this.config.mapForcePipeline=w.validateNumber(t,-1,Number.MAXINTEGER,0);break;case"mapDMapSize":this.config.mapDMapSize=w.validateNumber(t,16,Number.MAXINTEGER,512);break;case"mapDMapMode":this.config.mapDMapMode=w.validateNumber(t,1,Number.MAXINTEGER,1);break;case"map16bitMeshes":this.config.map16bitMeshes=w.validateBool(t,!1);break;case"inspector":this.config.inspector=w.validateBool(t,!0);break;case"authorization":this.config.authorization="string"==typeof t||"function"==typeof t?t:null;break;default:0!=e.indexOf("map")&&"mario"!=e||(i&&void 0!==this.configStorage[e]||(this.configStorage[e]=t),null!=this.getMap()&&this.getMap().setConfigParam(e,t)),0==e.indexOf("renderer")&&(i&&void 0!==this.configStorage[e]||(this.configStorage[e]=t),this.setRendererConfigParam(e,t)),0==e.indexOf("debug")&&(this.configStorage[e]=t,null!=this.getMap()&&this.inspector.setParameter(e,t))}},A.prototype.getConfigParam=function(e){return"map"==e?this.config.map:"inspector"==e?this.config.inspector:0==e.indexOf("map")&&null!=this.getMap()?this.getMap().getConfigParam(e):0==e.indexOf("renderer")?this.getRendererConfigParam(e):void 0},A.prototype.setRendererConfigParam=function(e,t){switch(e){case"rendererAnisotropic":this.config.rendererAnisotropic=w.validateNumber(t,-1,2048,0),this.rederer&&this.rederer.gpu.setAniso(this.config.rendererAnisotropic);break;case"rendererAntialiasing":this.config.rendererAntialiasing=w.validateBool(t,!0);break;case"rendererAllowScreenshots":this.config.rendererAllowScreenshots=w.validateBool(t,!1)}},A.prototype.getRendererConfigParam=function(e){switch(e){case"rendererAnisotropic":return this.config.rendererAnisotropic;case"rendererAntialiasing":return this.config.rendererAntialiasing;case"rendererAllowScreenshots":return this.config.rendererAllowScreenshots}}},function(e,t,i){"use strict";t.a=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))}},function(e,t,i){"use strict";t.a=function(e){return.375*e*(1+.25*e*(1+.46875*e))}},function(e,t,i){"use strict";t.a=function(e){return.05859375*e*e*(1+.75*e)}},function(e,t,i){"use strict";t.a=function(e){return e*e*e*(35/3072)}},function(e,t,i){"use strict";t.a=function(e,t,i,r,s){return e*s-t*Math.sin(2*s)+i*Math.sin(4*s)-r*Math.sin(6*s)}},function(e,t,i){"use strict";var r=i(0);t.a=function(e,t){for(var i,s,a=.5*e,n=r.a-2*Math.atan(t),o=0;o<=15;o++)if(i=e*Math.sin(n),s=r.a-2*Math.atan(t*Math.pow((1-i)/(1+i),a))-n,n+=s,Math.abs(s)<=1e-10)return n;return-9999}},function(e,t,i){"use strict";var r=i(0);t.a=function(e,t,i){var s=e*i,a=.5*e;return s=Math.pow((1-s)/(1+s),a),Math.tan(.5*(r.a-t))/s}},function(e,t,i){"use strict";var r=i(78),s=i(24),a=i(63),n=i(40),o=i(42),h=i(45),l=i(35),u=i(114),c=i(116);r.a.defaultDatum="WGS84",r.a.Proj=s.a,r.a.WGS84=new r.a.Proj("WGS84"),r.a.Point=a.a,r.a.toPoint=n.a,r.a.defs=o.a,r.a.transform=h.a,r.a.mgrs=l.a,r.a.version=u.a,i.i(c.a)(r.a),t.a=r.a},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r={initialized:!1,init:function(){var e=r;e.browser=e.searchString(e.dataBrowser)||"An unknown browser",e.version=e.searchVersion(navigator.userAgent.toLowerCase())||e.searchVersion(navigator.appVersion)||"an unknown version",e.OS=e.searchString(e.dataOS)||"an unknown os: ua: "+navigator.userAgent+" pl: "+navigator.platform,e.mobile="iphone/ipod"==e.OS||"android"==e.OS||"ipad"==e.OS||"windows ce"==e.OS||"windows phone"==e.OS||"kindle"==e.OS,e.mobileAndroid="android"==e.OS,e.initialized=!0},getBrowser:function(){return r.initialized||r.init(),r.browser},getBrowserVersion:function(){return r.initialized||r.init(),r.browser},getOS:function(){return r.initialized||r.init(),r.browser},isMobile:function(){return r.initialized||r.init(),r.mobile},isAndroid:function(){return r.initialized||r.init(),r.mobileAndroid},searchString:function(e){for(var t=r,i=0;i<e.length;i++){var s=e[i].string,a=e[i].prop;if(t.versionSearchString=e[i].versionSearch||e[i].identity,s){if(-1!=s.toLowerCase().indexOf(e[i].subString))return null!=e[i].version&&(t.version=e[i].version),e[i].identity}else if(a)return e[i].identity}},searchVersion:function(e){var t=r;if(null!=t.version)return t.version;var i=e.indexOf(t.versionSearchString);if(-1!=i)return parseFloat(e.substring(i+t.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"chrome",identity:"chrome"},{string:navigator.userAgent,subString:"firefox",identity:"firefox"},{string:navigator.vendor,subString:"apple",identity:"safari",versionSearch:"version"},{prop:window.opera,identity:"opera",versionSearch:"version"},{string:navigator.vendor,subString:"icab",identity:"icab"},{string:navigator.vendor,subString:"kde",identity:"konqueror"},{string:navigator.vendor,subString:"camino",identity:"camino"},{string:navigator.userAgent,subString:"netscape",identity:"netscape"},{string:navigator.userAgent,subString:"msie",identity:"explorer",versionSearch:"msie"},{string:navigator.userAgent,subString:"trident/",identity:"explorer",version:"11"},{string:navigator.userAgent,subString:"edge/",identity:"explorer",version:"12"},{string:navigator.userAgent,subString:"omniweb",versionSearch:"omniweb/",identity:"omniweb"},{string:navigator.userAgent,subString:"silk",versionSearch:"silk/",identity:"silk"},{string:navigator.userAgent,subString:"gecko",identity:"mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"mozilla",identity:"netscape",versionSearch:"mozilla"}],dataOS:[{string:navigator.userAgent,subString:"windows ce",identity:"windows ce"},{string:navigator.userAgent,subString:"windows phone",identity:"windows phone"},{string:navigator.platform,subString:"win",identity:"windows"},{string:navigator.platform,subString:"mac",identity:"mac"},{string:navigator.userAgent,subString:"iphone",identity:"iphone/ipod"},{string:navigator.userAgent,subString:"ipod",identity:"iphone/ipod"},{string:navigator.userAgent,subString:"ipad",identity:"ipad"},{string:navigator.userAgent,subString:"android",identity:"android"},{string:navigator.userAgent,subString:"silk",identity:"kindle"},{string:navigator.userAgent,subString:"blackberry",identity:"blackberry"},{string:navigator.platform,subString:"linux",identity:"linux"}]}},function(e,t,i){var r,s;!function(i){"use strict";var a={};a.Constants={},a.Math={},a.Accumulator={},function(e){e.WGS84={a:6378137,f:1/298.257223563},e.version={major:1,minor:48,patch:0},e.version_string="1.48"}(a.Constants),function(e){e.digits=53,e.epsilon=Math.pow(.5,e.digits-1),e.degree=Math.PI/180,e.sq=function(e){return e*e},e.hypot=function(e,t){var i,r;return e=Math.abs(e),t=Math.abs(t),i=Math.max(e,t),r=Math.min(e,t)/(i||1),i*Math.sqrt(1+r*r)},e.cbrt=function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t},e.log1p=function(e){var t=1+e,i=t-1;return 0===i?e:e*Math.log(t)/i},e.atanh=function(t){var i=Math.abs(t);return i=e.log1p(2*i/(1-i))/2,t<0?-i:i},e.copysign=function(e,t){return Math.abs(e)*(t<0||0===t&&1/t<0?-1:1)},e.sum=function(e,t){var i,r=e+t,s=r-t,a=r-s;return s-=e,a-=t,i=-(s+a),{s:r,t:i}},e.polyval=function(e,t,i,r){for(var s=e<0?0:t[i++];--e>=0;)s=s*r+t[i++];return s},e.AngRound=function(e){if(0===e)return e;var t=1/16,i=Math.abs(e);return i=i<t?t-(t-i):i,e<0?-i:i},e.AngNormalize=function(e){return e%=360,e<=-180?e+360:e<=180?e:e-360},e.LatFix=function(e){return Math.abs(e)>90?Number.NaN:e},e.AngDiff=function(t,i){var r=e.sum(e.AngNormalize(-t),e.AngNormalize(i)),s=e.AngNormalize(r.s),a=r.t;return e.sum(180===s&&a>0?-180:s,a)},e.sincosd=function(e){var t,i,r,s,a,n;switch(t=e%360,i=Math.floor(t/90+.5),t-=90*i,t*=this.degree,r=Math.sin(t),s=Math.cos(t),3&i){case 0:a=r,n=s;break;case 1:a=s,n=-r;break;case 2:a=-r,n=-s;break;default:a=-s,n=r}return e&&(a+=0,n+=0),{s:a,c:n}},e.atan2d=function(e,t){var i,r,s=0;switch(Math.abs(e)>Math.abs(t)&&(i=t,t=e,e=i,s=2),t<0&&(t=-t,++s),r=Math.atan2(e,t)/this.degree,s){case 1:r=(e>=0?180:-180)-r;break;case 2:r=90-r;break;case 3:r=-90+r}return r}}(a.Math),function(e,t){e.Accumulator=function(e){this.Set(e)},e.Accumulator.prototype.Set=function(t){t||(t=0),t.constructor===e.Accumulator?(this._s=t._s,this._t=t._t):(this._s=t,this._t=0)},e.Accumulator.prototype.Add=function(e){var i=t.sum(e,this._t),r=t.sum(i.s,this._s);i=i.t,this._s=r.s,this._t=r.t,0===this._s?this._s=i:this._t+=i},e.Accumulator.prototype.Sum=function(t){var i;return t?(i=new e.Accumulator(this),i.Add(t),i._s):this._s},e.Accumulator.prototype.Negate=function(){this._s*=-1,this._t*=-1}}(a.Accumulator,a.Math),a.Geodesic={},a.GeodesicLine={},a.PolygonArea={},function(e,t,i,r,s){var a,n,o,h,l,u,c,d,p,f,g,m=20+r.digits+10,v=r.epsilon,y=200*v,b=Math.sqrt(v),x=v*y,w=1e3*b;e.tiny_=Math.sqrt(Number.MIN_VALUE),e.nC1_=6,e.nC1p_=6,e.nC2_=6,e.nC3_=6,e.nC4_=6,a=e.nC3_*(e.nC3_-1)/2,n=e.nC4_*(e.nC4_+1)/2,e.CAP_C1=1,e.CAP_C1p=2,e.CAP_C2=4,e.CAP_C3=8,e.CAP_C4=16,e.NONE=0,e.ARC=64,e.LATITUDE=128,e.LONGITUDE=256|e.CAP_C3,e.AZIMUTH=512,e.DISTANCE=1024|e.CAP_C1,e.STANDARD=e.LATITUDE|e.LONGITUDE|e.AZIMUTH|e.DISTANCE,e.DISTANCE_IN=2048|e.CAP_C1|e.CAP_C1p,e.REDUCEDLENGTH=4096|e.CAP_C1|e.CAP_C2,e.GEODESICSCALE=8192|e.CAP_C1|e.CAP_C2,e.AREA=16384|e.CAP_C4,e.ALL=32671,e.LONG_UNROLL=32768,e.OUT_MASK=32640|e.LONG_UNROLL,e.SinCosSeries=function(e,t,i,r){var s=r.length,a=s-(e?1:0),n=2*(i-t)*(i+t),o=1&a?r[--s]:0,h=0;for(a=Math.floor(a/2);a--;)h=n*o-h+r[--s],o=n*h-o+r[--s];return e?2*t*i*o:i*(o-h)},o=function(e,t){var i,s,a,n,o,h,l,u,c,d,p,f,g=r.sq(e),m=r.sq(t),v=(g+m-1)/6;return 0===m&&v<=0?i=0:(s=g*m/4,a=r.sq(v),n=v*a,o=s*(s+2*n),h=v,o>=0?(l=s+n,l+=l<0?-Math.sqrt(o):Math.sqrt(o),u=r.cbrt(l),h+=u+(0!==u?a/u:0)):(c=Math.atan2(Math.sqrt(-o),-(s+n)),h+=2*v*Math.cos(c/3)),d=Math.sqrt(r.sq(h)+m),p=h<0?m/(d-h):h+d,f=(p-m)/(2*d),i=p/(Math.sqrt(p+r.sq(f))+f)),i},h=[1,4,64,0,256],e.A1m1f=function(e){var t=Math.floor(3);return(r.polyval(t,h,0,r.sq(e))/h[t+1]+e)/(1-e)},l=[-1,6,-16,32,-9,64,-128,2048,9,-16,768,3,-5,512,-7,1280,-7,2048],e.C1f=function(t,i){var s,a,n=r.sq(t),o=t,h=0;for(s=1;s<=e.nC1_;++s)a=Math.floor((e.nC1_-s)/2),i[s]=o*r.polyval(a,l,h,n)/l[h+a+1],h+=a+2,o*=t},u=[205,-432,768,1536,4005,-4736,3840,12288,-225,116,384,-7173,2695,7680,3467,7680,38081,61440],e.C1pf=function(t,i){var s,a,n=r.sq(t),o=t,h=0;for(s=1;s<=e.nC1p_;++s)a=Math.floor((e.nC1p_-s)/2),i[s]=o*r.polyval(a,u,h,n)/u[h+a+1],h+=a+2,o*=t},c=[-11,-28,-192,0,256],e.A2m1f=function(e){var t=Math.floor(3);return(r.polyval(t,c,0,r.sq(e))/c[t+1]-e)/(1+e)},d=[1,2,16,32,35,64,384,2048,15,80,768,7,35,512,63,1280,77,2048],e.C2f=function(t,i){var s,a,n=r.sq(t),o=t,h=0;for(s=1;s<=e.nC2_;++s)a=Math.floor((e.nC2_-s)/2),i[s]=o*r.polyval(a,d,h,n)/d[h+a+1],h+=a+2,o*=t},e.Geodesic=function(e,t){if(this.a=e,this.f=t,this._f1=1-this.f,this._e2=this.f*(2-this.f),this._ep2=this._e2/r.sq(this._f1),this._n=this.f/(2-this.f),this._b=this.a*this._f1,this._c2=(r.sq(this.a)+r.sq(this._b)*(0===this._e2?1:(this._e2>0?r.atanh(Math.sqrt(this._e2)):Math.atan(Math.sqrt(-this._e2)))/Math.sqrt(Math.abs(this._e2))))/2,this._etol2=.1*b/Math.sqrt(Math.max(.001,Math.abs(this.f))*Math.min(1,1-this.f/2)/2),!(isFinite(this.a)&&this.a>0))throw new Error("Equatorial radius is not positive");if(!(isFinite(this._b)&&this._b>0))throw new Error("Polar semi-axis is not positive");this._A3x=new Array(6),this._C3x=new Array(a),this._C4x=new Array(n),this.A3coeff(),this.C3coeff(),this.C4coeff()},p=[-3,128,-2,-3,64,-1,-3,-1,16,3,-1,-2,8,1,-1,2,1,1],e.Geodesic.prototype.A3coeff=function(){var e,t,i=0,s=0;for(e=5;e>=0;--e)t=Math.min(6-e-1,e),this._A3x[s++]=r.polyval(t,p,i,this._n)/p[i+t+1],i+=t+2},f=[3,128,2,5,128,-1,3,3,64,-1,0,1,8,-1,1,4,5,256,1,3,128,-3,-2,3,64,1,-3,2,32,7,512,-10,9,384,5,-9,5,192,7,512,-14,7,512,21,2560],e.Geodesic.prototype.C3coeff=function(){var t,i,s,a=0,n=0;for(t=1;t<e.nC3_;++t)for(i=e.nC3_-1;i>=t;--i)s=Math.min(e.nC3_-i-1,i),this._C3x[n++]=r.polyval(s,f,a,this._n)/f[a+s+1],a+=s+2},g=[97,15015,1088,156,45045,-224,-4784,1573,45045,-10656,14144,-4576,-858,45045,64,624,-4576,6864,-3003,15015,100,208,572,3432,-12012,30030,45045,1,9009,-2944,468,135135,5792,1040,-1287,135135,5952,-11648,9152,-2574,135135,-64,-624,4576,-6864,3003,135135,8,10725,1856,-936,225225,-8448,4992,-1144,225225,-1440,4160,-4576,1716,225225,-136,63063,1024,-208,105105,3584,-3328,1144,315315,-128,135135,-2560,832,405405,128,99099],e.Geodesic.prototype.C4coeff=function(){var t,i,s,a=0,n=0;for(t=0;t<e.nC4_;++t)for(i=e.nC4_-1;i>=t;--i)s=e.nC4_-i-1,this._C4x[n++]=r.polyval(s,g,a,this._n)/g[a+s+1],a+=s+2},e.Geodesic.prototype.A3f=function(e){return r.polyval(5,this._A3x,0,e)},e.Geodesic.prototype.C3f=function(t,i){var s,a,n=1,o=0;for(s=1;s<e.nC3_;++s)a=e.nC3_-s-1,n*=t,i[s]=n*r.polyval(a,this._C3x,o,t),o+=a+1},e.Geodesic.prototype.C4f=function(t,i){var s,a,n=1,o=0;for(s=0;s<e.nC4_;++s)a=e.nC4_-s-1,i[s]=n*r.polyval(a,this._C4x,o,t),o+=a+1,n*=t},e.Geodesic.prototype.Lengths=function(t,i,r,s,a,n,o,h,l,u,c,d,p){c&=e.OUT_MASK;var f,g,m,v,y,b={},x=0,w=0,S=0,M=0;if(c&(e.DISTANCE|e.REDUCEDLENGTH|e.GEODESICSCALE)&&(S=e.A1m1f(t),e.C1f(t,d),c&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(M=e.A2m1f(t),e.C2f(t,p),x=S-M,M=1+M),S=1+S),c&e.DISTANCE)f=e.SinCosSeries(!0,n,o,d)-e.SinCosSeries(!0,r,s,d),b.s12b=S*(i+f),c&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(g=e.SinCosSeries(!0,n,o,p)-e.SinCosSeries(!0,r,s,p),w=x*i+(S*f-M*g));else if(c&(e.REDUCEDLENGTH|e.GEODESICSCALE)){for(m=1;m<=e.nC2_;++m)p[m]=S*d[m]-M*p[m];w=x*i+(e.SinCosSeries(!0,n,o,p)-e.SinCosSeries(!0,r,s,p))}return c&e.REDUCEDLENGTH&&(b.m0=x,b.m12b=h*(s*n)-a*(r*o)-s*o*w),c&e.GEODESICSCALE&&(v=s*o+r*n,y=this._ep2*(l-u)*(l+u)/(a+h),b.M12=v+(y*n-o*w)*r/a,b.M21=v-(y*r-s*w)*n/h),b},e.Geodesic.prototype.InverseStart=function(t,i,s,a,n,h,l,u,c,d,p){var f,g,m,v,b,x,S,M,A,C,T,P,F,L,E,k,N,B,I,R,U,D,z,_={},G=a*i-n*t,V=n*i+a*t;return _.sig12=-1,f=a*i,f+=n*t,g=V>=0&&G<.5&&n*l<.5,g?(v=r.sq(t+a),v/=v+r.sq(i+n),_.dnm=Math.sqrt(1+this._ep2*v),m=l/(this._f1*_.dnm),b=Math.sin(m),x=Math.cos(m)):(b=u,x=c),_.salp1=n*b,_.calp1=x>=0?G+n*t*r.sq(b)/(1+x):f-n*t*r.sq(b)/(1-x),M=r.hypot(_.salp1,_.calp1),A=t*a+i*n*x,g&&M<this._etol2?(_.salp2=i*b,_.calp2=G-i*a*(x>=0?r.sq(b)/(1+x):1-x),S=r.hypot(_.salp2,_.calp2),_.salp2/=S,_.calp2/=S,_.sig12=Math.atan2(M,A)):Math.abs(this._n)>.1||A>=0||M>=6*Math.abs(this._n)*Math.PI*r.sq(i)||(z=Math.atan2(-u,-c),this.f>=0?(L=r.sq(t)*this._ep2,E=L/(2*(1+Math.sqrt(1+L))+L),P=this.f*i*this.A3f(E)*Math.PI,F=P*i,C=z/P,T=f/F):(k=n*i-a*t,N=Math.atan2(f,k),R=this.Lengths(this._n,Math.PI+N,t,-i,s,a,n,h,i,n,e.REDUCEDLENGTH,d,p),B=R.m12b,I=R.m0,C=B/(i*n*I*Math.PI)-1,F=C<-.01?f/C:-this.f*r.sq(i)*Math.PI,P=F/i,T=l/P),T>-y&&C>-1-w?this.f>=0?(_.salp1=Math.min(1,-C),_.calp1=-Math.sqrt(1-r.sq(_.salp1))):(_.calp1=Math.max(C>-y?0:-1,C),_.salp1=Math.sqrt(1-r.sq(_.calp1))):(U=o(C,T),D=P*(this.f>=0?-C*U/(1+U):-T*(1+U)/U),b=Math.sin(D),x=-Math.cos(D),_.salp1=n*b,_.calp1=f-n*t*r.sq(b)/(1-x))),_.salp1<=0?(_.salp1=1,_.calp1=0):(S=r.hypot(_.salp1,_.calp1),_.salp1/=S,_.calp1/=S),_},e.Geodesic.prototype.Lambda12=function(t,i,s,a,n,o,h,l,u,c,d,p,f,g){var m,v,y,b,x,w,S,M,A,C,T,P,F,L={};return 0===t&&0===l&&(l=-e.tiny_),v=h*i,y=r.hypot(l,h*t),L.ssig1=t,b=v*t,L.csig1=x=l*i,m=r.hypot(L.ssig1,L.csig1),L.ssig1/=m,L.csig1/=m,L.salp2=n!==i?v/n:h,L.calp2=n!==i||Math.abs(a)!==-t?Math.sqrt(r.sq(l*i)+(i<-t?(n-i)*(i+n):(t-a)*(t+a)))/n:Math.abs(l),L.ssig2=a,w=v*a,L.csig2=S=L.calp2*n,m=r.hypot(L.ssig2,L.csig2),L.ssig2/=m,L.csig2/=m,L.sig12=Math.atan2(Math.max(0,L.csig1*L.ssig2-L.ssig1*L.csig2),L.csig1*L.csig2+L.ssig1*L.ssig2),M=Math.max(0,x*w-b*S),A=x*S+b*w,T=Math.atan2(M*c-A*u,A*c+M*u),P=r.sq(y)*this._ep2,L.eps=P/(2*(1+Math.sqrt(1+P))+P),this.C3f(L.eps,g),C=e.SinCosSeries(!0,L.ssig2,L.csig2,g)-e.SinCosSeries(!0,L.ssig1,L.csig1,g),L.domg12=-this.f*this.A3f(L.eps)*v*(L.sig12+C),L.lam12=T+L.domg12,d&&(0===L.calp2?L.dlam12=-2*this._f1*s/t:(F=this.Lengths(L.eps,L.sig12,L.ssig1,L.csig1,s,L.ssig2,L.csig2,o,i,n,e.REDUCEDLENGTH,p,f),L.dlam12=F.m12b,L.dlam12*=this._f1/(L.calp2*n))),L},e.Geodesic.prototype.Inverse=function(t,i,s,a,n){var o,h;return n||(n=e.STANDARD),n===e.LONG_UNROLL&&(n|=e.STANDARD),n&=e.OUT_MASK,o=this.InverseInt(t,i,s,a,n),h=o.vals,n&e.AZIMUTH&&(h.azi1=r.atan2d(o.salp1,o.calp1),h.azi2=r.atan2d(o.salp2,o.calp2)),h},e.Geodesic.prototype.InverseInt=function(t,i,s,a,n){var o,h,l,u,c,d,p,f,g,y,b,w,S,M,A,C,T,P,F,L,E,k,N,B,I,R,U,D,z,_,G,V,O,j,H,Y,q,J,Z,X,W,Q,K,$,ee,te,ie,re,se,ae,ne,oe,he,le,ue,ce,de,pe,fe,ge,me,ve,ye,be,xe,we={};if(we.lat1=t=r.LatFix(t),we.lat2=s=r.LatFix(s),t=r.AngRound(t),s=r.AngRound(s),o=r.AngDiff(i,a),h=o.t,o=o.s,n&e.LONG_UNROLL?(we.lon1=i,we.lon2=i+o+h):(we.lon1=r.AngNormalize(i),we.lon2=r.AngNormalize(a)),l=o>=0?1:-1,o=l*r.AngRound(o),h=r.AngRound(180-o-l*h),A=o*r.degree,u=r.sincosd(o>90?h:o),C=u.s,T=(o>90?-1:1)*u.c,c=Math.abs(t)<Math.abs(s)?-1:1,c<0&&(l*=-1,u=t,t=s,s=u),d=t<0?1:-1,t*=d,s*=d,u=r.sincosd(t),p=this._f1*u.s,f=u.c,u=r.hypot(p,f),p/=u,f/=u,f=Math.max(e.tiny_,f),u=r.sincosd(s),g=this._f1*u.s,y=u.c,u=r.hypot(g,y),g/=u,y/=u,y=Math.max(e.tiny_,y),f<-p?y===f&&(g=g<0?p:-p):Math.abs(g)===-p&&(y=f),S=Math.sqrt(1+this._ep2*r.sq(p)),M=Math.sqrt(1+this._ep2*r.sq(g)),N=new Array(e.nC1_+1),B=new Array(e.nC2_+1),I=new Array(e.nC3_),R=-90===t||0===C,R&&(F=T,L=C,E=1,k=0,D=p,z=F*f,_=g,G=E*y,P=Math.atan2(Math.max(0,z*_-D*G),z*G+D*_),U=this.Lengths(this._n,P,D,z,S,_,G,M,f,y,n|e.DISTANCE|e.REDUCEDLENGTH,N,B),b=U.s12b,w=U.m12b,0!=(n&e.GEODESICSCALE)&&(we.M12=U.M12,we.M21=U.M21),P<1||w>=0?(P<3*e.tiny_&&(P=w=b=0),w*=this._b,b*=this._b,we.a12=P/r.degree):R=!1),de=2,!R&&0===p&&(this.f<=0||h>=180*this.f))F=E=0,L=k=1,b=this.a*A,P=O=A/this._f1,w=this._b*Math.sin(P),n&e.GEODESICSCALE&&(we.M12=we.M21=Math.cos(P)),we.a12=o/this._f1;else if(!R)if(U=this.InverseStart(p,f,S,g,y,M,A,C,T,N,B),P=U.sig12,L=U.salp1,F=U.calp1,P>=0)k=U.salp2,E=U.calp2,j=U.dnm,b=P*this._b*j,w=r.sq(j)*this._b*Math.sin(P/j),n&e.GEODESICSCALE&&(we.M12=we.M21=Math.cos(P/j)),we.a12=P/r.degree,O=A/(this._f1*j);else{for(H=0,Y=e.tiny_,q=1,J=e.tiny_,Z=-1,X=!1,W=!1;H<m&&(U=this.Lambda12(p,f,S,g,y,M,L,F,C,T,H<20,N,B,I),Q=U.lam12,k=U.salp2,E=U.calp2,P=U.sig12,D=U.ssig1,z=U.csig1,_=U.ssig2,G=U.csig2,V=U.eps,fe=U.domg12,K=U.dlam12,!W&&Math.abs(Q)>=(X?8:1)*v);++H)Q>0&&(H<20||F/L>Z/J)?(J=L,Z=F):Q<0&&(H<20||F/L<q/Y)&&(Y=L,q=F),H<20&&K>0&&($=-Q/K,ee=Math.sin($),te=Math.cos($),(ie=L*te+F*ee)>0&&Math.abs($)<Math.PI)?(F=F*te-L*ee,L=ie,u=r.hypot(L,F),L/=u,F/=u,X=Math.abs(Q)<=16*v):(L=(Y+J)/2,F=(q+Z)/2,u=r.hypot(L,F),L/=u,F/=u,X=!1,W=Math.abs(Y-L)+(q-F)<x||Math.abs(L-J)+(F-Z)<x);re=n|(n&(e.REDUCEDLENGTH|e.GEODESICSCALE)?e.DISTANCE:e.NONE),U=this.Lengths(V,P,D,z,S,_,G,M,f,y,re,N,B),b=U.s12b,w=U.m12b,0!=(n&e.GEODESICSCALE)&&(we.M12=U.M12,we.M21=U.M21),w*=this._b,b*=this._b,we.a12=P/r.degree,n&e.AREA&&(be=Math.sin(fe),xe=Math.cos(fe),de=C*xe-T*be,pe=T*xe+C*be)}return n&e.DISTANCE&&(we.s12=0+b),n&e.REDUCEDLENGTH&&(we.m12=0+w),n&e.AREA&&(se=L*f,ae=r.hypot(F,L*p),0!==ae&&0!==se?(D=p,z=F*f,_=g,G=E*y,oe=r.sq(ae)*this._ep2,V=oe/(2*(1+Math.sqrt(1+oe))+oe),he=r.sq(this.a)*ae*se*this._e2,u=r.hypot(D,z),D/=u,z/=u,u=r.hypot(_,G),_/=u,G/=u,le=new Array(e.nC4_),this.C4f(V,le),ue=e.SinCosSeries(!1,D,z,le),ce=e.SinCosSeries(!1,_,G,le),we.S12=he*(ce-ue)):we.S12=0,!R&&de>1&&(de=Math.sin(O),pe=Math.cos(O)),!R&&pe>-.7071&&g-p<1.75?(fe=1+pe,ge=1+f,me=1+y,ne=2*Math.atan2(de*(p*me+g*ge),fe*(p*g+ge*me))):(ve=k*F-E*L,ye=E*F+k*L,0===ve&&ye<0&&(ve=e.tiny_*F,ye=-1),ne=Math.atan2(ve,ye)),we.S12+=this._c2*ne,we.S12*=c*l*d,we.S12+=0),c<0&&(u=L,L=k,k=u,u=F,F=E,E=u,n&e.GEODESICSCALE&&(u=we.M12,we.M12=we.M21,we.M21=u)),L*=c*l,F*=c*d,k*=c*l,E*=c*d,{vals:we,salp1:L,calp1:F,salp2:k,calp2:E}},e.Geodesic.prototype.GenDirect=function(i,r,s,a,n,o){var h;return o?o===e.LONG_UNROLL&&(o|=e.STANDARD):o=e.STANDARD,a||(o|=e.DISTANCE_IN),h=new t.GeodesicLine(this,i,r,s,o),h.GenPosition(a,n,o)},e.Geodesic.prototype.Direct=function(e,t,i,r,s){return this.GenDirect(e,t,i,!1,r,s)},e.Geodesic.prototype.ArcDirect=function(e,t,i,r,s){return this.GenDirect(e,t,i,!0,r,s)},e.Geodesic.prototype.Line=function(e,i,r,s){return new t.GeodesicLine(this,e,i,r,s)},e.Geodesic.prototype.DirectLine=function(e,t,i,r,s){return this.GenDirectLine(e,t,i,!1,r,s)},e.Geodesic.prototype.ArcDirectLine=function(e,t,i,r,s){return this.GenDirectLine(e,t,i,!0,r,s)},e.Geodesic.prototype.GenDirectLine=function(i,r,s,a,n,o){var h;return o||(o=e.STANDARD|e.DISTANCE_IN),a||(o|=e.DISTANCE_IN),h=new t.GeodesicLine(this,i,r,s,o),h.GenSetDistance(a,n),h},e.Geodesic.prototype.InverseLine=function(i,s,a,n,o){var h,l,u;return o||(o=e.STANDARD|e.DISTANCE_IN),h=this.InverseInt(i,s,a,n,e.ARC),u=r.atan2d(h.salp1,h.calp1),o&e.OUT_MASK&e.DISTANCE_IN&&(o|=e.DISTANCE),l=new t.GeodesicLine(this,i,s,u,o,h.salp1,h.calp1),l.SetArc(h.vals.a12),l},e.Geodesic.prototype.Polygon=function(e){return new i.PolygonArea(this,e)},e.WGS84=new e.Geodesic(s.WGS84.a,s.WGS84.f)}(a.Geodesic,a.GeodesicLine,a.PolygonArea,a.Math,a.Constants),function(e,t,i){t.GeodesicLine=function(t,r,s,a,n,o,h){var l,u,c,d,p,f;n||(n=e.STANDARD|e.DISTANCE_IN),this.a=t.a,this.f=t.f,this._b=t._b,this._c2=t._c2,this._f1=t._f1,this.caps=n|e.LATITUDE|e.AZIMUTH|e.LONG_UNROLL,this.lat1=i.LatFix(r),this.lon1=s,void 0===o||void 0===h?(this.azi1=i.AngNormalize(a),l=i.sincosd(i.AngRound(this.azi1)),this.salp1=l.s,this.calp1=l.c):(this.azi1=a,this.salp1=o,this.calp1=h),l=i.sincosd(i.AngRound(this.lat1)),c=this._f1*l.s,u=l.c,l=i.hypot(c,u),c/=l,u/=l,u=Math.max(e.tiny_,u),this._dn1=Math.sqrt(1+t._ep2*i.sq(c)),this._salp0=this.salp1*u,this._calp0=i.hypot(this.calp1,this.salp1*c),this._ssig1=c,this._somg1=this._salp0*c,this._csig1=this._comg1=0!==c||0!==this.calp1?u*this.calp1:1,l=i.hypot(this._ssig1,this._csig1),this._ssig1/=l,this._csig1/=l,this._k2=i.sq(this._calp0)*t._ep2,d=this._k2/(2*(1+Math.sqrt(1+this._k2))+this._k2),this.caps&e.CAP_C1&&(this._A1m1=e.A1m1f(d),this._C1a=new Array(e.nC1_+1),e.C1f(d,this._C1a),this._B11=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C1a),p=Math.sin(this._B11),f=Math.cos(this._B11),this._stau1=this._ssig1*f+this._csig1*p,this._ctau1=this._csig1*f-this._ssig1*p),this.caps&e.CAP_C1p&&(this._C1pa=new Array(e.nC1p_+1),e.C1pf(d,this._C1pa)),this.caps&e.CAP_C2&&(this._A2m1=e.A2m1f(d),this._C2a=new Array(e.nC2_+1),e.C2f(d,this._C2a),this._B21=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C2a)),this.caps&e.CAP_C3&&(this._C3a=new Array(e.nC3_),t.C3f(d,this._C3a),this._A3c=-this.f*this._salp0*t.A3f(d),this._B31=e.SinCosSeries(!0,this._ssig1,this._csig1,this._C3a)),this.caps&e.CAP_C4&&(this._C4a=new Array(e.nC4_),t.C4f(d,this._C4a),this._A4=i.sq(this.a)*this._calp0*this._salp0*t._e2,this._B41=e.SinCosSeries(!1,this._ssig1,this._csig1,this._C4a)),this.a13=this.s13=Number.NaN},t.GeodesicLine.prototype.GenPosition=function(t,r,s){var a,n,o,h,l,u,c,d,p,f,g,m,v,y,b,x,w,S,M,A,C,T,P,F,L,E,k,N,B,I={};return s?s===e.LONG_UNROLL&&(s|=e.STANDARD):s=e.STANDARD,s&=this.caps&e.OUT_MASK,I.lat1=this.lat1,I.azi1=this.azi1,I.lon1=s&e.LONG_UNROLL?this.lon1:i.AngNormalize(this.lon1),t?I.a12=r:I.s12=r,t||this.caps&e.DISTANCE_IN&e.OUT_MASK?(h=0,l=0,t?(a=r*i.degree,E=i.sincosd(r),n=E.s,o=E.c):(d=r/(this._b*(1+this._A1m1)),p=Math.sin(d),f=Math.cos(d),h=-e.SinCosSeries(!0,this._stau1*f+this._ctau1*p,this._ctau1*f-this._stau1*p,this._C1pa),a=d-(h-this._B11),n=Math.sin(a),o=Math.cos(a),Math.abs(this.f)>.01&&(u=this._ssig1*o+this._csig1*n,c=this._csig1*o-this._ssig1*n,h=e.SinCosSeries(!0,u,c,this._C1a),g=(1+this._A1m1)*(a+(h-this._B11))-r/this._b,a-=g/Math.sqrt(1+this._k2*i.sq(u)),n=Math.sin(a),o=Math.cos(a))),u=this._ssig1*o+this._csig1*n,c=this._csig1*o-this._ssig1*n,T=Math.sqrt(1+this._k2*i.sq(u)),s&(e.DISTANCE|e.REDUCEDLENGTH|e.GEODESICSCALE)&&((t||Math.abs(this.f)>.01)&&(h=e.SinCosSeries(!0,u,c,this._C1a)),l=(1+this._A1m1)*(h-this._B11)),x=this._calp0*u,w=i.hypot(this._salp0,this._calp0*c),0===w&&(w=c=e.tiny_),A=this._salp0,C=this._calp0*c,t&&s&e.DISTANCE&&(I.s12=this._b*((1+this._A1m1)*a+l)),s&e.LONGITUDE&&(S=this._salp0*u,M=c,b=i.copysign(1,this._salp0),m=s&e.LONG_UNROLL?b*(a-(Math.atan2(u,c)-Math.atan2(this._ssig1,this._csig1))+(Math.atan2(b*S,M)-Math.atan2(b*this._somg1,this._comg1))):Math.atan2(S*this._comg1-M*this._somg1,M*this._comg1+S*this._somg1),v=m+this._A3c*(a+(e.SinCosSeries(!0,u,c,this._C3a)-this._B31)),y=v/i.degree,I.lon2=s&e.LONG_UNROLL?this.lon1+y:i.AngNormalize(i.AngNormalize(this.lon1)+i.AngNormalize(y))),s&e.LATITUDE&&(I.lat2=i.atan2d(x,this._f1*w)),s&e.AZIMUTH&&(I.azi2=i.atan2d(A,C)),s&(e.REDUCEDLENGTH|e.GEODESICSCALE)&&(P=e.SinCosSeries(!0,u,c,this._C2a),F=(1+this._A2m1)*(P-this._B21),L=(this._A1m1-this._A2m1)*a+(l-F),s&e.REDUCEDLENGTH&&(I.m12=this._b*(T*(this._csig1*u)-this._dn1*(this._ssig1*c)-this._csig1*c*L)),s&e.GEODESICSCALE&&(E=this._k2*(u-this._ssig1)*(u+this._ssig1)/(this._dn1+T),I.M12=o+(E*u-c*L)*this._ssig1/this._dn1,I.M21=o-(E*this._ssig1-this._csig1*L)*u/T)),s&e.AREA&&(k=e.SinCosSeries(!1,u,c,this._C4a),0===this._calp0||0===this._salp0?(N=A*this.calp1-C*this.salp1,B=C*this.calp1+A*this.salp1):(N=this._calp0*this._salp0*(o<=0?this._csig1*(1-o)+n*this._ssig1:n*(this._csig1*n/(1+o)+this._ssig1)),B=i.sq(this._salp0)+i.sq(this._calp0)*this._csig1*c),I.S12=this._c2*Math.atan2(N,B)+this._A4*(k-this._B41)),t||(I.a12=a/i.degree),I):(I.a12=Number.NaN,I)},t.GeodesicLine.prototype.Position=function(e,t){return this.GenPosition(!1,e,t)},t.GeodesicLine.prototype.ArcPosition=function(e,t){return this.GenPosition(!0,e,t)},t.GeodesicLine.prototype.GenSetDistance=function(e,t){e?this.SetArc(t):this.SetDistance(t)},t.GeodesicLine.prototype.SetDistance=function(t){var i;this.s13=t,i=this.GenPosition(!1,this.s13,e.ARC),this.a13=0+i.a12},t.GeodesicLine.prototype.SetArc=function(t){var i;this.a13=t,i=this.GenPosition(!0,this.a13,e.DISTANCE),this.s13=0+i.s12}}(a.Geodesic,a.GeodesicLine,a.Math),function(e,t,i,r){var s,a;s=function(e,t){var r;return e=i.AngNormalize(e),t=i.AngNormalize(t),r=i.AngDiff(e,t).s,e<=0&&t>0&&r>0?1:t<=0&&e>0&&r<0?-1:0},a=function(e,t){return e%=720,t%=720,(t>=0&&t<360||t<-360?0:1)-(e>=0&&e<360||e<-360?0:1)},e.PolygonArea=function(e,i){this._geod=e,this.a=this._geod.a,this.f=this._geod.f,this._area0=4*Math.PI*e._c2,this.polyline=i||!1,this._mask=t.LATITUDE|t.LONGITUDE|t.DISTANCE|(this.polyline?t.NONE:t.AREA|t.LONG_UNROLL),this.polyline||(this._areasum=new r.Accumulator(0)),this._perimetersum=new r.Accumulator(0),this.Clear()},e.PolygonArea.prototype.Clear=function(){this.num=0,this._crossings=0,this.polyline||this._areasum.Set(0),this._perimetersum.Set(0),this._lat0=this._lon0=this.lat=this.lon=Number.NaN},e.PolygonArea.prototype.AddPoint=function(e,t){var i;0===this.num?(this._lat0=this.lat=e,this._lon0=this.lon=t):(i=this._geod.Inverse(this.lat,this.lon,e,t,this._mask),this._perimetersum.Add(i.s12),this.polyline||(this._areasum.Add(i.S12),this._crossings+=s(this.lon,t)),this.lat=e,this.lon=t),++this.num},e.PolygonArea.prototype.AddEdge=function(e,t){var i;this.num&&(i=this._geod.Direct(this.lat,this.lon,e,t,this._mask),this._perimetersum.Add(t),this.polyline||(this._areasum.Add(i.S12),this._crossings+=a(this.lon,i.lon2)),this.lat=i.lat2,this.lon=i.lon2),++this.num},e.PolygonArea.prototype.Compute=function(e,t){var i,a,n,o={number:this.num};return this.num<2?(o.perimeter=0,this.polyline||(o.area=0),o):this.polyline?(o.perimeter=this._perimetersum.Sum(),o):(i=this._geod.Inverse(this.lat,this.lon,this._lat0,this._lon0,this._mask),o.perimeter=this._perimetersum.Sum(i.s12),a=new r.Accumulator(this._areasum),a.Add(i.S12),n=this._crossings+s(this.lon,this._lon0),1&n&&a.Add((a.Sum()<0?1:-1)*this._area0/2),e||a.Negate(),t?a.Sum()>this._area0/2?a.Add(-this._area0):a.Sum()<=-this._area0/2&&a.Add(+this._area0):a.Sum()>=this._area0?a.Add(-this._area0):a<0&&a.Add(-this._area0),o.area=a.Sum(),o)},e.PolygonArea.prototype.TestPoint=function(e,t,i,r){var a,n,o,h,l={number:this.num+1};if(0===this.num)return l.perimeter=0,this.polyline||(l.area=0),l;for(l.perimeter=this._perimetersum.Sum(),n=this.polyline?0:this._areasum.Sum(),o=this._crossings,h=0;h<(this.polyline?1:2);++h)a=this._geod.Inverse(0===h?this.lat:e,0===h?this.lon:t,0!==h?this._lat0:e,0!==h?this._lon0:t,this._mask),l.perimeter+=a.s12,this.polyline||(n+=a.S12,o+=s(0===h?this.lon:t,0!==h?this._lon0:t));return this.polyline?l:(1&o&&(n+=(n<0?1:-1)*this._area0/2),i||(n*=-1),r?n>this._area0/2?n-=this._area0:n<=-this._area0/2&&(n+=this._area0):n>=this._area0?n-=this._area0:n<0&&(n+=this._area0),l.area=n,l)},e.PolygonArea.prototype.TestEdge=function(e,t,i,r){var n,o,h,l={number:this.num?this.num+1:0};return 0===this.num?l:(l.perimeter=this._perimetersum.Sum()+t,this.polyline?l:(o=this._areasum.Sum(),h=this._crossings,n=this._geod.Direct(this.lat,this.lon,e,t,this._mask),o+=n.S12,h+=a(this.lon,n.lon2),n=this._geod.Inverse(n.lat2,n.lon2,this._lat0,this._lon0,this._mask),l.perimeter+=n.s12,o+=n.S12,h+=s(n.lon2,this._lon0),1&h&&(o+=(o<0?1:-1)*this._area0/2),i||(o*=-1),r?o>this._area0/2?o-=this._area0:o<=-this._area0/2&&(o+=this._area0):o>=this._area0?o-=this._area0:o<0&&(o+=this._area0),l.area=o,l))}}(a.PolygonArea,a.Geodesic,a.Math,a.Accumulator),a.DMS={},function(e){var t,i,r,s,a="SNWE",n="'\"",o=["degrees","minutes","seconds"];t=function(e,t){return e.indexOf(t.toUpperCase())},i=function(e,t){return String("0000").substr(0,Math.max(0,Math.min(4,t-e.length)))+e},e.NONE=0,e.LATITUDE=1,e.LONGITUDE=2,e.AZIMUTH=3,e.DEGREE=0,e.MINUTE=1,e.SECOND=2,e.Decode=function(i){var s,n,o,h,l,u,c,d,p=i,f=0,g=0,m=e.NONE;for(p=p.replace(/\u00b0/g,"d").replace(/\u00ba/g,"d").replace(/\u2070/g,"d").replace(/\u02da/g,"d").replace(/\u2032/g,"'").replace(/\u00b4/g,"'").replace(/\u2019/g,"'").replace(/\u2033/g,'"').replace(/\u201d/g,'"').replace(/\u2212/g,"-").replace(/''/g,'"').trim(),s=p.length,u=0;u<s;u=d,++g)if(c=u,0===g&&t(a,p.charAt(c))>=0&&++c,(g>0||c<s&&t("-+",p.charAt(c))>=0)&&++c,n=p.substr(c,s-c).indexOf("-"),o=p.substr(c,s-c).indexOf("+"),n<0?n=s:n+=c,o<0?o=s:o+=c,d=Math.min(n,o),h=r(p.substr(u,d-u)),f+=h.val,l=h.ind,m==e.NONE)m=l;else if(l!=e.NONE&&m!=l)throw new Error("Incompatible hemisphere specifies in "+p.substr(0,d));if(0===g)throw new Error("Empty or incomplete DMS string "+p);return{val:f,ind:m}},r=function(i){var r,n,h,l,u,c,d,p,f,g,m,v,y,b,x,w,S={},M="";do{if(r=1,n=0,h=i.length,l=e.NONE,u=-1,h>n&&(u=t(a,i.charAt(n)))>=0&&(l=2&u?e.LONGITUDE:e.LATITUDE,r=1&u?1:-1,++n),h>n&&(u=t(a,i.charAt(h-1)))>=0&&u>=0){if(l!==e.NONE){M=i.charAt(n-1).toUpperCase()===i.charAt(h-1).toUpperCase()?"Repeated hemisphere indicators "+i.charAt(n-1)+" in "+i.substr(n-1,h-n+1):"Contradictory hemisphere indicators "+i.charAt(n-1)+" and "+i.charAt(h-1)+" in "+i.substr(n-1,h-n+1);break}l=2&u?e.LONGITUDE:e.LATITUDE,r=1&u?1:-1,--h}if(h>n&&(u=t("-+",i.charAt(n)))>=0&&u>=0&&(r*=u?1:-1,++n),h===n){M="Empty or incomplete DMS string "+i;break}for(c=[0,0,0],d=[0,0,0],p=0,f=0,g=0,m=0,v=n,y=!1,b=0,x=0;v<h;)if(w=i.charAt(v++),(u=t("0123456789",w))>=0)++m,b>0?++b:(f=10*f+u,++x);else if("."===w){if(y){M="Multiple decimal points in "+i.substr(n,h-n);break}y=!0,b=1}else{if(!((u=t("D'\":",w))>=0)){if(t("-+",w)>=0){M="Internal sign in DMS string "+i.substr(n,h-n);break}M="Illegal character "+w+" in DMS string "+i.substr(n,h-n);break}if(u>=3){if(v===h){M="Illegal for colon to appear at the end of "+i.substr(n,h-n);break}u=p}if(u===p-1){M="Repeated "+o[u]+" component in "+i.substr(n,h-n);break}if(u<p){M=o[u]+" component follows "+o[p-1]+" component in "+i.substr(n,h-n);break}if(0===m){M="Missing numbers in "+o[u]+" component of "+i.substr(n,h-n);break}b>0&&(g=parseFloat(i.substr(v-x-b-1,x+b)),f=0),c[u]=f,d[u]=f+g,v<h&&(p=u+1,f=g=0,m=b=x=0)}if(M.length)break;if(t("D'\":",i.charAt(v-1))<0){if(p>=3){M="Extra text following seconds in DMS string "+i.substr(n,h-n);break}if(0===m){M="Missing numbers in trailing component of "+i.substr(n,h-n);break}b>0&&(g=parseFloat(i.substr(v-x-b,x+b)),f=0),c[p]=f,d[p]=f+g}if(y&&0===b){M="Decimal point in non-terminal component of "+i.substr(n,h-n);break}if(c[1]>=60||d[1]>60){M="Minutes "+d[1]+" not in range [0,60)";break}if(c[2]>=60||d[2]>60){M="Seconds "+d[2]+" not in range [0,60)";break}return S.ind=l,S.val=r*(d[2]?(60*(60*d[0]+d[1])+d[2])/3600:d[1]?(60*d[0]+d[1])/60:d[0]),S}while(!1);if(S.val=s(i),0===S.val)throw new Error(M);return S.ind=e.NONE,S},s=function(e){var t,i,r,s;return e.length<3?0:(t=e.toUpperCase().replace(/0+$/,""),i="-"===t.charAt(0)?-1:1,r="-"===t.charAt(0)||"+"===t.charAt(0)?1:0,(s=t.length-1)+1<r+3?0:(t=t.substr(r,s+1-r),"NAN"===t||"1.#QNAN"===t||"1.#SNAN"===t||"1.#IND"===t||"1.#R"===t?Number.NaN:"INF"===t||"1.#INF"===t?i*Number.POSITIVE_INFINITY:0))},e.DecodeLatLon=function(t,i,r){var s,a,n={},o=e.Decode(t),h=e.Decode(i),l=o.val,u=o.ind,c=h.val,d=h.ind;if(r||(r=!1),u===e.NONE&&d===e.NONE?(u=r?e.LONGITUDE:e.LATITUDE,d=r?e.LATITUDE:e.LONGITUDE):u===e.NONE?u=e.LATITUDE+e.LONGITUDE-d:d===e.NONE&&(d=e.LATITUDE+e.LONGITUDE-u),u===d)throw new Error("Both "+t+" and "+i+" interpreted as "+(u===e.LATITUDE?"latitudes":"longitudes"));if(s=u===e.LATITUDE?l:c,a=u===e.LATITUDE?c:l,Math.abs(s)>90)throw new Error("Latitude "+s+" not in [-90,90]");return n.lat=s,n.lon=a,n},e.DecodeAngle=function(t){var i=e.Decode(t),r=i.val;if(i.ind!==e.NONE)throw new Error("Arc angle "+t+" includes a hemisphere N/E/W/S");return r},e.DecodeAzimuth=function(t){var i=e.Decode(t),r=i.val;if(i.ind===e.LATITUDE)throw new Error("Azimuth "+t+" has a latitude hemisphere N/S");return r},e.Encode=function(t,r,s,o){var h,l,u,c,d,p,f,g,m,v=1;if(o||(o=e.NONE),!isFinite(t))return t<0?String("-inf"):t>0?String("inf"):String("nan");for(s=Math.min(15-2*r,s),h=0;h<r;++h)v*=60;for(h=0;h<s;++h)v*=10;for(o===e.AZIMUTH&&(t-=360*Math.floor(t/360)),l=t<0?-1:1,t*=l,u=Math.floor(t),c=(t-u)*v+.5,d=Math.floor(c),c=d==c&&1&d?d-1:d,c/=v,c=Math.floor((t-u)*v+.5)/v,c>=1&&(u+=1,c-=1),p=[c,0,0],h=1;h<=r;++h)f=Math.floor(p[h-1]),g=p[h-1]-f,p[h]=60*g,p[h-1]=f;switch(p[0]+=u,m="",o===e.NONE&&l<0&&(m+="-"),r){case e.DEGREE:m+=i(p[0].toFixed(s),o===e.NONE?0:1+Math.min(o,2)+s+(s?1:0))+n.charAt(0);break;default:switch(m+=i(p[0].toFixed(0),o===e.NONE?0:1+Math.min(o,2))+n.charAt(0),r){case e.MINUTE:m+=i(p[1].toFixed(s),2+s+(s?1:0))+n.charAt(1);break;case e.SECOND:m+=i(p[1].toFixed(0),2)+n.charAt(1),m+=i(p[2].toFixed(s),2+s+(s?1:0))+n.charAt(2)}}return o!==e.NONE&&o!==e.AZIMUTH&&(m+=a.charAt((o===e.LATITUDE?0:2)+(l<0?0:1))),m}}(a.DMS),function(i){"object"==typeof e&&e.exports?e.exports=i:(r=[],void 0!==(s=function(){return i}.apply(t,r))&&(e.exports=s))}(a)}()},function(e,t,i){"use strict";function r(e,t){if(!(this instanceof r))return new r(e);t=t||function(e){if(e)throw e};var n=i.i(s.a)(e);if("object"!=typeof n)return void t(e);var c=r.projections.get(n.projName);if(!c)return void t(e);if(n.datumCode&&"none"!==n.datumCode){var d=i.i(u.a)(h.a,n.datumCode);d&&(n.datum_params=d.towgs84?d.towgs84.split(","):null,n.ellps=d.ellipse,n.datumName=d.datumName?d.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84";var p=i.i(o.a)(n.a,n.b,n.rf,n.ellps,n.sphere),f=i.i(o.b)(p.a,p.b,p.rf,n.R_A),g=n.datum||i.i(l.a)(n.datumCode,n.datum_params,p.a,p.b,f.es,f.ep2);i.i(a.a)(this,n),i.i(a.a)(this,c),this.a=p.a,this.b=p.b,this.rf=p.rf,this.sphere=p.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=g,this.init(),t(null,this)}var s=i(84),a=i(82),n=i(85),o=i(81),h=i(74),l=i(79),u=i(29);r.projections=n.a,r.projections.start(),t.a=r},function(e,t,i){"use strict";t.a=function(e,t,i){var r=t*i;return e/Math.sqrt(1-r*r)}},function(e,t,i){"use strict";t.a=function(e,t,i,r,s){var a,n;a=e/t;for(var o=0;o<15;o++)if(n=(e-(t*a-i*Math.sin(2*a)+r*Math.sin(4*a)-s*Math.sin(6*a)))/(t-2*i*Math.cos(2*a)+4*r*Math.cos(4*a)-6*s*Math.cos(6*a)),a+=n,Math.abs(n)<=1e-10)return a;return NaN}},function(e,t,i){"use strict";t.a=function(e,t,i,r){return i*=t,t*=t,r[0]*e-i*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))}},function(e,t,i){"use strict";t.a=function(e,t){var i;return e>1e-7?(i=e*t,(1-e*e)*(t/(1-i*i)-.5/e*Math.log((1-i)/(1+i)))):2*t}},function(e,t,i){"use strict";function r(e,t){if(e[t])return e[t];for(var i,r=Object.keys(e),a=t.toLowerCase().replace(s,""),n=-1;++n<r.length;)if(i=r[n],i.toLowerCase().replace(s,"")===a)return e[i]}t.a=r;var s=/[\s_\-\/\(\)]/g},function(e,t,i){"use strict";var r=i(2),s=r.a,a=function(e,t){this.map=e,this.id=t.id||null,this.notice=t.notice||null,this.copyrighted=t.copyrighted||!0,this.url=t.url||null,this.html=s.simpleWikiLinks(this.notice),this.plain=s.simpleWikiLinks(this.notice)};a.prototype.getInfo=function(){return{id:this.id,notice:this.notice,html:this.html,plain:this.plain}},t.a=a},function(e,t,i){"use strict";var r=i(4),s=r.a,a=function(e){e instanceof a?this.pos=e.pos.slice():(null!=e&&e instanceof Array?this.pos=e.slice():this.pos=[],this.validate())};a.prototype.clone=function(){return new a(this.pos)},a.prototype.getCoords=function(){return[this.pos[1],this.pos[2],this.pos[4]]},a.prototype.getCoords2=function(){return[this.pos[1],this.pos[2]]},a.prototype.setCoords=function(e){return this.pos[1]=e[0],this.pos[2]=e[1],this.pos[4]=e[2],this},a.prototype.setCoords2=function(e){return this.pos[1]=e[0],this.pos[2]=e[1],this},a.prototype.getHeight=function(){return this.pos[4]},a.prototype.setHeight=function(e){return this.pos[4]=e,this},a.prototype.getOrientation=function(){return[this.pos[5],this.pos[6],this.pos[7]]},a.prototype.setOrientation=function(e){return this.pos[5]=e[0],this.pos[6]=e[1],this.pos[7]=e[2],this},a.prototype.getFov=function(){return this.pos[9]},a.prototype.setFov=function(e){return this.pos[9]=e,this},a.prototype.getViewExtent=function(){return this.pos[8]},a.prototype.setViewExtent=function(e){return this.pos[8]=e,this},a.prototype.getViewDistance=function(){return.5*this.getViewExtent()/Math.tan(s.radians(.5*this.getFov()))},a.prototype.getViewMode=function(){return this.pos[0]},a.prototype.getHeightMode=function(){return this.pos[3]},a.prototype.check=function(){this.getViewMode(),this.pos[6]=s.clamp(this.pos[6],-90,90),this.pos[5]=this.pos[5]%360,this.pos[7]=this.pos[7]%360},a.prototype.isSame=function(e){return e=e.pos,this.pos[0]==e[0]&&s.isEqual(this.pos[1],e[1],1e-7)&&s.isEqual(this.pos[2],e[2],1e-7)&&this.pos[3]==e[3]&&s.isEqual(this.pos[4],e[4],.001)&&s.isEqual(this.pos[5],e[5],.001)&&s.isEqual(this.pos[6],e[6],.001)&&s.isEqual(this.pos[7],e[7],.001)&&s.isEqual(this.pos[8],e[8],.001)&&s.isEqual(this.pos[9],e[9],.001)},a.prototype.validate=function(){var e=this.pos;"fixed"==e[0]&&(e[0]="obj",e[9]=e[8],e[8]=e[7],e[7]=e[6],e[6]=e[5],e[5]=e[4],e[4]=e[3],e[3]="fix"),e[0]="obj"==e[0]||"subj"==e[0]?e[0]:"obj",e[1]=null!=e[1]?e[1]:0,e[2]=null!=e[2]?e[2]:0,e[3]="fix"==e[3]||"fixed"==e[3]||"float"==e[3]?e[3]:"float",e[4]=null!=e[4]?e[4]:0,e[5]=null!=e[5]?e[5]:0,e[6]=null!=e[6]?e[6]:-90,e[7]=null!=e[7]?e[7]:0,e[8]=null!=e[8]?e[8]:900,e[9]=null!=e[9]?e[9]:45,e[3]="fixed"==e[3]?"fix":e[3]},a.prototype.toString=function(){var e=this.pos;return e[0]+", "+e[1].toFixed(0)+", "+e[2].toFixed(0)+", "+e[3]+", "+e[4].toFixed(0)+", "+e[5].toFixed(0)+", "+e[6].toFixed(0)+", "+e[7].toFixed(0)+", , "+e[8].toFixed(0)+", "+e[9].toFixed(0)},a.prototype.toArray=function(){return this.pos.slice()},t.a=a},function(e,t,i){"use strict";var r=function(e,t,i,r,s,a,n){this.gpu=e,this.gl=e.gl,this.bbox=t.bbox,this.fileSize=i,this.core=r,this.vertexBuffer=null,this.uvBuffer=null,this.uv2Buffer=null,this.use16bit=!!a,this.verticesUnnormalized=!!n,this.size=0;var o=t.vertices,h=t.uvs,l=t.uvs2,u=t.indices,c=t.vertexSize||3,d=t.uvSize||2,p=t.uv2Size||2,f=this.gl;if(o&&f){this.vertexBuffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.bufferData(f.ARRAY_BUFFER,s?o:new Float32Array(o),f.STATIC_DRAW),this.vertexBuffer.itemSize=c,this.vertexBuffer.numItems=o.length/c,null!=h&&(this.uvBuffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.bufferData(f.ARRAY_BUFFER,s?h:new Float32Array(h),f.STATIC_DRAW),this.uvBuffer.itemSize=d,this.uvBuffer.numItems=h.length/d),null!=l&&(this.uv2Buffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,this.uv2Buffer),f.bufferData(f.ARRAY_BUFFER,s?l:new Float32Array(l),f.STATIC_DRAW),this.uv2Buffer.itemSize=p,this.uv2Buffer.numItems=l.length/p),null!=u&&(this.indexBuffer=f.createBuffer(),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,s?u:new Uint16Array(u),f.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=u.length);var g=this.use16bit?2:4;this.size=this.vertexBuffer.numItems*c*g,this.size+=h?this.uvBuffer.numItems*d*g:0,this.size+=l?this.uv2Buffer.numItems*p*g:0,this.size+=u?2*u.length:0,this.polygons=u?u.length/3:this.vertexBuffer.numItems/3,this.valid=!0}};r.prototype.kill=function(){this.gl&&this.valid&&(this.vertexBuffer&&this.gl.deleteBuffer(this.vertexBuffer),this.uvBuffer&&this.gl.deleteBuffer(this.uvBuffer),this.uv2Buffer&&this.gl.deleteBuffer(this.uv2Buffer),this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer),this.vertexBuffer=null,this.uvBuffer=null,this.uv2Buffer=null,this.indexBuffer=null)},r.prototype.draw=function(e,t,i,r,s,a){var n=this.gl;if(null!=n&&this.valid){if(this.use16bit){var o=e.getAttribute(t);if(n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(o,this.vertexBuffer.itemSize,n.UNSIGNED_SHORT,!this.verticesUnnormalized,0,0),this.uvBuffer&&i){var h=e.getAttribute(i);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.vertexAttribPointer(h,this.uvBuffer.itemSize,n.UNSIGNED_SHORT,!0,0,0)}if(this.uv2Buffer&&r){var l=e.getAttribute(r);n.bindBuffer(n.ARRAY_BUFFER,this.uv2Buffer),n.vertexAttribPointer(l,this.uv2Buffer.itemSize,n.UNSIGNED_SHORT,!0,0,0)}}else{var o=e.getAttribute(t);if(n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(o,this.vertexBuffer.itemSize,n.FLOAT,!1,0,0),this.uvBuffer&&i){var h=e.getAttribute(i);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.vertexAttribPointer(h,this.uvBuffer.itemSize,n.FLOAT,!1,0,0)}if(this.uv2Buffer&&r){var l=e.getAttribute(r);n.bindBuffer(n.ARRAY_BUFFER,this.uv2Buffer),n.vertexAttribPointer(l,this.uv2Buffer.itemSize,n.FLOAT,!1,0,0)}}if(s&&s){var u=e.getAttribute(s);-1!=u&&(n.bindBuffer(n.ARRAY_BUFFER,this.gpu.barycentricBuffer),n.vertexAttribPointer(u,this.gpu.barycentricBuffer.itemSize,n.FLOAT,!1,0,0))}this.indexBuffer?(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a||n.drawElements(n.TRIANGLES,this.indexBuffer.numItems,n.UNSIGNED_SHORT,0)):a||n.drawArrays(n.TRIANGLES,0,this.vertexBuffer.numItems)}},r.prototype.getSize=function(){return this.size},r.prototype.getBBox=function(){return this.bbox},r.prototype.getPolygons=function(){return this.polygons},t.a=r},function(e,t,i){"use strict";var r=function(e,t,i,r){this.gpu=e,this.gl=e.gl,this.vertex=t,this.fragment=i,this.program=null,this.uniformLocationCache=[],this.attributeLocationCache=[],this.m=new Float32Array(16),this.ready=!1,this.createProgram(t,i),this.variants=r||[],this.programs={}};r.prototype.createShader=function(e,t){var i=this.gl;if(!e||!i)return null;var r;if(r=!0!==t?i.createShader(i.FRAGMENT_SHADER):i.createShader(i.VERTEX_SHADER),i.shaderSource(r,e),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS)){var s=i.getShaderInfoLog(r);return console.log("An error occurred compiling the "+(!0!==t?"fragment":"vertex")+" shaders: "+s),this.gpu.renderer.core.callListener("renderer-shader-error",{where:"compilation",info:s}),null}return r},r.prototype.createProgram=function(e,t){var i=this.gl;if(null!=i){var r=this.createShader(e,!0),s=this.createShader(t,!1);if(r&&s){var a=i.createProgram();i.attachShader(a,r),i.attachShader(a,s),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)||(console.log("Unable to initialize the shader program."),this.gpu.renderer.core.callListener("renderer-shader-error",{where:"linking"})),i.useProgram(a),this.program=a,this.ready=!0}}},r.prototype.setSampler=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniform1i(r,t)}},r.prototype.isReady=function(e,t){return this.ready},r.prototype.setMat4=function(e,t,i){var r=this.gl;if(null!=r&&null!=this.program){var s=this.getUniform(e);if(null!=s)if(i){i=2*(1+i)-1;var a=this.m;a[0]=t[0],a[1]=t[1],a[2]=t[2]*i,a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6]*i,a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10]*i,a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14]*i,a[15]=t[15],r.uniformMatrix4fv(s,!1,a)}else r.uniformMatrix4fv(s,!1,t)}},r.prototype.setMat3=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniformMatrix3fv(r,!1,t)}},r.prototype.setVec2=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniform2fv(r,t)}},r.prototype.setVec3=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniform3fv(r,t)}},r.prototype.setVec4=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniform4fv(r,t)}},r.prototype.setFloat=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniform1f(r,t)}},r.prototype.setFloatArray=function(e,t){var i=this.gl;if(null!=i&&null!=this.program){var r=this.getUniform(e);null!=r&&i.uniform1fv(r,t)}},r.prototype.getAttribute=function(e){var t=this.gl;if(null!=t&&null!=this.program){var i=this.attributeLocationCache[e];return null==i&&(i=t.getAttribLocation(this.program,e),this.attributeLocationCache[e]=i),i}},r.prototype.getUniform=function(e){var t=this.gl;if(null!=t&&null!=this.program){var i=this.uniformLocationCache[e];return null==i&&(i=t.getUniformLocation(this.program,e),this.uniformLocationCache[e]=i),i}},t.a=r},function(e,t,i){"use strict";function r(e,t,i){i=i||2;var r=t&&t.length,a=r?t[0]*i:e.length,o=s(e,0,a,i,!0),h=[];if(!o)return h;var l,u,d,p,f,g,m;if(r&&(o=c(e,t,o,i)),e.length>80*i){l=d=e[0],u=p=e[1];for(var v=i;v<a;v+=i)f=e[v],g=e[v+1],f<l&&(l=f),g<u&&(u=g),f>d&&(d=f),g>p&&(p=g);m=Math.max(d-l,p-u)}return n(o,h,i,l,u,m),h}function s(e,t,i,r,s){var a,n;if(s===k(e,t,i,r)>0)for(a=t;a<i;a+=r)n=F(a,e[a],e[a+1],n);else for(a=i-r;a>=t;a-=r)n=F(a,e[a],e[a+1],n);return n&&S(n,n.next)&&(L(n),n=n.next),n}function a(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!S(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(L(r),(r=t=r.prev)===r.next)return null;i=!0}}while(i||r!==t);return t}function n(e,t,i,r,s,c,d){if(e){!d&&c&&g(e,r,s,c);for(var p,f,m=e;e.prev!==e.next;)if(p=e.prev,f=e.next,c?h(e,r,s,c):o(e))t.push(p.i/i),t.push(e.i/i),t.push(f.i/i),L(e),e=f.next,m=f.next;else if((e=f)===m){d?1===d?(e=l(e,t,i),n(e,t,i,r,s,c,2)):2===d&&u(e,t,i,r,s,c):n(a(e),t,i,r,s,c,1);break}}}function o(e){var t=e.prev,i=e,r=e.next;if(w(t,i,r)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(b(t.x,t.y,i.x,i.y,r.x,r.y,s.x,s.y)&&w(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function h(e,t,i,r){var s=e.prev,a=e,n=e.next;if(w(s,a,n)>=0)return!1;for(var o=s.x<a.x?s.x<n.x?s.x:n.x:a.x<n.x?a.x:n.x,h=s.y<a.y?s.y<n.y?s.y:n.y:a.y<n.y?a.y:n.y,l=s.x>a.x?s.x>n.x?s.x:n.x:a.x>n.x?a.x:n.x,u=s.y>a.y?s.y>n.y?s.y:n.y:a.y>n.y?a.y:n.y,c=v(o,h,t,i,r),d=v(l,u,t,i,r),p=e.nextZ;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&b(s.x,s.y,a.x,a.y,n.x,n.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&b(s.x,s.y,a.x,a.y,n.x,n.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function l(e,t,i){var r=e;do{var s=r.prev,a=r.next.next;!S(s,a)&&M(s,r,r.next,a)&&C(s,a)&&C(a,s)&&(t.push(s.i/i),t.push(r.i/i),t.push(a.i/i),L(r),L(r.next),r=e=a),r=r.next}while(r!==e);return r}function u(e,t,i,r,s,o){var h=e;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&x(h,l)){var u=P(h,l);return h=a(h,h.next),u=a(u,u.next),n(h,t,i,r,s,o),void n(u,t,i,r,s,o)}l=l.next}h=h.next}while(h!==e)}function c(e,t,i,r){var n,o,h,l,u,c=[];for(n=0,o=t.length;n<o;n++)h=t[n]*r,l=n<o-1?t[n+1]*r:e.length,u=s(e,h,l,r,!1),u===u.next&&(u.steiner=!0),c.push(y(u));for(c.sort(d),n=0;n<c.length;n++)p(c[n],i),i=a(i,i.next);return i}function d(e,t){return e.x-t.x}function p(e,t){if(t=f(e,t)){var i=P(t,e);a(i,i.next)}}function f(e,t){var i,r=t,s=e.x,a=e.y,n=-1/0;do{if(a<=r.y&&a>=r.next.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=s&&o>n){if(n=o,o===s){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(s===n)return i.prev;var h,l=i,u=i.x,c=i.y,d=1/0;for(r=i.next;r!==l;)s>=r.x&&r.x>=u&&b(a<c?s:n,a,u,c,a<c?n:s,a,r.x,r.y)&&((h=Math.abs(a-r.y)/(s-r.x))<d||h===d&&r.x>i.x)&&C(r,e)&&(i=r,d=h),r=r.next;return i}function g(e,t,i,r){var s=e;do{null===s.z&&(s.z=v(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,m(s)}function m(e){var t,i,r,s,a,n,o,h,l=1;do{for(i=e,e=null,a=null,n=0;i;){for(n++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ);t++);for(h=l;o>0||h>0&&r;)0===o?(s=r,r=r.nextZ,h--):0!==h&&r?i.z<=r.z?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,h--):(s=i,i=i.nextZ,o--),a?a.nextZ=s:e=s,s.prevZ=a,a=s;i=r}a.nextZ=null,l*=2}while(n>1);return e}function v(e,t,i,r,s){return e=32767*(e-i)/s,t=32767*(t-r)/s,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function y(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function b(e,t,i,r,s,a,n,o){return(s-n)*(t-o)-(e-n)*(a-o)>=0&&(e-n)*(r-o)-(i-n)*(t-o)>=0&&(i-n)*(a-o)-(s-n)*(r-o)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!A(e,t)&&C(e,t)&&C(t,e)&&T(e,t)}function w(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function S(e,t){return e.x===t.x&&e.y===t.y}function M(e,t,i,r){return!!(S(e,t)&&S(i,r)||S(e,r)&&S(i,t))||w(e,t,i)>0!=w(e,t,r)>0&&w(i,r,e)>0!=w(i,r,t)>0}function A(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&M(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function C(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function T(e,t){var i=e,r=!1,s=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function P(e,t){var i=new E(e.i,e.x,e.y),r=new E(t.i,t.x,t.y),s=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function F(e,t,i,r){var s=new E(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function L(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(e,t,i,r){for(var s=0,a=t,n=i-r;a<i;a+=r)s+=(e[n]-e[a])*(e[a+1]+e[n+1]),n=a;return s}e.exports=r,r.deviation=function(e,t,i,r){var s=t&&t.length,a=s?t[0]*i:e.length,n=Math.abs(k(e,0,a,i));if(s)for(var o=0,h=t.length;o<h;o++){var l=t[o]*i,u=o<h-1?t[o+1]*i:e.length;n-=Math.abs(k(e,l,u,i))}var c=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,p=r[o+1]*i,f=r[o+2]*i;c+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===n&&0===c?0:Math.abs((c-n)/n)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,s=0;s<e.length;s++){for(var a=0;a<e[s].length;a++)for(var n=0;n<t;n++)i.vertices.push(e[s][a][n]);s>0&&(r+=e[s-1].length,i.holes.push(r))}return i}},function(e,t,i){"use strict";function r(e,t){return t=t||5,c(h({lat:e[1],lon:e[0]}),t)}function s(e){var t=l(g(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function a(e){var t=l(g(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function n(e){return e*(Math.PI/180)}function o(e){return e/Math.PI*180}function h(e){var t,i,r,s,a,o,h,l,c,d=e.lat,p=e.lon,f=6378137,g=n(d),m=n(p);c=Math.floor((p+180)/6)+1,180===p&&(c=60),d>=56&&d<64&&p>=3&&p<12&&(c=32),d>=72&&d<84&&(p>=0&&p<9?c=31:p>=9&&p<21?c=33:p>=21&&p<33?c=35:p>=33&&p<42&&(c=37)),t=6*(c-1)-180+3,l=n(t),i=.006739496752268451,r=f/Math.sqrt(1-.00669438*Math.sin(g)*Math.sin(g)),s=Math.tan(g)*Math.tan(g),a=i*Math.cos(g)*Math.cos(g),o=Math.cos(g)*(m-l),h=f*(.9983242984503243*g-.002514607064228144*Math.sin(2*g)+2639046602129982e-21*Math.sin(4*g)-3.418046101696858e-9*Math.sin(6*g));var v=.9996*r*(o+(1-s+a)*o*o*o/6+(5-18*s+s*s+72*a-58*i)*o*o*o*o*o/120)+5e5,y=.9996*(h+r*Math.tan(g)*(o*o/2+(5-s+9*a+4*a*a)*o*o*o*o/24+(61-58*s+s*s+600*a-330*i)*o*o*o*o*o*o/720));return d<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(v),zoneNumber:c,zoneLetter:u(d)}}function l(e){var t=e.northing,i=e.easting,r=e.zoneLetter,s=e.zoneNumber;if(s<0||s>60)return null;var a,n,h,u,c,d,p,f,g,m,v=6378137,y=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),b=i-5e5,x=t;r<"N"&&(x-=1e7),f=6*(s-1)-180+3,a=.006739496752268451,p=x/.9996,g=p/6367449.145945056,m=g+(3*y/2-27*y*y*y/32)*Math.sin(2*g)+(21*y*y/16-55*y*y*y*y/32)*Math.sin(4*g)+151*y*y*y/96*Math.sin(6*g),n=v/Math.sqrt(1-.00669438*Math.sin(m)*Math.sin(m)),h=Math.tan(m)*Math.tan(m),u=a*Math.cos(m)*Math.cos(m),c=.99330562*v/Math.pow(1-.00669438*Math.sin(m)*Math.sin(m),1.5),d=b/(.9996*n);var w=m-n*Math.tan(m)/c*(d*d/2-(5+3*h+10*u-4*u*u-9*a)*d*d*d*d/24+(61+90*h+298*u+45*h*h-252*a-3*u*u)*d*d*d*d*d*d/720);w=o(w);var S=(d-(1+2*h+u)*d*d*d/6+(5-2*u+28*h-3*u*u+8*a+24*h*h)*d*d*d*d*d/120)/Math.cos(m);S=f+o(S);var M;if(e.accuracy){var A=l({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});M={top:A.lat,right:A.lon,bottom:w,left:S}}else M={lat:w,lon:S};return M}function u(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function c(e,t){var i="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+d(e.easting,e.northing,e.zoneNumber)+i.substr(i.length-5,t)+r.substr(r.length-5,t)}function d(e,t,i){var r=p(i);return f(Math.floor(e/1e5),Math.floor(t/1e5)%20,r)}function p(e){var t=e%b;return 0===t&&(t=b),t}function f(e,t,i){var r=i-1,s=x.charCodeAt(r),a=w.charCodeAt(r),n=s+e-1,o=a+t,h=!1;return n>T&&(n=n-T+S-1,h=!0),(n===M||s<M&&n>M||(n>M||s<M)&&h)&&n++,(n===A||s<A&&n>A||(n>A||s<A)&&h)&&++n===M&&n++,n>T&&(n=n-T+S-1),o>C?(o=o-C+S-1,h=!0):h=!1,(o===M||a<M&&o>M||(o>M||a<M)&&h)&&o++,(o===A||a<A&&o>A||(o>A||a<A)&&h)&&++o===M&&o++,o>C&&(o=o-C+S-1),String.fromCharCode(n)+String.fromCharCode(o)}function g(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,i=e.length,r=null,s="",a=0;!/[A-Z]/.test(t=e.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+e;s+=t,a++}var n=parseInt(s,10);if(0===a||a+3>i)throw"MGRSPoint bad conversion from: "+e;var o=e.charAt(a++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+e;r=e.substring(a,a+=2);for(var h=p(n),l=m(r.charAt(0),h),u=v(r.charAt(1),h);u<y(o);)u+=2e6;var c=i-a;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,f,g,b,x,w=c/2,S=0,M=0;return w>0&&(d=1e5/Math.pow(10,w),f=e.substring(a,a+w),S=parseFloat(f)*d,g=e.substring(a+w),M=parseFloat(g)*d),b=S+l,x=M+u,{easting:b,northing:x,zoneLetter:o,zoneNumber:n,accuracy:d}}function m(e,t){for(var i=x.charCodeAt(t-1),r=1e5,s=!1;i!==e.charCodeAt(0);){if(i++,i===M&&i++,i===A&&i++,i>T){if(s)throw"Bad character: "+e;i=S,s=!0}r+=1e5}return r}function v(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var i=w.charCodeAt(t-1),r=0,s=!1;i!==e.charCodeAt(0);){if(i++,i===M&&i++,i===A&&i++,i>C){if(s)throw"Bad character: "+e;i=S,s=!0}r+=1e5}return r}function y(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}t.c=r,t.b=a;var b=6,x="AJSAJS",w="AFAFAF",S=65,M=73,A=79,C=86,T=90;t.a={forward:r,inverse:s,toPoint:a}},function(e,t,i){"use strict";t.a=function(e,t){e=Math.abs(e),t=Math.abs(t);var i=Math.max(e,t),r=Math.min(e,t)/(i||1);return i*Math.sqrt(1+Math.pow(r,2))}},function(e,t,i){"use strict";var r=.01068115234375;t.a=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(.01953125+e*r))),t[1]=e*(.75-e*(.046875+e*(.01953125+e*r)));var i=e*e;return t[2]=i*(.46875-e*(.013020833333333334+.007120768229166667*e)),i*=e,t[3]=i*(.3645833333333333-.005696614583333333*e),t[4]=i*e*.3076171875,t}},function(e,t,i){"use strict";var r=i(27),s=i(0);t.a=function(e,t,a){for(var n=1/(1-t),o=e,h=20;h;--h){var l=Math.sin(o),u=1-t*l*l;if(u=(i.i(r.a)(o,l,Math.cos(o),a)-e)*(u*Math.sqrt(u))*n,o-=u,Math.abs(u)<s.d)return o}return o}},function(e,t,i){"use strict";t.a=function(e){var t=Math.exp(e);return t=(t-1/t)/2}},function(e,t,i){"use strict";t.a=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}},function(e,t,i){"use strict";function r(e,t){return e.datum_type===t.datum_type&&(!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===h.h?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==h.i||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6]))}function s(e,t,i){var r,s,a,n,o=e.x,l=e.y,u=e.z?e.z:0;if(l<-h.a&&l>-1.001*h.a)l=-h.a;else if(l>h.a&&l<1.001*h.a)l=h.a;else if(l<-h.a||l>h.a)return null;return o>Math.PI&&(o-=2*Math.PI),s=Math.sin(l),n=Math.cos(l),a=s*s,r=i/Math.sqrt(1-t*a),{x:(r+u)*n*Math.cos(o),y:(r+u)*n*Math.sin(o),z:(r*(1-t)+u)*s}}function a(e,t,i,r){var s,a,n,o,l,u,c,d,p,f,g,m,v,y,b,x,w=e.x,S=e.y,M=e.z?e.z:0;if(s=Math.sqrt(w*w+S*S),a=Math.sqrt(w*w+S*S+M*M),s/i<1e-12){if(y=0,a/i<1e-12)return b=h.a,x=-r,{x:e.x,y:e.y,z:e.z}}else y=Math.atan2(S,w);n=M/a,o=s/a,l=1/Math.sqrt(1-t*(2-t)*o*o),d=o*(1-t)*l,p=n*l,v=0;do{v++,c=i/Math.sqrt(1-t*p*p),x=s*d+M*p-c*(1-t*p*p),u=t*c/(c+x),l=1/Math.sqrt(1-u*(2-u)*o*o),f=o*(1-u)*l,g=n*l,m=g*d-f*p,d=f,p=g}while(m*m>1e-24&&v<30);return b=Math.atan(g/Math.abs(f)),{x:y,y:b,z:x}}function n(e,t,i){if(t===h.h)return{x:e.x+i[0],y:e.y+i[1],z:e.z+i[2]};if(t===h.i){var r=i[0],s=i[1],a=i[2],n=i[3],o=i[4],l=i[5],u=i[6];return{x:u*(e.x-l*e.y+o*e.z)+r,y:u*(l*e.x+e.y-n*e.z)+s,z:u*(-o*e.x+n*e.y+e.z)+a}}}function o(e,t,i){if(t===h.h)return{x:e.x-i[0],y:e.y-i[1],z:e.z-i[2]};if(t===h.i){var r=i[0],s=i[1],a=i[2],n=i[3],o=i[4],l=i[5],u=i[6],c=(e.x-r)/u,d=(e.y-s)/u,p=(e.z-a)/u;return{x:c+l*d-o*p,y:-l*c+d+n*p,z:o*c-n*d+p}}}var h=i(0);t.c=r,t.b=s,t.a=a,t.d=n,t.e=o},function(e,t,i){"use strict";function r(e){var t=this;if(2===arguments.length){var s=arguments[1];"string"==typeof s?"+"===s.charAt(0)?r[e]=i.i(a.a)(arguments[1]):r[e]=i.i(n.a)(arguments[1]):r[e]=s}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?r.apply(t,e):r(e)});if("string"==typeof e){if(e in r)return r[e]}else"EPSG"in e?r["EPSG:"+e.EPSG]=e:"ESRI"in e?r["ESRI:"+e.ESRI]=e:"IAU2000"in e?r["IAU2000:"+e.IAU2000]=e:console.log(e);return}}var s=i(83),a=i(43),n=i(46);i.i(s.a)(r),t.a=r},function(e,t,i){"use strict";var r=i(0),s=i(76),a=i(77),n=i(29);t.a=function(e){var t,o,h,l={},u=e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var i=t.split("=");return i.push(!0),e[i[0].toLowerCase()]=i[1],e},{}),c={proj:"projName",datum:"datumCode",rf:function(e){l.rf=parseFloat(e)},lat_0:function(e){l.lat0=e*r.g},lat_1:function(e){l.lat1=e*r.g},lat_2:function(e){l.lat2=e*r.g},lat_ts:function(e){l.lat_ts=e*r.g},lon_0:function(e){l.long0=e*r.g},lon_1:function(e){l.long1=e*r.g},lon_2:function(e){l.long2=e*r.g},alpha:function(e){l.alpha=parseFloat(e)*r.g},lonc:function(e){l.longc=e*r.g},x_0:function(e){l.x0=parseFloat(e)},y_0:function(e){l.y0=parseFloat(e)},k_0:function(e){l.k0=parseFloat(e)},k:function(e){l.k0=parseFloat(e)},a:function(e){l.a=parseFloat(e)},b:function(e){l.b=parseFloat(e)},r_a:function(){l.R_A=!0},zone:function(e){l.zone=parseInt(e,10)},south:function(){l.utmSouth=!0},towgs84:function(e){l.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){l.to_meter=parseFloat(e)},units:function(e){l.units=e;var t=i.i(n.a)(a.a,e);t&&(l.to_meter=t.to_meter)},from_greenwich:function(e){l.from_greenwich=e*r.g},pm:function(e){var t=i.i(n.a)(s.a,e);l.from_greenwich=(t||parseFloat(e))*r.g},nadgrids:function(e){"@null"===e?l.datumCode="none":l.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(l.axis=e)}};for(t in u)o=u[t],t in c?(h=c[t],"function"==typeof h?h(o):l[h]=o):l[t]=o;return"string"==typeof l.datumCode&&"WGS84"!==l.datumCode&&(l.datumCode=l.datumCode.toLowerCase()),l}},function(e,t,i){"use strict";function r(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),r=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),r*=t,this.cgb[1]=r*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),r*=t,this.cgb[2]=r*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=r*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),r*=t,this.cgb[3]=r*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=r*(1237/630+t*(t*(-24832/14175)-2.4)),r*=t,this.cgb[4]=r*(4174/315+t*(-144838/6237)),this.cbg[4]=r*(-734/315+t*(109598/31185)),r*=t,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+r*(.25+r*(1/64+r/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=r*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=r*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),r*=t,this.utg[2]=r*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=r*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),r*=t,this.utg[3]=r*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=r*(49561/161280+t*(-179/168+t*(6601661/7257600))),r*=t,this.utg[4]=r*(-4583/161280+t*(108847/3991680)),this.gtu[4]=r*(34729/80640+t*(-3418889/1995840)),r*=t,this.utg[5]=-.03233083094085698*r,this.gtu[5]=.6650675310896665*r;var s=i.i(l.a)(this.cbg,this.lat0);this.Zb=-this.Qn*(s+i.i(u.a)(this.gtu,2*s))}function s(e){var t=i.i(d.a)(e.x-this.long0),r=e.y;r=i.i(l.a)(this.cbg,r);var s=Math.sin(r),a=Math.cos(r),n=Math.sin(t),u=Math.cos(t);r=Math.atan2(s,u*a),t=Math.atan2(n*a,i.i(o.a)(s,a*u)),t=i.i(h.a)(Math.tan(t));var p=i.i(c.a)(this.gtu,2*r,2*t);r+=p[0],t+=p[1];var f,g;return Math.abs(t)<=2.623395162778?(f=this.a*(this.Qn*t)+this.x0,g=this.a*(this.Qn*r+this.Zb)+this.y0):(f=1/0,g=1/0),e.x=f,e.y=g,e}function a(e){var t=(e.x-this.x0)*(1/this.a),r=(e.y-this.y0)*(1/this.a);r=(r-this.Zb)/this.Qn,t/=this.Qn;var s,a;if(Math.abs(t)<=2.623395162778){var h=i.i(c.a)(this.utg,2*r,2*t);r+=h[0],t+=h[1],t=Math.atan(i.i(n.a)(t));var u=Math.sin(r),p=Math.cos(r),f=Math.sin(t),g=Math.cos(t);r=Math.atan2(u*g,i.i(o.a)(f,g*p)),t=Math.atan2(f,g*p),s=i.i(d.a)(t+this.long0),a=i.i(l.a)(this.cgb,r)}else s=1/0,a=1/0;return e.x=s,e.y=a,e}var n=i(39),o=i(36),h=i(66),l=i(70),u=i(67),c=i(68),d=i(3),p=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"];t.a={init:r,forward:s,inverse:a,names:p}},function(e,t,i){"use strict";function r(e,t){return(e.datum.datum_type===a.h||e.datum.datum_type===a.i)&&"WGS84"!==t.datumCode||(t.datum.datum_type===a.h||t.datum.datum_type===a.i)&&"WGS84"!==e.datumCode}function s(e,t,c){var d;return Array.isArray(c)&&(c=i.i(u.a)(c)),e.datum&&t.datum&&r(e,t)&&(d=new l.a("WGS84"),c=s(e,d,c),e=d),"enu"!==e.axis&&(c=i.i(h.a)(e,!1,c)),"longlat"===e.projName?(c.x*=a.g,c.y*=a.g):e.isGeocent?(e.to_meter&&(c.x*=e.to_meter,c.y*=e.to_meter,c.z*=e.to_meter),c=i.i(o.a)(c,t.es,t.a,t.b)):(e.to_meter&&(c.x*=e.to_meter,c.y*=e.to_meter),c=e.inverse(c)),e.from_greenwich&&(c.x+=e.from_greenwich),c=i.i(n.a)(e.datum,t.datum,c),t.from_greenwich&&(c.x-=t.from_greenwich),"longlat"===t.projName?(c.x*=a.j,c.y*=a.j):t.isGeocent?(c=i.i(o.b)(c,t.es,t.a),t.to_meter&&(c.x/=t.to_meter,c.y/=t.to_meter,c.z/=t.to_meter)):(t.forward(c),t.to_meter&&(c.x/=t.to_meter,c.y/=t.to_meter)),"enu"!==t.axis?i.i(h.a)(t,!0,c):c}var a=i(0),n=i(80),o=i(41),h=i(64),l=i(24),u=i(40);t.a=s},function(e,t,i){"use strict";function r(e,t){var i=t[0],r=t[1];!(i in e)&&r in e&&(e[i]=e[r],3===t.length&&(e[i]=t[2](e[i])))}function s(e){return e*h}function a(e){function t(t){return t*(e.to_meter||1)}"GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var i=e.GEOGCS;"GEOGCS"===e.type&&(i=e),i&&(i.DATUM?e.datumCode=i.DATUM.name.toLowerCase():e.datumCode=i.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"===e.datumCode&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),i.DATUM&&i.DATUM.SPHEROID&&(e.ellps=i.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=i.DATUM.SPHEROID.a,e.rf=parseFloat(i.DATUM.SPHEROID.rf,10)),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",s],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",s],["x0","false_easting",t],["y0","false_northing",t],["long0","central_meridian",s],["lat0","latitude_of_origin",s],["lat0","standard_parallel_1",s],["lat1","standard_parallel_1",s],["lat2","standard_parallel_2",s],["alpha","azimuth",s],["srsCode","name"]].forEach(function(t){return r(e,t)}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=s(e.lat1>0?90:-90),e.lat_ts=e.lat1)}var n=i(117),o=i(118),h=.017453292519943295;t.a=function(e){var t=i.i(n.a)(e),r=t.shift(),s=t.shift();t.unshift(["name",s]),t.unshift(["type",r]);var h={};return i.i(o.a)(t,h),a(h),h}},function(e,t){var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{var s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;r=new s,r.append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(i.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,i){"use strict";var r=i(30),s=i(2),a=i(9),n=s.a,o=a.a,h=r.a,l=function(e,t,i){if(this.map=e,this.id=i,this.currentAlpha=1,this.tileSize=[256,256],this.lodRange=[0,100],this.credits=[],this.tileRange=[[0,0],[0,0]],this.jsonUrl=null,this.baseUrl=this.map.url.baseUrl,this.baseUrlSchema=this.map.url.baseUrlSchema,this.baseUrlOrigin=this.map.url.baseUrlOrigin,this.ready=!1,this.dataType=0,this.shaderFilters=null,"esri-world-imagery"==i&&(t.availability={type:"negative-size",size:2521}),"string"==typeof t){this.jsonUrl=this.map.url.processUrl(t),this.baseUrl=o.getBase(this.jsonUrl),this.baseUrlSchema=o.getSchema(this.jsonUrl),this.baseUrlOrigin=o.getOrigin(this.jsonUrl);var r=function(e){this.parseJson(e),this.ready=!0,this.map.refreshView()}.bind(this),s=function(){}.bind(this);n.loadJSON(this.jsonUrl,r,s,null,!!n.useCredentials&&-1!=this.jsonUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)}else this.parseJson(t),this.ready=!0};l.prototype.parseJson=function(e){switch(this.numberId=e.id||null,this.type=e.type||"raster",this.url=this.processUrl(e.url,""),this.tileSize=e.tileSize||[256,256],this.lodRange=e.lodRange||[0,0],this.tileRange=e.tileRange||[[0,0],[0,0]],this.metaUrl=this.processUrl(e.metaUrl),this.maskUrl=this.processUrl(e.maskUrl),this.isTransparent=e.isTransparent||!1,this.options=e.options||{},this.credits=e.credits||[],this.creditsUrl=null,this.shaderFilter=this.options.shaderFilter||null,e.dataType){default:case"color":this.dataType=0;break;case"height":this.dataType=1;break;case"classification":this.dataType=2}if(this.specificity=Math.pow(2,this.lodRange[0])/((this.tileRange[1][0]-this.tileRange[1][0]+1)*(this.tileRange[1][1]-this.tileRange[1][1]+1)),this.availability=e.availability?{}:null,this.availability){var t=e.availability;switch(t.type){case"negative-type":this.availability.type=2;break;case"negative-code":this.availability.type=3;break;case"negative-size":this.availability.type=4}this.availability.mime=t.mime,this.availability.codes=t.codes,this.availability.size=t.size}switch(this.metaUrl&&this.maskUrl&&(this.availability={type:1}),typeof this.credits){case"string":this.creditsUrl=this.credits,this.credits=[];break;case"object":if(!Array.isArray(this.credits)){var i=this.credits;this.credits=[];for(var r in i)this.map.addCredit(r,new h(this.map,i[r])),this.credits.push(r)}}},l.prototype.kill=function(){},l.prototype.setOptions=function(){},l.prototype.getOptions=function(){return this.getInfo()},l.prototype.getInfo=function(){return{type:this.type,url:this.url,tileSize:this.tileSize,credits:this.credits,lodRange:this.lodRange,tileRange:this.tileRange,mataUrl:this.metaUrl,maskUrl:this.maskUrl,isTransparent:this.isTransparent}},l.prototype.processUrl=function(e,t){return e?(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},l.prototype.hasTile=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var i=e[1]>>t,r=e[2]>>t;return!(e[0]<this.lodRange[0]||e[0]>this.lodRange[1]||i<this.tileRange[0][0]||i>this.tileRange[1][0]||r<this.tileRange[0][1]||r>this.tileRange[1][1])},l.prototype.hasTileOrInfluence=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var i=e[1]>>t,r=e[2]>>t;return i<this.tileRange[0][0]||i>this.tileRange[1][0]||r<this.tileRange[0][1]||r>this.tileRange[1][1]?0:e[0]>this.lodRange[1]?1:2},l.prototype.getUrl=function(e,t){return this.map.url.makeUrl(this.url,{lod:e[0],ix:e[1],iy:e[2]},null,t)},l.prototype.getMetatileUrl=function(e,t){return this.map.url.makeUrl(this.metaUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},l.prototype.getMaskUrl=function(e,t){return this.map.url.makeUrl(this.maskUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},t.a=l},function(e,t,i){"use strict";var r=i(136),s=i(138),a=i(139),n=i(137),o=i(1),h=r.a,l=s.a,u=a.a,c=n.a,d=o.b,p=(o.e,function(e){this.map=e,this.groups=[],this.nodes=[],this.currentGroup=null,this.bboxMin=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],this.bboxMax=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],this.navSrs=this.map.getNavigationSrs(),this.physSrs=this.map.getPhysicalSrs(),this.heightsToProcess=0,this.heightsProcessBuffer=null,this.heightsProcessBufferFirst=null,this.heightsProcessBufferLast=null,this.heightsLod=8,this.heightsSource="heightmap-by-precision",this.updateCallback=null,this.processingHeights=!1,this.processHeightsCalls=[]});p.prototype.addToHeightsBuffer=function(e){var t={coords:e,prev:null,next:this.heightsProcessBufferFirst};null!=this.heightsProcessBufferFirst&&(this.heightsProcessBufferFirst.prev=t),this.heightsProcessBufferFirst=t,null==this.heightsProcessBufferLast&&(this.heightsProcessBufferLast=t)},p.prototype.removeFromHeightsBuffer=function(e){var t=!1;e==this.heightsProcessBufferFirst&&(this.heightsProcessBufferFirst=e.next,t=!0,null!=this.heightsProcessBufferFirst&&(this.heightsProcessBufferFirst.prev=null)),e==this.heightsProcessBufferLast&&(this.heightsProcessBufferLast=e.prev,t=!0,null!=this.heightsProcessBufferLast&&(this.heightsProcessBufferLast.next=null)),t||(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev))},p.prototype.addGroup=function(e){return this.groups.push({points:[],lines:[],polygons:[],id:e}),this.currentGroup=this.groups[this.groups.length-1],this},p.prototype.addNode=function(e,t,i){var r={meshes:[],precision:i,volume:t,nodes:[]};return e||(e=this),e.nodes.push(r),r},p.prototype.addMesh=function(e,t){e&&e.meshes.push(t)},p.prototype.addPoint=function(e,t,i,r,s,a){this.currentGroup||this.addGroup("some-group");var n,o=!t||"float"==t,h={id:r,properties:i};return o?(n=[e[0],e[1],e[2]||0,h,null,null],this.addToHeightsBuffer(n),h.points=[n],h.floatHeights=!0,h.srs=s||this.navSrs,h.heightsToProcess=1,this.heightsToProcess++):h.points=a?[[e[0],e[1],e[2]]]:[this.physSrs.convertCoordsFrom(e,s||this.navSrs)],this.currentGroup.points.push(h),this},p.prototype.addPointArray=function(e,t,i,r,s,a){this.currentGroup||this.addGroup("some-group");var n,o,h,l,u=!t||"float"==t;s=s||this.navSrs;var c={id:r,properties:i},d=new Array(e.length);if(u){for(n=0,o=e.length;n<o;n++)h=e[n],l=[h[0],h[1],h[2]||0,c,null,null],this.addToHeightsBuffer(l),d[n]=l;c.floatHeights=!0,c.srs=s,c.heightsToProcess=o,this.heightsToProcess++}else if(a)for(n=0,o=e.length;n<o;n++)h=e[n],d[n]=[h[0],h[1],h[2]];else for(n=0,o=e.length;n<o;n++)d[n]=this.physSrs.convertCoordsFrom(e[n],s);return c.points=d,this.currentGroup.points.push(c),this},p.prototype.addLineString=function(e,t,i,r,s,a){this.currentGroup||this.addGroup("some-group");var n,o,h,l,u=!t||"float"==t;s=s||this.navSrs;var c={id:r,properties:i},d=new Array(e.length);if(u){for(n=0,o=e.length;n<o;n++)h=e[n],l=[h[0],h[1],h[2]||0,c,null,null],this.addToHeightsBuffer(l),d[n]=l;c.floatHeights=!0,c.srs=s,c.heightsToProcess=o,this.heightsToProcess+=o}else if(a)for(n=0,o=e.length;n<o;n++)h=e[n],d[n]=[h[0],h[1],h[2]];else for(n=0,o=e.length;n<o;n++)d[n]=this.physSrs.convertCoordsFrom(e[n],s);return c.lines=[d],this.currentGroup.lines.push(c),this},p.prototype.addLineStringArray=function(e,t,i,r,s,a){this.currentGroup||this.addGroup("some-group");var n,o,h,l,u,c,d,p,f=!t||"float"==t;s=s||this.navSrs;var g={id:r,properties:i},m=new Array(e.length);if(f){var v=0;for(h=0,l=e.length;h<l;h++){for(n=e[h],o=new Array(n.length),u=0,c=n.length;u<c;u++)d=n[u],p=[d[0],d[1],d[2]||0,g,null,null],this.addToHeightsBuffer(p),o[u]=p;v+=c,m[h]=o}g.floatHeights=!0,g.srs=s,g.heightsToProcess=v,this.heightsToProcess+=v}else for(h=0,l=e.length;h<l;h++){if(n=e[h],o=new Array(n.length),a)for(u=0,c=n.length;u<c;u++)d=n[u],o[u]=[d[0],d[1],d[2]];else for(u=0,c=n.length;u<c;u++)o[u]=this.physSrs.convertCoordsFrom(n[u],s);m[h]=o}return g.lines=m,this.currentGroup.lines.push(g),this},p.prototype.addPolygon=function(e,t,i,r,s,a,n,o){return this.addPolygon3(e,t,i,r,s,a,n,o)},p.prototype.getPolygonCenter=function(e,t,i){if(e&&!e.length)return[0,0];var r=0,s=0,a=0;if(t){for(var n=0,o=e.length;n<o;n++){var h=e[n];r+=h[0],s+=h[1],a+=h[2]}return[r/o,s/o,a/o]}for(var n=0,o=e.length;n<o;n++){var h=e[n],l=i.forward(h);r+=l[0],s+=l[1],a+=l[2]}var u=r/o,c=s/o,d=a/o;return h=i.inverse([u,c,d]),[h[0],h[1],0]},p.prototype.insidePolygon=function(e,t,i){var r=e[0],s=e[1];i=i||Math.round(t.length/3);for(var a=!1,n=0,o=i-1,h=i;n<h;o=n++){var l=t[3*n],u=t[3*n+1],c=t[3*o],d=t[3*o+1];u>s!=d>s&&r<(c-l)*(s-u)/(d-u)+l&&(a=!a)}return a},p.prototype.addPolygon3=function(e,t,i,r,s,a,n,o){n=n||this.navSrs.srsProj4,t=t||[];var h,l,u,c,p,f,g,m,v,y,b,x,w,S,M,A=e,C=[],T=[],P=!0,F=0,L=t.length;o=o||{},o.mode=o.mode||"auto","by-length"==o.mode&&(o.length=o.length||2e5);-1!=n.indexOf("+proj=longlat")&&(P=!1,v=this.map.proj4(n,"+proj=geocent +datum=WGS84 +units=m +no_defs"));var E=3*e.length;for(h=0,l=e.length;h<l;h++)e[h][2]=e[h][2]||0;for(h=0,l=t.length;h<l;h++)for(m=t[h],E+=3*m.length,u=0,c=m.length;u<c;u++)m[u][2]=m[u][2]||0;var k,N,B,I=this.getPolygonCenter(e,P,v),R=this.map.measure.getNewNED(I);B=R.direction,k=R.direction,N=R.east,A=new Array(E),b=new Array(E),u=0;var U=new Array(t.length+1),D=new Array(e.length);U[0]=D;var z;for(z=v?v.forward(I):I,h=0,l=e.length;h<l;h++)D[h]=h,C=e[h],b[u]=C[0],b[u+1]=C[1],b[u+2]=C[2],v?(T=v.forward(e[h]),C=[N[0]*T[0]+N[1]*T[1]+N[2]*T[2],k[0]*T[0]+k[1]*T[1]+k[2]*T[2],0]):(T=e[h],C=T),x=T[0]-z[0],w=T[1]-z[1],S=T[2]-z[2],M=x*x+w*w+S*S,M>F&&(F=M,e[h]),A[u]=C[0],A[u+1]=C[1],A[u+2]=C[2],u+=3;var _,G,V,O,j,H=0;for(h=0,l=3*e.length;h<l;h+=3)_=A[h],G=A[h+1],h<l-3?(V=A[h+3],O=A[h+4]):(V=A[0],O=A[1]),H+=_*O,H-=V*G;if(H<0){var Y=b.slice(),q=A.slice();for(h=0,l=3*e.length;h<l;h+=3)b[h]=Y[l-h-3],b[h+1]=Y[l-h-2],b[h+2]=Y[l-h-1],A[h]=q[l-h-3],A[h+1]=q[l-h-2],A[h+2]=q[l-h-1]}for(new Array(t.length),y=new Array(t.length),h=0,l=t.length;h<l;h++){for(m=t[h],j=Math.round(u/3),y[h]=j,h<L&&(D=new Array(m.length),U[h+1]=D),g=j,p=0,f=m.length;p<f;p++)C=m[p],b[u]=C[0],b[u+1]=C[1],b[u+2]=C[2],v?(T=v.forward(m[p]),C=[N[0]*T[0]+N[1]*T[1]+N[2]*T[2],B[0]*T[0]+B[1]*T[1]+B[2]*T[2],0]):C=m[p],A[u]=C[0],A[u+1]=C[1],A[u+2]=C[2],u+=3,h<L&&(D[p]=g,g++);for(H=0,j*=3,p=0,f=3*m.length;p<f;p+=3)_=A[j+p],G=A[j+p+1],p<f-3?(V=A[j+p+3],O=A[j+p+4]):(V=A[j+0],O=A[j+1]),H+=_*O,H-=V*G;if(H>0){var Y=b.slice(),q=A.slice();for(p=0,f=3*m.length;p<f;p+=3)b[j+p]=Y[j+f-p-3],b[j+p+1]=Y[j+f-p-2],b[j+p+2]=Y[j+f-p-1],A[j+p]=q[j+f-p-3],A[j+p+1]=q[j+f-p-2],A[j+p+2]=q[j+f-p-1]}}var J=vts.earcut(A,y,3),Z=Number.POSITIVE_INFINITY;switch(o.mode){case"auto":Z=Math.sqrt(F)/19;break;case"by-length":Z=o.length}var X,W,Q,K,$,ee,te,ie,re,se,ae=new Array(U.length);for(h=0,l=U.length;h<l;h++)ae[h]=U[h].slice();var ne,oe,he,le,ue,ce,de=new Array(196608),pe=new Array(196608),fe=new Array(196608),ge=0,me=0,ve=0,ye=new Array(196608);for(h=0,l=b.length;h<l;h+=3)ye[h]=b[h],ye[h+1]=b[h+1],ye[h+2]=b[h+2];var be=Math.round(l/3),xe=Z;for(h=0,l=J.length;h<l;h+=3){X=J[h],W=J[h+1],Q=J[h+2],ge=3;var we=null,Se=null,Me=null;for(u=0,c=U.length;u<c;u++)for(D=U[u],se=ae[u],p=0,f=D.length;p<f;p++){var Ae=p<D.length-1?p+1:0;(X==D[p]&&W==D[Ae]||X==D[Ae]&&W==D[p])&&(se[p]=[D[p]],we=se[p]),(W==D[p]&&Q==D[Ae]||W==D[Ae]&&Q==D[p])&&(se[p]=[D[p]],Se=se[p]),(Q==D[p]&&X==D[Ae]||X==D[Ae]&&Q==D[p])&&(se[p]=[D[p]],Me=se[p])}de[0]=[X,we],de[1]=[W,Se],de[2]=[Q,Me];var Ce=0;do{for(u=0,c=ge;u<c;u+=3)if(le=de[u][0],ue=de[u+1][0],ce=de[u+2][0],we=de[u][1],Se=de[u+1][1],Me=de[u+2][1],K=[ye[3*le],ye[3*le+1],ye[3*le+2]],$=[ye[3*ue],ye[3*ue+1],ye[3*ue+2]],ee=[ye[3*ce],ye[3*ce+1],ye[3*ce+2]],v&&(K=v.forward(K),$=v.forward($),ee=v.forward(ee)),ne=d.length([K[0]-$[0],K[1]-$[1],K[2]-$[2]]),oe=d.length([$[0]-ee[0],$[1]-ee[1],$[2]-ee[2]]),he=d.length([ee[0]-K[0],ee[1]-K[1],ee[2]-K[2]]),(g=Math.max(ne,oe,he))<Z)fe[ve]=le,fe[ve+1]=ue,fe[ve+2]=ce,ve+=3;else{te=[.5*(K[0]+$[0]),.5*(K[1]+$[1]),.5*(K[2]+$[2])],v&&(te=v.inverse(te),te[2]=.5*(ye[3*le+2]+ye[3*ue+2])),ie=[.5*($[0]+ee[0]),.5*($[1]+ee[1]),.5*($[2]+ee[2])],v&&(ie=v.inverse(ie),ie[2]=.5*(ye[3*ue+2]+ye[3*ce+2])),re=[.5*(ee[0]+K[0]),.5*(ee[1]+K[1]),.5*(ee[2]+K[2])],v&&(re=v.inverse(re),re[2]=.5*(ye[3*ce+2]+ye[3*le+2]));var Te=3*be;ne==g?(ye[Te]=te[0],ye[Te+1]=te[1],ye[Te+2]=te[2],we&&(we[0]=[[we[0]],[-be]],we=we[0]),g=me,pe[g]=[le,we?we[0]:null],pe[g+1]=[be,null],pe[g+2]=[ce,Me||null],pe[g+3]=[be,we?we[1]:null],pe[g+4]=[ue,Se||null],pe[g+5]=[ce,null]):oe==g?(ye[Te]=ie[0],ye[Te+1]=ie[1],ye[Te+2]=ie[2],Se&&(Se[0]=[[Se[0]],[-be]],Se=Se[0]),g=me,pe[g]=[le,we||null],pe[g+1]=[ue,Se?Se[0]:null],pe[g+2]=[be,null],pe[g+3]=[be,Se?Se[1]:null],pe[g+4]=[ce,Me||null],pe[g+5]=[le,null]):he==g&&(ye[Te]=re[0],ye[Te+1]=re[1],ye[Te+2]=re[2],Me&&(Me[0]=[[Me[0]],[-be]],Me=Me[0]),g=me,pe[g]=[le,we||null],pe[g+1]=[ue,null],pe[g+2]=[be,Me?Me[1]:null],pe[g+3]=[be,null],pe[g+4]=[ue,Se||null],pe[g+5]=[ce,Me?Me[0]:null]),be+=1,me+=6}var Pe=de;de=pe,pe=Pe,ge=me,me=0,Ce++}while(ge>0);Z=xe}var Fe=new Array(196608),Le=0,Ee=function(e){for(var t=0,i=e.length;t<i;t++)Array.isArray(e[t])?Ee(e[t]):(Fe[Le]=e[t],Le++)},ke=0;for(h=0,l=ae.length;h<l;h++)Ee(ae[h]),ae[h]=Fe.slice(ke,Le),ke=Le;for(J=new Array(ge),h=0,l=ve;h<l;h+=3)J[h]=fe[h],J[h+1]=fe[h+1],J[h+2]=fe[h+2];for(b=new Array(3*be),u=0,h=0,l=3*be;h<l;h+=3)b[h]=ye[h],b[h+1]=ye[h+1],b[h+2]=ye[h+2],u++;this.addPolygonRAW(b,J,ae,i,r,s,a,n)},p.prototype.addPolygonRAW=function(e,t,i,r,s,a,n,o,h,l){this.currentGroup||this.addGroup("some-group");var u,c,d,p=!s||"float"==s,f=0;o=o||this.navSrs;var g={id:n,properties:a},m=new Array(Math.round(e.length/3));if(p){for(u=0,c=e.length;u<c;u+=3)d=[e[u],e[u+1],e[u+2],g,null,null],this.addToHeightsBuffer(d),m[f++]=d;g.floatHeights=!0,g.srs=o,g.heightsToProcess=m.length,this.heightsToProcess+=m.length}else for(u=0,c=e.length;u<c;u+=3)m[f++]=h?l?[e[u]*l.sx+l.px,e[u+1]*l.sy+l.py,e[u+2]*l.sz+l.pz]:[e[u],e[u+1],e[u+2]]:this.physSrs.convertCoordsFrom(d,o);var v=t.slice(),y=new Array(i.length);for(u=0,c=i.length;u<c;u++)y[u]=i[u].slice();return g.vertices=m,g.surface=v,g.borders=y,this.currentGroup.polygons.push(g),this},p.prototype.importVTSGeodata=function(e,t,i){return new u(this,t,i).processJSON(e)},p.prototype.importGeoJson=function(e,t,i,r){return new l(this,t,i,r).processJSON(e)},p.prototype.import3DTiles=function(e,t){return new c(this,t).processJSON(e)},p.prototype.load3DTiles=function(e,t,i){new c(this,t).loadJSON(e,t,i)},p.prototype.processHeights=function(e,t,i){if(this.heightsToProcess<=0)return void(i&&i(this));this.processingHeights&&this.processHeightsCalls.push(this.processHeights.bind(this,e,t)),this.processingHeights=!0,this.heightsSource=e,this.heightsLod=t;var r,s,a,n,o,n,h,l,u=this.heightsProcessBufferFirst;if(u){switch(e){case"node-by-precision":n=!0;case"heightmap-by-precision":h=u.coords,s=h[3].srs?this.navSrs.convertCoordsFrom(h,h[3].srs):h,o=this.map.measure.getOptimalHeightLodBySampleSize(s,t);break;case"node-by-lod":n=!0,t-=8;case"heightmap-by-lod":o=t;break;case"none":l=!0}do{h=u.coords,l||null!=h[4]||(s=h[3].srs?this.navSrs.convertCoordsFrom(h,h[3].srs):h,a=this.map.measure.getSpatialDivisionNode(s),h[4]=a[0],h[5]=a[1]),a=l?[0,!0,!0]:this.map.measure.getSurfaceHeight(h,o,null,h[4],h[5],null,n),(a[1]||a[2])&&(h[2]+=a[0],this.removeFromHeightsBuffer(u,r),h[3].heightsToProcess--,this.heightsToProcess--,h[3].heightsToProcess<=0&&(h[3].floatHeights=!1),s=[h[0],h[1],h[2]],s=this.physSrs.convertCoordsFrom(s,h[3].srs),h[0]=s[0],h[1]=s[1],h[2]=s[2]),r=u,u=u.next}while(u)}this.heightsToProcess<=0?(this.updateCallback&&this.updateCallback(),this.processingHeights=!1,i&&i(this),this.processHeightsCalls.length>1&&this.processHeightsCalls.shift()()):this.updateCallback||(this.updateCallback=this.map.core.on("map-update",this.processHeights.bind(this,this.heightsSource,this.heightsLod,i)))},p.prototype.extractGeometry=function(e){for(var t,i,r,s,a,n,o,l,u,c,d,i=0,r=this.groups.length;i<r;i++){var s,a,p=this.groups[i],f=p.points,g=p.lines,m=p.polygons;for(s=0,a=f.length;s<a;s++)f[s].id==e&&(t=f[s]);for(s=0,a=g.length;s<a;s++)g[s].id==e&&(t=g[s]);for(s=0,a=m.length;s<a;s++)m[s].id==e&&(t=m[s])}if(t){if(t.points){if(n=t.points,n.length>0)for(l=new Float64Array(3*n.length),i=0,r=n.length;i<r;i++)c=3*i,d=n[i],l[c]=d[0],l[c+1]=d[1],l[c+2]=d[2];return new h(this.map,{type:"point-geometry",id:t.id,geometryBuffer:l})}if(t.lines){if(o=t.lines,o.length>0){var v=0;for(i=0,r=o.length;i<r;i++)v+=o[i].length;for(l=new Float64Array(3*v),u=new Uint32Array(r),c=0,i=0,r=o.length;i<r;i++){var n=o[i];for(s=0,a=n.length;s<a;s++)d=n[s],l[c]=d[0],l[c+1]=d[1],l[c+2]=d[2],c+=3}}return new h(this.map,{type:"line-geometry",id:t.id,geometryBuffer:l,indicesBuffer:u})}if(t.vertices)return new h(this.map,{type:"polygon-geometry",id:t.id,geometryBuffer:t.vertices,surface:t.surface})}else;},p.prototype.compileGroup=function(e,t){var i,r,s,a,n,o,h,l,u,c,d,p,f,g=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],m=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],v={},y=e.points,b=e.lines,x=e.polygons;for(v.id=e.id,h=0,l=y.length;h<l;h++)for(i=y[h].points,u=0,c=i.length;u<c;u++)r=i[u],r[0]>m[0]&&(m[0]=r[0]),r[1]>m[1]&&(m[1]=r[1]),r[2]>m[2]&&(m[2]=r[2]),r[0]<g[0]&&(g[0]=r[0]),r[1]<g[1]&&(g[1]=r[1]),r[2]<g[2]&&(g[2]=r[2]);for(h=0,l=b.length;h<l;h++)for(n=b[h].lines,u=0,c=n.length;u<c;u++)for(o=n[u],d=0,p=o.length;d<p;d++)r=o[d],r[0]>m[0]&&(m[0]=r[0]),r[1]>m[1]&&(m[1]=r[1]),r[2]>m[2]&&(m[2]=r[2]),r[0]<g[0]&&(g[0]=r[0]),r[1]<g[1]&&(g[1]=r[1]),r[2]<g[2]&&(g[2]=r[2]);for(h=0,l=x.length;h<l;h++)for(i=x[h].vertices,u=0,c=i.length;u<c;u++)r=i[u],r[0]>m[0]&&(m[0]=r[0]),r[1]>m[1]&&(m[1]=r[1]),r[2]>m[2]&&(m[2]=r[2]),r[0]<g[0]&&(g[0]=r[0]),r[1]<g[1]&&(g[1]=r[1]),r[2]<g[2]&&(g[2]=r[2]);if(!t){t=Math.max(m[0]-g[0]+1,m[1]-g[1]+1,m[2]-g[2]+1)/.25,t=Math.max(t,1024),t=Math.min(t,2<<20)}v.resolution=t;var w=[t/(m[0]-g[0]+1),t/(m[1]-g[1]+1),t/(m[2]-g[2]+1)];for(v.points=new Array(y.length),h=0,l=y.length;h<l;h++){s=y[h],i=s.points;var S=new Array(i.length);for(u=0,c=i.length;u<c;u++)r=i[u],S[u]=[Math.round((r[0]-g[0])*w[0]),Math.round((r[1]-g[1])*w[1]),Math.round((r[2]-g[2])*w[2])];a={points:S},s.id&&(a.id=s.id),s.properties&&(a.properties=s.properties),v.points[h]=a}for(v.lines=new Array(b.length),h=0,l=b.length;h<l;h++){s=b[h],n=s.lines;var M=new Array(n.length);for(u=0,c=n.length;u<c;u++){for(o=n[u],S=new Array(o.length),d=0,p=o.length;d<p;d++)r=o[d],S[d]=[Math.round((r[0]-g[0])*w[0]),Math.round((r[1]-g[1])*w[1]),Math.round((r[2]-g[2])*w[2])];M[u]=S}a={lines:M},s.id&&(a.id=s.id),s.properties&&(a.properties=s.properties),v.lines[h]=a}for(v.polygons=new Array(x.length),h=0,l=x.length;h<l;h++){s=x[h],i=s.vertices;var A=new Array(i.length);for(d=0,u=0,c=i.length;u<c;u++)r=i[u],A[d++]=Math.round((r[0]-g[0])*w[0]),A[d++]=Math.round((r[1]-g[1])*w[1]),A[d++]=Math.round((r[2]-g[2])*w[2]);a={vertices:A,surface:s.surface.slice()},f=s.borders;var C=new Array(f.length);for(u=0,c=C.length;u<c;u++)C[u]=f[u].slice();a.borders=C,s.id&&(a.id=s.id),s.properties&&(a.properties=s.properties),v.polygons[h]=a}return v.bbox=[g,m],m[0]>this.bboxMax[0]&&(this.bboxMax[0]=m[0]),m[1]>this.bboxMax[1]&&(this.bboxMax[1]=m[1]),m[2]>this.bboxMax[2]&&(this.bboxMax[2]=m[2]),g[0]<this.bboxMin[0]&&(this.bboxMin[0]=g[0]),g[1]<this.bboxMin[1]&&(this.bboxMin[1]=g[1]),g[2]<this.bboxMin[2]&&(this.bboxMin[2]=g[2]),v},p.prototype.makeGeodata=function(e){this.bboxMin=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],this.bboxMax=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(var t={version:1,groups:[]},i=0,r=this.groups.length;i<r;i++)t.groups.push(this.compileGroup(this.groups[i],e));if(this.nodes.length>0)for(t.nodes=[],i=0,r=this.nodes.length;i<r;i++)t.nodes.push(this.nodes[i]);return t},p.prototype.makeFreeLayer=function(e,t,i){return i||(i=this.makeGeodata(t)),e||(e={layers:{"my-lines":{filter:["==","#type","line"],line:!0,"line-width":4,"line-color":[255,0,255,255],"zbuffer-offset":[-5,0,0]},"my-points":{filter:["==","#type","point"],point:!0,"point-radius":10,"point-color":[0,0,255,255],"zbuffer-offset":[-5,0,0]}}}),{credits:[],displaySize:1024,extents:{ll:this.bboxMin,ur:this.bboxMax},geodata:i,style:e,type:"geodata"}},t.a=p},function(e,t,i){"use strict";var r=i(1),s=i(4),a=i(2),n=i(164),o=i(140),h=r.e,l=s.a,u=a.a,c=n.a,d=o.a,p=function(e,t,i){if(this.map=e,this.stats=e.stats,this.geodata=t,this.gpu=this.map.renderer.gpu,this.renderer=this.map.renderer,this.gpuGroups=[],this.currentGpuGroup=null,this.tile=i.tile,this.surface=i.surface,this.surface.geodataProcessor)this.surface.styleChanged&&(this.surface.geodataProcessor.setStylesheet(this.surface.stylesheet),this.surface.styleChanged=!1);else{var r=new d(this,this.onGeodataProcessorMessage.bind(this));r.setStylesheet(this.surface.stylesheet),this.surface.geodataProcessor=r,this.map.geodataProcessors.push(r)}this.geodataProcessor=this.surface.geodataProcessor,this.processing=!1,this.statsCounter=0,this.size=0,this.killed=!1,this.killedByCache=!1,this.ready=!1,this.isReady()};p.prototype.kill=function(){this.killed=!0,this.geodata=null,this.killGeodataView(!1)},p.prototype.killGeodataView=function(e){this.killedByCache=e;for(var t=0,i=this.gpuGroups.length;t<i;t++)this.gpuGroups[t].kill();this.gpuGroups=[],!0!==e&&null!=this.gpuCacheItem&&this.map.gpuCache.remove(this.gpuCacheItem),this.stats.gpuGeodata-=this.size,this.stats.graphsFluxGeodata[1][0]++,this.stats.graphsFluxGeodata[1][1]+=this.size,this.ready=!1,this.size=0,this.gpuCacheItem=null},p.prototype.processPackedCommands=function(e,t){var i,r,s,a=e.byteLength,n=this.map.config.mapMaxGeodataProcessingTime,o=performance.now(),h=new DataView(e.buffer);do{var l=e[t];switch(t+=1,l){case 9:t+=1,i=h.getUint32(t),t+=4,r=u.unint8ArrayToString(new Uint8Array(e.buffer,t,i)),t+=i,s=JSON.parse(r),this.currentGpuGroup=new c(s.id,s.bbox,s.origin,this.gpu,this.renderer),this.gpuGroups.push(this.currentGpuGroup);break;case 10:this.size+=this.currentGpuGroup.size,t+=5;break;case 5:t=this.currentGpuGroup.addRenderJob2(e,t,this.tile);break;case 7:this.map.markDirty(),this.gpuCacheItem=this.map.gpuCache.insert(this.killGeodataView.bind(this,!0),this.size),this.stats.gpuGeodata+=this.size,this.stats.graphsFluxGeodata[0][0]++,this.stats.graphsFluxGeodata[0][1]+=this.size,this.ready=!0,this.processing=!1,t+=5}if(performance.now()-o>n&&t<a)return t}while(t<a);return this.stats.renderBuild+=performance.now()-o,-1},p.prototype.onGeodataProcessorMessage=function(e,t,i){if(!this.killed&&!this.killedByCache)switch(e){case"addPackedCommands":if(i){var r=this.processPackedCommands(t.buffer,t.index);if(!(r<0))return t.index=r,-123;this.map.markDirty()}else t.index=0,this.map.markDirty(),this.map.addProcessingTask2(this.onGeodataProcessorMessage.bind(this,e,t,!0));break;case"ready":if(this.geodataProcessor.processCounter>0&&--this.geodataProcessor.processCounter>0){this.map.markDirty();break}t.geodata&&(this.geodata.geodata=t.geodata),this.geodataProcessor.busy=!1,this.map.markDirty()}},p.prototype.isReady=function(e,t,i){if(this.killed)return!1;var r=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||r,!this.ready&&!this.processing&&!e&&this.surface.stylesheet.isReady()&&this.geodata.isReady(e,t,i)&&this.geodataProcessor.isReady()){this.processing=!0,this.killedByCache=!1,this.geodataProcessor.setListener(this.onGeodataProcessorMessage.bind(this));var s=this.geodata.geodata;this.map.config.mapGeodataBinaryLoad&&"string"!=typeof s?this.geodataProcessor.sendCommand("processGeodataRaw",s,this.tile,window.devicePixelRatio||1,[s]):this.geodataProcessor.sendCommand("processGeodata",s,this.tile,window.devicePixelRatio||1),this.geodataProcessor.busy=!0}return!e&&this.gpuCacheItem&&this.map.gpuCache.updateItem(this.gpuCacheItem),this.ready},p.prototype.getWorldMatrix=function(e,t,i){var r=i;return null!=r?(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e.min[0]-t[0],r[13]=e.min[1]-t[1],r[14]=e.min[2]-t[2],r[15]=1):(r=h.create(),h.multiply(l.translationMatrix(e.min[0]-t[0],e.min[1]-t[1],e.min[2]-t[2]),l.scaleMatrix(1,1,1),r)),r},p.prototype.draw=function(e){if(this.ready){for(var t=this.renderer,i=this.tile?Math.abs(this.tile.tiltAngle):t.cameraTiltFator,r=(t.useSuperElevation,0),s=this.gpuGroups.length;r<s;r++){var a=this.gpuGroups[r];if(a.rootNode)a.draw(o,n,null,i,this.tile?this.tile.texelSize:1);else if(a.jobs.length||a.rootNode){var n=a.mvp,o=a.mv,l=n;h.multiply(t.camera.getModelviewFMatrix(),this.getWorldMatrix(a.bbox,e,l),o);var u=t.camera.getProjectionFMatrix();h.multiply(u,o,n),a.draw(o,n,null,i,this.tile?this.tile.texelSize:1),this.stats.drawnFaces+=a.polygons,this.stats.drawCalls+=a.jobs.length}}this.statsCoutner!=this.stats.counter&&(this.statsCoutner=this.stats.counter,this.stats.gpuRenderUsed+=this.size)}return this.ready},t.a=p},function(e,t,i){"use strict";var r=i(5),s=i(2),a=i(49),n=r.a,o=s.a,h=(a.a,function(e,t,i){this.map=e,this.stats=e.stats,this.mapLoaderUrl=t,this.extraInfo=i,this.bbox=new n,this.size=0,this.fileSize=0,this.geodata=null,this.type="geodata",this.cacheItem=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.map.markDirty()});h.prototype.kill=function(){this.bbox=null,this.killGeodata()},h.prototype.killGeodata=function(e){this.geodata&&(this.geodata=null),!0!==e&&null!=this.cacheItem&&this.map.resourcesCache.remove(this.cacheItem),this.loadState=0,this.size=0,this.fileSize=0,this.cacheItem=null},h.prototype.isReady=function(e,t){var i=this.map.stats.gpuRenderUsed>=this.map.maxGpuUsed;if(e=e||i,2==this.loadState)return this.map.resourcesCache.updateItem(this.cacheItem),!0;if(0==this.loadState)if(e);else{if("object"==typeof this.mapLoaderUrl)return this.geodata=JSON.stringify(this.mapLoaderUrl),this.loadState=2,this.size=this.geodata.length,this.cacheItem=this.map.resourcesCache.insert(this.killGeodata.bind(this,!0),this.size),this.map.resourcesCache.updateItem(this.cacheItem),!0;this.scheduleLoad(t)}else 3==this.loadState&&this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(t);return!1},h.prototype.scheduleLoad=function(e){this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this),e,this.extraInfo.tile,"geodata")},h.prototype.onLoad=function(e,t,i){this.mapLoaderCallLoaded=t,this.mapLoaderCallError=i,this.loadState=1,this.map.config.mapGeodataBinaryLoad?this.map.loader.processLoadBinary(e,this.onLoaded.bind(this),this.onLoadError.bind(this),null,"geodata"):o.loadJSON(e,this.onLoaded.bind(this),this.onLoadError.bind(this),!0,!!o.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)},h.prototype.onLoadError=function(){this.map.killed||(this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},h.prototype.onLoaded=function(e){if(!this.map.killed){var t=e.length||e.byteLength;t||(t=0),this.size=t,this.fileSize=t,this.geodata=e,this.cacheItem=this.map.resourcesCache.insert(this.killGeodata.bind(this,!0),t),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},t.a=h},function(e,t,i){"use strict";var r=i(58),s=i(55),a=i(147),n=i(145),o=i(51),h=r.a,l=s.a,u=a.a,c=n.a,d=o.a,p=function(e,t,i){this.map=e,this.id=i,this.parent=t,this.metatiles={},this.meshes={},this.textures={},this.subtextures={},this.geodata={},this.credits={},this.children=[null,null,null,null]};p.prototype.kill=function(){for(var e=0;e<4;e++)null!=this.children[e]&&this.children[e].kill();this.children=[null,null,null,null];var t=this.parent;this.parent=null,null!=t&&t.removeChild(this)},p.prototype.addChild=function(e){if(!this.children[e]){var t=this.id,i=[t[0]+1,t[1]<<1,t[2]<<1];switch(e){case 1:i[1]++;break;case 2:i[2]++;break;case 3:i[1]++,i[2]++}this.children[e]=new p(this.map,this,i)}},p.prototype.removeChildByIndex=function(e){null!=this.children[e]&&(this.children[e].kill(),this.children[e]=null)},p.prototype.removeChild=function(e){for(var t=0;t<4;t++)this.children[t]==e&&(this.children[t].kill(),this.children[t]=null)},p.prototype.getMesh=function(e,t){var i=this.meshes[e];return i||(i=new c(this.map,e,t),this.meshes[e]=i),i},p.prototype.getGeodata=function(e,t){var i=this.geodata[e];return i||(i=new d(this.map,e,t),this.geodata[e]=i),i},p.prototype.getTexture=function(e,t,i,r,s,a){var n;if(r&&(r.layer||r.hmap)){var o=e+(r.hmap?"":r.layer.id);n=this.textures[o],n||(n=new h(this.map,e,t,i,r,s,a),this.textures[o]=n)}else(n=this.textures[e])||(n=new h(this.map,e,t,i,r,s,a),this.textures[e]=n);return n},p.prototype.getSubtexture=function(e,t,i,r,s,a,n){return e=this.subtextures[t],e||(e=new l(this.map,t,i,r,s,a,n),this.subtextures[t]=e),e},p.prototype.addMetatile=function(e,t){this.metatiles[e]=t},p.prototype.removeMetatile=function(e){for(var t in this.metatiles)this.metatiles[t]==e&&delete this.metatiles[t]},p.prototype.getMetatile=function(e,t,i){var r,s=this.metatiles;for(var a in s)if(s[a].surface==e)return s[a];var n=e.getMetaUrl(this.id);return s[n]?(r=s[n].clone(e),this.addMetatile(n,r),r):t?(r=new u(this,e,i),this.addMetatile(n,r),r):null},t.a=p},function(e,t,i){"use strict";var r=i(58),s=i(4),a=i(23),n=i.n(a),o=r.a,h=s.a,l=n.a,u=function(e,t,i){if(this.map=e,this.id=t,this.proj4=e.proj4,this.comment=i.comment||null,this.srsDef=i.srsDef||null,this.srsModifiers=i.srsModifiers||[],this.type=i.type||"projected",this.vdatum=i.vdatum||"orthometric",this.srsDef=i.srsDefEllps||this.srsDef,this.periodicity=this.parsePeriodicity(i.periodicity),this.srsInfo=this.proj4(this.srsDef).info(),this.geoidGrid=null,this.geoidGridMap=null,this.srsProj4=this.proj4(this.srsDef,null,null,!0),this.latlonProj4=null,this.proj4Cache={},i.geoidGrid){var r=i.geoidGrid;if(this.geoidGrid={definition:r.definition||null,srsDefEllps:r.srsDefEllps||null,valueRange:r.valueRange||[0,1]},r.extents?this.geoidGrid.extents={ll:r.extents.ll,ur:r.extents.ur}:this.geoidGrid.extents={ll:[0,0],ur:[1,1]},this.geoidGrid.definition){var s=this.map.url.makeUrl(this.geoidGrid.definition,{},null);this.geoidGridMap=new o(this.map,s,!0)}this.geoidGrid.srsDefEllps&&(this.geoidGrid.srsProj4=this.proj4(this.geoidGrid.srsDefEllps,null,null,!0))}"geographic"==this.type&&(this.spheroid=i.spheroid||null,this.spheroid)};u.prototype.parsePeriodicity=function(e){return null==e?null:{type:e.type||"",period:e.period||0}},u.prototype.getInfo=function(){return{comment:this.comment,srsDef:this.srsDef,srsModifiers:this.srsModifiers,type:this.type,vdatum:this.vdatum,srsDefEllps:this.srsDef,a:this.srsInfo.a,b:this.srsInfo.b}},u.prototype.getSrsInfo=function(){return this.srsInfo},u.prototype.isReady=function(){return this.isGeoidGridReady()},u.prototype.isGeoidGridReady=function(){return null==this.geoidGrid||null!=this.geoidGridMap&&this.geoidGridMap.isReady()},u.prototype.isProjected=function(){return"projected"==this.type},u.prototype.getOriginalHeight=function(e){var t=e[2]||0;return t/=this.getVerticalAdjustmentFactor(e),t+=this.getGeoidGridDelta(e)},u.prototype.getFinalHeight=function(e){var t=e[2]||0;return t-=this.getGeoidGridDelta(e),t*=this.getVerticalAdjustmentFactor(e)},u.prototype.getGeoidGridDelta=function(e){if(null!=this.geoidGridMap&&this.isGeoidGridReady()){var t=this.proj4(this.srsProj4,this.geoidGrid.srsProj4,[e[0],e[1]]),i=t[0]-this.geoidGrid.extents.ll[0],r=this.geoidGrid.extents.ur[1]-t[1],s=this.geoidGridMap.getImageExtents();i*=s[0]/(this.geoidGrid.extents.ur[0]-this.geoidGrid.extents.ll[0]),r*=s[1]/(this.geoidGrid.extents.ur[1]-this.geoidGrid.extents.ll[1]),i=h.clamp(i,0,s[0]-2),r=h.clamp(r,0,s[1]-2);var a=Math.floor(i),n=Math.floor(r),o=i-a,l=r-n,u=this.geoidGridMap.getImageData(),c=n*s[0],d=c+s[0],p=u[4*(c+a)],f=u[4*(c+a+1)],g=u[4*(d+a)],m=u[4*(d+a+1)],v=p+(f-p)*o,y=g+(m-g)*o,b=v+(y-v)*l;return b=this.geoidGrid.valueRange[0]+b*((this.geoidGrid.valueRange[1]-this.geoidGrid.valueRange[0])/255)}return 0},u.prototype.getVerticalAdjustmentFactor=function(e){if(-1!=this.srsModifiers.indexOf("adjustVertical")){var t=this.getSrsInfo(),i="+proj=longlat  +alpha=0 +gamma=0 +a="+t.a+" +b="+t.b+" +x0=0 +y0=0";this.latlonProj4||(this.latlonProj4=this.proj4(i,null,null,!0));var r=this.proj4(this.srsProj4,this.latlonProj4,[e[0],e[1]]),s=new l.Geodesic.Geodesic(t.a,t.a/t.b-1),a=s.Direct(r[1],r[0],90,1e3);r=[a.lon2,a.lat2],r=this.proj4(this.latlonProj4,this.srsProj4,r);var n=r[0]-e[0],o=r[1]-e[1];return Math.sqrt(n*n+o*o)/1e3}return 1},u.prototype.convertCoordsTo=function(e,t,i){if(this.isReady(),"string"!=typeof t){if(t.id==this.id)return e.slice();t.isReady()}e=e.slice();var r="string"==typeof t;e[2]=this.getOriginalHeight(e);var s=r?t:t.srsProj4,a=r?t:t.srsDef,n=this.proj4Cache[a];n||(n=this.proj4(this.srsProj4,s),this.proj4Cache[a]=n);var o=n.forward(e);return i||r||(o[2]=t.getFinalHeight(o)),o},u.prototype.convertCoordsToFast=function(e,t,i,r,s,a){var n=t.srsProj4,o=t.srsDef,h=this.proj4Cache[o];h||(h=this.proj4(this.srsProj4,n),this.proj4Cache[o]=h);var l=h.forward(e);r[a]=l[0],r[a+1]=l[1],r[a+2]=l[2],t.geoidGrid&&(r[a+2]-=t.getGeoidGridDelta(e))},u.prototype.convertCoordsFrom=function(e,t){if(this.isReady(),"string"!=typeof t){if(t.id==this.id)return e.slice();t.isReady()}e=e.slice(),"string"!=typeof t&&(e[2]=t.getOriginalHeight(e));var i="string"==typeof t?t:t.srsProj4,r="string"==typeof t?t:t.srsDef,s=this.proj4Cache[r];s||(s=this.proj4(this.srsProj4,i),this.proj4Cache[r]=s);var a=s.inverse(e);return a[2]=this.getFinalHeight(a),a},u.prototype.phi2z=function(e,t){for(var i,r,s=.5*Math.PI,a=.5*e,n=s-2*Math.atan(t),o=0;o<=15;o++)if(i=e*Math.sin(n),r=s-2*Math.atan(t*Math.pow((1-i)/(1+i),a))-n,n+=r,Math.abs(r)<=1e-10)return n;return-9999},u.prototype.convertMercToWGS=function(e,t,i,r){var s=2*Math.PI,a=.5*Math.PI,n=this.srsProj4,o=e[i]-n.x0,h=e[i+1]-n.y0;if(n.sphere)t[r+1]=a-2*Math.atan(Math.exp(-h/(n.a*n.k0)));else{var l=Math.exp(-h/(n.a*n.k0)),u=this.phi2z(n.e,l);if(t[r+1]=u,-9999===u)return}o=n.long0+o/(n.a*n.k0);t[r]=Math.abs(o)<=3.14159265359?o:o-(o<0?-1:1)*s,t[r+2]=e[i+2]},u.prototype.convertWGSToGeocent=function(e,t,i,r,s){var a,n,o,h,l=t.datum,u=.5*Math.PI,c=e[r],d=e[r+1],p=e[r+2];if(d<-u&&d>-1.001*u)d=-u;else if(d>u&&d<1.001*u)d=u;else if(d<-u||d>u)return null;c>Math.PI&&(c-=2*Math.PI),n=Math.sin(d),h=Math.cos(d),o=n*n,a=l.a/Math.sqrt(1-l.es*o),i[s]=(a+p)*h*Math.cos(c),i[s+1]=(a+p)*h*Math.sin(c),i[s+2]=(a*(1-l.es)+p)*n},t.a=u},function(e,t,i){"use strict";var r=i(2),s=r.a,a=function(e,t,i,r){this.generateLines=!0,this.map=e,this.renderer=this.map.renderer,this.stats=e.stats,this.id=t,this.url=null,this.data=null,this.loadState=0,this.size=0,this.fileSize=0,this.freeLayer=r,this.fonts={},this.fontsReady=!1,"object"==typeof i?(this.data=i,this.setFonts(this.data),this.loadState=2,this.map.markDirty()):(this.freeLayer?this.url=this.freeLayer.processUrl(i,""):this.url=this.map.url.processUrl(i),s.loadJSON(this.url,this.onLoaded.bind(this),this.onLoadError.bind(this),null,!!s.useCredentials&&-1!=this.url.indexOf(this.map.url.baseUrl),this.map.core.xhrParams),this.loadState=1)};a.prototype.kill=function(){},a.prototype.setData=function(e){this.data=e,this.setFonts(e),this.loadState=2,this.checkFonts()},a.prototype.checkFonts=function(){var e=!0;for(var t in this.fonts)e=e&&this.renderer.getFont(this.fonts[t]).isReady();return this.fontsReady=e,e},a.prototype.isReady=function(e,t){return 2==this.loadState?!!this.fontsReady||this.checkFonts():(0==this.loadState&&(e||this.scheduleLoad(t)),!1)},a.prototype.scheduleLoad=function(e){this.map.loader.load(this.url,this.onLoad.bind(this),e)},a.prototype.onLoad=function(){this.loadState=1},a.prototype.onLoadError=function(){this.map.killed},a.prototype.setFonts=function(e){this.fonts=e.fonts||{},this.fonts["#default"]||(this.fonts["#default"]=this.map.core.config.mapDefaultFont)},a.prototype.onLoaded=function(e){this.map.killed||(this.data=e,this.setFonts(e),this.loadState=2,this.map.markDirty())},t.a=a},function(e,t,i){"use strict";var r=i(2),s=i(6),a=r.a,n=s.a,o=function(e,t,i,r,s){this.map=e,this.stats=e.stats,this.tile=r,this.internal=s,this.image=null,this.imageData=null,this.imageExtents=null,this.gpuTexture=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.neverReady=!1,this.mapLoaderUrl=t,this.type=i||!1,this.statsCounter=0,this.checkStatus=0,this.checkType=null,this.checkValue=null,this.fastHeaderCheck=!1,this.gpuSize=0,this.fileSize=0,this.cacheItem=null,this.gpuCacheItem=null};o.prototype.kill=function(){this.killImage(),this.killGpuTexture(),this.mask&&(this.mask.killImage(),this.mask.killGpuTexture())},o.prototype.killImage=function(e){this.image=null,this.imageData=null,!0!==e&&this.cacheItem&&this.map.resourcesCache.remove(this.cacheItem),this.mask&&this.mask.killImage(),this.gpuTexture||(this.loadState=0),this.cacheItem=null},o.prototype.killGpuTexture=function(e){null!=this.gpuTexture&&(this.stats.gpuTextures-=this.gpuTexture.size,this.gpuTexture.kill(),this.stats.graphsFluxTexture[1][0]++,this.stats.graphsFluxTexture[1][1]+=this.gpuTexture.size,this.mask&&this.mask.killGpuTexture()),this.gpuTexture=null,!0!==e&&this.gpuCacheItem&&this.map.gpuCache.remove(this.gpuCacheItem),this.image||this.imageData||(this.loadState=0),this.gpuCacheItem=null},o.prototype.isReady=function(e,t,i,r){var s=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||s,this.neverReady)return!1;switch(r.checkType){case 2:case 3:case 4:if(2!=this.checkStatus){if(this.checkType=r.checkType,this.checkValue=r.checkValue,0==this.checkStatus)this.scheduleHeadRequest(t,4==this.checkType);else if(3==this.checkStatus)this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleHeadRequest(t,4==this.checkType);else if(-1==this.checkStatus&&r.extraInfo)for(r.extraBound||(r.extraBound={tile:r.extraInfo.tile,layer:r.extraInfo.layer},r.setBoundTexture(r.extraBound.tile.parent,r.extraBound.layer));r.extraBound.texture.extraBound||-1==r.extraBound.texture.checkStatus;)r.setBoundTexture(r.extraBound.sourceTile.parent,r.extraBound.layer);return!1}}if(2==this.loadState){var a;if(!e&&this.cacheItem&&this.map.resourcesCache.updateItem(this.cacheItem),i)return 1==this.type&&(this.imageData||(a=performance.now(),this.buildHeightMap(),this.stats.renderBuild+=performance.now()-a)),!0;if(1==this.type)this.imageData||(a=performance.now(),this.buildHeightMap(),this.stats.renderBuild+=performance.now()-a);else{if(!this.gpuTexture){if(this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed)return!1;if(s)return!1;a=performance.now(),this.buildGpuTexture(),this.stats.renderBuild+=performance.now()-a}!e&&this.gpuCacheItem&&this.map.gpuCache.updateItem(this.gpuCacheItem)}return!0}return 0==this.loadState?e||this.scheduleLoad(t):3==this.loadState&&this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(t),!1},o.prototype.scheduleLoad=function(e,t){this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this,t),e,this.tile,this.internal?"texture-in":"texture-ex")},o.prototype.onLoad=function(e,t,i,r){this.mapLoaderCallLoaded=i,this.mapLoaderCallError=r;var s=this.onLoadError.bind(this),n=this.onLoaded.bind(this);e?this.checkStatus=1:this.loadState=1,this.map.config.mapXhrImageLoad?this.map.loader.processLoadBinary(t,this.onBinaryLoaded.bind(this),s,null,"texture"):this.image=a.loadImage(t,n,s,!!this.map.core.tokenCookieHost&&-1!=t.indexOf(this.map.core.tokenCookieHost))},o.prototype.onLoadError=function(e){this.map.killed||(e&&window.URL.revokeObjectURL(this.image.src),this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},o.prototype.onBinaryLoaded=function(e,t,i){if(this.fastHeaderCheck&&this.checkType&&1!=this.checkType&&(this.onHeadLoaded(null,e,null),-1==this.checkStatus))return void this.mapLoaderCallLoaded();if(t)return this.onLoaded(!1,e),void(this.fileSize=i);if(this.fileSize=e.size,this.map.config.mapAsyncImageDecode)createImageBitmap(e).then(this.onLoaded.bind(this,!1));else{var r=new Image;r.onerror=this.onLoadError.bind(this,!0,null),r.onload=this.onLoaded.bind(this,!0,null),this.image=r,r.src=window.URL.createObjectURL(e)}},o.prototype.onLoaded=function(e,t){if(!this.map.killed){e&&window.URL.revokeObjectURL(this.image.src),t&&(this.image=t,this.image.naturalWidth=t.width,this.image.naturalHeight=t.height);var i=this.image.naturalWidth*this.image.naturalHeight*(this.heightMap,3);this.gpuSize=this.image.naturalWidth*this.image.naturalHeight*4,this.cacheItem=this.map.resourcesCache.insert(this.killImage.bind(this,!0),i),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},o.prototype.scheduleHeadRequest=function(e,t){this.map.config.mapXhrImageLoad&&this.fastHeaderCheck?this.scheduleLoad(e,!0):this.map.loader.load(this.mapLoaderUrl,this.onLoadHead.bind(this,t),e,this.tile,this.internal,this.internal?"texture-in":"texture-ex")},o.prototype.onLoadHead=function(e,t,i,r){this.mapLoaderCallLoaded=i,this.mapLoaderCallError=r;var s=this.onLoadHeadError.bind(this,e),n=this.onHeadLoaded.bind(this,e);this.checkStatus=1,e?this.map.loader.processLoadBinary(t,onLoad,s,null,"texture"):a.headRequest(t,n,s,!!a.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams,"blob")},o.prototype.onLoadHeadError=function(){this.map.killed||(this.checkStatus=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},o.prototype.onHeadLoaded=function(e,t,i){if(!this.map.killed)if(this.checkStatus=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.map.config.mapXhrImageLoad&&this.fastHeaderCheck)switch(this.checkType){case 4:t&&t.size==this.checkValue&&(this.checkStatus=-1);break;case 2:t&&t.type==this.checkValue&&(this.checkStatus=-1);break;case 3:i&&-1!=this.checkValue.indexOf(i)&&(this.checkStatus=-1)}else{switch(this.checkType){case 4:t&&t.byteLength==this.checkValue&&(this.checkStatus=-1);break;case 2:t&&-1!=t.indexOf(this.checkValue)&&(this.checkStatus=-1);break;case 3:i&&-1!=this.checkValue.indexOf(i)&&(this.checkStatus=-1)}this.mapLoaderCallLoaded()}},o.prototype.buildGpuTexture=function(){if(this.map.config.mapCheckTextureSize&&(this.image.naturalWidth>1024||this.image.naturalHeight>1024))return console.log("very large texture: "+this.image.naturalWidth+"x"+this.image.naturalHeight+" "+this.mapLoaderUrl),this.gpuTexture=this.map.renderer.blackTexture,void(this.gpuSize=0);this.gpuTexture=new n(this.map.renderer.gpu,null,this.map.core),this.gpuTexture.createFromImage(this.image,2==this.type?"nearest":"linear",!1),this.gpuSize=this.gpuTexture.getSize(),this.stats.gpuTextures+=this.gpuSize,this.stats.graphsFluxTexture[0][0]++,this.stats.graphsFluxTexture[0][1]+=this.gpuSize,this.gpuCacheItem=this.map.gpuCache.insert(this.killGpuTexture.bind(this,!0),this.gpuSize)},o.prototype.buildHeightMap=function(){var e=document.createElement("canvas");e.width=this.image.naturalWidth,e.height=this.image.naturalHeight;var t=e.getContext("2d");t.drawImage(this.image,0,0),this.imageData=t.getImageData(0,0,this.image.naturalWidth,this.image.naturalHeight).data,this.imageExtents=[this.image.naturalWidth,this.image.naturalHeight],this.image=null},o.prototype.getGpuTexture=function(){return this.gpuTexture},o.prototype.getHeightMapValue=function(e,t){return this.imageData?this.imageData[4*(t*this.imageExtents[0]+e)]:0},t.a=o},function(e,t,i){"use strict";var r=i(1),s=i(154),a=r.b,n=s.a,o=function(e,t,i){this.map=e,this.camera=e.camera,this.rootId=[0,0,0],this.freeLayer=t,this.freeLayerSurface=i,this.metaBinaryOrder=this.map.referenceFrame.params.metaBinaryOrder,this.surfaceTree=new n(this.map,null,this.rootId),this.surfaceSequence=[],this.surfaceOnlySequence=[],this.config=this.map.config,this.cameraPos=[0,0,0],this.worldPos=[0,0,0],this.ndcToScreenPixel=1,this.counter=0};o.prototype.kill=function(){this.surfaceTree=null,this.metastorageTree=null,this.surfaceTracer=null,this.heightTracer=null},o.prototype.findSurfaceTile=function(e){for(var t=this.surfaceTree,i=e[0];i>0;i--){var r=1<<i-1,s=0;if(0!=(e[1]&r)&&(s+=1),0!=(e[2]&r)&&(s+=2),!(t=t.children[s]))return null}return t},o.prototype.findNavTile=function(e){var t=this.surfaceTree;if(0==e[0])return t.metanode&&t.metanode.hasNavtile()?t:null;for(var i=null,r=e[0];r>0;r--){var s=1<<r-1,a=0;if(0!=(e[1]&s)&&(a+=1),0!=(e[2]&s)&&(a+=2),!(t=t.children[a]))return i;t.metanode&&t.metanode.hasNavtile()&&(i=t)}return i},o.prototype.draw=function(e){this.cameraPos=[0,0,0],this.worldPos=[0,0,0];var t=this.map,i=t.draw;this.ndcToScreenPixel=i.ndcToScreenPixel;var r=t.getPhysicalSrs(),s=r.periodicity;if(!this.freeLayerSurface||!this.freeLayerSurface.geodata||0==i.drawChannel)if(null!=s)this.drawSurface([0,0,0]),"X"==s.type&&(this.drawSurface([s.period,0,0],e),this.drawSurface([-s.period,0,0],e));else{switch(this.freeLayerSurface&&this.freeLayerSurface.geodata?t.config.mapGeodataLoadMode:t.config.mapLoadMode){case"topdown":t.config.mapSplitMeshes?this.drawSurfaceWithSpliting([0,0,0],e):this.drawSurface([0,0,0],e);break;case"downtop":this.drawSurfaceDownTop([0,0,0],e);break;case"fit":this.drawSurfaceFit([0,0,0],e);break;case"fitonly":this.drawSurfaceFitOnly([0,0,0],e)}}},o.prototype.updateNodeHeightExtents=function(e,t){if(!t.heightReady&&t.metatile.useVersion<4){for(var i=e.parent;i;){var r=i.metanode;if(r.hasNavtile()){t.minHeight=r.minHeight,t.maxHeight=r.maxHeight,t.minZ=r.minZ,t.maxZ=r.maxZ,t.minZ2=r.minZ2,t.maxZ2=r.maxZ2,t.generateCullingHelpers();break}i=i.parent}t.heightReady=!0}},o.prototype.logTileInfo=function(e,t,i){if(e&&t){var r=e.bboxVisible(e.id,t.bbox,i,t);e.updateTexelSize(),console.log("tile: "+JSON.stringify(e.id)+" visible: "+r+" texelsize: "+e.texelSize+" center: "+JSON.stringify(t.diskPos)+" vec: "+t.diskNormal+"ang: "+t.diskAngle+" dist: "+t.diskDistance)}},o.prototype.drawSurface=function(e,t){this.counter++;var i=this.surfaceTree;if(i.isMetanodeReady(this,0)){var r=this.map,s=i.metanode,a=r.camera.position;if(i.bboxVisible(i.id,s.bbox,a,s)){i.updateTexelSize();var n=(this.freeLayerSurface,1),o=r.draw,h=o.drawTiles,l=o.drawBuffer,u=o.processBuffer,c=o.processBuffer2,d=0,p=0,f=0,g=0,m=0,v=0;u[0]=i,p=1;var y=o.texelSizeFit,b=o.replay,x=b.storeNodes||b.storeFreeNodes,w=b.nodeBuffer;o.drawCounter++;var S,M,A,C=1,T=1,P=1,F=o.drawCounter;do{var L=0;for(f=0,S=p-1;S>=0;S--)if(i=u[S],s=i.metanode,s&&(C++,s.metatile.drawCounter!=F&&(s.metatile.drawCounter=F,T++)),i.bboxVisible(i.id,s.bbox,a,s))if(P++,i.texelSize!=Number.POSITIVE_INFINITY&&i.texelSize>L&&(L=i.texelSize),x&&w.push(i),i.texelSize<=y)v=o.getDrawCommandsGpuSize(i.drawCommands[o.drawChannel]||i.lastRenderState.drawCommands[o.drawChannel]),g+=v,m+=v,i.drawCounter=o.drawCounter,l[d]=i,d++;else{v=o.getDrawCommandsGpuSize(i.drawCommands[o.drawChannel]||i.lastRenderState.drawCommands[o.drawChannel]),g+=v;var E=0,k=0,N=[];for(M=0;M<4;M++){var B=i.children[M];if(B&&(E++,B.isMetanodeReady(this,B.id[0]))){this.updateNodeHeightExtents(B,B.metanode),B.updateTexelSize(1);var I=B.id[0]*n*B.distance;i.surface&&B.metanode.hasGeometry()?h.drawSurfaceTile(B,B.metanode,a,B.texelSize,I,!0,!1,!0)&&(k++,N.push(B)):(k++,N.push(B))}}if(E>0&&E==k){do{var R=!0;for(M=0,A=N.length-1;M<A;M++)if(N[M].distance>N[M+1].distance){var U=N[M];N[M]=N[M+1],N[M+1]=U,R=!1}}while(!R);for(M=0,A=N.length;M<A;M++)c[f]=N[M],f++}else m+=v,i.drawCounter=o.drawCounter,l[d]=i,d++}var D=u;u=c,c=D,p=f}while(p>0);if(t)return void this.storeDrawBufferGeometry(d);0>o.bestMeshTexelSize&&(o.bestMeshTexelSize=0);var z=r.stats;z.usedNodes=P,z.processedNodes=C,z.processedMetatiles=T,z.gpuNeeded=g,this.processDrawBuffer(o,h,a,r,z,!1,!1,b,l,d,!0)}}},o.prototype.drawSurfaceWithSpliting=function(e,t){this.counter++;var i=this.surfaceTree;if(i.isMetanodeReady(this,0)){var r=this.map,s=i.metanode,a=r.camera.position;if(i.bboxVisible(i.id,s.bbox,a,s)){i.updateTexelSize();var n=(this.freeLayerSurface,1),o=r.draw,h=o.drawTiles,l=o.drawBuffer,u=o.processBuffer,c=o.processBuffer2,d=0,p=0,f=0,g=0,m=0,v=0;u[0]=i,p=1;var y=o.texelSizeFit,b=o.replay,x=b.storeNodes||b.storeFreeNodes,w=b.nodeBuffer;o.drawCounter++;var S,M,A,C=1,T=1,P=1,F=o.drawCounter;do{var L=0;for(f=0,S=p-1;S>=0;S--)if(i=u[S],s=i.metanode,s&&(C++,s.metatile.drawCounter!=F&&(s.metatile.drawCounter=F,T++)),i.splitMask=null,i.visibleCounter==F||i.bboxVisible(i.id,s.bbox,a,s))if(P++,i.texelSize!=Number.POSITIVE_INFINITY&&i.texelSize>L&&(L=i.texelSize),x&&w.push(i),i.texelSize<=y)i.skipRenderCounter!=F&&(v=o.getDrawCommandsGpuSize(i.drawCommands[o.drawChannel]||i.lastRenderState.drawCommands[o.drawChannel]),g+=v,m+=v,i.drawCounter=F,l[d]=i,d++);else{v=o.getDrawCommandsGpuSize(i.drawCommands[o.drawChannel]||i.lastRenderState.drawCommands[o.drawChannel]),g+=v;var E=0,k=[],N=[1,1,1,1],B=!1;for(M=0;M<4;M++){var I=i.children[M];if(I)if(E++,I.skipRenderCounter=i.skipRenderCounter,I.isMetanodeReady(this,I.id[0])){if(this.updateNodeHeightExtents(I,I.metanode),I.updateTexelSize(1),!I.bboxVisible(I.id,I.metanode.bbox,a,I.metanode))continue;I.visibleCounter=o.drawCounter;var R=I.id[0]*n*I.distance;i.surface&&I.metanode.hasGeometry()?h.drawSurfaceTile(I,I.metanode,a,I.texelSize,R,!0,!1,!0)?(k.push(I),N[M]=0):(k.push(I),I.skipRenderCounter=F,B=!0):k.push(I)}else B=!0}if(k.length>0){do{var U=!0;for(M=0,A=k.length-1;M<A;M++)if(k[M].distance>k[M+1].distance){var D=k[M];k[M]=k[M+1],k[M+1]=D,U=!1}}while(!U);for(M=0,A=k.length;M<A;M++)c[f]=k[M],f++}(0==E||B)&&i.skipRenderCounter!=F&&(m+=v,i.splitMask=B?N:null,i.drawCounter=F,l[d]=i,d++)}var z=u;u=c,c=z,p=f}while(p>0);if(t)return void this.storeDrawBufferGeometry(d);0>o.bestMeshTexelSize&&(o.bestMeshTexelSize=0);var _=r.stats;_.usedNodes=P,_.processedNodes=C,_.processedMetatiles=T,_.gpuNeeded=g,this.processDrawBuffer(o,h,a,r,_,!1,!1,b,l,d,!0)}}},o.prototype.drawSurfaceFitOnly=function(e,t,i){this.counter++;var r=this.surfaceTree;if(r.isMetanodeReady(this,0)){var s=this.map,a=r.metanode,n=s.camera.position;if(r.bboxVisible(r.id,a.bbox,n,a)){r.updateTexelSize();var o=s.draw,h=o.drawTiles,l=o.drawBuffer,u=o.processBuffer,c=o.processBuffer2,d=0,p=0,f=0;u[0]=r,p=1;var g=o.texelSizeFit,m=s.draw.replay,v=m.storeNodes||m.storeFreeNodes,y=m.nodeBuffer;o.drawCounter++;var b,x,w,S=1,M=1,A=1,C=o.drawCounter;do{var T=0;for(f=0,b=p-1;b>=0;b--)if(r=u[b],a=r.metanode,a&&(M++,a.metatile.drawCounter!=C&&(a.metatile.drawCounter=C,A++)),r.bboxVisible(r.id,a.bbox,n,a))if(S++,v&&y.push(r),r.texelSize!=Number.POSITIVE_INFINITY&&r.texelSize>T&&(T=r.texelSize),r.texelSize<=g)r.drawCounter=o.drawCounter,l[d]=r,d++;else{var P=0,F=0,L=[];for(x=0;x<4;x++){var E=r.children[x];E&&(P++,E.isMetanodeReady(this,E.id[0])&&(this.updateNodeHeightExtents(E,E.metanode),E.updateTexelSize(),L.push(E),F++))}if(P>0&&(!i||P==F)){do{var k=!0;for(x=0,w=L.length-1;x<w;x++)if(L[x].distance>L[x+1].distance){var N=L[x];L[x]=L[x+1],L[x+1]=N,k=!1}}while(!k);for(x=0,w=L.length;x<w;x++)c[f]=L[x],f++}else r.drawCounter=o.drawCounter,l[d]=r,d++}var B=u;u=c,c=B,p=f}while(p>0);if(t){if(i){var B=o.drawBuffer2;o.drawBuffer2=o.drawBuffer,o.drawBuffer=B}else this.storeDrawBufferGeometry(d);return d}var I=s.stats;I.usedNodes=S,I.processedNodes=M,I.processedMetatiles=A,this.processDrawBuffer(o,h,n,s,I,!1,!1,m,l,d,!0)}}},o.prototype.drawSurfaceFit=function(e,t){this.counter++;var i=this.surfaceTree;if(i.isMetanodeReady(this,0)){var r=this.map,s=i.metanode,a=r.camera.position;if(i.bboxVisible(i.id,s.bbox,a,s)){i.updateTexelSize();var n=i.surface?i.surface.geodata:null,o=i.surface.maxLod||i.surface.lodRange[1],h=i.surface?i.surface.free:null,l=!n&&!h&&r.config.mapHeightfiledWhenUnloaded,u=4,c=2e3;this.freeLayerSurface&&(u=0,c=.1);var d=r.draw,p=d.drawTiles,f=d.replay,g=d.drawBuffer,m=d.processBuffer,v=d.processBuffer2,y=0,b=0,x=0;m[0]=[i,0],b=1;var w=d.texelSizeFit,S=f.storeNodes||f.storeFreeNodes,M=f.nodeBuffer;d.drawCounter++;var A,C,T,P,F,L,E,k,N=1,B=1,I=1,R=d.drawCounter,U=r.config.mapMaxHiresLodLevels,D=!1;do{var z=0;for(x=0,A=b-1;A>=0;A--){var _=m[A];i=_[0];var G=_[1];if(i.childrenReadyCount=0,G>=U)l&&(L=i,E=L.parent,L.id[0]>3&&0!=G&&E&&0==E.childrenReadyCount&&(k=E.children,G>=1&&L.parent&&(k[0]&&0!=k[0].childrenReadyCount||k[1]&&0!=k[1].childrenReadyCount||k[2]&&0!=k[2].childrenReadyCount||k[3]&&0!=k[3].childrenReadyCount)||(L=L.parent)),L.drawCounter==d.drawCounter||L.parent&&L.parent.drawCounter==d.drawCounter||(L.drawCounter=d.drawCounter,g[y]=[L,!0],y++,D=!0));else{if(s=i.metanode,s&&(B++,s.metatile.drawCounter!=R&&(s.metatile.drawCounter=R,I++)),i.bboxVisible(i.id,s.bbox,a,s)){N++,i.texelSize!=Number.POSITIVE_INFINITY&&i.texelSize>z&&(z=i.texelSize),S&&M.push(i);var V=x,O=y;if(!s.hasChildren()||i.texelSize<=w||n&&i.id[0]>=o)if(F=(i.id[0]+u)*c*i.distance,s.hasChildren()&&!p.drawSurfaceTile(i,i.metanode,a,i.texelSize,F,!0,G>0,!0)){for(G++,C=0;C<4;C++)(P=i.children[C])&&P.isMetanodeReady(this,P.id[0],!0)&&(this.updateNodeHeightExtents(P,P.metanode),P.updateTexelSize(),p.drawSurfaceTile(P,P.metanode,a,P.texelSize,F,!0,G>0,!0)?(i.childrenReadyCount++,P.drawCounter=d.drawCounter,g[y]=[P,!1],y++):(v[x]=[P,G],x++));V==x&&O==y&&G--}else i.drawCounter=d.drawCounter,g[y]=[i,!1],y++;else if(0==G&&s.hasGeometry()&&i.texelSize<=2*w){var j=0,H=0,Y=[];for(C=0;C<4;C++)(P=i.children[C])&&(j++,P.isMetanodeReady(this,P.id[0])&&(this.updateNodeHeightExtents(P,P.metanode),P.updateTexelSize(),F=(P.id[0]+u)*c*P.distance,p.drawSurfaceTile(P,P.metanode,a,P.texelSize,F,!0,!0,!0)&&(H++,Y.push(P))));if(j>0&&j==H){do{var q=!0;for(C=0,T=Y.length-1;C<T;C++)if(Y[C].distance>Y[C+1].distance){var J=Y[C];Y[C]=Y[C+1],Y[C+1]=J,q=!1}}while(!q);for(C=0,T=Y.length;C<T;C++)v[x]=[Y[C],G],x++}else if(F=(i.id[0]+u)*c*i.distance,p.drawSurfaceTile(i,i.metanode,a,i.texelSize,F,!0,!0,!0))for(i.drawCounter=d.drawCounter,g[y]=[i,!1],y++,C=0;C<4;C++)(P=i.children[C])&&P.isMetanodeReady(this,P.id[0])&&(F=(P.id[0]+u)*c*P.distance,p.drawSurfaceTile(P,P.metanode,a,P.texelSize,F,!0,!1,!0));else for(C=0;C<4;C++)(P=i.children[C])&&P.isMetanodeReady(this,P.id[0])&&(this.updateNodeHeightExtents(P,P.metanode),P.updateTexelSize(),v[x]=[P,G],x++)}else for(C=0;C<4;C++)(P=i.children[C])&&P.isMetanodeReady(this,P.id[0])&&(this.updateNodeHeightExtents(P,P.metanode),P.updateTexelSize(),v[x]=[P,G],x++)}l&&V==x&&O==y&&(L=i,E=L.parent,L.id[0]>3&&0!=G&&E&&0==E.childrenReadyCount&&(k=E.children,G>=1&&L.parent&&(k[0]&&0!=k[0].childrenReadyCount||k[1]&&0!=k[1].childrenReadyCount||k[2]&&0!=k[2].childrenReadyCount||k[3]&&0!=k[3].childrenReadyCount)||(L=L.parent)),L&&L.drawCounter!=d.drawCounter&&(L.drawCounter=d.drawCounter,g[y]=[L,!0],y++,D=!0))}}var Z=m;m=v,v=Z,b=x}while(b>0);if(t)return void this.storeDrawBufferGeometry(y);var X=r.stats;X.usedNodes=N,X.processedNodes=B,X.processedMetatiles=I,this.processDrawBuffer(d,p,a,r,X,l,D,f,g,y)}}},o.prototype.drawSurfaceDownTop=function(e,t){this.counter++;var i=this.map,r=i.camera.position,s=this.surfaceTree;if(s.isMetanodeReady(this,0)){s.updateTexelSize();var a=s,n=s.metanode;if(s.bboxVisible(s.id,n.bbox,r,n)){var o,h,l,u=i.draw,c=u.drawTiles,d=u.drawBuffer,p=u.drawBuffer2,f=0,g=!1,m=u.texelSizeFit,v=0,y=u.processBuffer,b=u.processBuffer2,x=0,w=0;y[0]=s,x=1;var m=u.texelSizeFit;u.drawCounter++;var S,M,A,C,T,P=i.draw.replay,F=P.storeNodes||P.storeFreeNodes,L=P.nodeBuffer,E=1,k=1,N=1,B=u.drawCounter,g=!1;do{var I=0;for(w=0,S=x-1;S>=0;S--)if(s=y[S],n=s.metanode,n&&(k++,n.metatile.drawCounter!=B&&(n.metatile.drawCounter=B,N++)),s.bboxVisible(s.id,n.bbox,r,n))if(E++,F&&L.push(s),s.texelSize!=Number.POSITIVE_INFINITY&&s.texelSize>I&&(I=s.texelSize),s.texelSize<=m)s.drawCounter=B,d[f]=s,f++;else{var R=0,U=0,D=[];for(M=0;M<4;M++){var l=s.children[M];l&&(R++,l.isMetanodeReady(this,l.id[0])&&(this.updateNodeHeightExtents(l,l.metanode),l.updateTexelSize(),D.push(l),U++))}if(R>0&&R==U){do{var z=!0;for(M=0,A=D.length-1;M<A;M++)if(D[M].distance>D[M+1].distance){var _=D[M];D[M]=D[M+1],D[M+1]=_,z=!1}}while(!z);for(M=0,A=D.length;M<A;M++)b[w]=D[M],w++}else s.drawCounter=B,d[f]=[s,!0],f++}var G=y;y=b,b=G,x=w}while(x>0);if(0!=f){var G=u.drawBuffer2;u.drawBuffer2=u.drawBuffer,u.drawBuffer=G,d=u.drawBuffer;var p=u.drawBuffer2,V=f;f=0;var O=4,j=2e3;this.freeLayerSurface&&(O=0,j=.1);var H=function(){var e=!1;if(s!=a){for(h=s.parent;h!=a;){if(o=(h.id[0]+O)*j,c.drawSurfaceTile(h,h.metanode,r,h.texelSize,o,!0,!0,!1)){d[f]=[h,!1],h.drawCounter=B,e=!0;for(var t=0;t<4;t++)(l=h.children[t])&&l.isMetanodeReady(this,l.id[0])&&(c.drawSurfaceTile(l,l.metanode,r,l.texelSize,o,!0,!1,!1)||v++);break}h=h.parent}e||(o=(s.id[0]+O)*j,c.drawSurfaceTile(s,s.metanode,r,s.texelSize,o,!0,!1,!1)?(d[f]=[s,!1],s.drawCounter=B):(d[f]=[s,!0],s.drawCounter=B,v++))}};for(S=V-1;S>=0;S--){if(C=p[S],C[1]){if(s=C[0],!s.isMetanodeReady(this,s.id[0]))continue;d[f]=[s,!0],g=!0,o=20,H()}else s=C,n=s.metanode,d[f]=[s,!1],o=(s.id[0]+O)*j,c.drawSurfaceTile(s,s.metanode,r,s.texelSize,o,!0,!1,!1)?s.drawCounter=B:(H(),v++);f++}var G=p;p=d,d=G;var V=f;for(f=0,S=0;S<V;S++){if(C=p[S],s=C[0],T=!1,s!=a)for(h=s.parent;h!=a;){if(h.drawCounter==B){T=!0;break}h=h.parent}T||(d[f]=p[S],f++)}if(0==v)for(S=0;S<f;S++)if(C=d[S],s=C[0],T=!1,s!=a)for(h=s.parent;h!=a&&(o=(100-s.id[0]+O)*j,c.drawSurfaceTile(h,h.metanode,r,h.texelSize,o,!0,!1,!1));)h=h.parent;var Y=i.stats,u=i.draw,c=u.drawTiles,P=u.replay,q=s.surface?s.surface.geodata:null,J=s.surface?s.surface.free:null,Z=!q&&!J&&i.config.mapHeightfiledWhenUnloaded;this.processDrawBuffer(u,c,r,i,Y,Z,g,P,d,f)}}}},o.prototype.processDrawBuffer=function(e,t,i,r,s,n,o,h,l,u,c){if(h.storeTiles||h.storeFreeTiles){e.tileBuffer[0]||(e.tileBuffer[0]=[]);var d=e.tileBuffer[0];for(b=u-1;b>=0;b--)d.push(l[b])}var p,f,g,m,v,y,b,x,w,S=!this.freeLayerSurface&&2==r.config.mapFeatureStickMode[0],M=-999999,A=999999,C=r.renderer;this.camera.getMvpMatrix();r.gpuCache.skipCostCheck=!0;var T=n&&r.config.mapGridUnderSurface>0&&o;if(T){for(b=u-1;b>=0;b--)l[b][0].drawGrid(i);r.renderer.gpu.clear(!0,!1)}for(b=u-1;b>=0;b--){var P=l[b];if(x=c?P:P[0],w=x.metanode,S&&w&&(f=w.diskPos,p=C.cameraPosition,g=[f[0]-p[0],f[1]-p[1],f[2]-p[2]],m=a.normalize4(g),v=-a.dot(g,w.diskNormal),v<0&&(v=0),v=1-v,y=C.camera.fovDist/m*v,w.minZ*y<A&&(A=w.minZ*y),w.maxZ*y>M&&(M=w.maxZ*y)),c){if(s.gpuRenderUsed>=e.maxGpuUsed)break;t.drawSurfaceTile(x,x.metanode,i,x.texelSize,0,!1,!1)}else T?P[1]||s.gpuRenderUsed>=e.maxGpuUsed?t.debug.drawBBoxes&&t.drawTileInfo(x,x.metanode,i):t.drawSurfaceTile(x,x.metanode,i,x.texelSize,0,!1,!1):n&&P[1]||s.gpuRenderUsed>=e.maxGpuUsed?(t.debug.drawBBoxes&&t.drawTileInfo(x,x.metanode,i),x.drawGrid(i)):P[1]||t.drawSurfaceTile(x,x.metanode,i,x.texelSize,0,!1,!1)}S&&(C.gridHmax=M,C.gridHmin=A),r.gpuCache.skipCostCheck=!1,r.gpuCache.checkCost()},o.prototype.storeDrawBufferGeometry=function(e){var t=this.map,i=t.draw.drawBuffer;this.storeGeometry(i,e)},o.prototype.storeGeometry=function(e,t){var i=this.map,r=e;i.storedTilesRes=new Array(t);for(var s=t-1;s>=0;s--){var a=r[s];if(a.metanode&&a.surface&&a.metanode.hasGeometry()&&a.surfaceMesh&&a.surfaceMesh.isReady(!0,0,!0)){for(var n=a.surfaceMesh,o=[],h=0,l=n.submeshes.length;h<l;h++){for(var u=n.submeshes[h],c=u.vertices.slice(),d=u.bbox.min,p=u.bbox.max,f=[p[0]-d[0],p[1]-d[1],p[2]-d[2]],g=0,m=c.length;g<m;g+=3)c[g]=c[g]*f[0]+d[0],c[g+1]=c[g+1]*f[1]+d[1],c[g+2]=c[g+2]*f[2]+d[2];o.push({bbox:[d.slice(),p.slice()],vertices:c})}i.storedTilesRes[s]={id:a.id.slice(),type:"mesh",submeshes:o}}}},o.prototype.traceHeight=function(e,t,i){if(e){this.params=t;var r=i?this.traceHeightTileByNodeOnly:this.traceHeightTileByMap;(1!=e.id[0]||(this.traceHeightTile(e.parent,0,!0),e.parent.metanode))&&this.traceHeightTile(e,0,!1,r)}},o.prototype.traceHeightTile=function(e,t,i,r){if(null!=e){if(!e.isMetanodeReady(this,0)||i)return void(this.params.waitingForNode=!0);e.metanode.metatile.used(),e.lastSurface&&e.lastSurface==e.surface&&(e.lastSurface=null,e.restoreLastState());if(r(e,this.params,t)){var s=this.traceHeightChild(e,this.params),a=e.children[s];a||(this.params.finalNode=!0),this.traceHeightTile(a,0,!1,r)}}},o.prototype.traceHeightChild=function(e,t){var i=t.coords,r=t.extents,s=[.5*(r.ll[0]+r.ur[0]),.5*(r.ll[1]+r.ur[1])],a=i[0]>=s[0],n=i[1]>=s[1];return a?(r.ll[0]=s[0],n?r.ll[1]=s[1]:r.ur[1]=s[1]):(r.ur[0]=s[0],n?r.ll[1]=s[1]:r.ur[1]=s[1]),a?n?1:3:n?0:2},o.prototype.traceHeightTileByMap=function(e,t){if(!e||e.id[0]>t.desiredLod&&t.heightMap)return!1;var i=e.metanode;if(!i)return!1;if(!i.hasNavtile())return t.heightMap||(t.metanode=i),!0;if(t.bestHeightMap=e.id[0],e.heightMap){if(e.heightMap.isReady(null,null,!0))return t.parent={metanode:t.metanode,heightMap:t.heightMap,heightMapExtents:t.heightMapExtents},t.metanode=i,t.heightMap=e.heightMap,t.heightMapExtents={ll:t.extents.ll.slice(),ur:t.extents.ur.slice()},e.id[0]!=t.desiredLod}else{if(!e.surface||!e.resourceSurface)return!1;if(!e.resourceSurface.getNavUrl)return!1;var r=e.resourceSurface.getNavUrl(e.id);e.heightMap=e.resources.getTexture(r,!0)}return!1},o.prototype.traceHeightTileByNodeOnly=function(e,t){if(!e||e.id[0]>t.desiredLod)return!1;var i=e.metanode;return!!i&&(t.parent={metanode:t.metanode},t.metanode=i,e.id[0]!=t.desiredLod)},o.prototype.getNodeById=function(e,t){var i=this.surfaceTree;if(null!=i){for(var r=e[0];r>0;r--){var s=1<<r-1,a=0;if(0!=(e[1]&s)&&(a+=1),0!=(e[2]&s)&&(a+=2),!i.children[a]){if(!i.isMetanodeReady(this,0,t))return null;if(!i.metanode.hasChild(a))return null;i.addChild(a)}i=i.children[a]}if(i&&i.isMetanodeReady(this,0,t)){var n=i.metanode;return i.metanode.metatile.used(),n}}},o.prototype.getRenderedNodeById=function(e,t){var i=this.surfaceTree;if(null!=i){if(i.drawCounter==t){if(!i.isMetanodeReady(this,0))return;return i.metanode}for(var r=e[0];r>0;r--){var s=1<<r-1,a=0;if(0!=(e[1]&s)&&(a+=1),0!=(e[2]&s)&&(a+=2),!i.children[a]){if(!i.isMetanodeReady(this,0))return;if(!i.metanode.hasChild(a))return}if(i=i.children[a],i.drawCounter==t){if(!i.isMetanodeReady(this,0))return;return i.metanode}if(1==r)return i.metanode}}},o.prototype.chekTileMesh=function(e){if(this.params.loadMeshes||this.params.loadTextures){var t=this.config.mapNoTextures;this.config.mapNoTextures=!this.params.loadTextures,this.map.draw.drawTiles.drawSurfaceTile(e,e.metanode,this.map.renderer.cameraPosition,e.texelSize,0,!0,!1,!0)||(this.params.loaded=!1),this.config.mapNoTextures=t}},o.prototype.traceAreaTiles=function(e,t,i){if(null!=e){if(!e.isMetanodeReady(this,0)||i)return this.params.loaded=!1,void e.isMetanodeReady(this,0);if(e.metanode.metatile.used(),e.lastSurface&&e.lastSurface==e.surface&&(e.lastSurface=null,e.restoreLastState()),e.insideCone(this.params.coneVec,this.params.coneAngle,e.metanode)){if("lod"==this.params.mode?e.id[0]>=this.params.limit:e.metanode.pixelSize<=this.params.limit)return this.chekTileMesh(e),void this.params.areaTiles.push(e);if(e.metanode.hasChildren())for(var r=0;r<4;r++)this.traceAreaTiles(e.children[r],t,i);else this.chekTileMesh(e),this.params.areaTiles.push(e)}}},t.a=o},function(e,t,i){"use strict";var r=i(30),s=i(54),a=i(56),n=i(5),o=i(2),h=i(9),l=r.a,u=s.a,c=a.a,d=n.a,p=o.a,f=h.a,g=function(e,t,i){if(this.map=e,this.id=null,this.type="basic",this.metaBinaryOrder=1,this.metaUrl="",this.navUrl="",this.navDelta=1,this.meshUrl="",this.textureUrl="",this.baseUrl=this.map.url.baseUrl,this.baseUrlSchema=this.map.url.baseUrlSchema,this.baseUrlOrigin=this.map.url.baseUrlOrigin,this.lodRange=[0,0],this.tileRange=[[0,0],[0,0]],this.textureLayer=null,this.boundLayerSequence=[],this.glue="glue"==i,this.free="free"==i,this.virtual=!1,this.zFactor=0,this.ready=!1,this.geodataProcessor=null,this.geodataCounter=0,this.geodataNavtileInfo=!1,this.monoGeodata=null,this.monoGeodataView=null,this.monoGeodataCounter=-1,this.creditsNumbers=[],this.surfaceCounter=e.surfaceCounter,e.surfaceCounter++,this.style=null,this.stylesheet=null,this.originalStyle=null,this.originalStylesheet=null,this.styleChanged=!0,this.free?this.tree=new c(this.map,!0,this):this.tree=null,"string"==typeof t){this.jsonUrl=this.map.url.processUrl(t),this.baseUrl=f.getBase(this.jsonUrl),this.baseUrlSchema=f.getSchema(this.jsonUrl),this.baseUrlOrigin=f.getOrigin(this.jsonUrl);var r=function(e){this.parseJson(e),this.ready=!0,this.map.refreshView()}.bind(this),s=function(){}.bind(this);p.loadJSON(this.jsonUrl,r,s,null,!!p.useCredentials&&-1!=this.jsonUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)}else this.parseJson(t),this.ready=!0};g.prototype.parseJson=function(e){this.id=e.id||null,this.type=e.type||"basic",this.metaBinaryOrder=e.metaBinaryOrder||1,this.metaUrl=this.processUrl(e.metaUrl,""),this.navUrl=this.processUrl(e.navUrl,""),this.hmapUrl=this.processUrl(e.hmapUrl,e.navUrl+"00"),this.pipeline=this.map.config.mapForcePipeline?this.map.config.mapForcePipeline:e.pipeline,this.navDelta=e.navDelta||1,this.meshUrl=this.processUrl(e.meshUrl,""),this.textureUrl=this.processUrl(e.textureUrl,""),this.geodataUrl=this.processUrl(e.geodataUrl||e.geodata,""),this.lodRange=e.lodRange||[0,0],this.tileRange=e.tileRange||[[0,0],[0,0]],this.textureLayer=e.textureLayer||null,this.geodata="geodata"==this.type||"geodata-tiles"==this.type,this.credits=e.credits||[],this.creditsUrl=null,this.displaySize=e.displaySize||1024;var t,i;if(e.extents){var r=e.extents.ll,s=e.extents.ur;this.extents=new d(r[0],r[1],r[2],s[0],s[1],s[2])}else this.extents=new d(0,0,0,1,1,1);switch(this.specificity=Math.pow(2,this.lodRange[0])/((this.tileRange[1][0]-this.tileRange[1][0]+1)*(this.tileRange[1][1]-this.tileRange[1][1]+1)),typeof this.credits){case"string":this.creditsUrl=this.credits,this.credits=[];break;case"object":if(!Array.isArray(this.credits)){var a=this.credits;this.credits=[];for(var n in a)this.map.addCredit(n,new l(this.map,a[n])),this.credits.push(n)}for(t=0,i=this.credits.length;t<i;t++){var o=this.map.getCreditById(this.credits[t]);this.creditsNumbers.push(o?o.id:null)}}if(this.geodataUrl&&"string"==typeof this.geodataUrl&&-1!=this.geodataUrl.indexOf("{geonavtile}")&&(this.geodataNavtileInfo=!1),this.geodata){var h=e.style;"string"==typeof this.credits&&(h=this.processUrl(h,"")),this.originalStyle=h,h&&(this.setStyle(h),this.originalStylesheet=this.stylesheet)}if(this.surfaceReference=[],this.glue)for(t=0,i=this.id.length;t<i;t++)this.surfaceReference.push(this.map.getSurface(this.id[t]))},g.prototype.kill=function(){this.geodataProcessor&&(this.geodataProcessor.kill(),this.geodataProcessor=null),this.geodataUrl=null,this.style=null,this.stylesheet=null,this.originalStyle=null,this.originalStylesheet=null},g.prototype.setOptions=function(){},g.prototype.getOptions=function(){return this.getInfo()},g.prototype.getInfo=function(){return this.geodata?{type:this.type,metaUrl:this.metaUrl,geodataUrl:this.geodataUrl,lodRange:this.lodRange,tileRange:this.tileRange,style:this.originalStyle}:{type:this.type,metaUrl:this.metaUrl,navUrl:this.navUrl,meshUrl:this.meshUrl,textureUrl:this.textureUrl,lodRange:this.lodRange,tileRange:this.tileRange,textureLayer:this.textureLayer}},g.prototype.processUrl=function(e,t){return e?"string"!=typeof e?e:(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},g.prototype.hasTile=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var i=e[1]>>t,r=e[2]>>t;return!(e[0]<this.lodRange[0]||e[0]>this.lodRange[1]||i<this.tileRange[0][0]||i>this.tileRange[1][0]||r<this.tileRange[0][1]||r>this.tileRange[1][1])},g.prototype.hasTile2=function(e){var t=e[0]-this.lodRange[0],i=t<0;if(e[0]<this.lodRange[0]){t=-t;var r=this.tileRange[0][0]>>t,s=this.tileRange[0][1]>>t,a=this.tileRange[1][0]>>t,n=this.tileRange[1][1]>>t;if(e[0]>this.lodRange[1]||e[1]<r||e[1]>a||e[2]<s||e[2]>n)return[!1,!1]}else{var o=e[1]>>t,h=e[2]>>t;if(e[0]>this.lodRange[1]||o<this.tileRange[0][0]||o>this.tileRange[1][0]||h<this.tileRange[0][1]||h>this.tileRange[1][1])return[!1,!1]}return[!0,i]},g.prototype.hasMetatile=function(e){if(e[0]>this.lodRange[1])return!1;var t=e[0]-this.lodRange[0];if(t>=0){var i=e[1]>>t,r=e[2]>>t;if(i<this.tileRange[0][0]||i>this.tileRange[1][0]||r<this.tileRange[0][1]||r>this.tileRange[1][1])return!1}else if(t=-t,e[1]<this.tileRange[0][0]>>t||e[1]>this.tileRange[1][0]>>t||e[2]<this.tileRange[0][1]>>t||e[2]>this.tileRange[1][1]>>t)return!1;return!0},g.prototype.setStyle=function(e){if(this.style!=e){var t=e;"object"!=typeof t?t=this.processUrl(t,""):(t=JSON.stringify(t),t=p.getHash(t),t="#obj#"+t.toString(16)),this.stylesheet=this.map.getStylesheet(t),this.stylesheet||(this.stylesheet=new u(this.map,t,e,this),this.map.addStylesheet(t,this.stylesheet)),this.style=e,this.styleChanged=!0,this.geodataCounter++,this.map.markDirty()}},g.prototype.getSurfaceReference=function(e){return this.surfaceReference[e-1]},g.prototype.getMetaUrl=function(e,t){return this.map.url.makeUrl(this.metaUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},g.prototype.getNavUrl=function(e,t){return this.map.url.makeUrl(this.navUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},g.prototype.getHMapUrl=function(e,t){return this.map.url.makeUrl(this.hmapUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},g.prototype.getMeshUrl=function(e,t){return this.map.url.makeUrl(this.meshUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},g.prototype.getTextureUrl=function(e,t,i){return this.map.url.makeUrl(this.textureUrl,{lod:e[0],ix:e[1],iy:e[2]},t,i)},g.prototype.getGeodataUrl=function(e,t,i){return this.map.url.makeUrl(this.geodataUrl,{lod:e[0],ix:e[1],iy:e[2]},t,i)},g.prototype.getMonoGeodataUrl=function(e,t){return this.map.url.makeUrl(this.geodataUrl,{},null,t)},t.a=g},function(e,t,i){"use strict";var r=i(55),s=r.a,a=function(e,t,i,r,a,n,o){if(this.map=e,this.stats=e.stats,this.tile=n,this.internal=o,this.mainTexture=n?n.resources.getSubtexture(this,t,i,n,o):new s(e,t,i,n,o),this.maskTexture=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.neverReady=!1,this.maskTexture=null,this.mapLoaderUrl=t,this.type=i||0,this.extraBound=r,this.extraInfo=a,this.statsCounter=0,this.checkStatus=0,this.checkType=null,this.checkValue=null,this.fastHeaderCheck=!1,this.fileSize=0,a&&a.layer){var h=a.layer;if(h.availability)switch(this.checkType=h.availability.type,this.checkType){case 2:this.checkValue=h.availability.mime;break;case 3:this.checkValue=h.availability.codes;break;case 4:this.checkValue=h.availability.size}}};a.prototype.kill=function(){this.mainTexture.killImage(),this.mainTexture.killGpuTexture(),this.mainTexture=null,this.maskTexture&&(this.maskTexture.killImage(),this.maskTexture.killGpuTexture())},a.prototype.killImage=function(){this.mainTexture.killImage(),this.maskTexture&&this.maskTexture.killImage()},a.prototype.killGpuTexture=function(){this.mainTexture.killGpuTexture(),this.maskTexture&&this.maskTexture.killGpuTexture()},a.prototype.setBoundTexture=function(e,t,i){if(e){if(i){if(this.extraBound.sourceTile=e,this.extraBound.hmap=i,!e.hmap){var r=e.resourceSurface.getHMapUrl(e.id,!0);e.hmap=e.resources.getTexture(r,null,null,{tile:e,hmap:i},this.tile,this.internal)}this.extraBound.texture=e.hmap}else if(t){if(this.extraBound.sourceTile=e,this.extraBound.layer=t,!e.boundTextures[t.id]){e.boundLayers[t.id]=t;var r=t.getUrl(e.id);e.boundTextures[t.id]=e.resources.getTexture(r,null,null,{tile:e,layer:t},this.tile,this.internal)}this.extraBound.texture=e.boundTextures[t.id]}this.extraBound.transform=this.map.draw.drawTiles.getTileTextureTransform(e,this.extraBound.tile),this.map.markDirty()}},a.prototype.isReady=function(e,t,i){var r=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||r,this.neverReady)return!1;var s;if(this.extraBound){if(this.extraBound.texture){for(;this.extraBound.texture.extraBound||-1==this.extraBound.texture.checkStatus;){if(s=this.extraBound.sourceTile.parent,this.extraBound.hmap){if(!s||s.id[0]<1)return this.neverReady=!0,this.extraBound.tile.resetDrawCommands=!0,this.map.markDirty(),!1}else if(this.extraBound.layer&&s.id[0]<this.extraBound.layer.lodRange[0])return this.neverReady=!0,this.extraBound.tile.resetDrawCommands=!0,this.map.markDirty(),!1;this.setBoundTexture(s,this.extraBound.layer)}var a=this.extraBound.texture.isReady(e,t,i);return a&&this.checkMask&&(this.extraBound.tile.resetDrawCommands=null!=this.extraBound.texture.getMaskTexture(),this.checkMask=!1),a}return this.setBoundTexture(this.extraBound.sourceTile,this.extraBound.layer,this.extraBound.hmap),this.isReady(e,t,i)}switch(this.checkType){case 1:if(2!=this.checkStatus){if(0==this.checkStatus&&this.extraInfo&&this.extraInfo.tile){var n=this.extraInfo.tile.boundmetaresources;n||(n=this.map.resourcesTree.findAgregatedNode(this.extraInfo.tile.id,8),this.extraInfo.tile.boundmetaresources=n);var o=this.extraInfo.layer,h=this.extraInfo.metaPath;this.extraInfo.metaPath||(h=o.getMetatileUrl(n.id),this.extraInfo.metaPath=h);var l=n.getTexture(h,!0,null,null,this.tile,this.internal);if(this.maskTexture)this.maskTexture.isReady(e,t,i,this)&&(this.checkStatus=2);else if(l.isReady(e,t,i)){var u=this.extraInfo.tile,c=l.getHeightMapValue(255&u.id[1],255&u.id[2]);this.checkStatus=128&c?2:-1,2==this.checkStatus&&(64&c||(h=o.getMaskUrl(u.id),this.maskTexture=u.resources.getTexture(h,null,null,null,this.tile,this.internal),this.checkStatus=0)),u.resetDrawCommands=!0,this.map.markDirty()}}if(-1==this.checkStatus){if(!this.extraBound){if(s=this.extraInfo.tile.parent,s.id[0]<this.extraInfo.layer.lodRange[0])return this.neverReady=!0,this.extraInfo.tile.resetDrawCommands=!0,this.map.markDirty(),!1;this.extraBound={tile:this.extraInfo.tile,layer:this.extraInfo.layer},this.setBoundTexture(this.extraBound.tile.parent,this.extraBound.layer),this.checkMask=!0}for(;this.extraBound.texture.extraBound||-1==this.extraBound.texture.checkStatus;){if(s=this.extraBound.sourceTile.parent,s.id[0]<this.extraBound.layer.lodRange[0])return this.neverReady=!0,this.extraBound.tile.resetDrawCommands=!0,this.map.markDirty(),!1;this.setBoundTexture(s,this.extraBound.layer)}}return!1}}var d=!0;return this.maskTexture&&(d=this.maskTexture.isReady(e,t,i,this)),this.mainTexture.isReady(e,t,i,this)&&d},a.prototype.isMaskPosible=function(){var e=this;return this.extraBound&&this.extraBound.texture&&(e=this.extraBound.texture),1==e.checkType},a.prototype.isMaskInfoReady=function(){var e=this;return this.extraBound&&this.extraBound.texture&&(e=this.extraBound.texture),1!=e.checkType||!(!this.maskTexture&&2!=e.checkStatus&&-1!=e.checkStatus)},a.prototype.getGpuTexture=function(){return this.extraBound?this.extraBound.texture?this.extraBound.texture.getGpuTexture():null:this.mainTexture.getGpuTexture()},a.prototype.getMaskTexture=function(){return this.extraBound&&this.extraBound.texture?this.extraBound.texture.getMaskTexture():this.maskTexture},a.prototype.getGpuMaskTexture=function(){return this.extraBound?this.extraBound.texture&&this.extraBound.texture.maskTexture?this.extraBound.texture.getGpuMaskTexture():null:this.maskTexture?this.maskTexture.getGpuTexture():null},a.prototype.getGpuSize=function(){return(this.mainTexture&&this.mainTexture.gpuSize?this.mainTexture.gpuSize:0)+(this.maskTexture&&this.maskTexture.gpuSize?this.maskTexture.gpuSize:0)},a.prototype.getImageData=function(){return this.mainTexture.imageData},a.prototype.getImageExtents=function(){return this.mainTexture.imageExtents},a.prototype.getHeightMapValue=function(e,t){return this.mainTexture.getHeightMapValue(e,t)},a.prototype.getTransform=function(){return this.extraBound?this.extraBound.texture?this.extraBound.transform:null:[1,1,0,0]},t.a=a},function(e,t,i){"use strict";var r=function(e,t,i){this.map=e,this.parse(t,i)};r.prototype.parse=function(e,t){if(this.freeLayers=e.freeLayers||{},this.surfaces={},this.options=e.options||{},e.surfaces){var i=e.surfaces;if(Array.isArray(i))for(var r=0,s=i.length;r<s;r++)this.surfaces[i[r]]=[];else this.surfaces=i}if(!this.freeLayers||Array.isArray(this.freeLayers))this.freeLayers={};else if(this.freeLayers=JSON.parse(JSON.stringify(this.freeLayers)),t)for(var a in this.freeLayers){var n=this.freeLayers[a];"string"==typeof n.style&&(n.style=this.processUrl(n.style,""))}this.surfaces=JSON.parse(JSON.stringify(this.surfaces)),this.options=JSON.parse(JSON.stringify(this.options))},r.prototype.processUrl=function(e,t){return e?"string"!=typeof e?e:(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.map.url.baseUrlSchema+e:0==e.indexOf("/")?this.map.url.baseUrlOrigin+e:this.map.url.baseUrl+e):t},r.prototype.getInfo=function(){var e={surfaces:JSON.parse(JSON.stringify(this.surfaces)),freeLayers:JSON.parse(JSON.stringify(this.freeLayers)),options:JSON.parse(JSON.stringify(this.options))};this.map.renderer;if(this.map.renderer.getSuperElevationState()){var t=this.map.renderer.getSuperElevation();e.options={superelevation:[[t[0],t[2]],[t[1],t[3]]]}}return e},t.a=r},function(e,t,i){"use strict";var r=i(6),s=i(2),a=r.a,n=s.a,o=function(e,t,i,r,s){this.bbox=null,this.gpu=e,this.gl=e.gl,this.core=t,this.data=null,this.path=s,this.texture={width:256,height:256},this.textures=[],this.images=[],this.ready=!1,this.version=1,this.load(s)};o.prototype.kill=function(){},o.prototype.getSize=function(){return this.size},o.prototype.load=function(e){n.loadBinary(e,this.onLoaded.bind(this),this.onError.bind(this))},o.prototype.onLoaded=function(e){this.data=e,this.ready=!0,this.core.markDirty()},o.prototype.isReady=function(){return this.ready},o.prototype.onError=function(){},o.prototype.onFileLoaded=function(e,t){this.core.markDirty(),this.textures[e].createFromData(256,256,new Uint8Array(t),"linear")},o.prototype.onFileLoadError=function(){},o.prototype.areTexturesReady=function(e){for(var t=!0,i=0,r=e.length;i<r;i++){var s=e[i];this.textures[s]?t=t&&this.textures[s].loaded:(n.loadBinary(this.path+(s+2),this.onFileLoaded.bind(this,s),this.onFileLoadError.bind(this)),this.textures[s]=new a(this.gpu,null,this.core),t=!1)}return t},o.prototype.getTexture=function(e){return this.textures[e]},t.a=o},function(e,t,i){"use strict";var r={};r.bboxVertexShader="attribute vec3 aPosition;\nuniform mat4 uMVP;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\n}",r.bbox2VertexShader="attribute vec3 aPosition;\nuniform mat4 uMVP;\nuniform float uPoints[8*3];\nvoid main(){ \nint index = int(aPosition.z) * 3; \ngl_Position = uMVP * vec4(uPoints[index], uPoints[index+1], uPoints[index+2], 1.0);\n}",r.bboxFragmentShader="precision mediump float;\nvoid main() {\ngl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n}",r.text2VertexShader="attribute vec4 aPosition;\nvoid main(){ \n}",r.lineVertexShader="#ifndef dataPoints2\nuniform mat4 uMVP;\n#else\nuniform mat4 uMV, uProj;\n#endif\n#ifdef pixelLine\n#ifdef dataPoints2\nattribute vec3 aPosition;\n#else\nattribute vec4 aPosition;\nattribute vec4 aNormal;\n#endif\n#ifdef dataPoints\nuniform vec3 uScale;\nuniform vec3 uPoints[32];\n#else\nuniform vec2 uScale;\n#endif\n#ifdef dataPoints2\nvec4 getClippedPixelLinePoint(vec3 p1, vec3 p2, vec3 params) {\nvec2 pp1, pp2, n;\nvec4 wp0 = (uMV * vec4(p1.xyz, 1.0)), pp0, pp3;\nfloat near = gl_DepthRange.near + 0.1;\nif (params.y < 0.0) {\nif (wp0.z > -near) return vec4(8.0, 0.0, 0.0, 1.0);\npp0 = uProj * wp0;\nif (params.y == -1.0) return pp0;\nreturn pp0 + vec4((vec3(-sin(params.z)*uScale.x*uScale.z*pp0.w, cos(params.z)*uScale.y*uScale.z*pp0.w, 0.0)), 0.0);\n} else {\nvec3 p2 = uPoints[int(params.y)];\nvec4 wp3 = (uMV * vec4(p2.xyz, 1.0));\nif (wp0.z > -near) {\nvec3 dir = (wp3.xyz - wp0.xyz);\nfloat l = length(dir);\ndir = normalize(dir);\nfloat denominator = -dir.z;\nif (abs(denominator) < 0.0000001) return vec4(8.0, 0.0, 0.0, 1.0);\nfloat t = (near + wp0.z) / denominator;\nif (t < 0.0 || t > l) return vec4(8.0, 0.0, 0.0, 1.0);\nwp0.xyz = wp0.xyz + (dir * t);\n}\npp0 = uProj * wp0;\npp3 = uProj * wp3;\npp1 = pp0.xy / pp0.w;\npp2 = pp3.xy / pp3.w;\nn = normalize(pp2 - pp1);\nreturn pp0 + vec4((vec3(-n.y*uScale.x*params.z*uScale.z*pp0.w, n.x*uScale.y*params.z*uScale.z*pp0.w, 0.0)), 0.0);\n}\n}\n#endif\n#else\n#ifdef lineLabel2\nattribute vec2 aPosition;\nuniform vec4 uData[DSIZE];\nuniform float uFile;\nvarying vec2 vTexCoord;\n#else\n#ifdef lineLabel\nattribute vec4 aPosition;\nattribute vec4 aTexCoord;\nuniform vec4 uVec;\nuniform float uFile;\nvarying vec2 vTexCoord;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef dynamicWidth\nattribute vec4 aNormal;\nuniform vec4 uParams;\n#endif\n#endif\n#endif\n#ifdef applySE\nuniform mat4 uParamsSE;\n#endif\n#ifdef withElements\nattribute float aElement;\nvarying float vElement;\n#endif\nvoid main() {\n#ifdef withElements\nvElement = aElement;\n#endif\n#ifdef dataPoints\nvec3 p1 = uPoints[int(aPosition.x)];\n#else \n#ifndef lineLabel2\nvec3 p1 = aPosition.xyz;\n#endif\n#endif\n#ifdef pixelLine\n#ifndef dataPoints\nvec3 p2 = aNormal.xyz;\n#endif\n#endif\n#ifdef applySE\nvec3 geoPos2 = p1.xyz*vec3(uParamsSE[0][3],uParamsSE[1][0],uParamsSE[1][1]);\nvec3 geoPos = geoPos2+vec3(uParamsSE[0][0],uParamsSE[0][1],uParamsSE[0][2]);\ngeoPos.z *= uParamsSE[3][3];\nfloat ll = length(geoPos);\nvec3 v = geoPos * (1.0/(ll+0.0001));\nfloat h = ll - uParamsSE[3][2];\nfloat h2 = clamp(h, uParamsSE[2][1], uParamsSE[2][3]);\nfloat h3 = h;\nh *= (uParamsSE[2][2] + ((h2 - uParamsSE[2][1]) * uParamsSE[3][0]) * uParamsSE[3][1]);\ngeoPos2.xyz += v * (h - h3);\n#ifdef pixelLine\nvec4 pp0 = uMVP * vec4(geoPos2, 1.0);\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uScale.x*pp0.w, aNormal.y*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\ngeoPos2 = p2.xyz*vec3(uParamsSE[0][3],uParamsSE[1][0],uParamsSE[1][1]);\ngeoPos = geoPos2+vec3(uParamsSE[0][0],uParamsSE[0][1],uParamsSE[0][2]);\ngeoPos.z *= uParamsSE[3][3];\nll = length(geoPos);\nv = geoPos * (1.0/(ll+0.0001));\nh = ll - uParamsSE[3][2];\nh2 = clamp(h, uParamsSE[2][1], uParamsSE[2][3]);\nh3 = h;\nh *= (uParamsSE[2][2] + ((h2 - uParamsSE[2][1]) * uParamsSE[3][0]) * uParamsSE[3][1]);\ngeoPos2.xyz += v * (h - h3);\nvec4 pp3 = uMVP * vec4(geoPos2, 1.0);\nvec2 pp1 = pp0.xy / pp0.w;\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uScale.x*aNormal.w*pp0.w, n.x*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n#else\n#ifdef lineLabel\nvTexCoord = aTexCoord.xy;\nif (dot(uVec.xyz, vec3(aTexCoord.z, aTexCoord.w, aPosition.w)) < 0.0) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\nfloat file = floor(aTexCoord.y/4.0);\nvTexCoord.y = mod(aTexCoord.y,4.0);\nif (file != floor(uFile)) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\ngl_Position = uMVP * vec4(geoPos2, 1.0);\n}\n}\n#else\ngl_Position = uMVP * vec4(geoPos2, 1.0);\n#endif\n#endif\n#else\n#ifdef pixelLine\n#ifdef dataPoints2\nvec3 p2 = uPoints[int(aPosition.y)];\ngl_Position = getClippedPixelLinePoint(p1.xyz, p2.xyz, aPosition.xyz);\n#else\nvec4 pp0 = (uMVP * vec4(p1.xyz, 1.0));\n#ifdef dataPoints\nif (aPosition.y < 0.0) {\nif (aPosition.y == -1.0) {\ngl_Position = pp0;\n} else {\ngl_Position = pp0 + vec4((vec3(-sin(aPosition.z)*uScale.x*uScale.z, cos(aPosition.z)*uScale.y*uScale.z, 0.0)), 0.0);\n}\n} else {\nvec3 p2 = uPoints[int(aPosition.y)];\nvec4 pp3 = (uMVP * vec4(p2.xyz, 1.0));\nvec2 pp1 = pp0.xy / pp0.w;\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uScale.x*aPosition.z*uScale.z, n.x*uScale.y*aPosition.z*uScale.z, 0.0)), 0.0);\n}\n#else\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uScale.x*pp0.w, aNormal.y*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec4 pp3 = (uMVP * vec4(p2.xyz, 1.0));\nvec2 pp1 = pp0.xy / pp0.w;\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uScale.x*aNormal.w*pp0.w, n.x*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n#endif\n#endif\n#else\n#ifdef lineLabel2\nint index = int(aPosition.x) * 3;\nvec4 data = uData[index];\nvec4 data2 = uData[index+1];\nvec4 data3 = uData[index+2];\nvec3 pos = vec3(data[0],data[1],data[2]);\nvec4 q = vec4(data[3],data2[0],data2[1],data2[2]);\nvec2 factor = vec2(data2[3],data3[0]);\nvec2 uv = vec2(data3[1],data3[2]);\nfloat duv = data3[3];\nfloat x=q[0], y=q[1], z=q[2], w=q[3];\nfloat x2=x+x, y2=y+y, z2=z+z, xx=x*x2, yx=y*x2, yy=y*y2;\nfloat zx=z*x2, zy=z*y2, zz=z*z2, wx=w*x2, wy=w*y2, wz=w*z2;\nvec3 right = vec3(1.0-yy-zz, yx-wz, zx+wy) * factor.x;\nvec3 up = vec3(yx+wz, 1.0-xx-zz, zy-wx) * (-factor.y);\nfloat file = floor(uv.y/4.0);\nuv.y = (uv.y-file*4.0);\nint corner = int(aPosition.y);\nif (corner==1){ pos+=right; uv.x+=floor(duv)*(1.0/1024.0);  }\nif (corner==2){ pos+=right; pos+=up; uv.x+=floor(duv)*(1.0/1024.0); uv.y+=fract(duv); }\nif (corner==3){ pos+=up; uv.y+=fract(duv); }\nvTexCoord = uv;\nif (file != floor(uFile)) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\ngl_Position = uMVP * vec4(pos.xyz, 1.0);\n}\n#else\n#ifdef lineLabel\nvTexCoord = aTexCoord.xy;\nif (dot(uVec.xyz, vec3(aTexCoord.z, aTexCoord.w, aPosition.w)) < 0.0) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\nfloat file = floor(aTexCoord.y/4.0);\nvTexCoord.y = mod(aTexCoord.y,4.0);\nif (file != floor(uFile)) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\ngl_Position = uMVP * vec4(aPosition.xyz, 1.0);\n}\n}\n#else\n#ifdef dynamicWidth\ngl_Position = uMVP * vec4(aPosition.xyz + aNormal.xyz*(abs(aNormal.w)*uParams[3]), 1.0);\n#else\ngl_Position = uMVP * vec4(aPosition, 1.0);\n#endif\n#endif\n#endif\n#endif\n#endif\n}",r.lineFragmentShader="precision mediump float;\nuniform vec4 uColor;\n#ifdef withElements\nvarying float vElement;\n#endif\nvoid main() {\n#ifdef withElements\ngl_FragColor.xyz = fract(vec3(1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vElement) + (-0.5/255.0);\ngl_FragColor.w = 1.0;\n#else\ngl_FragColor = uColor;\n#endif\n}",r.tlineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying vec2 vTexCoord;\nvoid main(){ \nvec4 p=vec4(aPosition.xyz, 1.0);\np.xyz+=aNormal.xyz*(abs(aNormal.w)*uParams[3]);\nif (aNormal.w < 0.0){\nvTexCoord=vec2(abs(aPosition.w)*uParams[0], (uParams[1]+uParams[2])*0.5);\n} else {\nvTexCoord=vec2(abs(aPosition.w)*uParams[0], aPosition.w < 0.0 ? uParams[1] : uParams[2]);\n}\ngl_Position = uMVP * p;\n}",r.etlineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute float aElement;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying float vElement;\nvoid main(){ \nvec4 p=vec4(aPosition.xyz, 1.0);\np.xyz+=aNormal.xyz*(abs(aNormal.w)*uParams[3]);\nvElement = aElement;\ngl_Position = uMVP * p;\n}",r.tplineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying vec2 vTexCoord;\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(aPosition.xyz, 1.0));\nvTexCoord=vec2(abs(aPosition.w)*uParams[0], aPosition.w < 0.0 ? uParams[1] : uParams[2]);\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uParams[3]*uScale.x*pp0.w, aNormal.y*uParams[3]*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(aNormal.xyz, 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uParams[3]*uScale.x*aNormal.w*pp0.w, n.x*uParams[3]*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n}",r.etplineVertexShader="attribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute float aElement;\nuniform mat4 uMVP;\nuniform vec2 uScale;\nuniform vec4 uParams;\nvarying float vElement;\nvoid main(){ \nvec4 pp0 = (uMVP * vec4(aPosition.xyz, 1.0));\nvElement = aElement;\nif (aNormal.w == 0.0) {\ngl_Position = pp0 + vec4((vec3(aNormal.x*uParams[3]*uScale.x*pp0.w, aNormal.y*uParams[3]*uScale.y*pp0.w, 0.0)), 0.0);\n} else {\nvec2 pp1 = pp0.xy / pp0.w;\nvec4 pp3 = (uMVP * vec4(aNormal.xyz, 1.0));\nvec2 pp2 = pp3.xy / pp3.w;\nvec2 n = normalize(pp2 - pp1);\ngl_Position = pp0 + vec4((vec3(-n.y*uParams[3]*uScale.x*aNormal.w*pp0.w, n.x*uParams[3]*uScale.y*aNormal.w*pp0.w, 0.0)), 0.0);\n}\n}",r.tlineFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 uColor2;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 c=texture2D(uSampler, vTexCoord)*uColor;\ngl_FragColor = c;\n}",r.tblineFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 uColor2;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 c1=texture2D(uSampler, vTexCoord)*uColor;\nvec4 c2=uColor2,c=c1;\nc.xyz*=c.w; c2.xyz*=c2.w;\nc=mix(c,c2,1.0-c.w);\nc.xyz/=(c.w+0.00001);\nc.w=max(c1.w,c2.w);\ngl_FragColor = c;\n}",r.polygonVertexShader="attribute vec3 aPosition;\nattribute vec3 aNormal;\nuniform mat4 uMVP;\nuniform mat4 uRot;\nuniform vec4 uColor;\nvarying vec4 vColor;\nvoid main(){ \nfloat l = dot((uRot*vec4(aNormal,1.0)).xyz, vec3(0.0,0.0,1.0)) * 0.5;\nvec3 c = uColor.xyz;\nc = (l > 0.0) ? mix(c,vec3(1.0,1.0,1.0),l) : mix(vec3(0.0,0.0,0.0),c,1.0+l);\nvColor = vec4(c, uColor.w);\ngl_Position = uMVP * vec4(aPosition, 1.0);\n}",r.polygonFragmentShader="precision mediump float;\nvarying vec4 vColor;\nvoid main() {\ngl_FragColor = vColor;\n}",r.iconVertexShader="attribute vec4 aPosition;\nattribute vec4 aTexCoord;\nattribute vec3 aOrigin;\nuniform mat4 uMVP;\nuniform vec4 uScale;\nvarying vec2 vTexCoord;\nvoid main(){ \nvTexCoord = aTexCoord.xy * uScale[2];\nvec4 pos = (uMVP * vec4(aOrigin, 1.0));\ngl_Position = pos + vec4(aPosition.x*uScale.x*pos.w, (aPosition.y+uScale.w)*uScale.y*pos.w, 0.0, 0.0);\n}",r.icon2VertexShader="attribute vec4 aPosition;\nattribute vec4 aTexCoord;\nattribute vec3 aOrigin;\nuniform mat4 uMVP;\nuniform vec4 uScale;\nuniform float uFile;\nvarying vec2 vTexCoord;\nvoid main(){ \nvTexCoord = aTexCoord.xy * uScale[2];\nfloat file = floor(aTexCoord.y/4.0);\nvTexCoord.y = mod(aTexCoord.y,4.0);\nif (file != floor(uFile)) {\ngl_Position = uMVP * vec4(8.0, 0.0, 0.0, 1.0);\n}else{\nvec4 pos = (uMVP * vec4(aOrigin, 1.0));\ngl_Position = pos + vec4(aPosition.x*uScale.x*pos.w, (aPosition.y+uScale.w)*uScale.y*pos.w, 0.0, 0.0);\n}}",r.icon3VertexShader="attribute vec2 aPosition;\nuniform mat4 uProjectionMatrix;\nuniform vec4 uScale;\nuniform vec3 uOrigin;\nuniform vec4 uData[DSIZE];\nuniform float uFile;\nvarying vec2 vTexCoord;\nvoid main(){ \nint index = int(aPosition.x);\nvec4 data = uData[index];\nvec4 data2 = uData[index+1];\nvec4 v;\nint corner = int(aPosition.y);\nif (corner==0) v = vec4(data.x, data.y, data2.x, data2.y);\nif (corner==1) v = vec4(data.z, data.y, data2.z, data2.y);\nif (corner==2) v = vec4(data.z, data.w, data2.z, data2.w);\nif (corner==3) v = vec4(data.x, data.w, data2.x, data2.w);\nvTexCoord = vec2(v.z, v.w);\nfloat file = floor(v.w/4.0);\nvTexCoord.y = (v.w-file*4.0);\nif (file != floor(uFile)) {\ngl_Position = uProjectionMatrix * vec4(2.0, 0.0, 0.0, 2.0);\n}else{\nvec4 pos = (uProjectionMatrix * vec4(uOrigin.xyz, 1.0));\ngl_Position = pos + vec4(v.x*uScale.x*pos.w, v.y*uScale.y*pos.w, 0.0, 0.0);\n}}",r.textFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 c=texture2D(uSampler, vTexCoord);\nif(c.w < 0.01){ discard; }\ngl_FragColor = c*uColor;\n}",r.text2FragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec2 uParams;\nvarying vec2 vTexCoord;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec2 uv=(vTexCoord);\nuv.y=fract(uv.y);\nvec4 c=texture2D(uSampler, uv);\nfloat r = 0.0;\nint i=int(floor(vTexCoord.y));\nif (i == 0) r=c.x;else\nif (i == 1) r=c.y;else\nif (i == 2) r=c.z;else\nif (i == 3) r=c.w;\nfloat u_buffer = uParams[0];\nfloat u_gamma = uParams[1];\nfloat alpha = uColor.a * smoothstep(u_buffer - u_gamma, u_buffer + u_gamma, r);\nif(alpha < 0.01){ discard; }\ngl_FragColor = vec4(uColor.rgb, alpha);\n}",r.skydomeVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMVP;\nvarying vec2 vTexCoord;\nvoid main(){ \ngl_Position = uMVP * vec4(aPosition, 1.0);\nvTexCoord = aTexCoord;\n}",r.skydomeFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nconst vec4 gray = vec4(0.125, 0.125, 0.125, 1.0);\nvoid main() {\nfloat fade = smoothstep(0.51, 0.55, vTexCoord.t);\ngl_FragColor = mix(texture2D(uSampler, vTexCoord), gray, fade);\n}",r.stardomeFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uSampler, vTexCoord);\n}",r.atmoVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform mat3 uNorm;\nvarying vec3 vNormal;\nvarying vec4 vPosition;\nvoid main(){ \nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nvec4 c = uMV * vec4(aPosition, 1.0);\nvNormal = (aPosition.xyz - vec3(0.5));\nvPosition = camSpacePos;\n}",r.atmoFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uParams;\nuniform vec4 uParams2;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform vec4 uFogColor;\nuniform vec4 uFogColor2;\nvoid main() {\nfloat l = dot(normalize(vNormal),-uParams2.xyz);\nl = (1.0-pow(abs(l),uParams.x));\nvec4 c = mix(uFogColor2, uFogColor, l);\ngl_FragColor = vec4(c.xyz, c.w*l);\n}",r.atmoFragmentShader2="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uNFactor;\nuniform vec2 uRadius;\nuniform vec3 uPos;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vPosition.xyz);\nvec3 diff = uPos;\nfloat a = dot(ldir, ldir);\nfloat b = 2 * dot(ldir, diff);\nfloat c = dot(diff, diff) - (uRadius[0] * uRadius[0]);\nfloat i = 0;\nfloat discr = b * b - 4 * a * c;\nif (discr > 0.0) {}\n}\ngl_FragColor = uFogColor;\n}",r.atmoVertexShader3="attribute vec3 aPosition;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams2;\nvarying vec2 vTexcoords;\nvoid main(){ \ngl_Position = uProj * (uMV * vec4(aPosition, 1.0));\nvec3 position = (aPosition.xyz - vec3(0.5)) * vec3(uParams.w * 2.0);\nvec4 camPos = uParams2;\nfloat SurfaceRadius = uParams.x;\nfloat AtmosphereRadius = uParams.y;\nfloat StretchAmt = uParams.z;\nfloat camHeight = length(camPos.xyz);\nvec3 camToPos = position - camPos.xyz;\nfloat farDist = length(camToPos);\nfloat altitude = max(0.0,camHeight - SurfaceRadius);\nfloat horizonDist = sqrt((altitude*altitude) + (2.0 * SurfaceRadius * altitude));\nfloat maxDot = horizonDist / camHeight;\naltitude = max(0.0,camHeight - AtmosphereRadius);\nhorizonDist = sqrt((altitude*altitude) + (2.0 * AtmosphereRadius * altitude));\nfloat tweakAmount = 0.1;\nfloat minDot = max(tweakAmount,horizonDist / camHeight);\nfloat minDot2 = ((camHeight - SurfaceRadius) * (1.0 / (AtmosphereRadius  - SurfaceRadius))) - (1.0 - tweakAmount);\nminDot = min(minDot, minDot2);\nfloat posDot = dot(camToPos / farDist,-camPos.xyz / camHeight) - minDot;\nfloat height = posDot * (1.0 / (maxDot - minDot));\nvTexcoords.y = height;\nheight -= min(0.0,minDot2 + ((1.0 + StretchAmt) * minDot2));\nvTexcoords.x = height;\n}",r.atmoFragmentShader3="precision mediump float;\nvarying vec2 vTexcoords;\nuniform vec4 uParams3;\nuniform vec4 uFogColor;\nuniform vec4 uFogColor2;\nconst vec4 fogColor3 = vec4(0.0/255.0, 0.0/255.0, 0.0/255.0, 1.0);\nvoid main() {\nfloat l = vTexcoords.y;\nif (l > uParams3.z){ discard; } else {\nfloat l2 = clamp((l*l)*0.9+0.1, 0.0, 1.5);\nvec4 c = mix(uFogColor2, uFogColor, l2);\ngl_FragColor = vec4(c.xyz, c.w*l);\nif (l > uParams3.x){ gl_FragColor.xyz = mix(gl_FragColor.xyz, fogColor3.xyz, (l-uParams3.x)*uParams3.y); }\n}}",r.heightmapVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}",r.heightmapFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec4 gridColor = mix(texture2D(uSampler, vTexCoord1), texture2D(uSampler, vTexCoord2), uGridBlend);\ngl_FragColor = mix(uFogColor, gridColor, vFogFactor);\n}",r.heightmapDepthVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform float uFogDensity;\nuniform mat4 uGridMat;\nuniform float uGridStep1, uGridStep2;\nconst int HMSize = 5;\nconst float HMSize1 = float(HMSize-1);\nuniform float uHeight[HMSize*HMSize];\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vDepth;\nfloat round(float x) { return floor(x + 0.5); }\nvoid main() {\nvec3 pos = aPosition;\nfloat z = uHeight[int(round(pos.y*HMSize1)*float(HMSize) + round(pos.x*HMSize1))];\nvec4 camSpacePos = uMV * vec4(pos.xy, z, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvDepth = camDist;\nvec4 gridCoord = uGridMat * vec4(pos, 1.0);\nvTexCoord1 = aTexCoord;\nvTexCoord1 = gridCoord.xy * vec2(uGridStep1);\nvTexCoord2 = gridCoord.xy * vec2(uGridStep2);\n}",r.heightmapDepthFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform float uGridBlend;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying float vDepth;\nvoid main() {\ngl_FragColor = fract(vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vDepth) + (-0.5/255.0);\n}",r.quadPoint="vec3 quadPoint(int i1, int i2, int i3, float t, float t2) {\nfloat p1x = uPoints[i1], p1y = uPoints[i1+1], p1z = uPoints[i1+2];\nfloat p3x = uPoints[i3], p3y = uPoints[i3+1], p3z = uPoints[i3+2];\nfloat p2x = 2.0*uPoints[i2]-p1x*0.5-p3x*0.5;\nfloat p2y = 2.0*uPoints[i2+1]-p1y*0.5-p3y*0.5;\nfloat p2z = 2.0*uPoints[i2+2]-p1z*0.5-p3z*0.5;\nreturn vec3(t2*t2*p1x+2.0*t2*t*p2x+t*t*p3x, t2*t2*p1y+2.0*t2*t*p2y+t*t*p3y, t2*t2*p1z+2.0*t2*t*p2z+t*t*p3z); }\n",r.planeVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams3;\nuniform float uPoints[9*3];\n#ifndef poles\nuniform vec3 uVector;\nuniform float uHeights[9];\n#endif\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying float vFogFactor;\n"+r.quadPoint+"#ifndef poles\nfloat linearHeight(float x, float y) {\nint ix = int(x);\nint iy = int(y);\nint index = (2-iy)*3+ix;\nint index2 = (2-(iy+1))*3+ix;\nfloat fx = fract(x);\nfloat fy = fract(y);\nfloat w0 = (uHeights[index] + (uHeights[index+1] - uHeights[index])*fx);\nfloat w1 = (uHeights[index2] + (uHeights[index2+1] - uHeights[index2])*fx);\nreturn (w0 + (w1 - w0)*fy);\n}\n#endif\nvoid main() {\nvec3 indices = aPosition;\nfloat t = aPosition.y * uParams[2];\nfloat tt = t;\nfloat t2 = (1.0-t);\nvec3 p1 = quadPoint(0, 3, 6, t, t2);\nvec3 p2 = quadPoint(9, 9+3, 9+6, t, t2);\nvec3 p3 = quadPoint(18, 18+3, 18+6, t, t2);\nt = aPosition.x * uParams[2];\nfloat tt2 = t;\nt2 = (1.0-t);\nfloat p2x = 2.0*p2.x-p1.x*0.5-p3.x*0.5;\nfloat p2y = 2.0*p2.y-p1.y*0.5-p3.y*0.5;\nfloat p2z = 2.0*p2.z-p1.z*0.5-p3.z*0.5;\nvec4 p = vec4(t2*t2*p1.x+2.0*t2*t*p2x+t*t*p3.x, t2*t2*p1.y+2.0*t2*t*p2y+t*t*p3.y, t2*t2*p1.z+2.0*t2*t*p2z+t*t*p3.z, 1);\n#ifndef poles\n#ifndef flat\np.xyz += uVector * linearHeight(tt*2.0, tt2*2.0);\n#endif\n#endif\nvec4 camSpacePos = uMV * p;\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\n#ifdef depth\nvFogFactor = camDist;\n#else\nvFogFactor = exp(uParams[1] * camDist);\n#endif\nvec2 uv;\nuv.x = aTexCoord.y * uParams3[2] + uParams3[0];\nuv.y = (1.0-aTexCoord.x) * uParams3[3] + uParams3[1];\nvTexCoord = uv;\nvTexCoord2 = p.xy;\n}",r.planeFragmentShader="precision mediump float;\nuniform sampler2D uSampler;\nuniform vec4 uParams2;\n#ifdef poles\nuniform vec4 uParams4;\nvarying vec2 vTexCoord2;\n#endif\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\n#ifdef poles\nif (length(uParams4.xy - vTexCoord2.xy) > uParams4.z){ discard; }\n#endif\n#ifdef depth\ngl_FragColor = fract(vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vFogFactor) + (-0.5/255.0);\n#else\nvec4 c = mix(texture2D(uSampler, vTexCoord), texture2D(uSampler, vTexCoord*8.0), uParams2[2]);\ngl_FragColor = mix(uFogColor, c, vFogFactor);\n#endif\n}",r.getHFNormal="vec3 getHFNormal(vec2 uv, float texelSize, float heightDelta) {\nvec4 h;\nh[0] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0,-1.0))).r * heightDelta;\nh[1] = texture2D(uSampler2, uv + (texelSize * vec2(-1.0, 0.0))).r * heightDelta;\nh[2] = texture2D(uSampler2, uv + (texelSize * vec2( 1.0, 0.0))).r * heightDelta;\nh[3] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0, 1.0))).r * heightDelta;\nreturn normalize(vec3(h[1] - h[2], h[3] - h[0], 2.0));}\n",r.getHFNormal2="vec2 getHFNormal2(vec2 uv, float texelSize, float heightDelta) {\nvec4 h;\nh[0] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0,-1.0))).r * heightDelta;\nh[1] = texture2D(uSampler2, uv + (texelSize * vec2(-1.0, 0.0))).r * heightDelta;\nh[2] = texture2D(uSampler2, uv + (texelSize * vec2( 1.0, 0.0))).r * heightDelta;\nh[3] = texture2D(uSampler2, uv + (texelSize * vec2( 0.0, 1.0))).r * heightDelta;\nreturn vec2(h[1] - h[2], h[3] - h[0]);}\n",r.planeVertex4Shader="#define newspace\nuniform sampler2D uSampler2;\nattribute vec3 aPosition;\nuniform mat4 uMV, uProj;\nuniform vec4 uParams;\nuniform vec4 uParams3;\nuniform float uPoints[9*3];\nuniform vec3 uVector;\nuniform vec3 uHeights;\nuniform vec4 uTransform;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvarying vec3 vBarycentric;\n#ifdef newspace\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\nvarying float vFogFactor;\n"+r.quadPoint+r.getHFNormal+r.getHFNormal2+"void main() {\nvec3 indices = aPosition;\nfloat t = aPosition.y * uParams[2];\nfloat tt = t;\nfloat t2 = (1.0-t);\nvec3 p1 = quadPoint(0, 3, 6, t, t2);\nvec3 p2 = quadPoint(9, 9+3, 9+6, t, t2);\nvec3 p3 = quadPoint(18, 18+3, 18+6, t, t2);\nt = aPosition.x * uParams[2];\nfloat tt2 = t;\nt2 = (1.0-t);\nfloat p2x = 2.0*p2.x-p1.x*0.5-p3.x*0.5;\nfloat p2y = 2.0*p2.y-p1.y*0.5-p3.y*0.5;\nfloat p2z = 2.0*p2.z-p1.z*0.5-p3.z*0.5;\nvec4 p = vec4(t2*t2*p1.x+2.0*t2*t*p2x+t*t*p3.x, t2*t2*p1.y+2.0*t2*t*p2y+t*t*p3.y, t2*t2*p1.z+2.0*t2*t*p2z+t*t*p3.z, 1);\nvec2 uv2 = vec2(tt, 1.0-tt2);\nuv2 = vec2(uTransform[0] * uv2[0] + uTransform[2], uTransform[1] * uv2[1] + uTransform[3]);\np.xyz += uVector * (uHeights[0] + (uHeights[1]-uHeights[0])*texture2D(uSampler2, uv2).x);\nvec4 camSpacePos = uMV * p;\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uParams[1] * camDist);\nvec2 uv = vec2(tt, 1.0-tt2);\nuv.x = uv.x * uParams3[0] + uParams3[2];\nuv.y = uv.y * uParams3[1] + uParams3[3];\nvTexCoord = uv;\nvBarycentric = camSpacePos.xyz;\n#ifdef newspace\nvec2 d = getHFNormal2(uv2, 1.0/(128.0), (uHeights[1]-uHeights[0]) * uHeights[2]);\nvec3 T = vec3(2.0,0.0,-d.x); vec3 B = vec3(0.0,2.0,-d.y);\nvTBN = mat3(normalize(T), normalize(B), cross(T,B));\n#else\nvec3 n = getHFNormal(uv2, 1.0/(128.0), (uHeights[1]-uHeights[0]) * uHeights[2]);\nvNormal = normalize(n);\n#endif\n}",r.planeFragmentShader2="precision mediump float;\n#extension GL_OES_standard_derivatives : enable\n#define newspace\nuniform sampler2D uSampler;\nuniform vec4 uParams2;\nuniform mat3 uSpace;\nvarying vec2 vTexCoord;\nvarying float vFogFactor;\nvarying vec3 vBarycentric;\n#ifdef newspace\nvarying mat3 vTBN;\n#else\nvarying vec3 vNormal;\n#endif\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vBarycentric);\n#ifdef flat\nvec3 nx = dFdx(vBarycentric);\nvec3 ny = dFdy(vBarycentric);\nvec3 normal2 = normalize(cross(nx,ny));\nvec4 c2 = vec4(vec3(max(0.0,normal2.z*(204.0/255.0))+(32.0/255.0)),1.0);\n#else\n#ifdef newspace\n#ifdef nmix\nvec3 normal = vTBN * normalize((texture2D(uSampler, vTexCoord).xyz-0.5)*2.0);\n#else\nvec3 normal = vTBN * vec3(0.0,0.0,1.0);\n#endif\n#else\nvec3 normal = vNormal;\n#endif\nnormal = normalize(uSpace * normal);\nvec3 eyeDir = ldir;\nvec3 refDir = reflect(-ldir, normal);\nfloat specW = min(1.0, pow(max(dot(refDir, eyeDir), 0.0), 90.0));\nfloat diffW = min(1.0, max(dot(normal, ldir), 0.0));\nfloat lcolor = (dot(normal, ldir) + 1.0) * 0.5;\n#ifdef normals\nvec4 c2 = vec4(normal*0.5+0.5,1.0);\n#else\nvec4 c2 = vec4(vec3(dot(vec3(0.0,0.0,1.0), normal)),1.0);\n#endif\n#endif\n#ifdef grid\nvec4 c = mix(texture2D(uSampler, vTexCoord), texture2D(uSampler, vTexCoord*8.0), uParams2[2]);\nc = mix(c, c2, 0.5);\n#else\n#ifdef exmap\nvec4 c = texture2D(uSampler, vTexCoord);\n#ifdef classmap\nint i = int(c.x*255.0);\nif (i == 1 || i == 2 || i == 5 || i == 6) c = vec4(146.0, 178.0, 144.0, 255.0);\nif (i == 3 || i == 4) c = vec4(94.0, 169.0, 133.0, 255.0);\nif (i == 8 || i == 11) c = vec4(238.0, 221.0, 185.0, 255.0);\nif (i == 7) c = vec4(226.0, 192.0, 154.0, 255.0);\nif (i == 9 || i == 10 || i == 12) c = vec4(250.0, 246.0, 167.0, 255.0);\nif (i == 13 || i == 16) c = vec4(245.0, 236.0, 211.0, 255.0);\nif (i == 14) c = vec4(139.0, 185.0, 166.0, 255.0);\nif (i == 15) c = vec4(199.0, 219.0, 155.0, 255.0);\nif (i == 17) c = vec4(149.0, 132.0, 162.0, 255.0);\nif (i == 18 || i == 0) c = vec4(188.0, 221.0, 255.0, 255.0);\nif (i == 19) c = vec4(255.0, 255.0, 255.0, 255.0);\nc = (c*(1.0/255.0)) * c2;\n#endif\n#else\nvec4 c = c2;\n#endif\n#endif\n#ifdef fog\ngl_FragColor = mix(uFogColor, c, vFogFactor);\n#else\ngl_FragColor = c;\n#endif\n}",r.tileVertexShader="attribute vec3 aPosition;\n#ifdef onlyFog\nvarying float vFogFactor;\n#else\n#ifdef externalTex\nattribute vec2 aTexCoord2;\n#else\nattribute vec2 aTexCoord;\n#endif\nvarying vec3 vTexCoord;\n#endif\n#ifdef clip4\n#ifndef externalTex\nattribute vec2 aTexCoord2;\n#endif\nvarying vec2 vClipCoord;\n#endif\n#ifdef depth\nvarying float vDepth;\n#endif\n#ifdef flatShadeVar\nvarying vec3 vBarycentric;\n#endif\nuniform mat4 uMV, uProj, uParams;\n#ifdef applySE\nuniform mat4 uParamsSE;\n#endif\nvoid main() {\n#ifdef applySE\nvec3 geoPos2 = aPosition*vec3(uParamsSE[0][3],uParamsSE[1][0],uParamsSE[1][1]);\nvec3 geoPos = geoPos2+vec3(uParamsSE[0][0],uParamsSE[0][1],uParamsSE[0][2]);\ngeoPos.z *= uParamsSE[3][3];\nfloat ll = length(geoPos);\nvec3 v = geoPos * (1.0/(ll+0.0001));\nfloat h = ll - uParamsSE[3][2];\nfloat h2 = clamp(h, uParamsSE[2][1], uParamsSE[2][3]);\nfloat h3 = h;\nh *= (uParamsSE[2][2] + ((h2 - uParamsSE[2][1]) * uParamsSE[3][0]) * uParamsSE[3][1]);\ngeoPos2.xyz += v * (h - h3);\nvec4 camSpacePos = uMV * vec4(geoPos2, 1.0);\nfloat l = dot(v, vec3(uParams[1][0],uParams[1][1],uParams[1][2]));\n#else\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\nvec3 worldPos = vec3(aPosition.x * uParams[0][2] + uParams[3][1], aPosition.y * uParams[0][3] + uParams[3][2], aPosition.z * uParams[3][0] + uParams[3][3]);\nfloat l = dot(normalize(worldPos.xyz), vec3(uParams[1][0],uParams[1][1],uParams[1][2]));\n#endif\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\n#ifdef depth\nvDepth = camDist;\n#endif\n#ifdef flatShadeVar\nvBarycentric = camSpacePos.xyz;\n#endif\nfloat fogFactor = 1.0-exp(uParams[0][1] * camDist);\nfogFactor = clamp((1.0-abs(l))*uParams[1][3] + fogFactor, 0.0, 1.0);\n#ifdef onlyFog\nvFogFactor = fogFactor;\n#else\nvTexCoord.z = fogFactor;\n#ifdef externalTex\nvTexCoord.xy = vec2(uParams[2][0] * aTexCoord2[0] + uParams[2][2], uParams[2][1] * aTexCoord2[1] + uParams[2][3]);\n#else\nvTexCoord.xy = aTexCoord;\n#endif\n#endif\n#ifdef clip4\nvClipCoord.xy = aTexCoord2.xy;\n#endif\n}",r.tileFragmentShader="precision mediump float;\n#ifdef clip4\nuniform float uClip[4];\nvarying vec2 vClipCoord;\n#endif\n#ifdef onlyFog\nvarying float vFogFactor;\n#else\nvarying vec3 vTexCoord;\nuniform sampler2D uSampler;\n#ifdef mask\nuniform sampler2D uSampler2;\n#endif\n#endif\n#ifdef depth\nvarying float vDepth;\n#endif\n#ifdef flatShadeVar\nvarying vec3 vBarycentric;\n#ifdef fogAndColor\nuniform vec4 uColor;\n#endif\n#endif\nuniform vec4 uParams2;\nvoid main() {\n#ifdef clip4\nif (vClipCoord.y > 0.5){\nif (vClipCoord.x > 0.5){\nif (uClip[3] == 0.0) discard;\n} else {\nif (uClip[2] == 0.0) discard;\n}\n} else {\nif (vClipCoord.x > 0.5){\nif (uClip[1] == 0.0) discard;\n} else {\nif (uClip[0] == 0.0) discard;\n}\n}\n#endif\n#ifdef flatShadeVar\n#ifdef flatShadeVarFallback\nvec4 flatShadeData = vec4(1.0);\n#else\n#ifdef GL_OES_standard_derivatives\nvec3 nx = dFdx(vBarycentric);\nvec3 ny = dFdy(vBarycentric);\nvec3 normal=normalize(cross(nx,ny));\nvec4 flatShadeData = vec4(vec3(max(0.0,normal.z*(204.0/255.0))+(32.0/255.0)),1.0);\n#else\nvec4 flatShadeData = vec4(1.0);\n#endif\n#endif\n#endif\n#ifdef flatShade\n#ifdef fogAndColor\ngl_FragColor = vec4(uColor.xyz * flatShadeData.xyz, uColor.w);\n#else\ngl_FragColor = vec4(flatShadeData.xyz, 1.0);\n#endif\n#else\nvec4 fogColor = vec4(uParams2.xyz, 1.0);\n#ifdef onlyFog\ngl_FragColor = vec4(fogColor.xyz, vFogFactor);\n#else\n#ifdef depth\ngl_FragColor = fract(vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) * vDepth) + (-0.5/255.0);\n#else\n#ifdef externalTex\nvec4 c = texture2D(uSampler, vTexCoord.xy);\n__FILTER__vec4 cc = mix(c, fogColor, vTexCoord.z);\n#ifdef mask\nvec4 c2 = texture2D(uSampler2, vTexCoord.xy);\ncc.w = c.w * uParams2.w * c2.x;\n#else\ncc.w = c.w * uParams2.w;\n#endif\ngl_FragColor = cc;\n#else\ngl_FragColor = mix(texture2D(uSampler, vTexCoord.xy), fogColor, vTexCoord.z);\n#endif\n#endif\n#endif\n#endif\n}",r.shadedMeshVertexShader="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nuniform mat4 uMV, uProj;\nuniform mat3 uNorm;\nuniform float uFogDensity;\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nvarying float vFogFactor;\nvoid main() {\nvec4 camSpacePos = uMV * vec4(aPosition, 1.0);\ngl_Position = uProj * camSpacePos;\nfloat camDist = length(camSpacePos.xyz);\nvFogFactor = exp(uFogDensity * camDist);\nvTexCoord = aTexCoord;\nvPosition = camSpacePos;\nvNormal = aNormal * uNorm;\n}",r.shadedMeshFragmentShader="precision mediump float;\n#ifdef textured\nuniform sampler2D uSampler;\nvarying vec2 vTexCoord;\n#endif\nvarying vec4 vPosition;\nvarying vec3 vNormal;\nuniform mat4 uMaterial;\nvarying float vFogFactor;\nuniform vec4 uFogColor;\nvoid main() {\nvec3 ldir = normalize(-vPosition.xyz);\nvec3 normal = normalize(vNormal);\nvec3 eyeDir = ldir;\nvec3 refDir = reflect(-ldir, normal);\nfloat specW = min(1.0, pow(max(dot(refDir, eyeDir), 0.0), uMaterial[3][0]));\nfloat diffW = min(1.0, max(dot(normal, ldir), 0.0));\nvec4 lcolor = uMaterial[0]+(uMaterial[1]*diffW)+(uMaterial[2]*specW);\n#ifdef textured\nvec4 tcolor = texture2D(uSampler, vTexCoord);\ngl_FragColor = mix(uFogColor, vec4(lcolor.xyz*(1.0/255.0), 1.0) * tcolor, vFogFactor); gl_FragColor.w *= uMaterial[3][1];\n#else\ngl_FragColor = mix(uFogColor, vec4(lcolor.xyz*(1.0/255.0), 1.0), vFogFactor);  gl_FragColor.w = uMaterial[3][1];\n#endif\n}",r.tileWireFrameBasicShader="precision mediump float;\nuniform vec4 uColor;\nvoid main() {\ngl_FragColor = uColor;\n}",r.imageVertexShader="\nattribute vec4 aPosition;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uData;\nuniform vec4 uColor;\nuniform float uDepth;\nvarying vec4 vColor;\nvarying vec2 vTexcoords;\nvoid main(void){\nint i=int(aPosition.x);\nvec4 p;\nif(i==0) p = vec4(floor(uData[0][0]+0.1),floor(uData[0][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[0][2], uData[0][3]);\nif(i==1) p = vec4(floor(uData[1][0]+0.1),floor(uData[1][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[1][2], uData[1][3]);\nif(i==2) p = vec4(floor(uData[2][0]+0.1),floor(uData[2][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[2][2], uData[2][3]);\nif(i==3) p = vec4(floor(uData[3][0]+0.1),floor(uData[3][1]+0.1),uDepth,1.0), vTexcoords=vec2(uData[3][2], uData[3][3]);\ngl_Position=uProjectionMatrix*p;\nvec4 c=uColor;\nc.w*=1.0;\nvColor=c;\n}",r.imageFragmentShader="precision mediump float;\nvarying vec4 vColor;\nvarying vec2 vTexcoords;\nuniform sampler2D uSampler;\nvoid main(void){\nvec4 c=texture2D(uSampler, vec2(vTexcoords.x, vTexcoords.y) );\nc*=vColor;\nif(c.w < 0.01){ discard; }\ngl_FragColor = c;\n}",t.a=r},function(e,t,i){"use strict";var r=i(21),s=i(34),a=i.n(s),n=i(13);i.d(t,"a",function(){return l});var o=n.c,h=r.a,l=function(e,t){this.core=new o(e,t,this),Object.defineProperty(this,"map",{get:function(){return this.core?this.core.getMapInterface():null}}),Object.defineProperty(this,"renderer",{get:function(){return this.core?this.core.getRendererInterface():null}}),Object.defineProperty(this,"proj4",{get:function(){return this.core?h:null}}),Object.defineProperty(this,"earcut",{get:function(){return this.core?a.a:null}})};l.prototype.destroy=function(){this.core.destroy(),this.core=null},l.prototype.loadMap=function(e){return this.core?this.core.loadMap(e):null},l.prototype.destroyMap=function(){return this.core?this.core.destroyMap():null},l.prototype.on=function(e,t){return this.core?this.core.on(e,t):null},l.prototype.once=function(e,t,i){return this.core?this.core.once(e,t,i):null},l.prototype.callListener=function(e,t){if(!this.core)return null;this.core.callListener(e,t)}},function(e,t,i){"use strict";function r(e,t,i){if(!(this instanceof r))return new r(e,t,i);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var s=e.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=e,this.y=t,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var s=i(35);r.fromMGRS=function(e){return new r(i.i(s.b)(e))},r.prototype.toMGRS=function(e){return i.i(s.c)([this.x,this.y],e)},t.a=r},function(e,t,i){"use strict";t.a=function(e,t,i){var r,s,a,n=i.x,o=i.y,h=i.z||0,l={};for(a=0;a<3;a++)if(!t||2!==a||void 0!==i.z)switch(0===a?(r=n,s="x"):1===a?(r=o,s="y"):(r=h,s="z"),e.axis[a]){case"e":l[s]=r;break;case"w":l[s]=-r;break;case"n":l[s]=r;break;case"s":l[s]=-r;break;case"u":void 0!==i[s]&&(l.z=r);break;case"d":void 0!==i[s]&&(l.z=-r);break;default:return null}return l}},function(e,t,i){"use strict";var r=i(3);t.a=function(e,t){if(void 0===e){if((e=Math.floor(30*(i.i(r.a)(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}},function(e,t,i){"use strict";var r=i(36),s=i(72);t.a=function(e){var t=Math.abs(e);return t=i.i(s.a)(t*(1+t/(i.i(r.a)(1,t)+1))),e<0?-t:t}},function(e,t,i){"use strict";t.a=function(e,t){for(var i,r=2*Math.cos(t),s=e.length-1,a=e[s],n=0;--s>=0;)i=r*a-n+e[s],n=a,a=i;return Math.sin(t)*i}},function(e,t,i){"use strict";var r=i(39),s=i(69);t.a=function(e,t,a){for(var n,o,h=Math.sin(t),l=Math.cos(t),u=i.i(r.a)(a),c=i.i(s.a)(a),d=2*l*c,p=-2*h*u,f=e.length-1,g=e[f],m=0,v=0,y=0;--f>=0;)n=v,o=m,v=g,m=y,g=d*v-n-p*m+e[f],y=p*v-o+d*m;return d=h*c,p=l*u,[d*g-p*y,d*y+p*g]}},function(e,t,i){"use strict";t.a=function(e){var t=Math.exp(e);return t=(t+1/t)/2}},function(e,t,i){"use strict";t.a=function(e,t){for(var i,r=2*Math.cos(2*t),s=e.length-1,a=e[s],n=0;--s>=0;)i=r*a-n+e[s],n=a,a=i;return t+i*Math.sin(2*t)}},function(e,t,i){"use strict";var r=i(0);t.a=function(e,t){var i=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-i)<1e-6)return t<0?-1*r.a:r.a;for(var s,a,n,o,h=Math.asin(.5*t),l=0;l<30;l++)if(a=Math.sin(h),n=Math.cos(h),o=e*a,s=Math.pow(1-o*o,2)/(2*n)*(t/(1-e*e)-a/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),h+=s,Math.abs(s)<=1e-10)return h;return NaN}},function(e,t,i){"use strict";t.a=function(e){var t=1+e,i=t-1;return 0===i?e:e*Math.log(t)/i}},function(e,t,i){"use strict";t.a=function(e,t){return Math.pow((1-e)/(1+e),t)}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r={};r.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},r.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},r.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},r.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},r.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},r.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},r.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},r.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},r.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},r.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},r.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},r.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},r.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},r.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},r.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},r.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},function(e,t,i){"use strict";i.d(t,"a",function(){return r}),i.d(t,"b",function(){return s});var r={};r.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},r.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},r.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},r.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},r.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},r.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},r.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},r.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},r.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},r.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},r.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},r.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},r.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},r.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},r.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},r.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},r.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},r.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},r.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},r.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},r.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},r.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},r.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},r.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},r.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},r.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},r.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},r.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},r.hough={a:6378270,rf:297,ellipseName:"Hough"},r.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},r.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},r.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},r.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},r.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},r.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},r.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},r.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},r.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},r.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},r.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},r.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var s=r.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};r.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var r={};r.greenwich=0,r.lisbon=-9.131906111111,r.paris=2.337229166667,r.bogota=-74.080916666667,r.madrid=-3.687938888889,r.rome=12.452333333333,r.bern=7.439583333333,r.jakarta=106.807719444444,r.ferro=-17.666666666667,r.brussels=4.367975,r.stockholm=18.058277777778,r.athens=23.7163375,r.oslo=10.722916666667},function(e,t,i){"use strict";t.a={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}}},function(e,t,i){"use strict";function r(e,t,r){var s;return Array.isArray(r)?(s=i.i(o.a)(e,t,r),3===r.length?[s.x,s.y,s.z]:[s.x,s.y]):i.i(o.a)(e,t,r)}function s(e){return e instanceof n.a?e:e.oProj?e.oProj:i.i(n.a)(e)}function a(e,t,i,a){if(a)return e;e=s(e);var n,o=!1;return void 0===t?(t=e,e=h,o=!0):(void 0!==t.x||Array.isArray(t))&&(i=t,t=e,e=h,o=!0),t=s(t),i?r(e,t,i):(n={forward:function(i){return r(e,t,i)},inverse:function(i){return r(t,e,i)},info:function(){return{a:t.a,b:t.b,ra:t.R_A,"proj-name":t.projName}}},o&&(n.oProj=t),n)}var n=i(24),o=i(45),h=i.i(n.a)("WGS84");t.a=a},function(e,t,i){"use strict";function r(e,t,i,r,a,n){var o={};return o.datum_type=void 0===e||"none"===e?s.k:s.l,t&&(o.datum_params=t.map(parseFloat),0===o.datum_params[0]&&0===o.datum_params[1]&&0===o.datum_params[2]||(o.datum_type=s.h),o.datum_params.length>3&&(0===o.datum_params[3]&&0===o.datum_params[4]&&0===o.datum_params[5]&&0===o.datum_params[6]||(o.datum_type=s.i,o.datum_params[3]*=s.f,o.datum_params[4]*=s.f,o.datum_params[5]*=s.f,o.datum_params[6]=o.datum_params[6]/1e6+1))),o.a=i,o.b=r,o.es=a,o.ep2=n,o}var s=i(0);t.a=r},function(e,t,i){"use strict";function r(e){return e===s.h||e===s.i}var s=i(0),a=i(41);t.a=function(e,t,n){return i.i(a.c)(e,t)?n:e.datum_type===s.k||t.datum_type===s.k?n:e.es!==t.es||e.a!==t.a||r(e.datum_type)||r(t.datum_type)?(n=i.i(a.b)(n,e.es,e.a),r(e.datum_type)&&(n=i.i(a.d)(n,e.datum_type,e.datum_params)),r(t.datum_type)&&(n=i.i(a.e)(n,t.datum_type,t.datum_params)),i.i(a.a)(n,t.es,t.a,t.b)):n}},function(e,t,i){"use strict";function r(e,t,i,r){var s=e*e,n=t*t,o=(s-n)/s,h=0;return r?(e*=1-o*(a.m+o*(a.n+o*a.o)),s=e*e,o=0):h=Math.sqrt(o),{es:o,e:h,ep2:(s-n)/n}}function s(e,t,r,s,h){if(!e){var l=i.i(o.a)(n.a,s);l||(l=n.b),e=l.a,t=l.b,r=l.rf}return r&&!t&&(t=(1-1/r)*e),(0===r||Math.abs(e-t)<a.d)&&(h=!0,t=e),{a:e,b:t,rf:r,sphere:h}}var a=i(0),n=i(75),o=i(29);t.b=r,t.a=s},function(e,t,i){"use strict";t.a=function(e,t){e=e||{};var i,r;if(!t)return e;for(r in t)void 0!==(i=t[r])&&(e[r]=i);return e}},function(e,t,i){"use strict";t.a=function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}},function(e,t,i){"use strict";function r(e){return"string"==typeof e}function s(e){return e in h.a}function a(e){return c.some(function(t){return e.indexOf(t)>-1})}function n(e){return"+"===e[0]}function o(e){return r(e)?s(e)?h.a[e]:a(e)?i.i(l.a)(e):n(e)?i.i(u.a)(e):void 0:e}var h=i(42),l=i(46),u=i(43),c=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];t.a=o},function(e,t,i){"use strict";function r(e,t){var i=u.length;return e.names?(u[i]=e,e.names.forEach(function(e){l[e.toLowerCase()]=i}),this):(console.log(t),!0)}function s(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==l[t]&&u[l[t]]?u[l[t]]:void 0}function a(){h.forEach(r)}var n=i(99),o=i(98),h=[n.a,o.a],l={},u=[];t.a={start:a,add:r,get:s}},function(e,t,i){"use strict";function r(){Math.abs(this.lat1+this.lat2)<c.d||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=i.i(o.a)(this.e3,this.sin_po,this.cos_po),this.qs1=i.i(h.a)(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=i.i(o.a)(this.e3,this.sin_po,this.cos_po),this.qs2=i.i(h.a)(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=i.i(h.a)(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>c.d?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function s(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var s=i.i(h.a)(this.e3,this.sin_phi,this.cos_phi),a=this.a*Math.sqrt(this.c-this.ns0*s)/this.ns0,n=this.ns0*i.i(l.a)(t-this.long0),o=a*Math.sin(n)+this.x0,u=this.rh-a*Math.cos(n)+this.y0;return e.x=o,e.y=u,e}function a(e){var t,r,s,a,n,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),s=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),s=-1),a=0,0!==t&&(a=Math.atan2(s*e.x,s*e.y)),s=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-s*s)/(2*this.ns0)):(r=(this.c-s*s)/this.ns0,o=this.phi1z(this.e3,r)),n=i.i(l.a)(a/this.ns0+this.long0),e.x=n,e.y=o,e}function n(e,t){var r,s,a,n,o,h=i.i(u.a)(.5*t);if(e<c.d)return h;for(var l=e*e,d=1;d<=25;d++)if(r=Math.sin(h),s=Math.cos(h),a=e*r,n=1-a*a,o=.5*n*n/s*(t/(1-l)-r/n+.5/e*Math.log((1-a)/(1+a))),h+=o,Math.abs(o)<=1e-7)return h;return null}var o=i(8),h=i(28),l=i(3),u=i(7),c=i(0),d=["Albers_Conic_Equal_Area","Albers","aea"];t.a={init:r,forward:s,inverse:a,names:d,phi1z:n}},function(e,t,i){"use strict";function r(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function s(e){var t,r,s,a,f,g,m,v,y,b,x,w,S,M,A,C,T,P,F,L,E,k,N,B=e.x,I=e.y,R=Math.sin(e.y),U=Math.cos(e.y),D=i.i(n.a)(B-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=o.d?(e.x=this.x0+this.a*(o.a-I)*Math.sin(D),e.y=this.y0-this.a*(o.a-I)*Math.cos(D),e):Math.abs(this.sin_p12+1)<=o.d?(e.x=this.x0+this.a*(o.a+I)*Math.sin(D),e.y=this.y0+this.a*(o.a+I)*Math.cos(D),e):(P=this.sin_p12*R+this.cos_p12*U*Math.cos(D),C=Math.acos(P),T=C/Math.sin(C),e.x=this.x0+this.a*T*U*Math.sin(D),e.y=this.y0+this.a*T*(this.cos_p12*R-this.sin_p12*U*Math.cos(D)),e):(t=i.i(l.a)(this.es),r=i.i(u.a)(this.es),s=i.i(c.a)(this.es),a=i.i(d.a)(this.es),Math.abs(this.sin_p12-1)<=o.d?(f=this.a*i.i(h.a)(t,r,s,a,o.a),g=this.a*i.i(h.a)(t,r,s,a,I),e.x=this.x0+(f-g)*Math.sin(D),e.y=this.y0-(f-g)*Math.cos(D),e):Math.abs(this.sin_p12+1)<=o.d?(f=this.a*i.i(h.a)(t,r,s,a,o.a),g=this.a*i.i(h.a)(t,r,s,a,I),e.x=this.x0+(f+g)*Math.sin(D),e.y=this.y0+(f+g)*Math.cos(D),e):(m=R/U,v=i.i(p.a)(this.a,this.e,this.sin_p12),y=i.i(p.a)(this.a,this.e,R),b=Math.atan((1-this.es)*m+this.es*v*this.sin_p12/(y*U)),x=Math.atan2(Math.sin(D),this.cos_p12*Math.tan(b)-this.sin_p12*Math.cos(D)),F=0===x?Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):Math.abs(Math.abs(x)-Math.PI)<=o.d?-Math.asin(this.cos_p12*Math.sin(b)-this.sin_p12*Math.cos(b)):Math.asin(Math.sin(D)*Math.cos(b)/Math.sin(x)),w=this.e*this.sin_p12/Math.sqrt(1-this.es),S=this.e*this.cos_p12*Math.cos(x)/Math.sqrt(1-this.es),M=w*S,A=S*S,L=F*F,E=L*F,k=E*F,N=k*F,C=v*F*(1-L*A*(1-A)/6+E/8*M*(1-2*A)+k/120*(A*(4-7*A)-3*w*w*(1-7*A))-N/48*M),e.x=this.x0+C*Math.sin(x),e.y=this.y0+C*Math.cos(x),e))}function a(e){e.x-=this.x0,e.y-=this.y0;var t,r,s,a,m,v,y,b,x,w,S,M,A,C,T,P,F,L,E,k,N,B,I;if(this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*o.a*this.a)return;return r=t/this.a,s=Math.sin(r),a=Math.cos(r),m=this.long0,Math.abs(t)<=o.d?v=this.lat0:(v=i.i(f.a)(a*this.sin_p12+e.y*s*this.cos_p12/t),y=Math.abs(this.lat0)-o.a,m=Math.abs(y)<=o.d?this.lat0>=0?i.i(n.a)(this.long0+Math.atan2(e.x,-e.y)):i.i(n.a)(this.long0-Math.atan2(-e.x,e.y)):i.i(n.a)(this.long0+Math.atan2(e.x*s,t*this.cos_p12*a-e.y*this.sin_p12*s))),e.x=m,e.y=v,e}return b=i.i(l.a)(this.es),x=i.i(u.a)(this.es),w=i.i(c.a)(this.es),S=i.i(d.a)(this.es),Math.abs(this.sin_p12-1)<=o.d?(M=this.a*i.i(h.a)(b,x,w,S,o.a),t=Math.sqrt(e.x*e.x+e.y*e.y),A=M-t,v=i.i(g.a)(A/this.a,b,x,w,S),m=i.i(n.a)(this.long0+Math.atan2(e.x,-1*e.y)),e.x=m,e.y=v,e):Math.abs(this.sin_p12+1)<=o.d?(M=this.a*i.i(h.a)(b,x,w,S,o.a),t=Math.sqrt(e.x*e.x+e.y*e.y),A=t-M,v=i.i(g.a)(A/this.a,b,x,w,S),m=i.i(n.a)(this.long0+Math.atan2(e.x,e.y)),e.x=m,e.y=v,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),P=Math.atan2(e.x,e.y),C=i.i(p.a)(this.a,this.e,this.sin_p12),F=Math.cos(P),L=this.e*this.cos_p12*F,E=-L*L/(1-this.es),k=3*this.es*(1-E)*this.sin_p12*this.cos_p12*F/(1-this.es),N=t/C,B=N-E*(1+E)*Math.pow(N,3)/6-k*(1+3*E)*Math.pow(N,4)/24,I=1-E*B*B/2-N*B*B*B/6,T=Math.asin(this.sin_p12*Math.cos(B)+this.cos_p12*Math.sin(B)*F),m=i.i(n.a)(this.long0+Math.asin(Math.sin(P)*Math.sin(B)/Math.cos(T))),v=Math.atan((1-this.es*I*this.sin_p12/Math.sin(T))*Math.tan(T)/(1-this.es)),e.x=m,e.y=v,e)}var n=i(3),o=i(0),h=i(18),l=i(14),u=i(15),c=i(16),d=i(17),p=i(25),f=i(7),g=i(26),m=["Azimuthal_Equidistant","aeqd"];t.a={init:r,forward:s,inverse:a,names:m}},function(e,t,i){"use strict";function r(){this.sphere||(this.e0=i.i(o.a)(this.es),this.e1=i.i(h.a)(this.es),this.e2=i.i(l.a)(this.es),this.e3=i.i(u.a)(this.es),this.ml0=this.a*i.i(n.a)(this.e0,this.e1,this.e2,this.e3,this.lat0))}function s(e){var t,r,s=e.x,a=e.y;if(s=i.i(d.a)(s-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(a)*Math.sin(s)),r=this.a*(Math.atan2(Math.tan(a),Math.cos(s))-this.lat0);else{var o=Math.sin(a),h=Math.cos(a),l=i.i(c.a)(this.a,this.e,o),u=Math.tan(a)*Math.tan(a),p=s*Math.cos(a),f=p*p,g=this.es*h*h/(1-this.es),m=this.a*i.i(n.a)(this.e0,this.e1,this.e2,this.e3,a);t=l*p*(1-f*u*(1/6-(8-u+8*g)*f/120)),r=m-this.ml0+l*o/h*f*(.5+(5-u+6*g)*f/24)}return e.x=t+this.x0,e.y=r+this.y0,e}function a(e){e.x-=this.x0,e.y-=this.y0;var t,r,s=e.x/this.a,a=e.y/this.a;if(this.sphere){var n=a+this.lat0;t=Math.asin(Math.sin(n)*Math.cos(s)),r=Math.atan2(Math.tan(s),Math.cos(n))}else{var o=this.ml0/this.a+a,h=i.i(f.a)(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(h)-g.a)<=g.d)return e.x=this.long0,e.y=g.a,a<0&&(e.y*=-1),e;var l=i.i(c.a)(this.a,this.e,Math.sin(h)),u=l*l*l/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(h),2),v=s*this.a/l,y=v*v;t=h-l*Math.tan(h)/u*v*v*(.5-(1+3*m)*v*v/24),r=v*(1-y*(m/3+(1+3*m)*m*y/15))/Math.cos(h)}return e.x=i.i(d.a)(r+this.long0),e.y=i.i(p.a)(t),e}var n=i(18),o=i(14),h=i(15),l=i(16),u=i(17),c=i(25),d=i(3),p=i(11),f=i(26),g=i(0),m=["Cassini","Cassini_Soldner","cass"];t.a={init:r,forward:s,inverse:a,names:m}},function(e,t,i){"use strict";function r(){this.sphere||(this.k0=i.i(h.a)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function s(e){var t,r,s=e.x,a=e.y,h=i.i(n.a)(s-this.long0);if(this.sphere)t=this.x0+this.a*h*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var l=i.i(o.a)(this.e,Math.sin(a));t=this.x0+this.a*this.k0*h,r=this.y0+this.a*l*.5/this.k0}return e.x=t,e.y=r,e}function a(e){e.x-=this.x0,e.y-=this.y0;var t,r;return this.sphere?(t=i.i(n.a)(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(r=i.i(l.a)(this.e,2*e.y*this.k0/this.a),t=i.i(n.a)(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=r,e}var n=i(3),o=i(28),h=i(8),l=i(71),u=["cea"];t.a={init:r,forward:s,inverse:a,names:u}},function(e,t,i){"use strict";function r(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function s(e){var t=e.x,r=e.y,s=i.i(n.a)(t-this.long0),a=i.i(o.a)(r-this.lat0);return e.x=this.x0+this.a*s*this.rc,e.y=this.y0+this.a*a,e}function a(e){var t=e.x,r=e.y;return e.x=i.i(n.a)(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=i.i(o.a)(this.lat0+(r-this.y0)/this.a),e}var n=i(3),o=i(11),h=["Equirectangular","Equidistant_Cylindrical","eqc"];t.a={init:r,forward:s,inverse:a,names:h}},function(e,t,i){"use strict";function r(){Math.abs(this.lat1+this.lat2)<g.d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=i.i(n.a)(this.es),this.e1=i.i(o.a)(this.es),this.e2=i.i(h.a)(this.es),this.e3=i.i(l.a)(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=i.i(u.a)(this.e,this.sinphi,this.cosphi),this.ml1=i.i(c.a)(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<g.d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=i.i(u.a)(this.e,this.sinphi,this.cosphi),this.ml2=i.i(c.a)(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=i.i(c.a)(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function s(e){var t,r=e.x,s=e.y;if(this.sphere)t=this.a*(this.g-s);else{var a=i.i(c.a)(this.e0,this.e1,this.e2,this.e3,s);t=this.a*(this.g-a)}var n=this.ns*i.i(d.a)(r-this.long0),o=this.x0+t*Math.sin(n),h=this.y0+this.rh-t*Math.cos(n);return e.x=o,e.y=h,e}function a(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,r,s,a;this.ns>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var n=0;if(0!==r&&(n=Math.atan2(t*e.x,t*e.y)),this.sphere)return a=i.i(d.a)(this.long0+n/this.ns),s=i.i(p.a)(this.g-r/this.a),e.x=a,e.y=s,e;var o=this.g-r/this.a;return s=i.i(f.a)(o,this.e0,this.e1,this.e2,this.e3),a=i.i(d.a)(this.long0+n/this.ns),e.x=a,e.y=s,e}var n=i(14),o=i(15),h=i(16),l=i(17),u=i(8),c=i(18),d=i(3),p=i(11),f=i(26),g=i(0),m=["Equidistant_Conic","eqdc"];t.a={init:r,forward:s,inverse:a,names:m}},function(e,t,i){"use strict";function r(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+o.b)/(Math.pow(Math.tan(.5*this.lat0+o.b),this.C)*i.i(n.a)(this.e*e,this.ratexp))}function s(e){var t=e.x,r=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+o.b),this.C)*i.i(n.a)(this.e*Math.sin(r),this.ratexp))-o.a,e.x=this.C*t,e}function a(e){for(var t=e.x/this.C,r=e.y,s=Math.pow(Math.tan(.5*r+o.b)/this.K,1/this.C),a=h;a>0&&(r=2*Math.atan(s*i.i(n.a)(this.e*Math.sin(e.y),-.5*this.e))-o.a,!(Math.abs(r-e.y)<1e-14));--a)e.y=r;return a?(e.x=t,e.y=r,e):null}var n=i(73),o=i(0),h=20,l=["gauss"];t.a={init:r,forward:s,inverse:a,names:l}},function(e,t,i){"use strict";function r(){this.isGeocent=!0}function s(e){return e}var a=["geocent"];t.a={init:r,forward:s,inverse:s,names:a}},function(e,t,i){"use strict";function r(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function s(e){var t,r,s,a,o,l,u,c,d=e.x,p=e.y;return s=i.i(n.a)(d-this.long0),t=Math.sin(p),r=Math.cos(p),a=Math.cos(s),l=this.sin_p14*t+this.cos_p14*r*a,o=1,l>0||Math.abs(l)<=h.d?(u=this.x0+this.a*o*r*Math.sin(s)/l,c=this.y0+this.a*o*(this.cos_p14*t-this.sin_p14*r*a)/l):(u=this.x0+this.infinity_dist*r*Math.sin(s),c=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*a)),e.x=u,e.y=c,e}function a(e){var t,r,s,a,h,l;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(a=Math.atan2(t,this.rc),r=Math.sin(a),s=Math.cos(a),l=i.i(o.a)(s*this.sin_p14+e.y*r*this.cos_p14/t),h=Math.atan2(e.x*r,t*this.cos_p14*s-e.y*this.sin_p14*r),h=i.i(n.a)(this.long0+h)):(l=this.phic0,h=0),e.x=h,e.y=l,e}var n=i(3),o=i(7),h=i(0),l=["gnom"];t.a={init:r,forward:s,inverse:a,names:l}},function(e,t,i){"use strict";function r(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function s(e){var t,r,s,a,o,h,l,u=e.x,c=e.y,d=i.i(n.a)(u-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),s=-d*this.alfa,a=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),o=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(a)),h=this.n*o,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(a/2+this.s45),this.n),e.y=l*Math.cos(h)/1,e.x=l*Math.sin(h)/1,this.czech||(e.y*=-1,e.x*=-1),e}function a(e){var t,i,r,s,a,n,o,h,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),n=Math.sqrt(e.x*e.x+e.y*e.y),a=Math.atan2(e.y,e.x),s=a/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),i=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(t)),e.x=this.long0-i/this.alfa,o=t,h=0;var u=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(h=1),o=e.y,u+=1}while(0===h&&u<15);return u>=15?null:e}var n=i(3),o=["Krovak","krovak"];t.a={init:r,forward:s,inverse:a,names:o}},function(e,t,i){"use strict";function r(){var e=Math.abs(this.lat0);if(Math.abs(e-h.a)<h.d?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<h.d?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=i.i(l.a)(this.e,1),this.mmf=.5/(1-this.es),this.apa=n(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=i.i(l.a)(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function s(e){var t,r,s,a,n,o,c,d,p,f,g=e.x,m=e.y;if(g=i.i(u.a)(g-this.long0),this.sphere){if(n=Math.sin(m),f=Math.cos(m),s=Math.cos(g),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+f*s:1+this.sinph0*n+this.cosph0*f*s)<=h.d)return null;r=Math.sqrt(2/r),t=r*f*Math.sin(g),r*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*f*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(m+this.phi0)<h.d)return null;r=h.b-.5*m,r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)),t=r*Math.sin(g),r*=s}}else{switch(c=0,d=0,p=0,s=Math.cos(g),a=Math.sin(g),n=Math.sin(m),o=i.i(l.a)(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=o/this.qp,d=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:p=1+this.sinb1*c+this.cosb1*d*s;break;case this.EQUIT:p=1+d*s;break;case this.N_POLE:p=h.a+m,o=this.qp-o;break;case this.S_POLE:p=m-h.a,o=this.qp+o}if(Math.abs(p)<h.d)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),r=this.mode===this.OBLIQ?this.ymf*p*(this.cosb1*c-this.sinb1*d*s):(p=Math.sqrt(2/(1+d*s)))*c*this.ymf,t=this.xmf*p*d*a;break;case this.N_POLE:case this.S_POLE:o>=0?(t=(p=Math.sqrt(o))*a,r=s*(this.mode===this.S_POLE?p:-p)):t=r=0}}return e.x=this.a*t+this.x0,e.y=this.a*r+this.y0,e}function a(e){e.x-=this.x0,e.y-=this.y0;var t,r,s,a,n,l,c,d=e.x/this.a,p=e.y/this.a;if(this.sphere){var f,g=0,m=0;if(f=Math.sqrt(d*d+p*p),(r=.5*f)>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),g=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(f)<=h.d?0:Math.asin(p*m/f),d*=m,p=g*f;break;case this.OBLIQ:r=Math.abs(f)<=h.d?this.phi0:Math.asin(g*this.sinph0+p*m*this.cosph0/f),d*=m*this.cosph0,p=(g-Math.sin(r)*this.sinph0)*f;break;case this.N_POLE:p=-p,r=h.a-r;break;case this.S_POLE:r-=h.a}t=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(d,p):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,p*=this.dd,(l=Math.sqrt(d*d+p*p))<h.d)return e.x=0,e.y=this.phi0,e;a=2*Math.asin(.5*l/this.rq),s=Math.cos(a),d*=a=Math.sin(a),this.mode===this.OBLIQ?(c=s*this.sinb1+p*a*this.cosb1/l,n=this.qp*c,p=l*this.cosb1*s-p*this.sinb1*a):(c=p*a/l,n=this.qp*c,p=l*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(n=d*d+p*p))return e.x=0,e.y=this.phi0,e;c=1-n/this.qp,this.mode===this.S_POLE&&(c=-c)}t=Math.atan2(d,p),r=o(Math.asin(c),this.apa)}return e.x=i.i(u.a)(this.long0+t),e.y=r,e}function n(e){var t,i=[];return i[0]=e*c,t=e*e,i[0]+=t*d,i[1]=t*f,t*=e,i[0]+=t*p,i[1]+=t*g,i[2]=t*m,i}function o(e,t){var i=e+e;return e+t[0]*Math.sin(i)+t[1]*Math.sin(i+i)+t[2]*Math.sin(i+i+i)}var h=i(0),l=i(28),u=i(3),c=.3333333333333333,d=.17222222222222222,p=.10257936507936508,f=.06388888888888888,g=.0664021164021164,m=.016415012942191543,v=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];t.a={init:r,forward:s,inverse:a,names:v,S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4}},function(e,t,i){"use strict";function r(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<c.d)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),s=i.i(n.a)(this.e,t,r),a=i.i(o.a)(this.e,this.lat1,t),h=Math.sin(this.lat2),l=Math.cos(this.lat2),u=i.i(n.a)(this.e,h,l),d=i.i(o.a)(this.e,this.lat2,h),p=i.i(o.a)(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>c.d?this.ns=Math.log(s/u)/Math.log(a/d):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=s/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(p,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function s(e){var t=e.x,r=e.y;Math.abs(2*Math.abs(r)-Math.PI)<=c.d&&(r=i.i(h.a)(r)*(c.a-2*c.d));var s,a,n=Math.abs(Math.abs(r)-c.a);if(n>c.d)s=i.i(o.a)(this.e,r,Math.sin(r)),a=this.a*this.f0*Math.pow(s,this.ns);else{if((n=r*this.ns)<=0)return null;a=0}var u=this.ns*i.i(l.a)(t-this.long0);return e.x=this.k0*(a*Math.sin(u))+this.x0,e.y=this.k0*(this.rh-a*Math.cos(u))+this.y0,e}function a(e){var t,r,s,a,n,o=(e.x-this.x0)/this.k0,h=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(o*o+h*h),r=1):(t=-Math.sqrt(o*o+h*h),r=-1);var d=0;if(0!==t&&(d=Math.atan2(r*o,r*h)),0!==t||this.ns>0){if(r=1/this.ns,s=Math.pow(t/(this.a*this.f0),r),-9999===(a=i.i(u.a)(this.e,s)))return null}else a=-c.a;return n=i.i(l.a)(d/this.ns+this.long0),e.x=n,e.y=a,e}var n=i(8),o=i(20),h=i(12),l=i(3),u=i(19),c=i(0),d=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"];t.a={init:r,forward:s,inverse:a,names:d}},function(e,t,i){"use strict";function r(){}function s(e){return e}var a=["longlat","identity"];t.a={init:r,forward:s,inverse:s,names:a}},function(e,t,i){"use strict";function r(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=i.i(n.a)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function s(e){var t=e.x,r=e.y;if(r*u.j>90&&r*u.j<-90&&t*u.j>180&&t*u.j<-180)return null;var s,a;if(Math.abs(Math.abs(r)-u.a)<=u.d)return null;if(this.sphere)s=this.x0+this.a*this.k0*i.i(o.a)(t-this.long0),a=this.y0+this.a*this.k0*Math.log(Math.tan(u.b+.5*r));else{var n=Math.sin(r),l=i.i(h.a)(this.e,r,n);s=this.x0+this.a*this.k0*i.i(o.a)(t-this.long0),a=this.y0-this.a*this.k0*Math.log(l)}return e.x=s,e.y=a,e}function a(e){var t,r,s=e.x-this.x0,a=e.y-this.y0;if(this.sphere)r=u.a-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var n=Math.exp(-a/(this.a*this.k0));if(-9999===(r=i.i(l.a)(this.e,n)))return null}return t=i.i(o.a)(this.long0+s/(this.a*this.k0)),e.x=t,e.y=r,e}var n=i(8),o=i(3),h=i(20),l=i(19),u=i(0),c=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];t.a={init:r,forward:s,inverse:a,names:c}},function(e,t,i){"use strict";function r(){}function s(e){var t=e.x,r=e.y,s=i.i(n.a)(t-this.long0),a=this.x0+this.a*s,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return e.x=a,e.y=o,e}function a(e){e.x-=this.x0,e.y-=this.y0;var t=i.i(n.a)(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=r,e}var n=i(3),o=["Miller_Cylindrical","mill"];t.a={init:r,forward:s,inverse:a,names:o}},function(e,t,i){"use strict";function r(){}function s(e){for(var t=e.x,r=e.y,s=i.i(n.a)(t-this.long0),a=r,h=Math.PI*Math.sin(r),l=0;!0;l++){var u=-(a+Math.sin(a)-h)/(1+Math.cos(a));if(a+=u,Math.abs(u)<o.d)break}a/=2,Math.PI/2-Math.abs(r)<o.d&&(s=0);var c=.900316316158*this.a*s*Math.cos(a)+this.x0,d=1.4142135623731*this.a*Math.sin(a)+this.y0;return e.x=c,e.y=d,e}function a(e){var t,r;e.x-=this.x0,e.y-=this.y0,r=e.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),t=Math.asin(r);var s=i.i(n.a)(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),r=(2*t+Math.sin(2*t))/Math.PI,Math.abs(r)>1&&(r=1);var a=Math.asin(r);return e.x=s,e.y=a,e}var n=i(3),o=i(0),h=["Mollweide","moll"];t.a={init:r,forward:s,inverse:a,names:h}},function(e,t,i){"use strict";function r(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function s(e){var t,i=e.x,r=e.y,s=r-this.lat0,a=i-this.long0,o=s/n.f*1e-5,h=a,l=1,u=0;for(t=1;t<=10;t++)l*=o,u+=this.A[t]*l;var c,d,p=u,f=h,g=1,m=0,v=0,y=0;for(t=1;t<=6;t++)c=g*p-m*f,d=m*p+g*f,g=c,m=d,v=v+this.B_re[t]*g-this.B_im[t]*m,y=y+this.B_im[t]*g+this.B_re[t]*m;return e.x=y*this.a+this.x0,e.y=v*this.a+this.y0,e}function a(e){var t,i,r,s=e.x,a=e.y,o=s-this.x0,h=a-this.y0,l=h/this.a,u=o/this.a,c=1,d=0,p=0,f=0;for(t=1;t<=6;t++)i=c*l-d*u,r=d*l+c*u,c=i,d=r,p=p+this.C_re[t]*c-this.C_im[t]*d,f=f+this.C_im[t]*c+this.C_re[t]*d;for(var g=0;g<this.iterations;g++){var m,v,y=p,b=f,x=l,w=u;for(t=2;t<=6;t++)m=y*p-b*f,v=b*p+y*f,y=m,b=v,x+=(t-1)*(this.B_re[t]*y-this.B_im[t]*b),w+=(t-1)*(this.B_im[t]*y+this.B_re[t]*b);y=1,b=0;var S=this.B_re[1],M=this.B_im[1];for(t=2;t<=6;t++)m=y*p-b*f,v=b*p+y*f,y=m,b=v,S+=t*(this.B_re[t]*y-this.B_im[t]*b),M+=t*(this.B_im[t]*y+this.B_re[t]*b);var A=S*S+M*M;p=(x*S+w*M)/A,f=(w*S-x*M)/A}var C=p,T=f,P=1,F=0;for(t=1;t<=9;t++)P*=C,F+=this.D[t]*P;var L=this.lat0+F*n.f*1e5,E=this.long0+T;return e.x=E,e.y=L,e}var n=i(0),o=["New_Zealand_Map_Grid","nzmg"];t.a={init:r,forward:s,inverse:a,names:o}},function(e,t,i){"use strict";function r(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),r=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-r*r);var s=i.i(n.a)(this.e,this.lat0,e),a=this.bl/t*Math.sqrt((1-this.es)/(1-r*r));a*a<1&&(a=1);var h,l;if(isNaN(this.longc)){var u=i.i(n.a)(this.e,this.lat1,Math.sin(this.lat1)),c=i.i(n.a)(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(s,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(s,this.bl);var d=Math.pow(u,this.bl),p=Math.pow(c,this.bl);h=this.el/d,l=.5*(h-1/h);var f=(this.el*this.el-p*d)/(this.el*this.el+p*d),g=(p-d)/(p+d),m=i.i(o.a)(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(f*Math.tan(.5*this.bl*m)/g)/this.bl,this.long0=i.i(o.a)(this.long0);var v=i.i(o.a)(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*v)/l),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else h=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=h*Math.pow(s,this.bl),l=.5*(h-1/h),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(l*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))}function s(e){var t,r,s,a=e.x,h=e.y,u=i.i(o.a)(a-this.long0);if(Math.abs(Math.abs(h)-l.a)<=l.d)s=h>0?-1:1,r=this.al/this.bl*Math.log(Math.tan(l.b+s*this.gamma0*.5)),t=-1*s*l.a*this.al/this.bl;else{var c=i.i(n.a)(this.e,h,Math.sin(h)),d=this.el/Math.pow(c,this.bl),p=.5*(d-1/d),f=.5*(d+1/d),g=Math.sin(this.bl*u),m=(p*Math.sin(this.gamma0)-g*Math.cos(this.gamma0))/f;r=Math.abs(Math.abs(m)-1)<=l.d?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-m)/(1+m))/this.bl,t=Math.abs(Math.cos(this.bl*u))<=l.d?this.al*this.bl*u:this.al*Math.atan2(p*Math.cos(this.gamma0)+g*Math.sin(this.gamma0),Math.cos(this.bl*u))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+r):(t-=this.uc,e.x=this.x0+r*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-r*Math.sin(this.alpha)),e}function a(e){var t,r;this.no_rot?(r=e.y-this.y0,t=e.x-this.x0):(r=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var s=Math.exp(-1*this.bl*r/this.al),a=.5*(s-1/s),n=.5*(s+1/s),u=Math.sin(this.bl*t/this.al),c=(u*Math.cos(this.gamma0)+a*Math.sin(this.gamma0))/n,d=Math.pow(this.el/Math.sqrt((1+c)/(1-c)),1/this.bl);return Math.abs(c-1)<l.d?(e.x=this.long0,e.y=l.a):Math.abs(c+1)<l.d?(e.x=this.long0,e.y=-1*l.a):(e.y=i.i(h.a)(this.e,d),e.x=i.i(o.a)(this.long0-Math.atan2(a*Math.cos(this.gamma0)-u*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e}var n=i(20),o=i(3),h=i(19),l=i(0),u=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"];t.a={init:r,forward:s,inverse:a,names:u}},function(e,t,i){"use strict";function r(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function s(e){var t,r,s,a,o,l,u,c,d=e.x,p=e.y;return s=i.i(n.a)(d-this.long0),t=Math.sin(p),r=Math.cos(p),a=Math.cos(s),l=this.sin_p14*t+this.cos_p14*r*a,o=1,(l>0||Math.abs(l)<=h.d)&&(u=this.a*o*r*Math.sin(s),c=this.y0+this.a*o*(this.cos_p14*t-this.sin_p14*r*a)),e.x=u,e.y=c,e}function a(e){var t,r,s,a,l,u,c;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),r=i.i(o.a)(t/this.a),s=Math.sin(r),a=Math.cos(r),u=this.long0,Math.abs(t)<=h.d?(c=this.lat0,e.x=u,e.y=c,e):(c=i.i(o.a)(a*this.sin_p14+e.y*s*this.cos_p14/t),l=Math.abs(this.lat0)-h.a,Math.abs(l)<=h.d?(u=this.lat0>=0?i.i(n.a)(this.long0+Math.atan2(e.x,-e.y)):i.i(n.a)(this.long0-Math.atan2(-e.x,e.y)),e.x=u,e.y=c,e):(u=i.i(n.a)(this.long0+Math.atan2(e.x*s,t*this.cos_p14*a-e.y*this.sin_p14*s)),e.x=u,e.y=c,e))}var n=i(3),o=i(7),h=i(0),l=["ortho"];t.a={init:r,forward:s,inverse:a,names:l}},function(e,t,i){"use strict";function r(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=i.i(n.a)(this.es),this.e1=i.i(o.a)(this.es),this.e2=i.i(h.a)(this.es),this.e3=i.i(l.a)(this.es),this.ml0=this.a*i.i(d.a)(this.e0,this.e1,this.e2,this.e3,this.lat0)}function s(e){var t,r,s,a=e.x,n=e.y,o=i.i(u.a)(a-this.long0);if(s=o*Math.sin(n),this.sphere)Math.abs(n)<=p.d?(t=this.a*o,r=-1*this.a*this.lat0):(t=this.a*Math.sin(s)/Math.tan(n),r=this.a*(i.i(c.a)(n-this.lat0)+(1-Math.cos(s))/Math.tan(n)));else if(Math.abs(n)<=p.d)t=this.a*o,r=-1*this.ml0;else{var h=i.i(f.a)(this.a,this.e,Math.sin(n))/Math.tan(n);t=h*Math.sin(s),r=this.a*i.i(d.a)(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+h*(1-Math.cos(s))}return e.x=t+this.x0,e.y=r+this.y0,e}function a(e){var t,r,s,a,n,o,h,l,c;if(s=e.x-this.x0,a=e.y-this.y0,this.sphere)if(Math.abs(a+this.a*this.lat0)<=p.d)t=i.i(u.a)(s/this.a+this.long0),r=0;else{o=this.lat0+a/this.a,h=s*s/this.a/this.a+o*o,l=o;var f;for(n=g;n;--n)if(f=Math.tan(l),c=-1*(o*(l*f+1)-l-.5*(l*l+h)*f)/((l-o)/f-1),l+=c,Math.abs(c)<=p.d){r=l;break}t=i.i(u.a)(this.long0+Math.asin(s*Math.tan(l)/this.a)/Math.sin(r))}else if(Math.abs(a+this.ml0)<=p.d)r=0,t=i.i(u.a)(this.long0+s/this.a);else{o=(this.ml0+a)/this.a,h=s*s/this.a/this.a+o*o,l=o;var m,v,y,b,x;for(n=g;n;--n)if(x=this.e*Math.sin(l),m=Math.sqrt(1-x*x)*Math.tan(l),v=this.a*i.i(d.a)(this.e0,this.e1,this.e2,this.e3,l),y=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),b=v/this.a,c=(o*(m*b+1)-b-.5*m*(b*b+h))/(this.es*Math.sin(2*l)*(b*b+h-2*o*b)/(4*m)+(o-b)*(m*y-2/Math.sin(2*l))-y),l-=c,Math.abs(c)<=p.d){r=l;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),t=i.i(u.a)(this.long0+Math.asin(s*m/this.a)/Math.sin(r))}return e.x=t,e.y=r,e}var n=i(14),o=i(15),h=i(16),l=i(17),u=i(3),c=i(11),d=i(18),p=i(0),f=i(25),g=20,m=["Polyconic","poly"];t.a={init:r,forward:s,inverse:a,names:m}},function(e,t,i){"use strict";function r(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=h.a-h.b/2?this.face=l.TOP:this.lat0<=-(h.a-h.b/2)?this.face=l.BOTTOM:Math.abs(this.long0)<=h.b?this.face=l.FRONT:Math.abs(this.long0)<=h.a+h.b?this.face=this.long0>0?l.RIGHT:l.LEFT:this.face=l.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function s(e){var t,i,r,s,a,c,d={x:0,y:0},p={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,i=e.x,this.face===l.TOP)s=h.a-t,i>=h.b&&i<=h.a+h.b?(p.value=u.AREA_0,r=i-h.a):i>h.a+h.b||i<=-(h.a+h.b)?(p.value=u.AREA_1,r=i>0?i-h.c:i+h.c):i>-(h.a+h.b)&&i<=-h.b?(p.value=u.AREA_2,r=i+h.a):(p.value=u.AREA_3,r=i);else if(this.face===l.BOTTOM)s=h.a+t,i>=h.b&&i<=h.a+h.b?(p.value=u.AREA_0,r=-i+h.a):i<h.b&&i>=-h.b?(p.value=u.AREA_1,r=-i):i<-h.b&&i>=-(h.a+h.b)?(p.value=u.AREA_2,r=-i-h.a):(p.value=u.AREA_3,r=i>0?-i+h.c:-i-h.c);else{var f,g,m,v,y,b,x;this.face===l.RIGHT?i=o(i,+h.a):this.face===l.BACK?i=o(i,+h.c):this.face===l.LEFT&&(i=o(i,-h.a)),v=Math.sin(t),y=Math.cos(t),b=Math.sin(i),x=Math.cos(i),f=y*x,g=y*b,m=v,this.face===l.FRONT?(s=Math.acos(f),r=n(s,m,g,p)):this.face===l.RIGHT?(s=Math.acos(g),r=n(s,m,-f,p)):this.face===l.BACK?(s=Math.acos(-f),r=n(s,m,-g,p)):this.face===l.LEFT?(s=Math.acos(-g),r=n(s,m,f,p)):(s=r=0,p.value=u.AREA_0)}return c=Math.atan(12/h.c*(r+Math.acos(Math.sin(r)*Math.cos(h.b))-h.a)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(c)*Math.cos(c))/(1-Math.cos(Math.atan(1/Math.cos(r))))),p.value===u.AREA_1?c+=h.a:p.value===u.AREA_2?c+=h.c:p.value===u.AREA_3&&(c+=1.5*h.c),d.x=a*Math.cos(c),d.y=a*Math.sin(c),d.x=d.x*this.a+this.x0,d.y=d.y*this.a+this.y0,e.x=d.x,e.y=d.y,e}function a(e){var t,i,r,s,a,n,c,d,p,f={lam:0,phi:0},g={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,i=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?g.value=u.AREA_0:e.y>=0&&e.y>=Math.abs(e.x)?(g.value=u.AREA_1,t-=h.a):e.x<0&&-e.x>=Math.abs(e.y)?(g.value=u.AREA_2,t=t<0?t+h.c:t-h.c):(g.value=u.AREA_3,t+=h.a),p=h.c/12*Math.tan(t),a=Math.sin(p)/(Math.cos(p)-1/Math.sqrt(2)),n=Math.atan(a),r=Math.cos(t),s=Math.tan(i),c=1-r*r*s*s*(1-Math.cos(Math.atan(1/Math.cos(n)))),c<-1?c=-1:c>1&&(c=1),this.face===l.TOP)d=Math.acos(c),f.phi=h.a-d,g.value===u.AREA_0?f.lam=n+h.a:g.value===u.AREA_1?f.lam=n<0?n+h.c:n-h.c:g.value===u.AREA_2?f.lam=n-h.a:f.lam=n;else if(this.face===l.BOTTOM)d=Math.acos(c),f.phi=d-h.a,g.value===u.AREA_0?f.lam=-n+h.a:g.value===u.AREA_1?f.lam=-n:g.value===u.AREA_2?f.lam=-n-h.a:f.lam=n<0?-n-h.c:-n+h.c;else{var m,v,y;m=c,p=m*m,y=p>=1?0:Math.sqrt(1-p)*Math.sin(n),p+=y*y,v=p>=1?0:Math.sqrt(1-p),g.value===u.AREA_1?(p=v,v=-y,y=p):g.value===u.AREA_2?(v=-v,y=-y):g.value===u.AREA_3&&(p=v,v=y,y=-p),this.face===l.RIGHT?(p=m,m=-v,v=p):this.face===l.BACK?(m=-m,v=-v):this.face===l.LEFT&&(p=m,m=v,v=-p),f.phi=Math.acos(-y)-h.a,f.lam=Math.atan2(v,m),this.face===l.RIGHT?f.lam=o(f.lam,-h.a):this.face===l.BACK?f.lam=o(f.lam,-h.c):this.face===l.LEFT&&(f.lam=o(f.lam,+h.a))}if(0!==this.es){var b,x,w;b=f.phi<0?1:0,x=Math.tan(f.phi),w=this.b/Math.sqrt(x*x+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-w*w)/(this.one_minus_f*w)),b&&(f.phi=-f.phi)}return f.lam+=this.long0,e.x=f.lam,e.y=f.phi,e}function n(e,t,i,r){var s;return e<h.d?(r.value=u.AREA_0,s=0):(s=Math.atan2(t,i),Math.abs(s)<=h.b?r.value=u.AREA_0:s>h.b&&s<=h.a+h.b?(r.value=u.AREA_1,s-=h.a):s>h.a+h.b||s<=-(h.a+h.b)?(r.value=u.AREA_2,s=s>=0?s-h.c:s+h.c):(r.value=u.AREA_3,s+=h.a)),s}function o(e,t){var i=e+t;return i<-h.c?i+=h.e:i>+h.c&&(i-=h.e),i}var h=i(0),l={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},u={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},c=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];t.a={init:r,forward:s,inverse:a,names:c}},function(e,t,i){"use strict";function r(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=i.i(h.a)(this.es)}function s(e){var t,r,s=e.x,a=e.y;if(s=i.i(n.a)(s-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(a),h=p;h;--h){var u=(this.m*a+Math.sin(a)-o)/(this.m+Math.cos(a));if(a-=u,Math.abs(u)<c.d)break}else a=1!==this.n?Math.asin(this.n*Math.sin(a)):a;t=this.a*this.C_x*s*(this.m+Math.cos(a)),r=this.a*this.C_y*a}else{var d=Math.sin(a),f=Math.cos(a);r=this.a*i.i(l.a)(a,d,f,this.en),t=this.a*s*f/Math.sqrt(1-this.es*d*d)}return e.x=t,e.y=r,e}function a(e){var t,r,s,a;return e.x-=this.x0,s=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,s/=this.C_x*(this.m+Math.cos(t)),this.m?t=i.i(d.a)((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=i.i(d.a)(Math.sin(t)/this.n)),s=i.i(n.a)(s+this.long0),t=i.i(o.a)(t)):(t=i.i(u.a)(e.y/this.a,this.es,this.en),a=Math.abs(t),a<c.a?(a=Math.sin(t),r=this.long0+e.x*Math.sqrt(1-this.es*a*a)/(this.a*Math.cos(t)),s=i.i(n.a)(r)):a-c.d<c.a&&(s=this.long0)),e.x=s,e.y=t,e}var n=i(3),o=i(11),h=i(37),l=i(27),u=i(38),c=i(0),d=i(7),p=20,f=["Sinusoidal","sinu"];t.a={init:r,forward:s,inverse:a,names:f}},function(e,t,i){"use strict";function r(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),i=this.a,r=this.rf,s=1/r,a=2*s-Math.pow(s,2),n=this.e=Math.sqrt(a);this.R=this.k0*i*Math.sqrt(1-a)/(1-a*Math.pow(t,2)),this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+n*t)/(1-n*t));this.K=o-this.alpha*h+this.alpha*n/2*l}function s(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+i)+this.K,s=2*(Math.atan(Math.exp(r))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),n=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(a));return e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,e.x=this.R*n+this.x0,e}function a(e){for(var t=e.x-this.x0,i=e.y-this.y0,r=t/this.R,s=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(r)),n=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+n/this.alpha,h=0,l=a,u=-1e3,c=0;Math.abs(l-u)>1e-7;){if(++c>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return e.x=o,e.y=l,e}var n=["somerc"];t.a={init:r,forward:s,inverse:a,names:n}},function(e,t,i){"use strict";function r(e,t,i){return t*=i,Math.tan(.5*(o.a+e))*Math.pow((1-t)/(1+t),.5*i)}function s(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o.d&&(this.k0=.5*(1+i.i(h.a)(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=o.d&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=o.d&&(this.k0=.5*this.cons*i.i(l.a)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/i.i(u.a)(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=i.i(l.a)(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-o.a,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function a(e){var t,r,s,a,n,h,l=e.x,c=e.y,p=Math.sin(c),f=Math.cos(c),g=i.i(d.a)(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=o.d&&Math.abs(c+this.lat0)<=o.d?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*p+this.coslat0*f*Math.cos(g)),e.x=this.a*t*f*Math.sin(g)+this.x0,e.y=this.a*t*(this.coslat0*p-this.sinlat0*f*Math.cos(g))+this.y0,e):(r=2*Math.atan(this.ssfn_(c,p,this.e))-o.a,a=Math.cos(r),s=Math.sin(r),Math.abs(this.coslat0)<=o.d?(n=i.i(u.a)(this.e,c*this.con,this.con*p),h=2*this.a*this.k0*n/this.cons,e.x=this.x0+h*Math.sin(l-this.long0),e.y=this.y0-this.con*h*Math.cos(l-this.long0),e):(Math.abs(this.sinlat0)<o.d?(t=2*this.a*this.k0/(1+a*Math.cos(g)),e.y=t*s):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*s+this.cosX0*a*Math.cos(g))),e.y=t*(this.cosX0*s-this.sinX0*a*Math.cos(g))+this.y0),e.x=t*a*Math.sin(g)+this.x0,e))}function n(e){e.x-=this.x0,e.y-=this.y0;var t,r,s,a,n,h=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(h/(.5*this.a*this.k0));return t=this.long0,(r=this.lat0,h<=o.d)?(e.x=t,e.y=r,e):(r=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/h),t=Math.abs(this.coslat0)<o.d?this.lat0>0?i.i(d.a)(this.long0+Math.atan2(e.x,-1*e.y)):i.i(d.a)(this.long0+Math.atan2(e.x,e.y)):i.i(d.a)(this.long0+Math.atan2(e.x*Math.sin(l),h*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=t,e.y=r,e)}if(Math.abs(this.coslat0)<=o.d){if(h<=o.d)return r=this.lat0,t=this.long0,e.x=t,e.y=r,e;e.x*=this.con,e.y*=this.con,s=h*this.cons/(2*this.a*this.k0),r=this.con*i.i(c.a)(this.e,s),t=this.con*i.i(d.a)(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else a=2*Math.atan(h*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,h<=o.d?n=this.X0:(n=Math.asin(Math.cos(a)*this.sinX0+e.y*Math.sin(a)*this.cosX0/h),t=i.i(d.a)(this.long0+Math.atan2(e.x*Math.sin(a),h*this.cosX0*Math.cos(a)-e.y*this.sinX0*Math.sin(a)))),r=-1*i.i(c.a)(this.e,Math.tan(.5*(o.a+n)));return e.x=t,e.y=r,e}var o=i(0),h=i(12),l=i(8),u=i(20),c=i(19),d=i(3),p=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"];t.a={init:s,forward:a,inverse:n,names:p,ssfn_:r}},function(e,t,i){"use strict";function r(){n.a.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function s(e){var t,r,s,a;return e.x=i.i(o.a)(e.x-this.long0),n.a.forward.apply(this,[e]),t=Math.sin(e.y),r=Math.cos(e.y),s=Math.cos(e.x),a=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*s),e.x=a*r*Math.sin(e.x),e.y=a*(this.cosc0*t-this.sinc0*r*s),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function a(e){var t,r,s,a,h;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,h=Math.sqrt(e.x*e.x+e.y*e.y)){var l=2*Math.atan2(h,this.R2);t=Math.sin(l),r=Math.cos(l),a=Math.asin(r*this.sinc0+e.y*t*this.cosc0/h),s=Math.atan2(e.x*t,h*this.cosc0*r-e.y*this.sinc0*t)}else a=this.phic0,s=0;return e.x=s,e.y=a,n.a.inverse.apply(this,[e]),e.x=i.i(o.a)(e.x+this.long0),e}var n=i(92),o=i(3),h=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"];t.a={init:r,forward:s,inverse:a,names:h}},function(e,t,i){"use strict";function r(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=i.i(n.a)(this.es),this.ml0=i.i(o.a)(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function s(e){var t,r,s,a=e.x,n=e.y,h=i.i(l.a)(a-this.long0),c=Math.sin(n),d=Math.cos(n);if(this.es){var p=d*h,f=Math.pow(p,2),g=this.ep2*Math.pow(d,2),m=Math.pow(g,2),v=Math.abs(d)>u.d?Math.tan(n):0,y=Math.pow(v,2),b=Math.pow(y,2);t=1-this.es*Math.pow(c,2),p/=Math.sqrt(t);var x=i.i(o.a)(n,c,d,this.en);r=this.a*(this.k0*p*(1+f/6*(1-y+g+f/20*(5-18*y+b+14*g-58*y*g+f/42*(61+179*b-b*y-479*y)))))+this.x0,s=this.a*(this.k0*(x-this.ml0+c*h*p/2*(1+f/12*(5-y+9*g+4*m+f/30*(61+b-58*y+270*g-330*y*g+f/56*(1385+543*b-b*y-3111*y))))))+this.y0}else{var w=d*Math.sin(h);if(Math.abs(Math.abs(w)-1)<u.d)return 93;if(r=.5*this.a*this.k0*Math.log((1+w)/(1-w))+this.x0,s=d*Math.cos(h)/Math.sqrt(1-Math.pow(w,2)),(w=Math.abs(s))>=1){if(w-1>u.d)return 93;s=0}else s=Math.acos(s);n<0&&(s=-s),s=this.a*this.k0*(s-this.lat0)+this.y0}return e.x=r,e.y=s,e}function a(e){var t,r,s,a,n=(e.x-this.x0)*(1/this.a),o=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+o/this.k0,r=i.i(h.a)(t,this.es,this.en),Math.abs(r)<u.a){var d=Math.sin(r),p=Math.cos(r),f=Math.abs(p)>u.d?Math.tan(r):0,g=this.ep2*Math.pow(p,2),m=Math.pow(g,2),v=Math.pow(f,2),y=Math.pow(v,2);t=1-this.es*Math.pow(d,2);var b=n*Math.sqrt(t)/this.k0,x=Math.pow(b,2);t*=f,s=r-t*x/(1-this.es)*.5*(1-x/12*(5+3*v-9*g*v+g-4*m-x/30*(61+90*v-252*g*v+45*y+46*g-x/56*(1385+3633*v+4095*y+1574*y*v)))),a=i.i(l.a)(this.long0+b*(1-x/6*(1+2*v+g-x/20*(5+28*v+24*y+8*g*v+6*g-x/42*(61+662*v+1320*y+720*y*v))))/p)}else s=u.a*i.i(c.a)(o),a=0;else{var w=Math.exp(n/this.k0),S=.5*(w-1/w),M=this.lat0+o/this.k0,A=Math.cos(M);t=Math.sqrt((1-Math.pow(A,2))/(1+Math.pow(S,2))),s=Math.asin(t),o<0&&(s=-s),a=0===S&&0===A?0:i.i(l.a)(Math.atan2(S,A)+this.long0)}return e.x=a,e.y=s,e}var n=i(37),o=i(27),h=i(38),l=i(3),u=i(0),c=i(12),d=["Transverse_Mercator","Transverse Mercator","tmerc"];t.a={init:r,forward:s,inverse:a,names:d}},function(e,t,i){"use strict";function r(){var e=i.i(s.a)(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*n.g,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,a.a.init.apply(this),this.forward=a.a.forward,this.inverse=a.a.inverse}var s=i(65),a=i(44),n=i(0),o=["Universal Transverse Mercator System","utm"];t.a={init:r,names:o,dependsOn:"etmerc"}},function(e,t,i){"use strict";function r(){this.R=this.a}function s(e){var t,r,s=e.x,a=e.y,l=i.i(n.a)(s-this.long0);Math.abs(a)<=o.d&&(t=this.x0+this.R*l,r=this.y0);var u=i.i(h.a)(2*Math.abs(a/Math.PI));(Math.abs(l)<=o.d||Math.abs(Math.abs(a)-o.a)<=o.d)&&(t=this.x0,r=a>=0?this.y0+Math.PI*this.R*Math.tan(.5*u):this.y0+Math.PI*this.R*-Math.tan(.5*u));var c=.5*Math.abs(Math.PI/l-l/Math.PI),d=c*c,p=Math.sin(u),f=Math.cos(u),g=f/(p+f-1),m=g*g,v=g*(2/p-1),y=v*v,b=Math.PI*this.R*(c*(g-y)+Math.sqrt(d*(g-y)*(g-y)-(y+d)*(m-y)))/(y+d);l<0&&(b=-b),t=this.x0+b;var x=d+g;return b=Math.PI*this.R*(v*x-c*Math.sqrt((y+d)*(d+1)-x*x))/(y+d),r=a>=0?this.y0+b:this.y0-b,e.x=t,e.y=r,e}function a(e){var t,r,s,a,h,l,u,c,d,p,f,g,m;return e.x-=this.x0,e.y-=this.y0,f=Math.PI*this.R,s=e.x/f,a=e.y/f,h=s*s+a*a,l=-Math.abs(a)*(1+h),u=l-2*a*a+s*s,c=-2*l+1+2*a*a+h*h,m=a*a/c+(2*u*u*u/c/c/c-9*l*u/c/c)/27,d=(l-u*u/3/c)/c,p=2*Math.sqrt(-d/3),f=3*m/d/p,Math.abs(f)>1&&(f=f>=0?1:-1),g=Math.acos(f)/3,r=e.y>=0?(-p*Math.cos(g+Math.PI/3)-u/3/c)*Math.PI:-(-p*Math.cos(g+Math.PI/3)-u/3/c)*Math.PI,t=Math.abs(s)<o.d?this.long0:i.i(n.a)(this.long0+Math.PI*(h-1+Math.sqrt(1+2*(s*s-a*a)+h*h))/2/s),e.x=t,e.y=r,e}var n=i(3),o=i(0),h=i(7),l=["Van_der_Grinten_I","VanDerGrinten","vandg"];t.a={init:r,forward:s,inverse:a,names:l}},function(e,t,i){"use strict";var r=i(115);i.n(r);i.o(r,"version")&&i.d(t,"a",function(){return r.version})},function(e,t){e.exports={_args:[[{raw:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",scope:null,escapedName:null,name:null,rawSpec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",spec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",type:"directory"},"g:\\code\\melown"]],_from:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",_id:"proj4@2.4.4-alpha",_inCache:!0,_location:"/proj4",_phantomChildren:{},_requested:{raw:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",scope:null,escapedName:null,name:null,rawSpec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",spec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",type:"directory"},_requiredBy:["#USER"],_resolved:"file:C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",_shasum:"762f64abdcff3ac4aaa425107b49b02cb4386ec6",_shrinkwrap:null,_spec:"C:\\Users\\David\\AppData\\Local\\Temp\\npm-git-117725-13600-x0yd79.599i93haor",_where:"g:\\code\\melown",author:"",bugs:{url:"https://github.com/proj4js/proj4js/issues"},contributors:[{name:"Mike Adair",email:"madair@dmsolutions.ca"},{name:"Richard Greenwood",email:"rich@greenwoodmap.com"},{name:"Calvin Metcalf",email:"calvin.metcalf@gmail.com"},{name:"Richard Marsden",url:"http://www.winwaed.com"},{name:"T. Mittan"},{name:"D. Steinwand"},{name:"S. Nelson"}],dependencies:{mgrs:"1.0.0","wkt-parser":"^1.1.3"},description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",devDependencies:{chai:"~1.8.1",curl:"git://github.com/cujojs/curl.git",grunt:"~0.4.2","grunt-cli":"~0.1.13","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~1.1.0","grunt-contrib-uglify":"~0.11.1","grunt-mocha-phantomjs":"~0.4.0","grunt-rollup":"^1.0.1",istanbul:"~0.2.4",mocha:"~1.17.1",rollup:"^0.41.4","rollup-plugin-json":"^2.0.1","rollup-plugin-node-resolve":"^2.0.0",tin:"~0.4.0"},directories:{test:"test",doc:"docs"},gitHead:"3494d52f2c543b2ee7bea04292924a771dbd3eb8",homepage:"https://github.com/proj4js/proj4js#readme",license:"MIT",main:"dist/proj4-src.js",module:"lib/index.js",name:"proj4",optionalDependencies:{},readme:'# PROJ4JS [![Build Status](https://travis-ci.org/proj4js/proj4js.svg)](https://travis-ci.org/proj4js/proj4js)\n\nProj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.\nOriginally a port of [PROJ.4](http://trac.osgeo.org/proj/) and [GCTCP C](http://edcftp.cr.usgs.gov/pub//software/gctpc) it is\na part of the [MetaCRS](http://wiki.osgeo.org/wiki/MetaCRS) group of projects.\n\n## Installing\n\nDepending on your preferences\n\n```bash\nnpm install proj4\nbower install proj4\ncomponent install proj4js/proj4js\n```\n\nor just manually grab the file `proj4.js` from the [latest release](https://github.com/proj4js/proj4js/releases)\'s `dist/` folder.\n\nif you do not want to download anything, Proj4js is also hosted on [cdnjs](http://www.cdnjs.com/libraries/proj4js) for direct use in your browser applications.\n\n## Using\n\nthe basic signature is:\n\n```javascript\nproj4(fromProjection[, toProjection, coordinates])\n```\n\nProjections can be proj or wkt strings.\n\nCoordinates may an object of the form `{x:x,y:y}` or an array of the form `[x,y]`.\n\nWhen all 3 arguments  are given, the result is that the coordinates are transformed from projection1 to projection 2. And returned in the same format that they were given in.\n\n```javascript\nvar firstProjection = \'PROJCS["NAD83 / Massachusetts Mainland",GEOGCS["NAD83",DATUM["North_American_Datum_1983",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],AUTHORITY["EPSG","6269"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.01745329251994328,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4269"]],UNIT["metre",1,AUTHORITY["EPSG","9001"]],PROJECTION["Lambert_Conformal_Conic_2SP"],PARAMETER["standard_parallel_1",42.68333333333333],PARAMETER["standard_parallel_2",41.71666666666667],PARAMETER["latitude_of_origin",41],PARAMETER["central_meridian",-71.5],PARAMETER["false_easting",200000],PARAMETER["false_northing",750000],AUTHORITY["EPSG","26986"],AXIS["X",EAST],AXIS["Y",NORTH]]\';\nvar secondProjection = "+proj=gnom +lat_0=90 +lon_0=0 +x_0=6300000 +y_0=6300000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";\n//I\'m not going to redefine those two in latter examples.\nproj4(firstProjection,secondProjection,[2,5]);\n// [-2690666.2977344505, 3662659.885459918]\n```\n\nIf only 1 projection is given then it is assumed that it is being projected *from* WGS84 (fromProjection is WGS84).\n\n```javascript\nproj4(firstProjection,[-71,41]);\n// [242075.00535055372, 750123.32090043]\n```\n\nIf no coordinates are given an object with two methods is returned, its methods are `forward` which projects from the first projection to the second and `inverse` which projects from the second to the first.\n\n```javascript\nproj4(firstProjection,secondProjection).forward([2,5]);\n// [-2690666.2977344505, 3662659.885459918]\nproj4(secondProjection,firstProjection).inverse([2,5]);\n// [-2690666.2977344505, 3662659.885459918]\n```\n\nand as above if only one projection is given, it\'s assumed to be coming from wgs84\n\n```javascript\nproj4(firstProjection).forward([-71,41]);\n// [242075.00535055372, 750123.32090043]\nproj4(firstProjection).inverse([242075.00535055372, 750123.32090043]);\n//[-71, 40.99999999999986]\n//the floating points to answer your question\n```\n\n## Named Projections\n\nIf you prefer to define a projection as a string and reference it that way, you may use the proj4.defs method which can be called 2 ways, with a name and projection:\n\n```js\nproj4.defs(\'WGS84\', "+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees");\n```\n\nor with an array\n\n```js\nproj4.defs([\n  [\n    \'EPSG:4326\',\n    \'+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees\'],\n  [\n    \'EPSG:4269\',\n    \'+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees\'\n  ]\n]);\n```\n\nyou can then do\n\n```js\nproj4(\'EPSG:4326\');\n```\n\ninstead of writing out the whole proj definition, by default proj4 has the following projections predefined:\n\n- \'EPSG:4326\', which has the following alias\n    - \'WGS84\'\n- \'EPSG:4269\'\n- \'EPSG:3857\', which has the following aliases\n    - \'EPSG:3785\'\n    - \'GOOGLE\'\n    - \'EPSG:900913\'\n    - \'EPSG:102113\'\n\ndefined projections can also be accessed through the proj4.defs function (`proj4.defs(\'EPSG:4326\')`).\n\nproj4.defs can also be used to define a named alias:\n\n```javascript\nproj4.defs(\'urn:x-ogc:def:crs:EPSG:4326\', proj4.defs(\'EPSG:4326\'));\n```\n\n## TypeScript\n\nTypeScript implementation was added to the [DefinitelyTyped repository](https://github.com/DefinitelyTyped/DefinitelyTyped).\n\n```bash\n$ npm install --save @types/proj4\n```\n\n## Developing\nto set up build tools make sure you have node and grunt-cli installed and then run `npm install`\n\nto do the complete build and browser tests run\n\n```bash\nnode_modules/.bin/grunt\n```\n\nto run node tests run\n\n```bash\nnpm test\n```\n\nto run node tests with coverage run\n\n```bash\nnpm test --coverage\n```\n\nto create a build with only default projections (latlon and Mercator) run\n\n```bash\nnode_modules/.bin/grunt build\n```\n\nto create a build with only custom projections include a comma separated list of projections codes (the file name in \'lib/projections\' without the \'.js\') after a colon, e.g.\n\n```bash\nnode_modules/.bin/grunt build:tmerc\n#includes transverse Mercator\nnode_modules/.bin/grunt build:lcc\n#includes lambert conformal conic\nnode_modules/.bin/grunt build:omerc,moll\n#includes oblique Mercator and Mollweide\n```\n',readmeFilename:"README.md",repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},scripts:{build:"grunt","build:tmerc":"grunt build:tmerc",test:"npm run build && istanbul test _mocha test/test.js"},version:"2.4.4-alpha"}},function(e,t,i){"use strict";var r=i(111),s=i(44),a=i(112),n=i(110),o=i(109),h=i(108),l=i(103),u=i(97),c=i(95),d=i(88),p=i(96),f=i(86),g=i(94),m=i(89),v=i(90),y=i(105),b=i(102),x=i(100),w=i(107),S=i(101),M=i(91),A=i(113),C=i(87),T=i(104),P=i(93),F=i(106);t.a=function(e){e.Proj.projections.add(r.a),e.Proj.projections.add(s.a),e.Proj.projections.add(a.a),e.Proj.projections.add(n.a),e.Proj.projections.add(o.a),e.Proj.projections.add(h.a),e.Proj.projections.add(l.a),e.Proj.projections.add(u.a),e.Proj.projections.add(c.a),e.Proj.projections.add(d.a),e.Proj.projections.add(p.a),e.Proj.projections.add(f.a),e.Proj.projections.add(g.a),e.Proj.projections.add(m.a),e.Proj.projections.add(v.a),e.Proj.projections.add(y.a),e.Proj.projections.add(b.a),e.Proj.projections.add(x.a),e.Proj.projections.add(w.a),e.Proj.projections.add(S.a),e.Proj.projections.add(M.a),e.Proj.projections.add(A.a),e.Proj.projections.add(C.a),e.Proj.projections.add(T.a),e.Proj.projections.add(P.a),e.Proj.projections.add(F.a)}},function(e,t,i){"use strict";function r(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=a}function s(e){return new r(e).output()}t.a=s;var a=1,n=/\s/,o=/[A-Za-z]/,h=/[A-Za-z84]/,l=/[,\]]/,u=/[\d\.E\-\+]/;r.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;n.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case a:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},r.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(l.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},r.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=a)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=a,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},r.prototype.number=function(e){if(u.test(e))return void(this.word+=e);if(l.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)},r.prototype.quoted=function(e){if('"'===e)return void(this.state=5);this.word+=e},r.prototype.keyword=function(e){if(h.test(e))return void(this.word+=e);if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=a)}if(l.test(e))return void this.afterItem(e);throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place)},r.prototype.neutral=function(e){if(o.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(u.test(e))return this.word=e,void(this.state=3);if(l.test(e))return void this.afterItem(e);throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place)},r.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)}},function(e,t,i){"use strict";function r(e,t,i){Array.isArray(t)&&(i.unshift(t),t=null);var r=t?{}:e,a=i.reduce(function(e,t){return s(t,e),e},r);t&&(e[t]=a)}function s(e,t){if(!Array.isArray(e))return void(t[e]=!0);var i=e.shift();if("PARAMETER"===i&&(i=e.shift()),1===e.length)return Array.isArray(e[0])?(t[i]={},void s(e[0],t[i])):void(t[i]=e[0]);if(!e.length)return void(t[i]=!0);if("TOWGS84"===i)return void(t[i]=e);Array.isArray(i)||(t[i]={});var a;switch(i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[i]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&s(e[2],t[i]));case"SPHEROID":case"ELLIPSOID":return t[i]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&s(e[3],t[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void r(t,i,e);default:for(a=-1;++a<e.length;)if(!Array.isArray(e[a]))return s(e,t[i]);return r(t,i,e)}}t.a=s},function(e,t,i){e.exports=function(){return i(47)('/*! Copyright (c) 2017 Melown Technologies SE\n *  For terms of use, see accompanying e9f34b92ea25efd1b304.worker.js.LICENSE file.\n *  For 3rd party libraries licenses, see 3rdpartylicenses.txt.\n */\n!function(e){function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}var t={};r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=9)}([function(e,r,t){"use strict";function n(e,r,t){return e<r&&(e=r),e>t&&(e=t),e}function a(e,r){r||(r=e);var t=e[0],n=e[1],a=e[2],i=Math.sqrt(t*t+n*n+a*a);return i?1==i?(r[0]=t,r[1]=n,r[2]=a,r):(i=1/i,r[0]=t*i,r[1]=n*i,r[2]=a*i,r):(r[0]=0,r[1]=0,r[2]=0,r)}function i(e){var r=e[0],t=e[1];return e=e[2],Math.sqrt(r*r+t*t+e*e)}function s(e,r,t){t||(t=e);var n=e[0],a=e[1];e=e[2];var i=r[0],s=r[1];return r=r[2],t[0]=a*r-e*s,t[1]=e*i-n*r,t[2]=n*s-a*i,t}function o(e){if(!e||0===e.length)return 0;for(var r,t=0,n=0,a=e.length;n<a;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t}function l(e){if(d)return d.encode(e);for(var r=String(e),t=r.length,n=0,a=[];n<t;){var i=r.charCodeAt(n);if(i<55296||i>57343)a.push(i);else if(56320<=i&&i<=57343)a.push(65533);else if(55296<=i&&i<=56319)if(n===t-1)a.push(65533);else{var s=r.charCodeAt(n+1);if(56320<=s&&s<=57343){var o=1023&i,l=1023&s;a.push(65536+(o<<10)+l),n+=1}else a.push(65533)}n+=1}return new Uint8Array(new Uint32Array(a).buffer)}function u(e,r){if(h&&!r)return h.decode(e);var t="",n=new Uint8Array(e.byteLength);n.set(e);for(var a=new Uint32Array(n.buffer),i=0,s=a.length;i<s;++i){var o=a[i];o<=65535?t+=String.fromCharCode(o):(o-=65536,t+=String.fromCharCode(55296+(o>>10),56320+(1023&o)))}return t}function c(e,r){if(h&&!r)return h.decode(e);var t,n,a,i,s,o;for(e=new Uint8Array(e),t="",a=e.length,n=0;n<a;)switch((i=e[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:s=e[n++],t+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=e[n++],o=e[n++],t+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}return t}t.d(r,"a",function(){return f}),t.d(r,"d",function(){return n}),t.d(r,"g",function(){return a}),t.d(r,"h",function(){return i}),t.d(r,"i",function(){return s}),t.d(r,"e",function(){return v}),t.d(r,"f",function(){return o}),t.d(r,"j",function(){return l}),t.d(r,"b",function(){return u}),t.d(r,"c",function(){return c});var f={stylesheetData:{},stylesheetLayers:{},stylesheetBitmaps:{},stylesheetFonts:{},stylesheetConstants:{},stylesheetVariables:{},insidePack:!1,directPoints:[],directPoint:null,fonts:{},fontsMap:{},fontsStorage:{},forceOrigin:!1,forceScale:[1,1,1],bboxMin:[0,0,0],bboxMax:[1,1,1],geocent:!1,tileX:0,tileY:0,tileLod:0,tileIX:0,tileIY:0,tileSize:1,hitState:0,pixelFactor:1,alwaysEventInfo:!0,metricUnits:!0,language:"en",groupOptimize:!0,groupOrigin:[0,0,0],messageBuffer:new Array(65536),messageBufferIndex:0,messageBufferSize:65536,messagePackSize:0,signatureCounter:0,autoLod:!1,featureType:null,groupId:null,disableLog:!1,reduceMode:"scr-count4",reduceParams:null,processLineLabel:!1,useLineLabel2:!0,lineLabelPass:0},v=function(e,r){if(!e||""==e)return"";var t,n,a=e.indexOf("{");if(-1==a)return e;n=a>0?e.substring(0,a):"";var i=0,s=-1;for(t=e.length;a<t;a++){var o=e.charAt(a);"{"==o?(0==i&&(s=a),i++):"}"==o?0==--i&&(n+=r(e.substring(s+1,a))):0==i&&(n+=o)}return n},d="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):null,h="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null},function(e,r,t){"use strict";function n(e,r){f.config.mapPackLoaderEvents?(b.push(e),r&&(g=g.concat(r))):r?postMessage(e,r):postMessage(e)}function a(e,r,t,n,a){var i,o,l=v(JSON.stringify(t)),u=6+l.byteLength;for(i=0,o=n.length;i<o;i++)u+=4+n[i].byteLength;var c=new Uint8Array(u),f=new DataView(c.buffer),d=0,h=0;for(f.setUint8(d,e),d+=1,f.setUint8(d,r),d+=1,f.setUint32(d,l.byteLength),d+=4,c.set(l,d),d+=l.byteLength,h=d,i=0,o=n.length;i<o;i++)f.setUint32(d,n[i].length),d+=4,c.set(new Uint8Array(n[i].buffer),d),d+=n[i].byteLength;s(e,r,c.buffer,h,a,t.hitable,t.totalPoints,11==r?t:null)}function i(e,r,t){var n=0,a=new ArrayBuffer(6),i=new DataView(a),n=0;i.setUint8(n,e),n+=1,i.setUint8(n,r),n+=1,i.setUint32(n,t||0),n+=4,s(e,r,a,n,"")}function s(e,r,t,n,a,i,s,o){if(f.messageBufferIndex>=f.messageBufferSize){var l=f.messageBuffer;f.messageBufferSize+=65536,f.messageBuffer=new Array(f.messageBufferSize);for(var u=0,c=f.messageBufferIndex;u<c;u++)f.messageBuffer[u]=l[u]}f.messageBuffer[f.messageBufferIndex]={command:e,type:r,job:t,buffersIndex:n,signature:a,hitable:i,totalPoints:s,job2:o},f.messageBufferIndex++,f.messagePackSize+=t.byteLength}function o(e,r,t){var n=1==e?h:d;if(n.byteLength<=r.byteLength+t){var a=new Uint8Array(2*n.byteLength);a.set(n,0),n=a,1==e?h=n:d=n}n.set(r,t)}function l(){for(var e,r,t,a,i,s,l,u,c,u,b,g,p=f.messageBuffer,y=0,L=f.messageBufferIndex;y<L;y++){var A=p[y],m=(A.job,A.type),N=A.signature;if(!A.hitable&&!A.reduced&&m>=6&&m<=13)switch(m){case 13:case 6:for(b=0,c=4*new DataView(A.job).getUint32(A.buffersIndex),o(0,new Uint8Array(A.job,A.buffersIndex+4,c),0),i=c,e=y+1;e<L;e++)a=p[e],a.signature==N&&(a.reduced=!0,b++,c=4*new DataView(a.job).getUint32(a.buffersIndex),o(0,new Uint8Array(a.job,a.buffersIndex+4,c),i),i+=c);b>0&&(s=new Uint8Array(A.buffersIndex+2*(4+i)),l=new DataView(s.buffer),s.set(new Uint8Array(A.job,0,A.buffersIndex),0),l.setUint32(A.buffersIndex,i/4),s.set(new Uint8Array(d.buffer,0,i),A.buffersIndex+4),f.messagePackSize-=A.job.byteLength,f.messagePackSize+=s.byteLength,A.job=s.buffer);break;case 9:case 11:case 7:for(b=0,g=0,c=new DataView(A.job).getUint32(A.buffersIndex),c*=4,g+=c,o(0,new Uint8Array(A.job,A.buffersIndex+4,c),0),o(1,new Uint8Array(A.job,A.buffersIndex+4+c+4,c),0),i=c,e=y+1;e<L;e++)if(a=p[e],a.signature==N&&(a.reduced=!0,f.messagePackSize-=a.job.byteLength,b++,c=new DataView(a.job).getUint32(a.buffersIndex),c*=4,g+=c,o(0,new Uint8Array(a.job,a.buffersIndex+4,c),i),o(1,new Uint8Array(a.job,a.buffersIndex+4+c+4,c),i),i+=c,11==m)){var U=A.job2.files,w=a.job2.files;for(t=0,r=w.length;t<r;t++){U[t]||(U[t]=[]);for(var x=0,S=w[t].length;x<S;x++)-1==U[t].indexOf(w[t][x])&&U[t].push(w[t][x])}}if(b>0){if(11==m){var M=v(JSON.stringify(A.job2));s=new Uint8Array(6+M.byteLength+2*(4+i)),l=new DataView(s.buffer),u=0,l.setUint8(u,A.command),u+=1,l.setUint8(u,m),u+=1,l.setUint32(u,M.byteLength),u+=4,s.set(M,u),u+=M.byteLength,A.buffersIndex=u}else s=new Uint8Array(A.buffersIndex+2*(4+i)),l=new DataView(s.buffer),s.set(new Uint8Array(A.job,0,A.buffersIndex),0);l.setUint32(A.buffersIndex,i/4),s.set(new Uint8Array(d.buffer,0,i),A.buffersIndex+4),l.setUint32(A.buffersIndex+4+i,i/4),s.set(new Uint8Array(h.buffer,0,i),A.buffersIndex+4+i+4),f.messagePackSize-=A.job.byteLength,f.messagePackSize+=s.byteLength,A.job=s.buffer}}}for(var s=new Uint8Array(f.messagePackSize),u=0,y=0,L=f.messageBufferIndex;y<L;y++){var A=f.messageBuffer[y];A.reduced||(s.set(new Uint8Array(A.job),u),u+=f.messageBuffer[y].job.byteLength)}n({command:"addPackedCommands",buffer:s},[s.buffer]),f.messageBufferIndex=0,f.messagePackSize=0}function u(){b.length>0&&(g.length>0?postMessage({command:"packed-events",messages:b},g):postMessage({command:"packed-events",messages:b}),b=[],g=[])}var c=t(0);t.d(r,"b",function(){return l}),t.d(r,"c",function(){return a}),t.d(r,"a",function(){return i}),t.d(r,"d",function(){return n}),t.d(r,"e",function(){return u});var f=c.a,v=c.j,d=new Uint8Array(16777216),h=new Uint8Array(16777216),b=[],g=[]},function(e,r,t){"use strict";function n(e,r,t,a,i,s,o,u,c){var f,v;if(!e||!Array.isArray(e))return!1;if(u>100)return!1;switch(e[0]){case"all":for(f=1,v=e.length;f<v;f++)if(!n(e[f],r,t,a,i,s,o,u+1,c))return!1;return!0;case"any":for(f=1,v=e.length;f<v;f++)if(n(e[f],r,t,a,s,o,u+1,c))return!0;return!1;case"none":for(f=1,v=e.length;f<v;f++)if(n(e[f],r,t,a,s,o,u+1,c))return!1;return!0;case"skip":return!1}var d,h;switch(c&&e[2]?d=e[1]:(l.disableLog="has"==e[0]||"!has"==e[0],d=A(i,s,r,o,e[1],0),l.disableLog=!1),e[0]){case"==":case"!=":case">=":case"<=":case">":case"<":if(void 0===(h=e[c?3:2]))return!1;c&&e[4]||(h=A(i,s,r,o,h,0))}switch(e[0]){case"==":return d==h;case"!=":return d!=h;case">=":return d>=h;case"<=":return d<=h;case">":return d>h;case"<":return d<h;case"has":return void 0!==d;case"!has":return void 0===d;case"in":for(f=c?3:2,v=e.length;f<v;f++)if(e[f]==d)return!0;return!1;case"!in":for(f=c?3:2,v=e.length;f<v;f++)if(e[f]==d)return!1;return!0}return!1}function a(e){switch(typeof e){case"number":return!0;case"string":if(!(e.length>0))return!0;switch(e.charAt(0)){case"#":case"$":case"@":case"&":break;default:if(-1==e.indexOf("{"))return!0}}return!1}function i(e){if(!e||!Array.isArray(e))return e;var r,t,n=[e[0]];switch(e[0]){case"all":case"any":case"none":case"skip":for(r=1,t=e.length;r<t;r++)n[r]=i(e[r]);return n}switch(n[1]=e[1],n[2]=a(e[1]),e[0]){case"==":case"!=":case">=":case"<=":case">":case"<":n[3]=e[2],n[4]=a(e[2]);break;case"in":case"!in":for(r=2,t=e.length;r<t;r++)n[r+1]=e[r]}return n}var s=t(0),o=t(3);t.d(r,"e",function(){return n}),t.d(r,"d",function(){return B}),t.d(r,"b",function(){return b}),t.d(r,"c",function(){return y}),t.d(r,"g",function(){return g}),t.d(r,"f",function(){return A}),t.d(r,"a",function(){return i}),t.d(r,"h",function(){return p});var l=s.a,u=s.d,c=s.e,f=s.f,v=o.c,d=o.d,h=o.e,b=function(e,r,t){var n=l.stylesheetData.layers[e];return null==n?(U("wrong-Layer",e,null,null,t,r),{}):n},g=function(e,r,t,n,a,i){var s;if(i||(i=0),!(i>100)){switch(typeof r){case"string":if(r.length>0){switch(r.charAt(0)){case"#":case"$":case"@":case"&":case"%":return s=L(e,a,t,n,r,i+1),void 0===s&&U("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),s}return c(r,function(o){if(o.length>0){switch(o.charAt(0)){case"#":case"$":case"@":case"&":case"%":return s=L(e,a,t,n,o,i+1),void 0===s&&U("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),s}if(-1!=o.indexOf("{")){try{o=o.replace(/\'/g,\'"\'),s=JSON.parse(o)}catch(t){return U("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),""}return void 0===s?(U("wrong-expresion",e["$$layer-id"],r,r,null,"feature-property"),""):A(e,a,t,n,s,i+1)}return o}})}}return r}},p=function(e,r){return void 0!==e[r]},y=function(e,r,t,n){var a=A(e,r,t,n);return x(e["$$layer-id"],r,a)},L=function(e,r,t,n,a,i){var s=a;switch(a.charAt(0)){case"$":s=t.properties[a.substr(1)];break;case"@":s=l.stylesheetConstants[a];break;case"%":s=l.stylesheetVariables[a.substr(1)];break;case"&":s=l.stylesheetLocals[a];break;case"#":switch(a){case"#id":return t.id;case"#type":return l.featureType;case"#group":return l.groupId;case"#lod":return l.tileLod;case"#ix":return l.tileIX;case"#iy":return l.tileIY;case"#tileSize":return l.tileSize;case"#pixelSize":return l.pixelSize;case"#metric":return l.metricUnits;case"#dpr":return l.pixelFactor;case"#language":return l.language}}return"&"==a.charAt(0)?void 0===s&&void 0!==(s=e[a])&&("string"==typeof s?s=g(e,s,t,n,r,i+1):void 0!==s&&(s=A(e,r,t,n,s,i+1)),l.stylesheetLocals[a]=s):"string"==typeof s?s=g(e,s,t,n,r,i+1):void 0!==s&&"@"==a.charAt(0)&&(s=A(e,r,t,n,s,i+1)),s},A=function(e,r,t,a,i,s){var o,c,f,b,g,p,y,m,N;if(void 0===i)i=e[r],b=!0,s=0;else if(s>100)return;switch(typeof i){case"string":return i.length>0?(f=L(e,r,t,a,i,s),void 0!==f?f:(U("wrong-object",e["$$layer-id"],r,i,null,"feature-property"),b?S(r):void 0)):i;case"object":if(null==i)return b?S(r):void 0;if(Array.isArray(i)){if("icon-source"==r&&null==l.stylesheetBitmaps[i[0]])return U("wrong-object",e["$$layer-id"],r,i,null,"bitmap"),b?S(r):void 0;if("filter"!=r){for(N=new Array(i.length),o=0,c=i.length;o<c;o++)N[o]=A(e,r,t,a,i[o],s+1);return N}return i}var w,x,M,f;for(w in i)break;if(!w)return b?S(r):void 0;switch(x=i[w],w){case"if":if(Array.isArray(x)&&3==x.length){if(void 0!==(f=n(x[0],t,l.featureType,l.groupId,e,r,a,0)?A(e,r,t,a,x[1],s+1):A(e,r,t,a,x[2],s+1)))return f;M=!0}else M=!0;break;case"add":case"sub":case"mul":case"div":case"mod":case"pow":case"tofixed":case"atan2":case"random":if(Array.isArray(x)&&2==x.length)if(g=A(e,r,t,a,x[0],s+1),p=A(e,r,t,a,x[1],s+1),"number"!=typeof g||"number"!=typeof p)M=!0;else switch(w){case"add":return g+p;case"sub":return g-p;case"mul":return g*p;case"div":return g/p;case"mod":return g%p;case"pow":return Math.pow(g,p);case"atan2":return Math.atan2(g,p);case"tofixed":return g.tofixed(p);case"random":return g+Math.random()*(p-g)}else M=!0;break;case"clamp":if(Array.isArray(x)&&3==x.length){if(g=A(e,r,t,a,x[0],s+1),p=A(e,r,t,a,x[1],s+1),y=A(e,r,t,a,x[2],s+1),"number"==typeof g&&"number"==typeof p&&"number"==typeof y)return u(g,p,y);M=!0}else M=!0;break;case"logScale":case"log-scale":if(!Array.isArray(x)||x.length<2)M=!0;else{if(g=A(e,r,t,a,x[0],s+1),p=A(e,r,t,a,x[1],s+1),y=0,m=100,x.length>2&&"number"!=typeof(y=A(e,r,t,a,x[2],s+1))&&(M=!0),x.length>3&&"number"!=typeof(m=A(e,r,t,a,x[3],s+1))&&(M=!0),!M&&"number"==typeof g&&"number"==typeof p){var B,o,O=m,k=y,_=p,I=g;return I>_&&(I=_),B=(O-k)/Math.log(_+1),o=B*Math.log(I+1)+k}M=!0}break;case"sgn":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"sqrt":case"abs":case"log":case"round":case"floor":case"ceil":case"deg2rad":case"rad2deg":if("number"!=typeof(x=A(e,r,t,a,x,s+1)))M=!0;else switch(w){case"sgn":return x<0?-1:1;case"sin":return Math.sin(x);case"cos":return Math.cos(x);case"tan":return Math.tan(x);case"asin":return Math.asin(x);case"acos":return Math.acos(x);case"atan":return Math.atan(x);case"sqrt":return Math.sqrt(x);case"abs":return Math.abs(x);case"log":return Math.log(x);case"round":return Math.round(x);case"floor":return Math.floor(x);case"ceil":return Math.ceil(x);case"deg2rad":return x/180*Math.PI;case"rad2deg":return x/Math.PI*180}break;case"strlen":case"trim":case"str2num":case"lowercase":case"uppercase":case"capitalize":case"has-fonts":case"has-latin":case"is-cjk":if("string"!=typeof(x=A(e,r,t,a,x,s+1))){if("number"==typeof x)return x;M=!0}else switch(w){case"strlen":return x.length;case"trim":return x.trim();case"str2num":return parseFloat(x);case"lowercase":return x.toLowerCase();case"uppercase":return x.toUpperCase();case"capitalize":return x.replace(/(?:^|\\s)\\S/g,function(e){return e.toUpperCase()});case"has-fonts":return h(x);case"has-latin":return v(x);case"is-cjk":return d(x)}break;case"find":case"replace":case"substr":if(Array.isArray(x)&&x.length>=2){if(g=A(e,r,t,a,x[0],s+1),p=A(e,r,t,a,x[1],s+1),"find"==w&&"string"==typeof g&&"string"==typeof p)return g.indexOf(p);if("replace"==w&&3==x.length&&(y=A(e,r,t,a,x[2],s+1),"string"==typeof g&&"string"==typeof p&&"string"==typeof y))return g.replace(p,y);if("substr"==w)if(2==x.length){if("string"==typeof g&&"number"==typeof p)return g.substr(p)}else if(y=A(e,r,t,a,x[2],s+1),"string"==typeof g&&"number"==typeof p&&"number"==typeof y)return g.substr(p,y)}M=!0;break;case"min":case"max":if(Array.isArray(x)){for(f=A(e,r,t,a,x[0],s+1),o=0,c=x.length;o<c;o++){if("number"!=typeof(N=A(e,r,t,a,x[o],s+1))){M=!0;break}f="max"==w?Math.max(f,N):Math.min(f,N)}return f}M=!0;break;case"map":if(Array.isArray(x)){f=A(e,r,t,a,x[0],s+1);var E=x[1];if(Array.isArray(E))for(o=0,c=E.length;o<c;o++){var C=E[o];if(!Array.isArray(C)){M=!0;break}var F=A(e,r,t,a,C[0],s+1);if(f==F)return A(e,r,t,a,C[1],s+1)}else M=!0;return A(e,r,t,a,x[2],s+1)}M=!0;break;case"linear":case"linear2":case"discrete":case"discrete2":case"lod-scaled":var z=null,P=null,x=a;if(null!=i["lod-scaled"]){var j=i["lod-scaled"];if("number"==typeof j[1])return j[1]*Math.pow(2*j[2],j[0]-a);z=j[1],P=j}if(null!=i.discrete2||null!=i.linear2){var j=i.discrete2||i.linear2;z=j[1],x=A(e,r,t,a,j[0],s+1)}else z=i.discrete||i.linear;for(var T,V,G=z[0][0],X=z[0][1],D=typeof X,R=X,o=0,c=z.length;o<=c;o++){if(o==c){R=X;break}if(z[o][0]>x){if(null!=i.discrete||null!=i.discrete2||null!=P){R=X;break}if(T=z[o][0],V=z[o][1],T==G)break;switch(D){case"boolean":X=X?1:0,V=X?1:0,R=X+(x-G)/(T-G)*(V-X),R=R>.5;break;case"number":R=X+(x-G)/(T-G)*(V-X);break;case"object":R=[];for(var $=0,q=X.length;$<q;$++)R[$]=X[$]+(V[$]-X[$])*((x-G)/(T-G))}break}G=z[o][0],X=z[o][1]}return null!=P&&(R*=Math.pow(2*P[2],P[0]-x)),R;default:M=!0}if(M)return b?S(r):void 0;case"number":case"boolean":return i}return b?S(r):void 0},m=function(e,r,t,n,a){if(a>100)return void U("custom","infinite inherit loop in Layer: "+e);if(null!=t.inherit){var i=n.layers[t.inherit];if(null==i)return U("wrong-object",e,"inherit",i,"Layer"),S(s);null!=i.inherit&&m(t.inherit,r,i,n,a++);for(var s in i)r[s]=i[s]}},N=function(e,r,t,n){null!=t.inherit&&m(e,r,t,n,0);for(var a in t)r[a]=t[a];r["$$layer-id"]=e},U=function(e,r,t,n,a,i){if(!l.disableLog){"object"==typeof n&&(n=JSON.stringify(n));var s=null;switch(e){case"wrong-property-value":s="Error: wrong layer property "+(i?"\'"+i+"\'":"")+": "+r+"."+t+" = "+n;break;case"wrong-property-value[]":s="Error: wrong layer property "+(i?"\'"+i+"\'":"")+"["+a+"]: "+r+"."+t+" = "+n;break;case"wrong-object":s="Error: reffered "+i+" does not exist: "+r+"."+t+" = "+n;break;case"wrong-object[]":s="Error: reffered "+i+" does not exist: "+r+"."+t+"["+a+"] = "+n;break;case"wrong-Layer":s="Error: reffered "+i+" Layer does not exist: "+i+"["+a+"].Layer = "+r;break;case"wrong-bitmap":s="Error: wrong definition of bitmap: "+r;break;case"custom":s="Error: "+r}s&&l.log&&console.log(s)}},w=function(e,r,t,n,a,i,s,o){var u,c;if(null!=t&&"object"==typeof t&&!Array.isArray(t))return U("wrong-property-value",e,r,t),S(r);if(typeof t!=n&&(null!==t||"icon-source"!=r&&"visibility"!=r&&"label-no-overlap-factor"!=r))return U("wrong-property-value",e,r,t),S(r);switch(typeof t){case"object":if(null===t)return t;if("reduce"==r||"dynamic-reduce"==r||"label-no-overlap-factor"==r||"line-points"==r){if(!(Array.isArray(t)&&t.length>0&&"string"==typeof t[0]))return U("wrong-property-value",e,r,t),S(r);if("line-points"==r){if("vertices"!=t[0]&&"by-length"!=t[0]&&"by-ratio"!=t[0]&&"endpoints"!=t[0]&&"start"!=t[0]&&"end"!=t[0]&&"middle"!=t[0]&&"midpoint"!=t[0])return U("wrong-property-value",e,r,t),S(r)}else if("dynamic-reduce"==r){if("by-extenal-param"==t[0]&&(t[0]=l.reduceMode),"tilt"!=t[0]&&"tilt-cos"!=t[0]&&"tilt-cos2"!=t[0]&&"scr-count"!=t[0]&&"scr-count2"!=t[0]&&"scr-count3"!=t[0]&&"scr-count4"!=t[0]&&"scr-count5"!=t[0]&&"scr-count6"!=t[0]&&"scr-count7"!=t[0]&&"scr-count8"!=t[0]||"number"!=typeof t[1]||"number"!=typeof t[2]&&"scr-count4"!=t[0]&&"scr-count5"!=t[0]&&"scr-count6"!=t[0]&&"scr-count7"!=t[0]&&"scr-count8"!=t[0])return U("wrong-property-value",e,r,t),S(r)}else if("reduce"==r){if("odd"!=t[0]&&"even"!=t&&("number"!=typeof t[1]||("top"!=t[0]||"bottom"!=t)&&"string"!=typeof t[2]))return U("wrong-property-value",e,r,t),S(r)}else if("label-no-overlap-factor"==r&&"direct"!=t[0]&&"div-by-dist"!=t[0])return U("wrong-property-value",e,r,t),S(r)}if("next-pass"==r||"visibility-switch"==r){var f="visibility-switch"==r;if(!(Array.isArray(t)&&t.length>0))return U("wrong-property-value",e,r,t),S(r);for(u=0;u<c;u++){var v=t[u];if("object"!=typeof v||!Array.isArray(v)||2!=v.length||"number"!=typeof v[0]||!("string"==typeof v[1]||f&&null===v[1]))return U("wrong-property-value[]",e,r,t,u),S(r);if("string"==typeof v[1]&&"@"==v[1].charAt(0)){if(void 0===l.stylesheetConstants[v[1]])return U("wrong-property-value[]",e,r,t,u),S(r);v[1]=l.stylesheetConstants[v[1]]}}}if("label-font"==r||"line-label-font"==r){if(!Array.isArray(t)||t.length<1)return U("wrong-property-value[]",e,r,t,0),S(r);for(u=0,c=t.length;u<c;u++)if("string"!=typeof t[u]||!l.fonts[t[u]])return U("wrong-property-value[]",e,r,t,0),S(r);return t}if(null!=a){if(Array.isArray(t)&&(t.length==a||t.length>=7)){if(u=0,"icon-source"==r||"line-style-texture"==r){if("string"!=typeof t[0])return U("wrong-property-value[]",e,r,t,0),S(r);if(null==l.stylesheetBitmaps[t[0]])return U("wrong-object",e,r,t,null,"bitmap"),S(r);u=1}for(c=t.length;u<c;u++)if("number"!=typeof t[u])return U("wrong-property-value[]",e,r,t,u),S(r);return 7==t.length&&(t[7]=0),t}return U("wrong-property-value",e,r,t),S(r)}return t;case"string":if("line-type"==r||"point-type"==r)switch(t){case"screen":case"flat":case"screen-flat":return t;default:return U("wrong-property-value",e,r,t),S(r)}if("line-label-type"==r)switch(t){case"flat":case"screen-flat":return t;default:return U("wrong-property-value",e,r,t),S(r)}if("line-style"==r)switch(t){case"solid":case"texture":return t;default:return U("wrong-property-value",e,r,t),S(r)}if("label-size-units"==r)switch(t){case"pixels":case"points":return t;default:return U("wrong-property-value",e,r,t),S(r)}if("line-width-units"==r)switch(t){case"pixels":case"points":case"meters":case"ratio":return t;default:return U("wrong-property-value",e,r,t),S(r)}if("label-origin"==r||"icon-origin"==r)switch(t){case"top-left":case"top-right":case"top-center":case"center-left":case"center-right":case"center-center":case"bottom-left":case"bottom-right":case"bottom-center":return t;default:return U("wrong-property-value",e,r,t),S(r)}if("label-align"==r)switch(t){case"left":case"right":case"center":return t;default:return U("wrong-property-value",e,r,t),S(r)}return t;case"number":return t>s||t<i?(U("wrong-property-value",e,r,t),S(r)):t;case"boolean":return t}},x=function(e,r,t){switch(r){case"inherit":return w(e,r,t,"string");case"reduce":case"dynamic-reduce":case"line-points":return w(e,r,t,"object");case"line":return w(e,r,t,"boolean");case"line-type":return w(e,r,t,"string");case"line-flat":return w(e,r,t,"boolean");case"line-width":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"line-width-units":return w(e,r,t,"string");case"line-color":return w(e,r,t,"object",4,0,255);case"line-style":return w(e,r,t,"string");case"line-style-texture":return w(e,r,t,"object",3,-Number.MAX_VALUE,Number.MAX_VALUE);case"line-style-background":return w(e,r,t,"object",4,0,255);case"line-label":return w(e,r,t,"boolean");case"line-label-type":case"line-label-source":return w(e,r,t,"string");case"line-label-color":case"line-label-color2":return w(e,r,t,"object",4,0,255);case"line-label-size":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"line-label-offset":return w(e,r,t,"number",null,-Number.MAX_VALUE,Number.MAX_VALUE);case"line-label-spacing":case"line-label-line-height":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"line-label-no-overlap":return w(e,r,t,"boolean");case"line-label-no-overlap-factor":return w(e,r,t,"object");case"line-label-no-overlap-margin":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"point":return w(e,r,t,"boolean");case"point-type":return w(e,r,t,"string");case"point-flat":return w(e,r,t,"boolean");case"point-radius":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"point-Layer":return w(e,r,t,"string");case"point-color":return w(e,r,t,"object",4,0,255);case"icon":return w(e,r,t,"boolean");case"icon-source":return w(e,r,t,"object",5,-Number.MAX_VALUE,Number.MAX_VALUE);case"icon-scale":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"icon-offset":return w(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"icon-origin":return w(e,r,t,"string");case"icon-stick":return w(e,r,t,"object",8,-Number.MAX_VALUE,Number.MAX_VALUE);case"icon-color":return w(e,r,t,"object",4,0,255);case"icon-no-overlap":return w(e,r,t,"boolean");case"icon-no-overlap-factor":return w(e,r,t,"object");case"icon-no-overlap-margin":return w(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"label":return w(e,r,t,"boolean");case"label-color":case"label-color2":return w(e,r,t,"object",4,0,255);case"label-source":return w(e,r,t,"string");case"label-size":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"label-size-units":return w(e,r,t,"string");case"label-spacing":case"label-line-height":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"label-offset":return w(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"label-origin":case"label-align":return w(e,r,t,"string");case"label-stick":return w(e,r,t,"object",8,-Number.MAX_VALUE,Number.MAX_VALUE);case"label-width":return w(e,r,t,"number",null,1e-4,Number.MAX_VALUE);case"label-no-overlap":return w(e,r,t,"boolean");case"label-no-overlap-factor":return w(e,r,t,"object");case"label-no-overlap-margin":return w(e,r,t,"object",2,-Number.MAX_VALUE,Number.MAX_VALUE);case"polygon":return w(e,r,t,"boolean");case"polygon-style":return w(e,r,t,"string");case"polygon-use-stencil":return w(e,r,t,"boolean");case"polygon-culling":return w(e,r,t,"string");case"polygon-color":return w(e,r,t,"object",4,0,255);case"polygon-extrude":return w(e,r,t,"number",0,-Number.MAX_VALUE,Number.MAX_VALUE);case"z-index":return w(e,r,t,"number",null,-Number.MAX_VALUE,Number.MAX_VALUE);case"zbuffer-offset":return w(e,r,t,"object",3,0,Number.MAX_VALUE);case"selected-hover-layer":case"selected-layer":return w(e,r,t,"string");case"hover-event":return w(e,r,t,"boolean");case"hover-layer":return w(e,r,t,"string");case"enter-event":case"leave-event":case"click-event":case"draw-event":case"advanced-hit":case"export-geometry":case"pack":case"visible":return w(e,r,t,"boolean");case"visibility":return w(e,r,t,"number",null,1e-5,Number.MAX_VALUE);case"visibility-abs":return w(e,r,t,"object",2,1e-5,Number.MAX_VALUE);case"visibility-rel":return w(e,r,t,"object",4,1e-5,Number.MAX_VALUE);case"visibility-switch":case"hysteresis":return w(e,r,t,"object");case"culling":return w(e,r,t,"number",180,1e-4,180);case"next-pass":return w(e,r,t,"object");case"importance-source":return w(e,r,t,"string");case"importance-weight":return w(e,r,t,"number",null,0,Number.MAX_VALUE)}return t},S=function(e){switch(e){case"inherit":return"";case"filter":case"reduce":case"dynamic-reduce":return null;case"line-points":return["vertices",0,0];case"line":return!1;case"line-type":return"screen";case"line-flat":return!1;case"line-width":return 1;case"line-width-units":return"meters";case"line-color":return[255,255,255,255];case"line-style":return"solid";case"line-style-texture":return null;case"line-style-background":return[0,0,0,0];case"line-label":return!1;case"line-label-type":return"flat";case"line-label-font":return["#default"];case"line-label-color":return[255,255,255,255];case"line-label-color2":return[0,0,0,255];case"line-label-outline":return[.27,.75,2.2,2.2];case"line-label-source":return"$name";case"line-label-size":return 1;case"line-label-offset":return 0;case"line-label-spacing":case"line-label-line-height":return 1;case"line-label-no-overlap":return!0;case"line-label-no-overlap-factor":return null;case"line-label-no-overlap-margin":return 1.1;case"point":return!1;case"point-type":return"screen";case"point-flat":return!1;case"point-radius":return 1;case"point-Layer":return"solid";case"point-color":return[255,255,255,255];case"icon":return!1;case"icon-source":return null;case"icon-scale":return 1;case"icon-offset":return[0,0];case"icon-origin":return"bottom-center";case"icon-stick":return[0,0,0,255,255,255,255,0];case"icon-color":return[255,255,255,255];case"icon-no-overlap":return!1;case"icon-no-overlap-factor":return null;case"icon-no-overlap-margin":return[5,5];case"label":return!1;case"label-font":return["#default"];case"label-color":return[255,255,255,255];case"label-color2":return[0,0,0,255];case"label-outline":return[.27,.75,2.2,2.2];case"label-source":return"$name";case"label-size":return 10;case"label-size-units":return"pixels";case"label-spacing":case"label-line-height":return 1;case"label-offset":return[0,0];case"label-origin":return"bottom-center";case"label-align":return"center";case"label-stick":return[0,0,0,255,255,255,255,0];case"label-width":return 200;case"label-no-overlap":return!0;case"label-no-overlap-factor":return null;case"label-no-overlap-margin":return[5,5];case"polygon":return!1;case"polygon-style":return"solid";case"polygon-use-stencil":return!0;case"polygon-culling":return"none";case"polygon-color":return[255,255,255,255];case"polygon-extrude":case"z-index":return 0;case"zbuffer-offset":return[0,0,0];case"selected-hover-layer":case"selected-layer":return"";case"hover-event":return!1;case"hover-layer":return"";case"enter-event":case"leave-event":case"click-event":case"draw-event":case"advanced-hit":case"export-geometry":case"pack":return!1;case"visible":return!0;case"visibility":case"visibility-abs":case"visibility-rel":case"visibility-switch":case"hysteresis":return null;case"culling":return 180;case"next-pass":case"importance-source":return null;case"importance-weight":return 1}},M=function(e,r,t){var n,a,i={};N(e,i,r,t);for(n in i){if("string"==typeof(a=i[n])&&a.length>0)switch(a.charAt(0)){case"@":null!=l.stylesheetConstants[a]?i[n]=l.stylesheetConstants[a]:(U("wrong-object",e,n,a,null,"constant"),i[n]=S(n));break;case"%":null!=l.stylesheetLocals[a]?(i["$$layer-variables"]||(i["$$layer-variables"]={}),i["$$layer-variables"][n]=a,i[n]=l.stylesheetLocals[a]):(U("wrong-object",e,n,a,null,"variable"),i[n]=S(n))}if("visibility-switch"==n){if(!(Array.isArray(a)&&a.length>0))return U("wrong-property-value",e,n,a),S(n);for(var s=0,o=a.length;s<o;s++){var u=a[s],c=!1;"object"==typeof u&&Array.isArray(u)&&2==u.length?("string"==typeof u[0]&&"@"==u[0].charAt(0)&&(void 0===l.stylesheetConstants[u[0]]?c=!0:u[0]=l.stylesheetConstants[u[0]]),("number"!=typeof u[0]||"string"!=typeof u[1]&&null!==u[1])&&(c=!0)):c=!0,c&&U("wrong-property-value[]",e,n,a,s)}}}return i},B=function(e){var r;l.stylesheetBitmaps={},l.stylesheetFonts={},l.stylesheetConstants=e.constants||{},l.stylesheetVariables=e.variables||{},l.stylesheetLocals={};var t=e.bitmaps||{};for(r in t){var n=t[r];"string"==typeof n?n={url:n,hash:f(n)}:"object"==typeof n?null==n.url?(n.hash="null",U("wrong-bitmap",r)):n.hash=f(n.url):U("wrong-bitmap",r),l.stylesheetBitmaps[r]=n}postMessage({command:"loadBitmaps",bitmaps:l.stylesheetBitmaps}),t=l.stylesheetBitmaps;for(r in t)n=t[r],n.url=null;var a=e.fonts||{};for(r in a){var i=a[r];"string"==typeof i?i={url:i}:"object"==typeof i?null==i.url&&U("wrong-font",r):U("wrong-font",r),l.stylesheetFonts[r]=i}postMessage({command:"loadFonts",fonts:l.stylesheetFonts}),l.stylesheetData={layers:{}};var s=e.layers||{};l.stylesheetLayers=l.stylesheetData.layers;for(r in s)l.stylesheetData.layers[r]=M(r,s[r],e)}},function(e,r,t){"use strict";var n=t(0),a=t(8);t.d(r,"n",function(){return p}),t.d(r,"i",function(){return A}),t.d(r,"m",function(){return L}),t.d(r,"g",function(){return m}),t.d(r,"e",function(){return x}),t.d(r,"f",function(){return b}),t.d(r,"a",function(){return c}),t.d(r,"b",function(){return f}),t.d(r,"l",function(){return h}),t.d(r,"j",function(){return B}),t.d(r,"k",function(){return O}),t.d(r,"c",function(){return S}),t.d(r,"d",function(){return M}),t.d(r,"h",function(){return k});var i=n.a,s=n.g,o=n.h,l=n.i,u=a.a,c=function(e){var r=u.parse(e.data);i.fontsStorage[e.url]=r},f=function(e){var r=e.map;for(var t in r)i.fonts[t]=i.fontsStorage[r[t]];i.fontsMap=r},v=function(e){var r,t,n,a,i,s=e[0][0]+e[1][1]+e[2][2];return s>0?(i=2*Math.sqrt(s+1),a=.25*i,r=(e[2][1]-e[1][2])/i,t=(e[0][2]-e[2][0])/i,n=(e[1][0]-e[0][1])/i):e[0][0]>e[1][1]&e[0][0]>e[2][2]?(i=2*Math.sqrt(1+e[0][0]-e[1][1]-e[2][2]),a=(e[2][1]-e[1][2])/i,r=.25*i,t=(e[0][1]+e[1][0])/i,n=(e[0][2]+e[2][0])/i):e[1][1]>e[2][2]?(i=2*Math.sqrt(1+e[1][1]-e[0][0]-e[2][2]),a=(e[0][2]-e[2][0])/i,r=(e[0][1]+e[1][0])/i,t=.25*i,n=(e[1][2]+e[2][1])/i):(i=2*Math.sqrt(1+e[2][2]-e[0][0]-e[1][1]),a=(e[1][0]-e[0][1])/i,r=(e[0][2]+e[2][0])/i,t=(e[1][2]+e[2][1])/i,n=.25*i),[r,t,n,a]},d=function(e,r,t,n,a,o,u,c,f,d,h,b,g,p,y,L){var A,m=d[y],N=[0,0,0];i.geocent&&!g?(A=[0,0,0],s(i.bboxMin,N),l(N,r,A)):A=[-r[1],r[0],0],l(r,A,N);var U=[e[0],e[1],e[2]],w=[U[0],U[1],U[2]],x=m.glyphs[n];if(n=0,!x)return[e,u,c,0];var S=0,M=f[0],B=f[1],O=f[2];if(9==n||32==n)(x=chars[32])&&(e[0]+=r[0]*x.step*a*o,e[1]+=r[1]*x.step*a*o,S=x.lx*a);else if(0==x.lx)e[0]=e[0]+r[0]*x.step*a*o,e[1]=e[1]+r[1]*x.step*a*o,S=x.lx*a;else{var k=4e3*y,_=x.plane+k;p&&(p[y]||(p[y]={}),p[y][_]=!0);var I=x.lx*a,E=x.ly*a;if(L)if(i.processLineLabel&&i.useLineLabel2){U[0]=U[0]+r[0]*x.sx*a,U[1]=U[1]+r[1]*x.sx*a,U[2]=U[2]+r[2]*x.sx*a,U[0]=U[0]+A[0]*(x.sy-m.size)*a,U[1]=U[1]+A[1]*(x.sy-m.size)*a,U[2]=U[2]+A[2]*(x.sy-m.size)*a;var C=[A[0]*t,A[1]*t,A[2]*t],F=[C[0]+A[0]*E,C[1]+A[1]*E,C[2]+A[2]*E];L[u]=U[0]-C[0],L[u+1]=U[1]-C[1],L[u+2]=U[2]-C[2];var z=[[r[0],r[1],r[2]],[A[0],A[1],A[2]],[N[0],N[1],N[2]]],P=v(z);L[u+3]=P[0],L[u+4]=P[1],L[u+5]=P[2],L[u+6]=P[3],i.lineLabelPass||(L[u+7]=I,L[u+8]=E),L[u+9]=x.u1,L[u+10]=x.v1+k;var j=1024*(x.u2-x.u1),T=x.v2-x.v1;L[u+11]=j+T;var V=.5*r[0]*I-.5*A[0]*E-C[0],G=.5*r[1]*I-.5*A[1]*E-C[1],X=.5*r[2]*I-.5*A[2]*E-C[2];i.lineLabelPoints.push([U[0]+V,U[1]+G,U[2]+X,.5*Math.sqrt(I*I+E*E),L[u],L[u+1],L[u+2],L[u+3],L[u+4],L[u+5],L[u+6],I,E]),u+=12}else L[u]=U[0]+x.sx*a,L[u+1]=U[1]+(x.sy-m.size)*a,L[u+2]=L[u]+I,L[u+3]=L[u+1]-E,L[u+4]=x.u1,L[u+5]=x.v1+k,L[u+6]=x.u2,L[u+7]=x.v2+k,u+=8;else{var C=[A[0]*t,A[1]*t,A[2]*t],F=[C[0]+A[0]*E,C[1]+A[1]*E,C[2]+A[2]*E];U[0]=U[0]+r[0]*x.sx*a,U[1]=U[1]+r[1]*x.sx*a,U[2]=U[2]+r[2]*x.sx*a,U[0]=U[0]+A[0]*(x.sy-m.size)*a,U[1]=U[1]+A[1]*(x.sy-m.size)*a,U[2]=U[2]+A[2]*(x.sy-m.size)*a,w[0]=U[0]+r[0]*I,w[1]=U[1]+r[1]*I,w[2]=U[2]+r[2]*I,h[u]=U[0]-C[0],h[u+1]=U[1]-C[1],h[u+2]=U[2]-C[2],h[u+3]=O,b[c]=x.u1,b[c+1]=x.v1+k,b[c+2]=M,b[c+3]=B,h[u+4]=U[0]-F[0],h[u+5]=U[1]-F[1],h[u+6]=U[2]-F[2],h[u+7]=O,b[c+4]=x.u1,b[c+5]=x.v2+k,b[c+6]=M,b[c+7]=B,h[u+8]=w[0]-C[0],h[u+9]=w[1]-C[1],h[u+10]=w[2]-C[2],h[u+11]=O,b[c+8]=x.u2,b[c+9]=x.v1+k,b[c+10]=M,b[c+11]=B,h[u+12]=U[0]-F[0],h[u+13]=U[1]-F[1],h[u+14]=U[2]-F[2],h[u+15]=O,b[c+12]=x.u1,b[c+13]=x.v2+k,b[c+14]=M,b[c+15]=B,h[u+16]=w[0]-F[0],h[u+17]=w[1]-F[1],h[u+18]=w[2]-F[2],h[u+19]=O,b[c+16]=x.u2,b[c+17]=x.v2+k,b[c+18]=M,b[c+19]=B,h[u+20]=w[0]-C[0],h[u+21]=w[1]-C[1],h[u+22]=w[2]-C[2],h[u+23]=O,b[c+20]=x.u2,b[c+21]=x.v1+k,b[c+22]=M,b[c+23]=B,u+=24,c+=24}e[0]=e[0]+r[0]*x.step*a*o,e[1]=e[1]+r[1]*x.step*a*o,S=x.lx*a}return[e,u,c,S*o]},h=function(e){return 3*(e?3:4)*2},b=function(e,r,t,n,a,i,s,o,l,c,f,v,h){for(var b=[0,1,0],g=[e[0],e[1],e[2]],p=v||u.U.stringToGlyphs(i,t),L=p[0],A=p[1],m=0,N=L.length;m<N;m++){var U=L[m],w=i[A[m]];if(w){var x=y(n,w),S=d(g,r,0,U,x,a,c,c,b,i,s,o,l,f,A[m],h);g=S[0],c=S[1]}}return c},g=function(e,r,t,n,a,o,l,c,f,v,h,b,g,p){null==o&&(o=[0,1,0]);var L=e[0];L=[L[0],L[1],L[2]];var A=r,m=g||u.U.stringToGlyphs(l,t),N=m[0],w=m[1];i.processLineLabel=!0;for(var x=0,S=N.length;x<S;x++){var M=N[x],B=l[w[x]];if(B){var O=y(n,B),k=.01,_=B.glyphs[M];_&&(k=_.step*O*a);var I=U(e,A),E=U(e,A+k),C=[.5*(E[1][0]+I[1][0]),.5*(E[1][1]+I[1][1]),.5*(E[1][2]+I[1][2])];s(C);var F=d(I[0],C,-O*B.size*.7+c,M,O,a,h,h,o,l,f,v,null,b,w[x],p);L=F[0],h=F[1],A+=k}}return i.processLineLabel=!1,h},p=function(e,r,t,n,a,s,o,l,u,c,f,v){var d=A(r,t,n,a,f),h=N(e),b=.5*(h-d);if(b<0&&(b=0),!(d>h)){var p=w(e,b,r,t,n,a,f);return i.textVector=p,i.textCenter=U(e,.5*h)[0],i.textLength=d,g(e,b,r,t,n,p,a,s,o,l,u,c,f,v)}},y=function(e,r){return r?e/r.size*1.52:1},L=function(e,r,t){var n=y(e,t[0]);return t[0].cly*n*r},A=function(e,r,t,n,a){for(var i=0,s=a||u.U.stringToGlyphs(n,e),o=s[0],l=s[1],c=0,f=o.length;c<f;c++){var v=o[c],d=n[l[c]];if(d){var h=y(r,d)*t,b=d.glyphs[v];b&&(i+=c==f-1?b.lx*h:b.step*h)}}return i},m=function(e,r,t,n,a,i){for(var s=0,o=i||u.U.stringToGlyphs(a,e),l=o[0],c=o[1],f=o[2],v=0,d=l.length;v<d;v++){var h=l[v],b=f[v];if(s>r&&(10==b||9==b||32==b))return v;if(10!=b){var g=a[c[v]];if(g){var p=y(t,g)*n,L=g.glyphs[h];L&&(s+=v==d-1?L.lx*p:L.step*p)}}}return d},N=function(e){for(var r=0,t=0,n=e.length-1;t<n;t++){var a=e[t],i=e[t+1],s=[i[0]-a[0],i[1]-a[1],i[2]-a[2]];r+=o(s)}return r},U=function(e,r){for(var t=0,n=[0,0,0],a=[1,0,0],i=0,l=e.length-1;i<l;i++){n=e[i];var u=e[i+1];a=[u[0]-n[0],u[1]-n[1],u[2]-n[2]];var c=o(a);if(t+c>r){var f=(r-t)/c,v=[n[0]+a[0]*f,n[1]+a[1]*f,n[2]+a[2]*f];return s(a),[v,a]}t+=c}return[n,a]},w=function(e,r,t,n,a,u,c){for(var f=0,v=[0,0,0],d=[1,0,0],h=[0,0,0],b=r,g=r+A(t,n,a,u,c),p=i.bboxMin,y=i.geocent,L=0,m=e.length-1;L<m;L++){v=e[L];var N=e[L+1];if(d=[N[0]-v[0],N[1]-v[1],N[2]-v[2]],f+=o(d),f>b&&(s(d),h[0]+=d[0],h[1]+=d[1],h[2]+=d[2]),f>g){if(s(h),y){var U=[0,0,0];return s(p,U),l(U,h,U),U}return[-h[1],h[0],0]}}return h},x=function(e,r,t){return!(!e||""==e)&&-1==(t||u.U.stringToGlyphs(r,e))[0].indexOf(0)},S=function(e){for(var r=0,t=e.length;r<t;r++){var n=e.charCodeAt(r);if(n>=65&&n<=90||n>=97&&n<=122||n>=192&&n<=255&&215!=n&&247!=n||n>=256&&n<=383)return!0}return!1},M=function(e){for(var r=0,t=e.length;r<t;r++){var n=e.charCodeAt(r);if(!(n>=19968&&n<=25343||n>=25344&&n<=30719||n>=30720&&n<=36095||n>=36096&&n<=40959||n>=13312&&n<=19903||n>=131072&&n<=136703||n>=136704&&n<=143615||n>=143616&&n<=148991||n>=148992&&n<=155903||n>=155904&&n<=161279||n>=161280&&n<=168191||n>=168192&&n<=173791||n>=173824&&n<=177983||n>=177984&&n<=178207||n>=178208&&n<=183983||n>=183984&&n<=191471||n>=63744&&n<=64255||n>=13056&&n<=13311||n>=65072&&n<=65103||n>=63744&&n<=64255||n>=194560&&n<=195103||n>=0&&n<=64||n>=160&&n<=191))return!1}return!0},B=function(e){for(var r=[],t=0,n=e.length;t<n;t++)r.push(i.fonts[e[t]]);return r},O=function(e){for(var r=[],t=0,n=e.length;t<n;t++)r.push(i.fontsMap[e[t]]);return r},k=function(e,r){return u.U.stringToGlyphs(r,e)}},function(e,r,t){"use strict";var n=t(0),a=t(2),i=t(3),s=t(1);t.d(r,"a",function(){return N}),t.d(r,"c",function(){return M}),t.d(r,"b",function(){return U}),t.d(r,"d",function(){return m});var o=n.a,l=n.d,u=a.c,c=a.g,f=i.f,v=i.g,d=i.h,h=i.i,b=i.j,g=i.k,p=i.e,y=i.l,L=i.m,A=s.c,m=function(e){var r,t,n,a,i,s,o,l=[];if(e["d-points"]||e["d-lines"]){if(l=e["d-points"]||e["d-lines"],Array.isArray(l)&&i.length>0)for(n=0,a=l;n<a;n++)if(i=l[n],Array.isArray(i)&&i.length>0)for(s=i[0],s[0]=s[0]>>1^-(1&s[0]),s[1]=s[1]>>1^-(1&s[1]),s[2]=s[2]>>1^-(1&s[2]),r=1,t=i.length;r<t;r++)s=i[r-1],o=i[r],o[0]=(o[0]>>1^-(1&o[0]))+s[0],o[1]=(o[1]>>1^-(1&o[1]))+s[1],o[2]=(o[2]>>1^-(1&o[2]))+s[2];e["d-points"]?(e.points=e["d-points"],delete e["d-points"]):(e.lines=e["d-lines"],delete e["d-lines"])}},N=function(e,r,t,n,a,i){var s,f,v,h,L,N,U,w=[];if(m(e),(w=e.lines?e.lines:[e.points])&&0!=w.length){var M,B,O,k,_=u(t,"visibility-rel",e,r)||u(t,"visibility-abs",e,r)||u(t,"visibility",e,r),I=u(t,"culling",e,r),E=u(t,"hover-event",e,r),C=u(t,"click-event",e,r),F=u(t,"draw-event",e,r),z=u(t,"enter-event",e,r),P=u(t,"leave-event",e,r),j=u(t,"advanced-event",e,r),T=u(t,"line-points",e,r),V=u(t,"zbuffer-offset",e,r),G=u(t,"point",e,r),X=u(t,"point-flat",e,r),D=u(t,"point-color",e,r),R=.5*u(t,"point-radius",e,r),$=0;for(v=0,h=w.length;v<h;v++)L=w[v],Array.isArray(L)&&L.length>0&&($+=L.length);var q=u(t,"icon",e,r);if(q)if(M=u(t,"icon-source",e,r)){B=y()*$,O=y(!0)*$;var Y={color:u(t,"icon-color",e,r),scale:u(t,"icon-scale",e,r),offset:u(t,"icon-offset",e,r),stick:u(t,"icon-stick",e,r),reduce:u(t,"dynamic-reduce",e,r),origin:u(t,"icon-origin",e,r),source:u(t,"icon-source",e,r),noOverlap:u(t,"icon-no-overlap",e,r),noOverlapMargin:u(t,"icon-no-overlap-margin",e,r),noOverlapFactor:u(t,"icon-no-overlap-factor",e,r),index:0,index2:0};$>1?(Y.vertexBuffer=new Float32Array(B),Y.originBuffer=new Float32Array(O),Y.texcoordsBuffer=new Float32Array(B)):Y.singleBuffer=new Float32Array(16)}else q=!1;var H=u(t,"label",e,r);if(H){M=u(t,"label-source",e,r);var J=c(t,M,e,r,M);J=J?J.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var W=u(t,"label-size",e,r),Z=u(t,"label-font",e,r),K=b(Z),Q=d(J,K);if("$name"==M&&!p(J,K,Q)){var ee=c(t,"$name:en",e,r,M);ee=ee?ee.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var re=d(ee,K);p(ee,K)&&(J=ee,Q=re)}if(J&&""!=J&&Math.abs(W)>1e-4){k=u(t,"label-no-overlap",e,r),B=y()*J.length*(k?1:$),O=y(!0)*J.length*(k?1:$);var te=1==$,ne=1;"points"==u(t,"label-size-units",e,r)&&(ne=o.pixelFactor/(1/72*96));var ae={color:u(t,"label-color",e,r),color2:u(t,"label-color2",e,r),outline:u(t,"label-outline",e,r),reduce:u(t,"dynamic-reduce",e,r),size:W*ne,spacing:u(t,"label-spacing",e,r),lineHeight:u(t,"label-line-height",e,r),offset:u(t,"label-offset",e,r),stick:u(t,"label-stick",e,r),origin:u(t,"label-origin",e,r),align:u(t,"label-align",e,r),fonts:K,fontsStorage:g(Z),text:J,hysteresis:u(t,"hysteresis",e,r),width:ne*u(t,"label-width",e,r),noOverlap:k,noOverlapMargin:u(t,"label-no-overlap-margin",e,r),noOverlapFactor:u(t,"label-no-overlap-factor",e,r),vertexBuffer:te?null:new Float32Array(B),originBuffer:te?null:new Float32Array(O),texcoordsBuffer:te?null:new Float32Array(B),singleBuffer:te?new Float32Array(4*J.length*2):null,index:0,index2:0,glyphsRes:Q};ae.stick&&(ae.stick=ae.stick.slice(),ae.stick[2]*=ne)}else H=!1}var ie,se,N,oe,le,U,ue,ce=0,fe=0,ve=[0,0,0],de=o.forceOrigin,he=o.bboxMin,be=o.tileX,ge=o.tileY,pe=o.forceScale,ye=function(e){var r=0,t=0;if(N=L[0],oe=[N[0],N[1],N[2]],de&&(oe=[oe[0]-be,oe[1]-ge,oe[2]]),null!=pe&&(oe=[oe[0]*pe[0],oe[1]*pe[1],oe[2]*pe[2]]),0==e)return oe;for(var n=0,a=L.length-1;n<a;n++){N=L[n+1],le=[N[0],N[1],N[2]],de&&(le=[le[0]-be,le[1]-ge,le[2]]),null!=pe&&(le=[le[0]*pe[0],le[1]*pe[1],le[2]*pe[2]]);var i=le[0]-oe[0],s=le[1]-oe[1],o=le[2]-oe[2],l=Math.sqrt(i*i+s*s+o*o);if(r=t,t+=l,e>=r&&e<=t){var u=(e-r)/l;return[oe[0]+i*u,oe[1]+s*u,oe[2]+o*u]}oe=le}},Le=new Array(2048),Ae=0;for(v=0,h=w.length;v<h;v++)if(L=w[v],Array.isArray(L)&&L.length>0){var me=0,Ne=null;for("vertices"!=T[0]&&(Ne=new Array(L.length),Ne[0]=0),s=0,f=L.length;s<f;s++){if(N=L[s],oe=[N[0],N[1],N[2]],de&&(oe=[oe[0]-be,oe[1]-ge,oe[2]]),null!=pe&&(oe=[oe[0]*pe[0],oe[1]*pe[1],oe[2]*pe[2]]),s+1<f){N=L[s+1],le=[N[0],N[1],N[2]],de&&(le=[le[0]-be,le[1]-ge,le[2]]),null!=pe&&(le=[le[0]*pe[0],le[1]*pe[1],le[2]*pe[2]]);var Ue=le[0]-oe[0],we=le[1]-oe[1],xe=le[2]-oe[2],Se=Math.sqrt(Ue*Ue+we*we+xe*xe);Ne&&(Ne[s]=Se),me+=Se}ve[0]+=oe[0],ve[1]+=oe[1],ve[2]+=oe[2],"vertices"==T[0]&&(Le[Ae]=oe,Ae++)}if("by-length"==T[0]||"by-ratio"==T[0]){var Me=T[1],Be=T[2]||0;if("by-ratio"==T[0]&&(Me*=me,Be*=me),Me<=0)Le[Ae]=ye(Be),Le[Ae]&&Ae++;else for(s=Be;s<me;s+=Me)Le[Ae]=ye(s),Le[Ae]&&Ae++}"start"==T[0]&&(Le[Ae]=ye(0),Ae++),"end"==T[0]&&(Le[Ae]=ye(me),Ae++),"endpoints"==T[0]&&(Le[Ae]=ye(0),Ae++,Le[Ae]=ye(me),Ae++),"middle"!=T[0]&&"midpoint"!=T[0]||(Le[Ae]=ye(.5*me),Ae++)}var Oe,ke,_e,Ie,Ee=Ae;if(G){var Ce=[],Fe=l(8*R*.5,8,32),ze=0,Pe=2*Math.PI/Fe;for(s=0;s<Fe;s++)Ce[s]=[-Math.sin(ze),Math.cos(ze)],ze+=Pe;Ce[Fe]=[0,1],X?(Oe=3*Fe*3,ke=new Float32Array(Ee*Oe)):(Oe=3*Fe*4,ke=new Float32Array(Ee*Oe),_e=3*Fe*4,Ie=new Float32Array(Ee*_e))}if(Ae){for(o.directPoints=Le.slice(0,Ae),s=0;s<Ae;s++)U=Le[s],function(e){if(q&&!Y.noOverlap&&(se=x(U,Y)),H&&!ae.noOverlap&&(ie=S(U,ae)),G)for(var r=0;r<Fe;r++)X?(ke[ce]=U[0],ke[ce+1]=U[1],ke[ce+2]=U[2],ke[ce+3]=U[0]+Ce[r][0]*R,ke[ce+4]=U[1]+Ce[r][1]*R,ke[ce+5]=U[2],ke[ce+6]=U[0]+Ce[r+1][0]*R,ke[ce+7]=U[1]+Ce[r+1][1]*R,ke[ce+8]=U[2],ce+=9):(ke[ce]=U[0],ke[ce+1]=U[1],ke[ce+2]=U[2],ke[ce+3]=0,Ie[fe]=0,Ie[fe+1]=0,Ie[fe+2]=0,Ie[fe+3]=0,ke[ce+4]=U[0],ke[ce+5]=U[1],ke[ce+6]=U[2],ke[ce+7]=0,Ie[fe+4]=Ce[r][0]*R,Ie[fe+5]=Ce[r][1]*R,Ie[fe+6]=0,Ie[fe+7]=0,ke[ce+8]=U[0],ke[ce+9]=U[1],ke[ce+10]=U[2],ke[ce+11]=0,Ie[fe+8]=Ce[r+1][0]*R,Ie[fe+9]=Ce[r+1][1]*R,Ie[fe+10]=0,Ie[fe+11]=0,ce+=12,fe+=12)}();$>0&&(ve[0]/=$,ve[1]/=$,ve[2]/=$),ve[0]+=he[0],ve[1]+=he[1],ve[2]+=he[2];var je=E||C||z||P;o.signatureCounter++;var Te=""+o.signatureCounter;_&&!Array.isArray(_)&&(_=[_]),G&&(X?A(5,6,{color:D,"z-index":a,visibility:_,center:ve,"hover-event":E,"click-event":C,"draw-event":F,advancedHit:j,"enter-event":z,"leave-event":P,"zbuffer-offset":V,hitable:je,state:o.hitState,eventInfo:o.alwaysEventInfo||je||F?i:{},lod:o.autoLod?null:o.tileLod},[ke],Te):A(5,9,{color:D,"z-index":a,visibility:_,center:ve,"hover-event":E,"click-event":C,"draw-event":F,"enter-event":z,"leave-event":P,"zbuffer-offset":V,hitable:je,state:o.hitState,eventInfo:o.alwaysEventInfo||je||F?i:{},lod:o.autoLod?null:o.tileLod},[ke,Ie],Te));var Ve=function(){if(q){if(o.signatureCounter++,Te=""+o.signatureCounter,Y.noOverlap){var e=Y.noOverlapMargin,r=null,t=null;if(null!==Y.noOverlapFactor){switch(Y.noOverlapFactor[0]){case"direct":r=0;break;case"div-by-dist":r=1}t=Y.noOverlapFactor[1]}var s=[se[0]-e[0],se[1]-e[1],se[2]+e[0],se[3]+e[1],r,t]}(Y.singleBuffer&&Y.singleBuffer.length>0||Y.vertexBuffer&&Y.vertexBuffer.length>0)&&A(5,Y.singleBuffer?3:4,{icon:o.stylesheetBitmaps[Y.source[0]],color:Y.color,"z-index":a,visibility:_,culling:I,center:ue,stick:Y.stick,"hover-event":E,"click-event":C,"draw-event":F,advancedHit:j,"enter-event":z,"leave-event":P,"zbuffer-offset":V,noOverlap:Y.noOverlap?s:null,hitable:je,state:o.hitState,eventInfo:o.alwaysEventInfo||je||F?i:{},index:n,reduce:Y.reduce,lod:o.autoLod?null:o.tileLod},Y.singleBuffer?[Y.singleBuffer]:[Y.vertexBuffer,Y.originBuffer,Y.texcoordsBuffer],Te)}},Ge=function(){if(H){if(o.signatureCounter++,Te=""+o.signatureCounter,ae.noOverlap){var e=ae.noOverlapMargin,r=null,t=null;if(null!==ae.noOverlapFactor){switch(ae.noOverlapFactor[0]){case"direct":r=0;break;case"div-by-dist":r=1}t=ae.noOverlapFactor[1]}var s=[ie[0]-e[0],ie[1]-e[1],ie[2]+e[0],ie[3]+e[1],r,t]}(ae.singleBuffer&&ae.singleBuffer.length>0||ae.vertexBuffer&&ae.vertexBuffer.length>0)&&A(5,ae.singleBuffer?1:2,{size:ae.size,origin:ae.pos,color:ae.color,color2:ae.color2,outline:ae.outline,"z-index":a,visibility:_,culling:I,center:ue,stick:ae.stick,noOverlap:ae.noOverlap?s:null,"hover-event":E,"click-event":C,"draw-event":F,files:ae.files,index:n,"enter-event":z,"leave-event":P,"zbuffer-offset":V,fonts:ae.fontsStorage,hitable:je,state:o.hitState,advancedHit:j,reduce:ae.reduce,hysteresis:ae.hysteresis,eventInfo:o.alwaysEventInfo||je||F?i:{},lod:o.autoLod?null:o.tileLod},ae.singleBuffer?[ae.singleBuffer]:[ae.vertexBuffer,ae.originBuffer,ae.texcoordsBuffer],Te)}};for(q&&!Y.noOverlap&&(ue=ve,Ve()),H&&!ae.noOverlap&&(ue=ve,Ge()),s=0,f=o.insidePack?1:o.directPoints.length;s<f;s++)U=o.directPoints[s],ue=[U[0]+he[0],U[1]+he[1],U[2]+he[2]],q&&Y.noOverlap&&(se=x(U,Y,se),Ve()),H&&ae.noOverlap&&(ie=S(U,ae,ie),Ge())}}},U=function(e,r,t,n,a,i){var s,l,c=[];if(m(e),(c=e.lines?e.lines:[e.points])&&0!=c.length){var f,v,d,h=u(t,"visibility-rel",e,r)||u(t,"visibility-abs",e,r)||u(t,"visibility",e,r),b=u(t,"culling",e,r),g=u(t,"hysteresis",e,r),p=0;for(v=0,d=c.length;v<d;v++)f=c[v],Array.isArray(f)&&f.length>0&&(p+=f.length);var y,L,N=[0,0,0],U=o.forceOrigin,w=o.bboxMin,x=o.tileX,S=o.tileY,M=o.forceScale;for(v=0,d=c.length;v<d;v++)if(f=c[v],Array.isArray(f)&&f.length>0)for(s=0,l=f.length;s<l;s++)y=f[s],L=[y[0],y[1],y[2]],U&&(L=[L[0]-x,L[1]-S,L[2]]),null!=M&&(L=[L[0]*M[0],L[1]*M[1],L[2]*M[2]]),N[0]+=L[0],N[1]+=L[1],N[2]+=L[2];p>0&&(N[0]/=p,N[1]/=p,N[2]/=p),N[0]+=w[0],N[1]+=w[1],N[2]+=w[2],o.signatureCounter++;var B=""+o.signatureCounter;A(5,20,{"z-index":a,hysteresis:g,visibility:h,culling:b,center:N,eventInfo:{},index:n,lod:o.autoLod?null:o.tileLod},[],B)}},w=function(e,r,t){switch(e){case"top-left":return[0,0];case"top-right":return[-r,0];case"top-center":return[.5*-r,0];case"center-left":return[0,.5*-t];case"center-right":return[-r,.5*-t];case"center-center":return[.5*-r,.5*-t];case"bottom-left":return[0,-t];case"bottom-right":return[-r,-t];case"bottom-center":return[.5*-r,-t]}},x=function(e,r,t){t&&(r.index=0,r.index2=0,r.vertexBuffer=r.vertexBuffer?new Float32Array(r.vertexBuffer.length):null,r.originBuffer=r.originBuffer?new Float32Array(r.originBuffer.length):null,r.singleBuffer=r.singleBuffer?new Float32Array(r.singleBuffer.length):null);var n=r.source,a=r.index,i=r.index2,s=a,o=Math.abs(n[3]*r.scale*.5),l=Math.abs(n[4]*r.scale*.5),u=w(r.origin,o,l),c=u[0]+r.offset[0],f=u[1]+r.offset[1];if(r.singleBuffer){var v=r.singleBuffer;return v[0]=c,v[1]=f,v[2]=n[1],v[3]=n[2],v[4]=o+c,v[5]=f,v[6]=n[1]+n[3],v[7]=n[2],v[8]=o+c,v[9]=l+f,v[10]=n[1]+n[3],v[11]=n[2]+n[4],v[12]=c,v[13]=l+f,v[14]=n[1],v[15]=n[2]+n[4],[.5*c,.5*f,.5*(c+o)+1,.5*(f+l)]}var d=r.vertexBuffer,h=r.texcoordsBuffer,b=r.originBuffer;d[a]=0,d[a+1]=0,d[a+2]=0,d[a+3]=0,d[a+4]=o,d[a+5]=0,d[a+6]=0,d[a+7]=0,d[a+8]=o,d[a+9]=-l,d[a+10]=0,d[a+11]=0,h[a]=n[1],h[a+1]=n[2],h[a+2]=0,h[a+3]=0,h[a+4]=n[1]+n[3],h[a+5]=n[2],h[a+6]=0,h[a+7]=0,h[a+8]=n[1]+n[3],h[a+9]=n[2]+n[4],h[a+10]=0,h[a+11]=0,a+=12,d[a]=0,d[a+1]=0,d[a+2]=0,d[a+3]=0,d[a+4]=0,d[a+5]=-l,d[a+6]=0,d[a+7]=0,d[a+8]=o,d[a+9]=-l,d[a+10]=0,d[a+11]=0,h[a]=n[1],h[a+1]=n[2],h[a+2]=0,h[a+3]=0,h[a+4]=n[1],h[a+5]=n[2]+n[4],h[a+6]=0,h[a+7]=0,h[a+8]=n[1]+n[3],h[a+9]=n[2]+n[4],h[a+10]=0,h[a+11]=0,a+=12;for(var g=e[0],p=e[1],y=e[2],L=s;L<a;L+=4)d[L]+=c,d[L+1]-=f,b[i]=g,b[i+1]=p,b[i+2]=y,i+=3;return r.index=a,r.index2=i,[.5*c,.5*f,.5*(c+o)+1,.5*(f+l)]},S=function(e,r,t){t&&(r.index=0,r.index2=0,r.vertexBuffer=r.vertexBuffer?new Float32Array(r.vertexBuffer.length):null,r.originBuffer=r.originBuffer?new Float32Array(r.originBuffer.length):null,r.singleBuffer=r.singleBuffer?new Float32Array(r.singleBuffer.length):null);var n,a,i=r.vertexBuffer,s=r.texcoordsBuffer,o=r.originBuffer,l=r.singleBuffer,u=r.index,c=r.index2,d=u,b=(r.text,r.fonts),g={},p=r.glyphsRes,y=[],A=[];do{var m=p[2].indexOf(10);-1!=m?(y.push([p[0].slice(0,m),p[1].slice(0,m),p[2].slice(0,m)]),p=[p[0].slice(m+1),p[1].slice(m+1),p[2].slice(m+1)]):y.push(p)}while(-1!=m);for(var n=0,a=y.length;n<a;n++)for(var p=y[n];;){var N=v(null,r.width,r.size,r.spacing,b,p),U=p[2];if(U.length==N){A.push(p);break}A.push([p[0].slice(0,N),p[1].slice(0,N),p[2].slice(0,N)]),p=[p[0].slice(N+1),p[1].slice(N+1),p[2].slice(N+1)]}var x=0,S=0,M=L(r.size,r.lineHeight,b),B=0,O=[];for(n=0,a=A.length;n<a;n++)O[n]=h(null,r.size,r.spacing,b,A[n]),B=Math.max(O[n],B);for(n=0,a=A.length;n<a;n++){var k=O[n];switch(r.align){case"left":x=0;break;case"right":x=B-k;break;case"center":x=.5*(B-k)}u=f([x,S,0],[1,0,0],null,r.size,r.spacing,b,i,s,!0,u,g,A[n],l),S-=M}var _=w(r.origin,B,-S),I=_[0]+r.offset[0],E=_[1]+r.offset[1],C=e[0],F=e[1],z=e[2];if(l){for(n=d;n<u;n+=8)l[n]+=I,l[n+1]-=E,l[n+2]+=I,l[n+3]-=E;r.pos=[C,F,z],l=new Float32Array(l.buffer,0,u)}else for(n=d;n<u;n+=4)i[n]+=I,i[n+1]-=E,o[c]=C,o[c+1]=F,o[c+2]=z,c+=3;var b=r.fonts;for(r.files=new Array(b.length),n=0,a=b.length;n<a;n++)r.files[n]=[];for(var P in g){var j=parseInt(P),T=g[P],V=[];for(var G in T){var X=parseInt(G)-4e3*j,D=Math.round((X-X%4)/4);-1==V.indexOf(D)&&V.push(D)}r.files[j]=V}return r.index=u,r.index2=c,[.5*I,.5*E,.5*(I+B)+1,.5*(E+Math.abs(S))]},M=function(e){var r;if(m(e),e.lines?pointsGroups=e.lines:pointsGroups=[e.points],pointsGroups&&0!=pointsGroups.length){var t=0,n=new Uint32Array(pointsGroups.length);for(r=0;r<pointsGroups.length;r++)n[r]=t,Array.isArray(pointsGroups[r])&&(t+=pointsGroups[r].length);for(var a,i,s,l=new Float64Array(3*t),u=o.forceScale,c=0,r=0;r<pointsGroups.length;r++)if(Array.isArray(pointsGroups[r])&&pointsGroups[r].length){var f=pointsGroups[r];s=f[0],a=[s[0],s[1],s[2]];for(var v=0,d=f.length;v<d&&(null!=u&&(i=[a[0]*u[0],a[1]*u[1],a[2]*u[2]]),l[c]=i[0],l[c+1]=i[1],l[c+2]=i[2],c+=3,v!=d-1);v++)a=f[v+1]}o.signatureCounter++,A(5,5,{id:e.id},[l,n],""+o.signatureCounter)}}},function(e,r,t){"use strict";var n=t(0),a=t(2),i=t(3),s=t(1),o=t(4);t.d(r,"a",function(){return N}),t.d(r,"b",function(){return w});var l=n.a,u=n.g,c=n.i,f=a.c,v=a.g,d=a.h,h=i.n,b=i.e,g=i.l,p=i.j,y=i.k,L=s.c,A=i.h,m=o.d,N=function(e,r,t,n,a,i){m(e);var s=e.lines;if(s&&0!=s.length){var o=f(t,"line",e,r),v=f(t,"line-label",e,r);if(o||v){var h=f(t,"hover-event",e,r),b=f(t,"click-event",e,r),g=f(t,"draw-event",e,r),p=f(t,"enter-event",e,r),y=f(t,"leave-event",e,r),A=f(t,"advanced-hit",e,r),N=f(t,"zbuffer-offset",e,r);if(d(t,"line-type"));else var w=f(t,"line-flat",e,r);var x=f(t,"line-color",e,r),S=.5*f(t,"line-width",e,r),M=f(t,"line-width-units",e,r),B=f(t,"line-style",e,r),O=f(t,"line-style-texture",e,r),k=f(t,"line-style-background",e,r),_=f(t,"line-label-size",e,r),I="solid"!=B,E="ratio"==M;"points"==M&&(S*=l.pixelFactor/(1/72*96));var C=0,F=0,z=0,P=!1;P=E?!w&&1080*S<2.1:!w&&S<2.1;var j,T,V,G,X,D,R,$,q,Y,H,J,W=1;if(!P){var Z=[],K=[],Q=8,ee=0,re=2*Math.PI/Q;for(T=0;T<Q;T++)Z[T]=[-Math.sin(ee),Math.cos(ee)],K[T]=ee,ee+=re;Z[Q]=[0,1],K[Q]=0}var te=0;for(j=0;j<s.length;j++)Array.isArray(s[j])&&(te+=s[j].length);if(!(te<=1)){w&&(Q=2);var ne=3*(I||E||!w?4:3)*2,ae=P?0:Q*(I||E||!w?4:3)*3,ie=new Float32Array((te-1)*ne+te*ae);if(A)var se=new Float32Array(6*(te-1)+te*(P?0:Q)*3);if(!w||I||E)var oe=P?0:3*Q*4,le=new Float32Array(24*(te-1)+te*oe);var ue=[0,0,0],ce=[],fe=l.forceOrigin,ve=l.bboxMin,de=l.geocent,he=l.tileX,be=l.tileY,ge=l.forceScale,pe=[1,0,0],ye=[-1,0,0];for(j=0;j<s.length;j++)if(Array.isArray(s[j])&&s[j].length){var Le=s[j];if(v){var Ae=new Array(Le.length),me=new Array(Le.length);ce.push({points:Ae,points2:me})}H=Le[0],Y=[H[0],H[1],H[2]],fe&&(Y=[Y[0]-he,Y[1]-be,Y[2]]),null!=ge&&(Y=[Y[0]*ge[0],Y[1]*ge[1],Y[2]*ge[2]]);var Ne=.001,Ue=.001,we=C,xe=F;for(T=0,V=Le.length-1;T<V;T++)Y=Le[T],G=Le[T+1],fe&&(Y=[Y[0]-he,Y[1]-be,Y[2]],G=[G[0]-he,G[1]-be,G[2]]),null!=ge&&(Y=[Y[0]*ge[0],Y[1]*ge[1],Y[2]*ge[2]],G=[G[0]*ge[0],G[1]*ge[1],G[2]*ge[2]]),A&&(J=W+T,se[z]=J,se[z+1]=J,se[z+2]=J,se[z+3]=J,se[z+4]=J,se[z+5]=J,z+=6),!w||I||E?w?(de?(X=[G[0]-Y[0],G[1]-Y[1],G[2]-Y[2]],R=Math.sqrt(X[0]*X[0]+X[1]*X[1]+X[2]*X[2]),Ue+=R,R=0!=R?1/R:0,D=[X[0]*R,X[1]*R,X[2]*R],$=[0,0,0],q=[0,0,0],0==T&&(pe=D),T==V-1&&(ye=D),u(ve,q),c(q,D,$),$=[$[0],$[1],$[2]]):(X=[G[0]-Y[0],G[1]-Y[1],0],R=Math.sqrt(X[0]*X[0]+X[1]*X[1]),Ue+=R,R=0!=R?S/R:0,$=[-X[1],X[0],0],0==T&&(pe=[X[0]*R,X[1]*R,0]),T==V-1&&(ye=[X[0]*R,X[1]*R,0])),ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=Ne,le[F]=$[0],le[F+1]=$[1],le[F+2]=$[2],le[F+3]=S,ie[C+4]=Y[0],ie[C+5]=Y[1],ie[C+6]=Y[2],ie[C+7]=-Ne,le[F+4]=-$[0],le[F+5]=-$[1],le[F+6]=-$[2],le[F+7]=S,ie[C+8]=G[0],ie[C+9]=G[1],ie[C+10]=G[2],ie[C+11]=Ue,le[F+8]=$[0],le[F+9]=$[1],le[F+10]=$[2],le[F+11]=S,ie[C+12]=Y[0],ie[C+13]=Y[1],ie[C+14]=Y[2],ie[C+15]=-Ne,le[F+12]=-$[0],le[F+13]=-$[1],le[F+14]=-$[2],le[F+15]=S,ie[C+16]=G[0],ie[C+17]=G[1],ie[C+18]=G[2],ie[C+19]=-Ue,le[F+16]=-$[0],le[F+17]=-$[1],le[F+18]=-$[2],le[F+19]=S,ie[C+20]=G[0],ie[C+21]=G[1],ie[C+22]=G[2],ie[C+23]=Ue,le[F+20]=$[0],le[F+21]=$[1],le[F+22]=$[2],le[F+23]=S,C+=24,F+=24):(X=[G[0]-Y[0],G[1]-Y[1],0],R=Math.sqrt(X[0]*X[0]+X[1]*X[1]),Ue+=R,ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=Ne,le[F]=G[0],le[F+1]=G[1],le[F+2]=G[2],le[F+3]=S,ie[C+4]=Y[0],ie[C+5]=Y[1],ie[C+6]=Y[2],ie[C+7]=-Ne,le[F+4]=G[0],le[F+5]=G[1],le[F+6]=G[2],le[F+7]=-S,ie[C+8]=G[0],ie[C+9]=G[1],ie[C+10]=G[2],ie[C+11]=-Ue,le[F+8]=Y[0],le[F+9]=Y[1],le[F+10]=Y[2],le[F+11]=S,ie[C+12]=Y[0],ie[C+13]=Y[1],ie[C+14]=Y[2],ie[C+15]=Ne,le[F+12]=G[0],le[F+13]=G[1],le[F+14]=G[2],le[F+15]=S,ie[C+16]=G[0],ie[C+17]=G[1],ie[C+18]=G[2],ie[C+19]=-Ue,le[F+16]=Y[0],le[F+17]=Y[1],le[F+18]=Y[2],le[F+19]=S,ie[C+20]=G[0],ie[C+21]=G[1],ie[C+22]=G[2],ie[C+23]=Ue,le[F+20]=Y[0],le[F+21]=Y[1],le[F+22]=Y[2],le[F+23]=-S,C+=24,F+=24):(de?(X=[G[0]-Y[0],G[1]-Y[1],G[2]-Y[2]],R=Math.sqrt(X[0]*X[0]+X[1]*X[1]+X[2]*X[2]),Ue+=R,R=0!=R?1/R:0,D=[X[0]*R,X[1]*R,X[2]*R],$=[0,0,0],q=[0,0,0],u(ve,q),c(q,D,$),0==T&&(pe=D),T==V-1&&(ye=D),$=[$[0]*S,$[1]*S,$[2]*S]):(X=[G[0]-Y[0],G[1]-Y[1],0],R=Math.sqrt(X[0]*X[0]+X[1]*X[1]),Ue+=R,R=0!=R?S/R:0,$=[-X[1]*R,X[0]*R,0],0==T&&(pe=[X[0]*R,X[1]*R,0]),T==V-1&&(ye=[X[0]*R,X[1]*R,0])),ie[C]=Y[0]+$[0],ie[C+1]=Y[1]+$[1],ie[C+2]=Y[2]+$[2],ie[C+3]=Y[0]-$[0],ie[C+4]=Y[1]-$[1],ie[C+5]=Y[2]-$[2],ie[C+6]=G[0]+$[0],ie[C+7]=G[1]+$[1],ie[C+8]=G[2]+$[2],ie[C+9]=Y[0]-$[0],ie[C+10]=Y[1]-$[1],ie[C+11]=Y[2]-$[2],ie[C+12]=G[0]-$[0],ie[C+13]=G[1]-$[1],ie[C+14]=G[2]-$[2],ie[C+15]=G[0]+$[0],ie[C+16]=G[1]+$[1],ie[C+17]=G[2]+$[2],C+=18),Ne=Ue,Y=G;for(Y=[H[0],H[1],H[2]],T=0,V=Le.length;T<V;T++){if(fe&&(Y=[Y[0]-he,Y[1]-be,Y[2]]),null!=ge&&(Y=[Y[0]*ge[0],Y[1]*ge[1],Y[2]*ge[2]]),ue[0]+=Y[0],ue[1]+=Y[1],ue[2]+=Y[2],!P){if(w){A&&(J=W+(T!=V-1?T:T-1),se[z]=J,se[z+1]=J,se[z+2]=J,se[z+3]=J,se[z+4]=J,se[z+5]=J,z+=6);var Se,Me;I||E?(Ne=T!=V-1?ie[T*ne+3]:ie[(T-1)*ne+11],Se=T!=V-1?xe+T*ne:xe+(T-1)*ne+8,Me=T>0?xe+(T-1)*ne+8:xe+Se,ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=Ne,ie[C+4]=Y[0],ie[C+5]=Y[1],ie[C+6]=Y[2],ie[C+7]=Ne,ie[C+8]=Y[0],ie[C+9]=Y[1],ie[C+10]=Y[2],ie[C+11]=Ne,ie[C+12]=Y[0],ie[C+1+12]=Y[1],ie[C+2+12]=Y[2],ie[C+3+12]=Ne,ie[C+4+12]=Y[0],ie[C+5+12]=Y[1],ie[C+6+12]=Y[2],ie[C+7+12]=-Ne,ie[C+8+12]=Y[0],ie[C+9+12]=Y[1],ie[C+10+12]=Y[2],ie[C+11+12]=-Ne,0==T?(le[F]=0,le[F+1]=0,le[F+2]=0,le[F+3]=-S,le[F+4]=le[Se],le[F+5]=le[Se+1],le[F+6]=le[Se+2],le[F+7]=S,le[F+8]=-pe[0],le[F+9]=-pe[1],le[F+10]=-pe[2],le[F+11]=-S,le[F+12]=0,le[F+1+12]=0,le[F+2+12]=0,le[F+3+12]=-S,le[F+4+12]=-le[Se],le[F+5+12]=-le[Se+1],le[F+6+12]=-le[Se+2],le[F+7+12]=S,le[F+8+12]=-pe[0],le[F+9+12]=-pe[1],le[F+10+12]=-pe[2],le[F+11+12]=-S):T==V-1?(le[F]=0,le[F+1]=0,le[F+2]=0,le[F+3]=-S,le[F+4]=le[Me],le[F+5]=le[Me+1],le[F+6]=le[Me+2],le[F+7]=S,le[F+8]=ye[0],le[F+9]=ye[1],le[F+10]=ye[2],le[F+11]=-S,le[F+12]=0,le[F+1+12]=0,le[F+2+12]=0,le[F+3+12]=-S,le[F+4+12]=-le[Me],le[F+5+12]=-le[Me+1],le[F+6+12]=-le[Me+2],le[F+7+12]=S,le[F+8+12]=ye[0],le[F+9+12]=ye[1],le[F+10+12]=ye[2],le[F+11+12]=-S):(le[F]=0,le[F+1]=0,le[F+2]=0,le[F+3]=-S,le[F+4]=le[Se],le[F+5]=le[Se+1],le[F+6]=le[Se+2],le[F+7]=S,le[F+8]=le[Me],le[F+9]=le[Me+1],le[F+10]=le[Me+2],le[F+11]=S,le[F+12]=0,le[F+1+12]=0,le[F+2+12]=0,le[F+3+12]=-S,le[F+4+12]=-le[Se],le[F+5+12]=-le[Se+1],le[F+6+12]=-le[Se+2],le[F+7+12]=S,le[F+8+12]=-le[Me],le[F+9+12]=-le[Me+1],le[F+10+12]=-le[Me+2],le[F+11+12]=S),C+=24,F+=24):(Se=T!=V-1?we+T*ne:we+(T-1)*ne,Me=T>0?we+(T-1)*ne:we+Se,0==T?(ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=ie[Se],ie[C+4]=ie[Se+1],ie[C+5]=ie[Se+2],ie[C+6]=Y[0]-pe[0]*S,ie[C+7]=Y[1]-pe[1]*S,ie[C+8]=Y[2]-pe[2]*S,ie[C+9]=Y[0],ie[C+9+1]=Y[1],ie[C+9+2]=Y[2],ie[C+9+3]=ie[Se+3],ie[C+9+4]=ie[Se+4],ie[C+9+5]=ie[Se+5],ie[C+9+6]=Y[0]-pe[0]*S,ie[C+9+7]=Y[1]-pe[1]*S,ie[C+9+8]=Y[2]-pe[2]*S):T==V-1?(ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=ie[Se+15],ie[C+4]=ie[Se+16],ie[C+5]=ie[Se+17],ie[C+6]=Y[0]+ye[0]*S,ie[C+7]=Y[1]+ye[1]*S,ie[C+8]=Y[2]+ye[2]*S,ie[C+9]=Y[0],ie[C+9+1]=Y[1],ie[C+9+2]=Y[2],ie[C+9+3]=ie[Se+12],ie[C+9+4]=ie[Se+13],ie[C+9+5]=ie[Se+14],ie[C+9+6]=Y[0]+ye[0]*S,ie[C+9+7]=Y[1]+ye[1]*S,ie[C+9+8]=Y[2]+ye[2]*S):(ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=ie[Se],ie[C+4]=ie[Se+1],ie[C+5]=ie[Se+2],ie[C+6]=ie[Me+15],ie[C+7]=ie[Me+16],ie[C+8]=ie[Me+17],ie[C+9]=Y[0],ie[C+9+1]=Y[1],ie[C+9+2]=Y[2],ie[C+9+3]=ie[Se+3],ie[C+9+4]=ie[Se+4],ie[C+9+5]=ie[Se+5],ie[C+9+6]=ie[Me+12],ie[C+9+7]=ie[Me+13],ie[C+9+8]=ie[Me+14]),C+=18)}else for(var Be=T!=V-1?T:T-1,Oe=0;Oe<Q;Oe++)A&&(J=W+Be,se[z]=J,se[z+1]=J,se[z+2]=J,z+=3),Ne=ie[Be*ne+3],ie[C]=Y[0],ie[C+1]=Y[1],ie[C+2]=Y[2],ie[C+3]=Ne,le[F]=0,le[F+1]=0,le[F+2]=0,le[F+3]=0,ie[C+4]=Y[0],ie[C+5]=Y[1],ie[C+6]=Y[2],ie[C+7]=Ne,le[F+4]=Z[Oe][0]*S,le[F+5]=Z[Oe][1]*S,le[F+6]=K[Oe]+0,le[F+7]=0,ie[C+8]=Y[0],ie[C+9]=Y[1],ie[C+10]=Y[2],ie[C+11]=Ne,le[F+8]=Z[Oe+1][0]*S,le[F+9]=Z[Oe+1][1]*S,le[F+10]=K[Oe+1]+0,le[F+11]=0,C+=12,F+=12}v&&(H=[Y[0],Y[1],Y[2]+.1*_],Ae[T]=H,me[V-T-1]=H),T+1<V&&(Y=Le[T+1])}W+=Le.length}te>0&&(ue[0]/=te,ue[1]/=te,ue[2]/=te),ue[0]+=l.groupOrigin[0],ue[1]+=l.groupOrigin[1],ue[2]+=l.groupOrigin[2];var ke,_e=h||b||p||y;if(o){var Ie={color:x,"z-index":a,center:ue,advancedHit:A,totalPoints:te,"hover-event":h,"click-event":b,"draw-event":g,"width-units":M,hitable:_e,state:l.hitState,eventInfo:l.alwaysEventInfo||_e||g?i:{},"enter-event":p,"leave-event":y,"zbuffer-offset":N,"line-width":2*S,lod:l.autoLod?null:l.tileLod};ke=w?I?8:E?7:6:I?10:9,I&&null!=O&&(Ie.texture=[l.stylesheetBitmaps[O[0]],O[1],O[2]],Ie.background=k);var Ee=JSON.stringify({type:"T"+ke,color:x,zIndex:a,zOffset:N,state:l.hitState}),Ce=le?[ie,le]:[ie];A&&Ce.push(se),L(5,ke,Ie,Ce,Ee)}if(v)for(T=0,V=ce.length;T<V;T++)U(ce[T].points,ce[T].points2,e,ue,r,t,n,a,i)}}}},U=function(e,r,t,n,a,i,s,o,u){var c=f(i,"line-label-type",t,a),d=f(i,"line-label-color",t,a),m=f(i,"line-label-color2",t,a),N=f(i,"line-label-outline",t,a),U=f(i,"line-label-source",t,a),w=f(i,"line-label-size",t,a),x=f(i,"line-label-spacing",t,a),S=(f(i,"line-label-line-height",t,a),f(i,"line-label-offset",t,a)),M=f(i,"dynamic-reduce",t,a),B=f(i,"line-label-no-overlap",t,a),O=f(i,"line-label-no-overlap-factor",t,a),k=f(i,"line-label-no-overlap-margin",t,a);if(!(Math.abs(w)<1e-4)){var _=v(i,U,t,a,U);_=_?_.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var I=f(i,"line-label-font",t,a),E=p(I),C=y(I),F=A(_,E);if("$name"==U&&!b(_,E,F)){var z=v(i,"$name:en",t,a,U);z=z?z.replace("\\r\\n","\\n").replace("\\r","\\n"):"";var P=A(_,E);b(z,E,P)&&(_=z,F=P)}if(_&&""!=_){var j,T,V,G,X,D=f(i,"hover-event",t,a),R=f(i,"click-event",t,a),$=f(i,"draw-event",t,a),q=f(i,"enter-event",t,a),Y=f(i,"leave-event",t,a),H=f(i,"advanced-hit",t,a),J=f(i,"zbuffer-offset",t,a);l.useLineLabel2="flat"!=c,l.useLineLabel2?(j=12*_.length,G=new Float32Array(j),X=new Float32Array(j)):(j=g()*_.length*2,T=new Float32Array(j),V=new Float32Array(j));var W={},Z=D||R||q||Y,K=w;l.lineLabelPass=0,l.lineLabelPoints=[];var Q=h(e,_,w,x,E,S,T,V,0,W,F,G),ee=l.lineLabelPoints;l.lineLabelPoints=[],Q=h(r,_,w,x,E,S,T,V,l.useLineLabel2?0:Q,null,F,X);var re=l.lineLabelPoints;if(!Q){if(l.useLineLabel2)for(;;){w*=.5,l.lineLabelPass=0,l.lineLabelPoints=[];var Q=h(e,_,w,x,E,S,T,V,0,W,F,G),ee=l.lineLabelPoints;l.lineLabelPoints=[],Q=h(r,_,w,x,E,S,T,V,l.useLineLabel2?0:Q,null,F,X);var re=l.lineLabelPoints;if(Q||w<.05)break}if(!Q)return}var te,ne,ae,ie=f(i,"visibility-rel",t,a)||f(i,"visibility-abs",t,a)||f(i,"visibility",t,a),se=f(i,"culling",t,a),oe=f(i,"hysteresis",t,a),le=l.bboxMin,ue=[],ce=0;if(l.useLineLabel2){for(ne=0,ae=ee.length;ne<ae;ne++)te=ee[ne],te[0]+=le[0],te[1]+=le[1],te[2]+=le[2],te=re[ne],te[0]+=le[0],te[1]+=le[1],te[2]+=le[2];for(ue.push([w,l.textVector,ee,re]),l.lineLabelPass=1;;){if(w*=2,l.lineLabelPoints=[],Q=h(e,_,w,x,E,S,T,V,0,W,F,G),ee=l.lineLabelPoints,!Q)break;for(l.lineLabelPoints=[],Q=h(r,_,w,x,E,S,T,V,l.useLineLabel2?0:Q,null,F,X),re=l.lineLabelPoints,ne=0,ae=ee.length;ne<ae;ne++)te=ee[ne],te[0]+=le[0],te[1]+=le[1],te[2]+=le[2],te=re[ne],te[0]+=le[0],te[1]+=le[1],te[2]+=le[2];ue.push([w,l.textVector,ee,re])}for(w=K;;){if(w*=.5,l.lineLabelPoints=[],Q=h(e,_,w,x,E,S,T,V,0,W,F,G),ee=l.lineLabelPoints,l.textLength<2)break;for(l.lineLabelPoints=[],Q=h(r,_,w,x,E,S,T,V,0,null,F,X),re=l.lineLabelPoints,ne=0,ae=ee.length;ne<ae;ne++)te=ee[ne],te[0]+=le[0],te[1]+=le[1],te[2]+=le[2],te=re[ne],te[0]+=le[0],te[1]+=le[1],te[2]+=le[2];ue.unshift([w,l.textVector,ee,re]),ce++}n=l.textCenter,n[0]+=le[0],n[1]+=le[1],n[2]+=le[2]}var fe=new Array(E.length);for(ne=0,ae=E.length;ne<ae;ne++)fe[ne]=[];for(var ve in W){var de=parseInt(ve),he=W[ve],be=[];for(var ge in he){var pe=parseInt(ge)-4e3*de,ye=Math.round((pe-pe%4)/4);-1==be.indexOf(ye)&&be.push(ye)}fe[de]=be}var Le=JSON.stringify({type:"line-label",color:d,color2:m,outline:N,fonts:I,zIndex:o,zOffset:J});if(B){var Ae=null,me=null;if(null!==O){switch(O[0]){case"direct":Ae=0;break;case"div-by-dist":Ae=1}me=O[1]}var Ne=[k,Ae,me]}L(5,l.useLineLabel2?12:11,{color:d,color2:m,outline:N,textVector:l.textVector,labelPoints:l.useLineLabel2?ue:[],visibility:ie,culling:se,hysteresis:oe,"z-index":o,center:n,"hover-event":D,"click-event":R,"draw-event":$,reduce:M,noOverlap:B?Ne:null,files:fe,"enter-event":q,"leave-event":Y,"zbuffer-offset":J,advancedHit:H,labelIndex:ce,labelSize:K,fonts:C,hitable:Z,state:l.hitState,eventInfo:l.alwaysEventInfo||Z||$?u:{},lod:l.autoLod?null:l.tileLod},l.useLineLabel2?[G,X]:[T,V],Le)}}},w=function(e){m(e);var r=e.lines;if(!r&&0!=r.length){var t=0,n=new Uint32Array(r.length);for(f=0;f<r.length;f++)n[f]=t,Array.isArray(r[f])&&(t+=r[f].length);for(var a,i,s,o=new Float64Array(3*t),u=l.forceScale,c=0,f=0;f<r.length;f++)if(Array.isArray(r[f])&&r[f].length){var v=r[f];s=v[0],a=[s[0],s[1],s[2]];for(var d=0,h=v.length;d<h&&(null!=u&&(i=[a[0]*u[0],a[1]*u[1],a[2]*u[2]]),o[c]=i[0],o[c+1]=i[1],o[c+2]=i[2],c+=3,d!=h-1);d++)a=v[d+1]}l.signatureCounter++,L(5,14,{id:e.id},[o,n],""+l.signatureCounter)}}},function(e,r,t){"use strict";var n=t(0),a=t(2),i=t(1),s=t(5),o=t(4);t.d(r,"a",function(){return h});var l=n.a,u=n.g,c=a.c,f=i.c,v=s.a,d=o.a,h=function(e,r,t,n,a,i){var s=e.vertices||[];if(0!=s.length){(c(t,"point",e,r)||c(t,"label",e,r))&&g(e,s,r,t,n,a,i,!1),(c(t,"line",e,r)||c(t,"line-label",e,r))&&g(e,s,r,t,n,a,i,!0);if(c(t,"polygon",e,r)){var o=e.surface||[];if(0!=o.length){var v=c(t,"hover-event",e,r),d=c(t,"click-event",e,r),h=c(t,"draw-event",e,r),b=c(t,"enter-event",e,r),p=c(t,"leave-event",e,r),y=c(t,"advanced-hit",e,r),L=c(t,"zbuffer-offset",e,r),A=c(t,"polygon-color",e,r),m=c(t,"polygon-style",e,r),N=c(t,"polygon-use-stencil",e,r),U=c(t,"polygon-culling",e,r),w=c(t,"polygon-extrude",e,r);m="flatshade"==m?1:0,U="back"==U?1:0;for(var x,S,M,B,O=l.geocent,k=[0,0,0],_=[0,0,0],I=l.bboxMin,E=o.length/3,C=3*E,F=new Float32Array(3*C),z=0,P=0,j=[0,0,0],T=[0,0,0],V=[0,0,0],G=[0,0,0],X=l.tileX,D=l.tileY,R=l.forceOrigin,$=l.forceScale,q=0;q<C;q++)x=3*o[z++],j=[s[x],s[x+1],s[x+2]],R&&(j=[j[0]-X,j[1]-D,j[2]]),null!=$&&(j=[j[0]*$[0],j[1]*$[1],j[2]*$[2]]),w&&(O?(u([j[0]+I[0],j[1]+I[1],j[2]+I[2]],_),j[0]+=_[0]*w,j[1]+=_[1]*w,j[2]+=_[2]*w):j[2]+=w),k[0]+=j[0],k[1]+=j[1],k[2]+=j[2],F[P++]=j[0],F[P++]=j[1],F[P++]=j[2];if(C>0){var Y=1/C;k[0]*=Y,k[1]*=Y,k[2]*=Y}k[0]+=l.groupOrigin[0],k[1]+=l.groupOrigin[1],k[2]+=l.groupOrigin[2];var H=e.borders||[];if(H.length>0){var J=0;for(q=0,S=H.length;q<S;q++){var W=H[q];J+=2*(W.length+1)}var Z=F;for(F=new Float32Array(F.length+3*J*3),F.set(Z),q=0,S=H.length;q<S;q++){var K,W=H[q];for(M=0,B=W.length;M<B;M++)K=W[M]>=0?3*W[M]:3*-W[M],j[0]=s[K],j[1]=s[K+1],j[2]=s[K+2],V[0]=s[K],V[1]=s[K+1],V[2]=s[K+2],K=M<B-1?W[M+1]>=0?3*W[M+1]:3*-W[M+1]:W[0]>=0?3*W[0]:3*-W[0],T[0]=s[K],T[1]=s[K+1],T[2]=s[K+2],G[0]=s[K],G[1]=s[K+1],G[2]=s[K+2],R&&(j=[j[0]-X,j[1]-D,j[2]],T=[T[0]-X,T[1]-D,T[2]],V=[V[0]-X,V[1]-D,V[2]],G=[G[0]-X,G[1]-D,G[2]]),null!=$&&(j=[j[0]*$[0],j[1]*$[1],j[2]*$[2]],T=[T[0]*$[0],T[1]*$[1],T[2]*$[2]],V=[V[0]*$[0],V[1]*$[1],V[2]*$[2]],G=[G[0]*$[0],G[1]*$[1],G[2]*$[2]]),w&&(O?(u([j[0]+I[0],j[1]+I[1],j[2]+I[2]],_),j=[j[0]+_[0]*w,j[1]+_[1]*w,j[2]+_[2]*w],u([T[0]+I[0],T[1]+I[1],T[2]+I[2]],_),T=[T[0]+_[0]*w,T[1]+_[1]*w,T[2]+_[2]*w]):(j[2]+=w,T[2]+=w)),F[P]=G[0],F[P+1]=G[1],F[P+2]=G[2],F[P+3]=T[0],F[P+4]=T[1],F[P+5]=T[2],F[P+6]=j[0],F[P+7]=j[1],F[P+8]=j[2],F[P+9]=j[0],F[P+10]=j[1],F[P+11]=j[2],F[P+12]=V[0],F[P+13]=V[1],F[P+14]=V[2],F[P+15]=G[0],F[P+16]=G[1],F[P+17]=G[2],P+=18}}var Q=v||d||b||p,ee=JSON.stringify({style:m,culling:U,stencil:N,color:A,zIndex:a,zOffset:L,state:l.hitState});f(5,13,{color:A,"z-index":a,center:k,advancedHit:y,culling:U,"hover-event":v,"click-event":d,"draw-event":h,style:m,stencil:N,hitable:Q,state:l.hitState,eventInfo:l.alwaysEventInfo||Q||h?i:{},"enter-event":b,"leave-event":p,"zbuffer-offset":L,lod:l.autoLod?null:l.tileLod},[F],ee)}}}},b=function(e){var r={};for(var t in e)"surface"!=t&&"vertices"!=t&&"borders"!=t&&(r[t]=e[t]);return r},g=function(e,r,t,n,a,i,s,o){var f=e.borders||[];if(0!=f.length){for(var h,g,p=c(n,"polygon-extrude",e,t),y=b(e),L=f.length,A=[],m=[],N=[0,0,0],U=l.tileX,w=l.tileY,x=l.forceOrigin,S=l.forceScale,M=[1/S[0],1/S[1],1/S[2]],B=l.geocent,O=l.bboxMin,k=0;k<L;k++){var _,I=f[k],E=I.length,C=0;if(E>0){var F,z,P,j;for(o?(F=new Array(E+1),z=new Array(E+1)):(F=new Array(E),z=new Array(E)),j=0;j<E;j++)I[j]>=0?(_=3*I[j],C++):_=3*-I[j],p?(h=[r[_],r[_+1],r[_+2]],g=h.slice(),x&&(g=[g[0]-U,g[1]-w,g[2]]),null!=S&&(g=[g[0]*S[0],g[1]*S[1],g[2]*S[2]]),B?(u([g[0]+O[0],g[1]+O[1],g[2]+O[2]],N),g=[h[0]+N[0]*p*M[0],h[1]+N[1]*p*M[1],h[2]+N[2]*p*M[2]]):g[2]+=p,F[j]=h,z[j]=g,I[j]>=0&&A.push([h,g])):F[j]=[r[_],r[_+1],r[_+2]],o&&0==j&&(F[E]=F[0],z[E]=z[0]);var T=new Array(C),P=new Array(C),V=0;for(j=0;j<E;j++)I[j]>=0&&(T[V]=F[j].slice(),p&&(P[V]=z[j].slice()),V++);A.push(F),m=m.concat(T),p&&(A.push(z),m=m.concat(P))}}o&&A.length>0?(y.lines=A,v(y,t,n,a,i,s)):m.length>0&&(y.points=m,d(y,t,n,a,i,s))}}},function(e,r,t){"use strict";function n(e){return 0!=(1&e)}function a(e){return 0==(1&e)}function i(e,r,t){for(var n=r,a=e.length;n<a;++n)if(e[n]!==t)return n;return n}function s(e,r,t,n){for(var a=r;a<t;++a)e[a]=n}function o(e,r,t,n){for(var a=t,i=n-1;a<i;++a,--i){var s=e[a];e[a]=e[i],e[i]=s,s=r[a],r[a]=r[i],r[i]=s}}function l(e,r,t){return{str:e,indices:h,types:d,dir:t?"ttb":r?"ltr":"rtl"}}function u(e,r,t){var u=!0,b=e.length;if(0===b||t)return l(e,u,t);v.length=b,d.length=b;var g,p,y=0;for(g=0;g<b;++g){v[g]=e.charAt(g),h[g]=g;var L=e.charCodeAt(g),A="L";L<=255?A=c[L]:1424<=L&&L<=1524?A="R":1536<=L&&L<=1791?A=f[255&L]:1792<=L&&L<=2220&&(A="AL"),"R"!==A&&"AL"!==A&&"AN"!==A||y++,d[g]=A}if(0===y)return u=!0,l(e,u);-1===r&&(y/b<.3?(u=!0,r=0):(u=!1,r=1));var m=[];for(g=0;g<b;++g)m[g]=r;var N=n(r)?"R":"L",U=N,w=U,x=U;for(g=0;g<b;++g)"NSM"===d[g]?d[g]=x:x=d[g];x=U;var S;for(g=0;g<b;++g)S=d[g],"EN"===S?d[g]="AL"===x?"AN":"EN":"R"!==S&&"L"!==S&&"AL"!==S||(x=S);for(g=0;g<b;++g)"AL"===(S=d[g])&&(d[g]="R");for(g=1;g<b-1;++g)"ES"===d[g]&&"EN"===d[g-1]&&"EN"===d[g+1]&&(d[g]="EN"),"CS"!==d[g]||"EN"!==d[g-1]&&"AN"!==d[g-1]||d[g+1]!==d[g-1]||(d[g]=d[g-1]);for(g=0;g<b;++g)if("EN"===d[g]){var M;for(M=g-1;M>=0&&"ET"===d[M];--M)d[M]="EN";for(M=g+1;M<b&&"ET"===d[M];++M)d[M]="EN"}for(g=0;g<b;++g)"WS"!==(S=d[g])&&"ES"!==S&&"ET"!==S&&"CS"!==S||(d[g]="ON");for(x=U,g=0;g<b;++g)S=d[g],"EN"===S?d[g]="L"===x?"L":"EN":"R"!==S&&"L"!==S||(x=S);for(g=0;g<b;++g)if("ON"===d[g]){var B=i(d,g+1,"ON"),O=U;g>0&&(O=d[g-1]);var k=w;B+1<b&&(k=d[B+1]),"L"!==O&&(O="R"),"L"!==k&&(k="R"),O===k&&s(d,g,B,O),g=B-1}for(g=0;g<b;++g)"ON"===d[g]&&(d[g]=N);for(g=0;g<b;++g)S=d[g],a(m[g])?"R"===S?m[g]+=1:"AN"!==S&&"EN"!==S||(m[g]+=2):"L"!==S&&"AN"!==S&&"EN"!==S||(m[g]+=1);var _,I=-1,E=99;for(g=0,p=m.length;g<p;++g)_=m[g],I<_&&(I=_),E>_&&n(_)&&(E=_);for(_=I;_>=E;--_){var C=-1;for(g=0,p=m.length;g<p;++g)m[g]<_?C>=0&&(o(v,h,C,g),C=-1):C<0&&(C=g);C>=0&&o(v,h,C,m.length)}for(g=0,p=v.length;g<p;++g){var F=v[g];"<"!==F&&">"!==F||(v[g]="")}return l(v.join(""),u)}t.d(r,"a",function(){return u});var c=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","ON","ON","ET","ET","ET","ON","ON","ON","ON","ON","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","ON","ET","ET","ET","ET","ON","ON","ON","ON","L","ON","ON","BN","ON","ON","ET","ET","EN","EN","ON","L","ON","ON","ON","EN","L","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L"],f=["AN","AN","AN","AN","AN","AN","ON","ON","AL","ET","ET","AL","CS","AL","ON","ON","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","ON","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","ON","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL"],v=[],d=[],h=[]},function(e,r,t){"use strict";var n=t(7);t.d(r,"a",function(){return i});var a=n.a,i={};i.parse=function(e){var r=i._bin,t=new Uint8Array(e),n=0;r.readFixed(t,n);n+=4;var a=r.readUshort(t,n);n+=2;r.readUshort(t,n);n+=2;r.readUshort(t,n);n+=2;r.readUshort(t,n);n+=2;for(var s=["cmap","head","hhea","maxp","hmtx","kern","GPOS","GSUB"],o={_data:t},l={},u=0,c=0;c<a;c++){var f=r.readASCII(t,n,4);n+=4;r.readUint(t,n);n+=4;var v=r.readUint(t,n);n+=4;var d=r.readUint(t,n);n+=4,l[f]={offset:v,length:d},u=v+d}for(var c=0;c<s.length;c++){var h=s[c];l[h]&&(o[h.trim()]=i[h.trim()].parse(t,l[h].offset,l[h].length,o))}o._tabs=l,i._processGlyphs(t,u,l,o);var b=o.GSUB;if(b){var g=b.lookupList,p=b.featureList;o.gsubIsolTable=[],o.gsubInitTable=[],o.gsubFinaTable=[],o.gsubMediTable=[],o.gsubRligLigaTable=[];for(var y=0;y<p.length;y++){var f=p[y].tag;switch(f){case"isol":case"init":case"fina":case"medi":for(var L=0;L<p[y].tab.length;L++){var A=g[p[y].tab[L]];if(1==A.ltype)switch(f){case"isol":o.gsubIsolTable.push(A.tabs);break;case"init":o.gsubInitTable.push(A.tabs);break;case"fina":o.gsubFinaTable.push(A.tabs);break;case"medi":o.gsubMediTable.push(A.tabs)}}break;case"rlig":case"liga":for(var L=0;L<p[y].tab.length;L++){var A=g[p[y].tab[L]];4==A.ltype&&o.gsubRligLigaTable.push(A.tabs)}}}}return o},i._processGlyphs=function(e,r,t,n){var a=e[r];r+=1;var s=e[r]<<8|e[r+1];r+=2;var o=e[r]<<8|e[r+1];r+=2;var l=e[r];r+=1;var u=e[r];r+=1,n.version=a,n.textureLX=s,n.textureLY=o,n.size=l,n.cly=1.5*l,n.flags=u;var c=new Array(n.maxp.numGlyphs),f=1/s,v=1/o,d=s>256?7:6,h=r+n.maxp.numGlyphs*d,b=e[h]<<8|e[h+1],g=new Array(b);h+=2;for(var p=0,y=b;p<y;p++)g[p]=e[h+2*p]<<8|e[h+2*p+1];var L=0;for(p=0,y=n.maxp.numGlyphs;p<y;p++)p==g[L]&&L++,c[p]=i._processGlyph(e,r,f,v,s,n,p,L),r+=d;n.glyphs=c},i._processGlyph=function(e,r,t,n,a,i,s,o){var l=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],u=l>>22&63,c=l>>16&63,f=(l>>9&63)*(l>>15&1?-1:1),v=-(l>>2&63)*(l>>8&1?-1:1),d=(3&l)+4*o;l=a>256?e[r+4]<<16|e[r+5]<<8|e[r+6]:e[r+4]<<8|e[r+5];var h,b,g=i.size/.75/i.head.unitsPerEm*.75,p=i.hmtx.aWidth[s]*g;switch(a){case 2048:h=l>>11&2047,b=2047&l;break;case 1024:h=l>>10&1023,b=1023&l;break;case 512:h=l>>9&511,b=511&l;break;default:h=l>>8&255,b=255&l}return{u1:h*t,v1:b*n+d,u2:(h+u)*t,v2:(b+c)*n+d,lx:u,ly:c,sx:f,sy:v,step:p,plane:d}},i._tabOffset=function(e,r){for(var t=i._bin,n=t.readUshort(e,4),a=12,s=0;s<n;s++){var o=t.readASCII(e,a,4);a+=4;t.readUint(e,a);a+=4;var l=t.readUint(e,a);a+=4;t.readUint(e,a);if(a+=4,o==r)return l}return 0},i._bin={readFixed:function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<8|e[r+3])/65540},readF2dot14:function(e,r){var t=i._bin.readShort(e,r);return t/16384},readInt:function(e,r){var t=i._bin.t.uint8;return t[0]=e[r+3],t[1]=e[r+2],t[2]=e[r+1],t[3]=e[r],i._bin.t.int32[0]},readInt8:function(e,r){return i._bin.t.uint8[0]=e[r],i._bin.t.int8[0]},readShort:function(e,r){var t=i._bin.t.uint8;return t[1]=e[r],t[0]=e[r+1],i._bin.t.int16[0]},readUshort:function(e,r){return e[r]<<8|e[r+1]},readUshorts:function(e,r,t){for(var n=[],a=0;a<t;a++)n.push(i._bin.readUshort(e,r+2*a));return n},readUint:function(e,r){var t=i._bin.t.uint8;return t[3]=e[r],t[2]=e[r+1],t[1]=e[r+2],t[0]=e[r+3],i._bin.t.uint32[0]},readUint64:function(e,r){return 4294967296*i._bin.readUint(e,r)+i._bin.readUint(e,r+4)},readASCII:function(e,r,t){for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[r+a]);return n},readUnicode:function(e,r,t){for(var n="",a=0;a<t;a++){var i=e[r++]<<8|e[r++];n+=String.fromCharCode(i)}return n},readBytes:function(e,r,t){for(var n=[],a=0;a<t;a++)n.push(e[r+a]);return n},readASCIIArray:function(e,r,t){for(var n=[],a=0;a<t;a++)n.push(String.fromCharCode(e[r+a]));return n}},i._bin.t={buff:new ArrayBuffer(8)},i._bin.t.int8=new Int8Array(i._bin.t.buff),i._bin.t.uint8=new Uint8Array(i._bin.t.buff),i._bin.t.int16=new Int16Array(i._bin.t.buff),i._bin.t.uint16=new Uint16Array(i._bin.t.buff),i._bin.t.int32=new Int32Array(i._bin.t.buff),i._bin.t.uint32=new Uint32Array(i._bin.t.buff),i._lctf={},i._lctf.parse=function(e,r,t,n,a){var s=i._bin,o={},l=r;s.readFixed(e,r);r+=4;var u=s.readUshort(e,r);r+=2;var c=s.readUshort(e,r);r+=2;var f=s.readUshort(e,r);return r+=2,o.scriptList=i._lctf.readScriptList(e,l+u),o.featureList=i._lctf.readFeatureList(e,l+c),o.lookupList=i._lctf.readLookupList(e,l+f,a),o},i._lctf.readLookupList=function(e,r,t){var n=i._bin,a=r,s=[],o=n.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=n.readUshort(e,r);r+=2;var c=i._lctf.readLookupTable(e,a+u,t);s.push(c)}return s},i._lctf.readLookupTable=function(e,r,t){var n=i._bin,a=r,s={tabs:[]};s.ltype=n.readUshort(e,r),r+=2,s.flag=n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=n.readUshort(e,r);r+=2;var c=t(e,s.ltype,a+u);s.tabs.push(c)}return s},i._lctf.numOfOnes=function(e){for(var r=0,t=0;t<32;t++)0!=(e>>>t&1)&&r++;return r},i._lctf.readClassDef=function(e,r){var t=i._bin,n={start:[],end:[],class:[]},a=t.readUshort(e,r);if(r+=2,1==a){var s=t.readUshort(e,r);r+=2;var o=t.readUshort(e,r);r+=2;for(var l=0;l<o;l++)n.start.push(s+l),n.end.push(s+l),n.class.push(t.readUshort(e,r)),r+=2}if(2==a){var u=t.readUshort(e,r);r+=2;for(var l=0;l<u;l++)n.start.push(t.readUshort(e,r)),r+=2,n.end.push(t.readUshort(e,r)),r+=2,n.class.push(t.readUshort(e,r)),r+=2}return n},i._lctf.readValueRecord=function(e,r,t){var n=i._bin,a=[];return a.push(1&t?n.readShort(e,r):0),r+=1&t?2:0,a.push(2&t?n.readShort(e,r):0),r+=2&t?2:0,a.push(4&t?n.readShort(e,r):0),r+=4&t?2:0,a.push(8&t?n.readShort(e,r):0),r+=8&t?2:0,a},i._lctf.readCoverage=function(e,r){var t=i._bin,n={};n.fmt=t.readUshort(e,r),r+=2;var a=t.readUshort(e,r);r+=2,1==n.fmt&&(n.tab=t.readUshorts(e,r,a)),2==n.fmt&&(n.tab=t.readUshorts(e,r,3*a));var s=Number.POSITIVE_INFINITY,o=0,l=n.tab;if(1==n.fmt)for(var u=0;u<l.length;u++){var c=l[u];c>o&&(o=c),c<s&&(s=c)}if(2==n.fmt)for(var u=0;u<l.length;u+=3){var f=l[u],v=l[u+1];f>o&&(o=f),f<s&&(s=f),v>o&&(o=v),v<s&&(s=v)}return n.min=s,n.max=o,n},i._lctf.coverageIndex=function(e,r){if(r<e.min||r>e.max)return-1;var t=e.tab;if(1==e.fmt)return t.indexOf(r);for(var n=0;n<t.length;n+=3){var a=t[n],i=t[n+1],s=t[n+2];if(a<=r&&r<=i)return s+(r-a)}return-1},i._lctf.readFeatureList=function(e,r){var t=i._bin,n=r,a=[],s=t.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=t.readASCII(e,r,4);r+=4;var u=t.readUshort(e,r);r+=2,a.push({tag:l.trim(),tab:i._lctf.readFeatureTable(e,n+u)})}return a},i._lctf.readFeatureTable=function(e,r){var t=i._bin;t.readUshort(e,r);r+=2;var n=t.readUshort(e,r);r+=2;for(var a=[],s=0;s<n;s++)a.push(t.readUshort(e,r+2*s));return a},i._lctf.readScriptList=function(e,r){var t=i._bin,n=r,a={},s=t.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=t.readASCII(e,r,4);r+=4;var u=t.readUshort(e,r);r+=2,a[l.trim()]=i._lctf.readScriptTable(e,n+u)}return a},i._lctf.readScriptTable=function(e,r){var t=i._bin,n=r,a={},s=t.readUshort(e,r);r+=2,a.default=i._lctf.readLangSysTable(e,n+s);var o=t.readUshort(e,r);r+=2;for(var l=0;l<o;l++){var u=t.readASCII(e,r,4);r+=4;var c=t.readUshort(e,r);r+=2,a[u.trim()]=i._lctf.readLangSysTable(e,n+c)}return a},i._lctf.readLangSysTable=function(e,r){var t=i._bin,n={};t.readUshort(e,r);r+=2,n.reqFeature=t.readUshort(e,r),r+=2;var a=t.readUshort(e,r);return r+=2,n.features=t.readUshorts(e,r,a),n},i.cmap={},i.cmap.parse=function(e,r,t){e=new Uint8Array(e.buffer,r,t),r=0;var n=i._bin,a={};n.readUshort(e,r);r+=2;var s=n.readUshort(e,r);r+=2;var o=[];a.tables=[];for(var l=0;l<s;l++){var u=n.readUshort(e,r);r+=2;var c=n.readUshort(e,r);r+=2;var f=n.readUint(e,r);r+=4;var v="p"+u+"e"+c,d=o.indexOf(f);if(-1==d){d=a.tables.length;var h;o.push(f);var b=n.readUshort(e,f);0==b?h=i.cmap.parse0(e,f):4==b?h=i.cmap.parse4(e,f):6==b?h=i.cmap.parse6(e,f):12==b?h=i.cmap.parse12(e,f):console.log("unknown format: "+b,u,c,f),a.tables.push(h)}if(null!=a[v])throw"multiple tables for one platform+encoding";a[v]=d}return a},i.cmap.parse0=function(e,r){var t=i._bin,n={};n.format=t.readUshort(e,r),r+=2;var a=t.readUshort(e,r);r+=2;t.readUshort(e,r);r+=2,n.map=[];for(var s=0;s<a-6;s++)n.map.push(e[r+s]);return n},i.cmap.parse4=function(e,r){var t=i._bin,n=r,a={};a.format=t.readUshort(e,r),r+=2;var s=t.readUshort(e,r);r+=2;t.readUshort(e,r);r+=2;var o=t.readUshort(e,r);r+=2;var l=o/2;a.searchRange=t.readUshort(e,r),r+=2,a.entrySelector=t.readUshort(e,r),r+=2,a.rangeShift=t.readUshort(e,r),r+=2,a.endCount=t.readUshorts(e,r,l),r+=2*l,r+=2,a.startCount=t.readUshorts(e,r,l),r+=2*l,a.idDelta=[];for(var u=0;u<l;u++)a.idDelta.push(t.readShort(e,r)),r+=2;for(a.idRangeOffset=t.readUshorts(e,r,l),r+=2*l,a.glyphIdArray=[];r<n+s;)a.glyphIdArray.push(t.readUshort(e,r)),r+=2;return a},i.cmap.parse6=function(e,r){var t=i._bin,n={};n.format=t.readUshort(e,r),r+=2;t.readUshort(e,r);r+=2;t.readUshort(e,r);r+=2,n.firstCode=t.readUshort(e,r),r+=2;var a=t.readUshort(e,r);r+=2,n.glyphIdArray=[];for(var s=0;s<a;s++)n.glyphIdArray.push(t.readUshort(e,r)),r+=2;return n},i.cmap.parse12=function(e,r){var t=i._bin,n={};n.format=t.readUshort(e,r),r+=2,r+=2;t.readUint(e,r);r+=4;t.readUint(e,r);r+=4;var a=t.readUint(e,r);r+=4,n.groups=[];for(var s=0;s<a;s++){var o=r+12*s,l=t.readUint(e,o+0),u=t.readUint(e,o+4),c=t.readUint(e,o+8);n.groups.push([l,u,c])}return n},i.GPOS={},i.GPOS.parse=function(e,r,t,n){return i._lctf.parse(e,r,t,n,i.GPOS.subt)},i.GPOS.subt=function(e,r,t){if(2!=r)return null;var n=i._bin,a=t,s={};s.format=n.readUshort(e,t),t+=2;var o=n.readUshort(e,t);t+=2,s.coverage=i._lctf.readCoverage(e,o+a),s.valFmt1=n.readUshort(e,t),t+=2,s.valFmt2=n.readUshort(e,t),t+=2;var l=i._lctf.numOfOnes(s.valFmt1),u=i._lctf.numOfOnes(s.valFmt2);if(1==s.format){s.pairsets=[];var c=n.readUshort(e,t);t+=2;for(var f=0;f<c;f++){var v=n.readUshort(e,t);t+=2,v+=a;var d=n.readUshort(e,v);v+=2;for(var h=[],b=0;b<d;b++){var g=n.readUshort(e,v);v+=2;var p,y;0!=s.valFmt1&&(p=i._lctf.readValueRecord(e,v,s.valFmt1),v+=2*l),0!=s.valFmt2&&(y=i._lctf.readValueRecord(e,v,s.valFmt2),v+=2*u),h.push({gid2:g,val1:p,val2:y})}s.pairsets.push(h)}}if(2==s.format){var L=n.readUshort(e,t);t+=2;var A=n.readUshort(e,t);t+=2;var m=n.readUshort(e,t);t+=2;var N=n.readUshort(e,t);t+=2,s.classDef1=i._lctf.readClassDef(e,a+L),s.classDef2=i._lctf.readClassDef(e,a+A),s.matrix=[];for(var f=0;f<m;f++){for(var U=[],b=0;b<N;b++){var p=null,y=null;0!=s.valFmt1&&(p=i._lctf.readValueRecord(e,t,s.valFmt1),t+=2*l),0!=s.valFmt2&&(y=i._lctf.readValueRecord(e,t,s.valFmt2),t+=2*u),U.push({val1:p,val2:y})}s.matrix.push(U)}}return s},i.GSUB={},i.GSUB.parse=function(e,r,t,n){return i._lctf.parse(e,r,t,n,i.GSUB.subt)},i.GSUB.subt=function(e,r,t){var n=i._bin,a=t,s={};if(1!=r&&4!=r)return null;s.fmt=n.readUshort(e,t),t+=2;var o=n.readUshort(e,t);if(t+=2,s.coverage=i._lctf.readCoverage(e,o+a),1==r){if(1==s.fmt)s.delta=n.readShort(e,t),t+=2;else if(2==s.fmt){var l=n.readUshort(e,t);t+=2,s.newg=n.readUshorts(e,t,l),t+=2*s.newg.length}}else if(4==r){s.vals=[];var l=n.readUshort(e,t);t+=2;for(var u=0;u<l;u++){var c=n.readUshort(e,t);t+=2,s.vals.push(i.GSUB.readLigatureSet(e,a+c))}}return s},i.GSUB.readChainSubClassSet=function(e,r){var t=i._bin,n=r,a=[],s=t.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=t.readUshort(e,r);r+=2,a.push(i.GSUB.readChainSubClassRule(e,n+l))}return a},i.GSUB.readChainSubClassRule=function(e,r){for(var t=i._bin,n={},a=["backtrack","input","lookahead"],s=0;s<a.length;s++){var o=t.readUshort(e,r);r+=2,1==s&&o--,n[a[s]]=t.readUshorts(e,r,o),r+=2*n[a[s]].length}var o=t.readUshort(e,r);return r+=2,n.subst=t.readUshorts(e,r,2*o),r+=2*n.subst.length,n},i.GSUB.readLigatureSet=function(e,r){var t=i._bin,n=r,a=[],s=t.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=t.readUshort(e,r);r+=2,a.push(i.GSUB.readLigature(e,n+l))}return a},i.GSUB.readLigature=function(e,r){var t=i._bin,n={chain:[]};n.nglyph=t.readUshort(e,r),r+=2;var a=t.readUshort(e,r);r+=2;for(var s=0;s<a-1;s++)n.chain.push(t.readUshort(e,r)),r+=2;return n},i.head={},i.head.parse=function(e,r,t){var n=i._bin,a={};n.readFixed(e,r);r+=4,a.fontRevision=n.readFixed(e,r),r+=4;n.readUint(e,r);r+=4;n.readUint(e,r);return r+=4,a.flags=n.readUshort(e,r),r+=2,a.unitsPerEm=n.readUshort(e,r),r+=2,a.created=n.readUint64(e,r),r+=8,a.modified=n.readUint64(e,r),r+=8,a.xMin=n.readShort(e,r),r+=2,a.yMin=n.readShort(e,r),r+=2,a.xMax=n.readShort(e,r),r+=2,a.yMax=n.readShort(e,r),r+=2,a.macStyle=n.readUshort(e,r),r+=2,a.lowestRecPPEM=n.readUshort(e,r),r+=2,a.fontDirectionHint=n.readShort(e,r),r+=2,a.indexToLocFormat=n.readShort(e,r),r+=2,a.glyphDataFormat=n.readShort(e,r),r+=2,a},i.hhea={},i.hhea.parse=function(e,r,t){var n=i._bin,a={};n.readFixed(e,r);return r+=4,a.ascender=n.readShort(e,r),r+=2,a.descender=n.readShort(e,r),r+=2,a.lineGap=n.readShort(e,r),r+=2,a.advanceWidthMax=n.readUshort(e,r),r+=2,a.minLeftSideBearing=n.readShort(e,r),r+=2,a.minRightSideBearing=n.readShort(e,r),r+=2,a.xMaxExtent=n.readShort(e,r),r+=2,a.caretSlopeRise=n.readShort(e,r),r+=2,a.caretSlopeRun=n.readShort(e,r),r+=2,a.caretOffset=n.readShort(e,r),r+=2,r+=8,a.metricDataFormat=n.readShort(e,r),r+=2,a.numberOfHMetrics=n.readUshort(e,r),r+=2,a},i.hmtx={},i.hmtx.parse=function(e,r,t,n){var a=i._bin,s={};s.aWidth=[],s.lsBearing=[];for(var o=0,l=0,u=0;u<n.maxp.numGlyphs;u++)u<n.hhea.numberOfHMetrics&&(o=a.readUshort(e,r),r+=2,l=a.readShort(e,r),r+=2),s.aWidth.push(o),s.lsBearing.push(l);return s},i.kern={},i.kern.parse=function(e,r,t,n){var a=i._bin,s=a.readUshort(e,r);if(r+=2,1==s)return i.kern.parseV1(e,r-2,t,n);var o=a.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},u=0;u<o;u++){r+=2;var t=a.readUshort(e,r);r+=2;var c=a.readUshort(e,r);r+=2;var f=c>>>8;if(0!=(f&=15))throw"unknown kern table format: "+f;r=i.kern.readFormat0(e,r,l)}return l},i.kern.parseV1=function(e,r,t,n){var a=i._bin;a.readFixed(e,r);r+=4;var s=a.readUint(e,r);r+=4;for(var o={glyph1:[],rval:[]},l=0;l<s;l++){a.readUint(e,r);r+=4;var u=a.readUshort(e,r);r+=2;a.readUshort(e,r);r+=2;var c=u>>>8;if(0!=(c&=15))throw"unknown kern table format: "+c;r=i.kern.readFormat0(e,r,o)}return o},i.kern.readFormat0=function(e,r,t){var n=i._bin,a=-1,s=n.readUshort(e,r);r+=2;n.readUshort(e,r);r+=2;n.readUshort(e,r);r+=2;n.readUshort(e,r);r+=2;for(var o=0;o<s;o++){var l=n.readUshort(e,r);r+=2;var u=n.readUshort(e,r);r+=2;var c=n.readShort(e,r);r+=2,l!=a&&(t.glyph1.push(l),t.rval.push({glyph2:[],vals:[]}));var f=t.rval[t.rval.length-1];f.glyph2.push(u),f.vals.push(c),a=l}return r},i.maxp={},i.maxp.parse=function(e,r,t){var n=i._bin,a={},s=n.readUint(e,r);return r+=4,a.numGlyphs=n.readUshort(e,r),r+=2,65536==s&&(a.maxPoints=n.readUshort(e,r),r+=2,a.maxContours=n.readUshort(e,r),r+=2,a.maxCompositePoints=n.readUshort(e,r),r+=2,a.maxCompositeContours=n.readUshort(e,r),r+=2,a.maxZones=n.readUshort(e,r),r+=2,a.maxTwilightPoints=n.readUshort(e,r),r+=2,a.maxStorage=n.readUshort(e,r),r+=2,a.maxFunctionDefs=n.readUshort(e,r),r+=2,a.maxInstructionDefs=n.readUshort(e,r),r+=2,a.maxStackElements=n.readUshort(e,r),r+=2,a.maxSizeOfInstructions=n.readUshort(e,r),r+=2,a.maxComponentElements=n.readUshort(e,r),r+=2,a.maxComponentDepth=n.readUshort(e,r),r+=2),a},i.U={},i.U.codeToGlyph=function(e,r){var t=e.cmap,n=-1;if(null!=t.p0e4?n=t.p0e4:null!=t.p3e1?n=t.p3e1:null!=t.p1e0&&(n=t.p1e0),-1==n)throw"no familiar platform and encoding!";var a=t.tables[n];if(0==a.format)return r>=a.map.length?0:a.map[r];if(4==a.format){for(var i=-1,s=0;s<a.endCount.length;s++)if(r<=a.endCount[s]){i=s;break}if(-1==i)return 0;if(a.startCount[i]>r)return 0;return 65535&(0!=a.idRangeOffset[i]?a.glyphIdArray[r-a.startCount[i]+(a.idRangeOffset[i]>>1)-(a.idRangeOffset.length-i)]:r+a.idDelta[i])}if(12==a.format){if(r>a.groups[a.groups.length-1][1])return 0;for(var s=0;s<a.groups.length;s++){var o=a.groups[s];if(o[0]<=r&&r<=o[1])return o[2]+(r-o[0])}return 0}throw"unknown cmap table format "+a.format},i.U._getGlyphClass=function(e,r){for(var t=0;t<r.start.length;t++)if(r.start[t]<=e&&r.end[t]>=e)return r.class[t];return 0},i.U.getPairAdjustment=function(e,r,t){if(e.GPOS){for(var n=null,a=0;a<e.GPOS.featureList.length;a++){var s=e.GPOS.featureList[a];if("kern"==s.tag)for(var o=0;o<s.tab.length;o++)2==e.GPOS.lookupList[s.tab[o]].ltype&&(n=e.GPOS.lookupList[s.tab[o]])}if(n)for(var a=0;a<n.tabs.length;a++){var l=n.tabs[a],u=i._lctf.coverageIndex(l.coverage,r);if(-1!=u){var c=0;if(1==l.format){for(var f=l.pairsets[u],o=0;o<f.length;o++)f[o].gid2==t&&(c=f[o]);if(null==c)continue}else if(2==l.format){var v=i.U._getGlyphClass(r,l.classDef1),d=i.U._getGlyphClass(t,l.classDef2);c=l.matrix[v][d]}return c.val1[2]}}}if(e.kern){var h=e.kern.glyph1.indexOf(r);if(-1!=h){var b=e.kern.rval[h].glyph2.indexOf(t);if(-1!=b)return e.kern.rval[h].vals[b]}}return 0},i.U.RTable=[1570,1571,1572,1573,1575,1577,1583,1584,1585,1586,1608,1649,1650,1651,1653,1654,1655,1672,1673,1674,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1728,1731,1732,1733,1734,1735,1736,1737,1738,1739,1741,1743,1746,1747,1749,1774,1775,1808,1813,1814,1815,1816,1817,1822,1832,1834,1836,1839,1869,1881,1882,1883,1899,1900,1905,1907,1908,1912,1913,2112,2118,2119,2121,2132,2151,2153,2154,2218,2219,2220,2222,2225,2226,2233,2757,2759,2761,2762,2766,2767,2768,2769,2770,2781,2785,2788,2799,2945,2947,2948,2949,2953,2956,2958,2959,2961,2985,2986,2987,2988],i.U.stringToGlyphs=function(e,r){var t,n,s,o,l,u,c,f,v,d,h,b,g,p=[],y=[],L=[],A=[],m=[],N=a(r,-1,!1),U=i.U.RTable;for(n=0,s=r.length;n<s;n++)f=r.charCodeAt(n),A.push(f),m.push(0),2765==f||2775==f||43122==f?m[n]=2:1548==f?m[n]=1:f<=63?9!=f&&10!=f&&32!=f&&33!=f&&34!=f&&40!=f&&41!=f&&44!=f&&46!=f&&58!=f&&59!=f&&63!=f||(m[n]=1):f>=1570&&f<=2988&&-1!=U.indexOf(f)&&(m[n]=3);for(n=0,s=r.length;n<s;n++)f=A[n],1!=m[n]&&n<s-2&&4156==(v=A[n+1])&&(A[n]=v,A[n+1]=f,n++);for(n=0,s=r.length;n<s;n++){for(f=A[n],o=0,l=e.length;o<l&&(h=e[o],!(t=i.U.codeToGlyph(h,f)));o++);p.push(t),y.push(t?o:0)}L=A,h=null;for(var w=0;w<p.length;w++)if(g=p[w],h!=y[w]&&(h=e[y[w]],d=h.GSUB),d){var x=m[w-1],S=m[w],M=m[w+1],B=0==w||1==x,O=w==p.length-1||1==M;if(B||3!=x||(B=!0),O||3!=S||(O=!0),O||2!=M||(O=!0),B||2!=S||(B=!0),b=null,b=B?O?h.gsubIsolTable:h.gsubInitTable:O?h.gsubFinaTable:h.gsubMediTable)for(c=0;c<b.length;c++){var k=b[c];for(o=0;o<k.length;o++){var _=k[o],I=i._lctf.coverageIndex(_.coverage,g);-1!=I&&(0==_.fmt?p[w]=I+_.delta:_.newg?p[w]=_.newg[I]:(p[w]=g,console.log(w,g,"subst-error"," original:",r)))}}}h=null;for(var w=0;w<p.length;w++)if(g=p[w],h!=y[w]&&(h=e[y[w]],d=h.GSUB),d&&(b=h.gsubRligLigaTable)){var E=Math.min(3,p.length-w-1);for(c=0;c<b.length;c++){var k=b[c];for(o=0;o<k.length;o++){var _=k[o],I=i._lctf.coverageIndex(_.coverage,g);if(-1!=I){var C=_.vals[I];for(u=0;u<C.length;u++){var F=C[u],z=F.chain.length;if(!(z>E)){for(var P=!0,j=0;j<z;j++)F.chain[j]!=p[w+(1+j)]&&(P=!1);if(P){p[w]=F.nglyph;for(var j=0;j<z;j++)p[w+j+1]=-1}}}}}}}var T=N.indices,V=p.slice(),G=L.slice(),X=y.slice();for(n=0,s=p.length;n<s;n++)f=T[n],V[n]=p[f],G[n]=L[f],X[n]=y[f];return[V,X,G]}},function(e,r,t){"use strict";function n(e,r,t,n,a,i,s){switch(p.stylesheetLocals={},e){case"line-string":(U(n,"point",r,t)||U(n,"label",r,t))&&M(r,t,n,a,i,s),S(r,t,n,a,i,s);break;case"point-array":M(r,t,n,a,i,s);break;case"polygon":O(r,t,n,a,i,s)}}function a(e,r,t,n,a){var i=p.reduceParams;for(var o in p.stylesheetLayers){var l=p.stylesheetLayers[o];if("point-array"==e){var u=l["importance-source"];if((void 0===u||null===u)&&r[0]&&r[0].importance&&(u="$importance"),void 0!==u&&null!==u)switch(p.reduceMode){case"scr-count1":case"scr-count2":l.reduce=["top",100,u],l["dynamic-reduce"]=["scr-count2",i[0],i[1]];break;case"scr-count4":l["dynamic-reduce"]=["scr-count4",u];break;case"scr-count5":l["dynamic-reduce"]=["scr-count5",u];break;case"scr-count6":case"scr-count7":case"scr-count8":var c="scr-count8"==p.reduceMode?i[6]:i[5];l["dynamic-reduce"]=[p.reduceMode,u,void 0!==l["importance-weight"]?l["importance-weight"]:1],l["label-no-overlap-margin"]=[i[0]*c,i[0]*c],l["icon-no-overlap-margin"]=[i[0]*c,i[0]*c],l["label-no-overlap-factor"]=["div-by-dist",u]}}var f,v,d=l.filter,h=l.reduce;for(d&&((d=l["#filter"])||(l["#filter"]=m(l.filter),d=l["#filter"])),V=0,X=0,D=0,f=0,v=r.length;f<v;f++){var b=r[f];b.properties=b.properties||{},b.id&&(b.properties["#id"]=b.id),d&&!x(d,b,n,a,l,"filter",t,0,!0)||(h?(T[V]=b,V++):s(e,b,t,l,f))}if(h){var g=h[1],y=h[2];switch(h[0]){case"top":case"bottom":if("string"==typeof y&&"@"==y.charAt(0)&&void 0===(y=p.stylesheetConstants[y]))break;if("string"==typeof y&&"$"==y.charAt(0)||"object"==typeof y){var L="object"==typeof y;L||(y=y.substr(1)),g>V&&(g=V);var A,N="top"==h[0],U=0,w=N?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;do{var S=N?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;for(D=X,f=0,v=V;f<v;f++)b=T[f],U?A=b.tmp:(A=L?P(l,null,b,t,y,0):parseFloat(b.properties[y]),b.tmp=A),!isNaN(A)&&(N&&A>=S&&A<w||A<=S&&A>w)&&(S!=A&&(X=D),G[X]=b,X++,S=A);w=S,U++}while(U<g)}break;case"odd":case"even":for(f="odd"==h[0]?1:0,v=V;f<v;f+=2)b=T[f],G[X]=b,X++;case"every":for(g>V&&(g=V),f=0,v=V;f<v;f+=g)b=T[f],G[X]=b,X++}for(f=0,v=X;f<v;f++)b=G[f],s(e,G[f],t,l,f)}}}function i(e,r,t,a,i,s){var o,l=U(a,"next-pass",r,t);if(null!=l)for(var u=0,c=l.length;u<c;u++){var f=l[u][0];if(o=N(l[u][1],e,i),U(o,"visible",r,t)){var v=U(o,"selected-layer",r,t),d=""!=v?N(v,e,i):null,h=U(o,"selected-hover-layer",r,t),b=""!=h?N(h,e,i):null,g=U(o,"hover-layer",r,t),y=""!=g?N(g,e,i):null,L=(null!=y?256:0)|(null!=d?512:0)|(null!=b?1024:0),A=p.hitState;null!=d&&(p.hitState=2|L,n(e,r,t,d,i,f,s)),null!=b&&(p.hitState=3|L,n(e,r,t,b,i,f,s)),null!=y&&(p.hitState=1|L,n(e,r,t,y,i,f,s)),n(e,r,t,o,i,f,s),p.hitState=A}}}function s(e,r,t,a,o,l){if(U(a,"visible",r,t)){if("point-array"==e&&a["visibility-switch"]){I(5,17);var u=U(a,"z-index",r,t),c=r.properties;B(r,t,a,o,u,c);for(var f=a["visibility-switch"],v=0,d=f.length;v<d;v++){if(f[v][1]){s(e,r,t,N(f[v][1],e,o),o)}I(5,18,f[v][0])}return void I(5,19)}if(l||1!=a.pack||(p.directPoints=[],I(5,15),s(e,r,t,a,o,!0),I(5,16),!p.directPoints)){var u=U(a,"z-index",r,t);if(U(a,"export-geometry",r,t)&&void 0!==r.id&&!j[r]){switch(e){case"line-string":k(r);break;case"point-array":_(r)}j[r]=!0}var c=r.properties,h=U(a,"selected-layer",r,t),b=""!=h?N(h,e,o):null,g=U(a,"selected-hover-layer",r,t),y=""!=g?N(g,e,o):null,L=U(a,"hover-layer",r,t),A=""!=L?N(L,e,o):null,m=(null!=A?256:0)|(null!=b?512:0)|(null!=y?1024:0);null!=b&&(p.hitState=2|m,n(e,r,t,b,o,u,c),i(e,r,t,b,o,c)),null!=y&&(p.hitState=3|m,n(e,r,t,y,o,u,c),i(e,r,t,y,o,c)),null!=A&&(p.hitState=1|m,n(e,r,t,A,o,u,c),i(e,r,t,A,o,c)),p.hitState=0|m,n(e,r,t,a,o,u,c),i(e,r,t,a,o,c)}}}function o(e,r){var t=e.id||"";p.groupId=t;var n=e.bbox;if(n){var i=n[0],s=n[1];p.bboxMin=i,p.bboxMax=s;var o=[n[1][0]-n[0][0],n[1][1]-n[0][1],n[1][2]-n[0][2]],l=e.resolution||4096;p.groupOrigin=[0,0,0],p.forceScale=[o[0]/l,o[1]/l,o[2]/l],C(9,0,{id:e.id,bbox:[i,s],origin:i},[],"");var u=e.points||[];p.featureType="point",a("point-array",u,r,"point",t);var c=e.lines||[];p.featureType="line",a("line-string",c,r,"line",t);var f=e.polygons||[];p.featureType="polygon",a("polygon",f,r,"polygon",t),I(10,0),p.groupOptimize&&E()}}function l(e,r){var t,n;C(5,21,{volume:e.volume,precision:e.precision},[],"");var a=e.meshes||[];for(t=0,n=a.length;t<n;t++){C(5,23,{path:a[t]},[],a[t])}var i=e.nodes||[];for(t=0,n=i.length;t<n;t++)l(i[t],r);C(5,22,{},[],"")}function u(e,r){if("string"==typeof e)try{var t=JSON.parse(e)}catch(e){t=null}else t=e;if(t){for(var n=t.groups||[],a=0,i=n.length;a<i;a++)o(n[a],r);for(var s=t.nodes||[],a=0,i=s.length;a<i;a++)C(9,0,{},[],""),l(s[a],r),I(10,0)}}Object.defineProperty(r,"__esModule",{value:!0});var c=t(0),f=t(3),v=t(2),d=t(5),h=t(4),b=t(6),g=t(1),p=c.a,y=f.a,L=(c.b,c.c),A=f.b,m=v.a,N=v.b,U=v.c,w=v.d,x=v.e,S=d.a,M=h.a,B=h.b,O=b.a,k=d.b,_=h.c,I=g.a,E=g.b,C=g.c,F=g.d,z=g.e,P=v.f,j=[],T=new Array(1024),V=0,G=new Array(1024),X=0,D=0;self.onmessage=function(e){var r=e.data,t=r.command,n=r.data,a=null,i=!1;switch(t){case"config":p.config=n;break;case"setStylesheet":n&&(p.geocent=n.geocent,p.metricUnits=n.metric,p.reduceMode=n.reduceMode,p.reduceParams=n.reduceParams,p.log=n.log,p.language=n.language,w(n.data));break;case"setFont":y(n);break;case"setFontMap":A(n),postMessage({command:"styleDone"}),postMessage({command:"ready"});break;case"processGeodataRaw":if(a=n,n.length>2){var s=new DataView(n),o="";o+=String.fromCharCode(s.getUint8(0,!0)),o+=String.fromCharCode(s.getUint8(1,!0)),"GE"!=o&&(i=!0)}n=L(n);case"processGeodata":p.tileLod=r.lod||0,p.tileIX=r.ix||0,p.tileIY=r.iy||0,p.tileSize=r.tileSize||1,p.pixelSize=r.pixelSize||1,p.pixelFactor=r.dpr||1,p.invPixelFactor=1/p.pixelFactor,p.pixelsPerMM=p.pixelFactor/96/2.54,p.invPixelsPerMM=1/p.pixelsPerMM,j=[],i?processGeodata2(s,p.tileLod):(n=JSON.parse(n),u(n,p.tileLod)),I(7,0),p.groupOptimize&&E(),a?F({command:"ready",geodata:a},[a]):F({command:"ready"}),p.config.mapPackLoaderEvents&&z()}}}]);',null)}},function(e,t,i){e.exports=function(){return i(47)('/*! Copyright (c) 2017 Melown Technologies SE\n *  For terms of use, see accompanying 67d9ba12f3d972ffe101.worker.js.LICENSE file.\n *  For 3rd party libraries licenses, see 3rdpartylicenses.txt.\n */\n!function(e){function n(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var a={};n.m=e,n.c=a,n.i=function(e){return e},n.d=function(e,a,t){n.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:t})},n.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(a,"a",a),a},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=2)}([function(e,n,a){"use strict";a.d(n,"a",function(){return t});var t={}},function(e,n,a){"use strict";function t(e){var n,a,t,i={},s=e.data,l="";if(s.length<2)return!1;if(l+=String.fromCharCode(s.getUint8(e.index,!0)),e.index+=1,l+=String.fromCharCode(s.getUint8(e.index,!0)),e.index+=1,"ME"!=l)return!1;if(i.version=s.getUint16(e.index,!0),e.index+=2,i.version>3)return!1;e.uint8Data=new Uint8Array(e.data.buffer),i.meanUndulation=s.getFloat64(e.index,!0),e.index+=8,i.numSubmeshes=s.getUint16(e.index,!0),e.index+=2,i.submeshes=[],i.gpuSize=0,i.faces=0,i.size=0;c.config.map16bitMeshes;for(n=0,a=i.numSubmeshes;n<a;n++){var t=r(i,e);t.valid&&(i.submeshes.push(t),i.size+=t.size,i.faces+=t.faces,i.gpuSize+=t.size)}i.numSubmeshes=i.submeshes.length;var o=[],f=[];for(n=0,a=i.numSubmeshes;n<a;n++)t=i.submeshes[n],o.push({bboxMax:t.bboxMax,bboxMin:t.bboxMin,externalUVs:t.externalUVs?t.externalUVs.buffer:null,faces:t.faces,flags:t.flags,gpuSize:t.gpuSize,indices:t.indices?t.indices.buffer:null,internalUVs:t.internalUVs?t.internalUVs.buffer:null,size:t.size,surfaceReference:t.surfaceReference,textureLayer:t.textureLayer,textureLayer2:t.textureLayer2,vertices:t.vertices.buffer}),t.externalUVs&&f.push(t.externalUVs.buffer),t.internalUVs&&f.push(t.internalUVs.buffer),t.vertices&&f.push(t.vertices.buffer),t.indices&&f.push(t.indices.buffer);return{mesh:{faces:i.faces,gpuSize:i.gpuSize,meanUndulation:i.meanUndulation,numSubmeshes:i.numSubmeshes,size:i.size,submeshes:i.submeshes,version:i.version},transferables:f}}function r(e,n){var a={valid:!0};return i(e,a,n),e.version>=3?f(e,a,n):s(e,a,n),a}function i(e,n,a){var t=a.data;n.flags=t.getUint8(a.index,!0),a.index+=1,e.version>1?(n.surfaceReference=t.getUint8(a.index,!0),a.index+=1):n.surfaceReference=0,n.textureLayer=t.getUint16(a.index,!0),a.index+=2,n.textureLayer2=n.textureLayer;var r=[],i=[];r[0]=t.getFloat64(a.index,!0),a.index+=8,r[1]=t.getFloat64(a.index,!0),a.index+=8,r[2]=t.getFloat64(a.index,!0),a.index+=8,i[0]=t.getFloat64(a.index,!0),a.index+=8,i[1]=t.getFloat64(a.index,!0),a.index+=8,i[2]=t.getFloat64(a.index,!0),a.index+=8,n.bboxMin=r,n.bboxMax=i}function s(e,n,a){var t=a.data,r=a.index,i=a.uint8Data,s=c.config.map16bitMeshes,l=t.getUint16(r,!0);r+=2,l||(n.valid=!1);var o,f,u,x=null,m=null,b=c.config.mapOnlyOneUVs&&n.flags&d,U=s?new Uint16Array(3*l):new Float32Array(3*l);n.flags&g&&(m=!!b||(s?new Uint16Array(2*l):new Float32Array(2*l)));var v,h,y=s?1:1/65535,p=0,w=0;for(v=0;v<l;v++)U[p]=(i[r]+(i[r+1]<<8))*y,U[p+1]=(i[r+2]+(i[r+3]<<8))*y,U[p+2]=(i[r+4]+(i[r+5]<<8))*y,p+=3,m?(b||(m[w]=(i[r+6]+(i[r+7]<<8))*y,m[w+1]=(65535-(i[r+8]+(i[r+9]<<8)))*y,w+=2),r+=10):r+=6;if(o=U,f=m,n.flags&d){var A=t.getUint16(r,!0);for(r+=2,x=s?new Uint16Array(2*A):new Float32Array(2*A),v=0,h=2*A;v<h;v+=2)x[v]=(i[r]+(i[r+1]<<8))*y,x[v+1]=(65535-(i[r+2]+(i[r+3]<<8)))*y,r+=4;u=x}var V=t.getUint16(r,!0);r+=2;var z=null;x=null,m=null;var F=c.config.mapIndexBuffers&&c.config.mapOnlyOneUVs&&!(n.flags&d),M=c.config.mapIndexBuffers&&c.config.mapOnlyOneUVs&&n.flags&d,L=F||M;L?z=new Uint16Array(3*V):(U=s?new Uint16Array(3*V*3):new Float32Array(3*V*3),n.flags&d&&(x=s?new Uint16Array(3*V*2):new Float32Array(3*V*2)),!b&&n.flags&g&&(m=s?new Uint16Array(3*V*2):new Float32Array(3*V*2)));var O,S,k,C,R,B,I,P=o,D=f,_=u;for(F&&(U=o,m=f),M&&(U=s?new Uint16Array(_.length/2*3):new Float32Array(_.length/2*3),x=u),v=0;v<V;v++)O=i[r]+(i[r+1]<<8),S=i[r+2]+(i[r+3]<<8),k=i[r+4]+(i[r+5]<<8),L?(p=3*v,null!=x?(C=i[r+6]+(i[r+7]<<8),R=i[r+8]+(i[r+9]<<8),B=i[r+10]+(i[r+11]<<8),U[3*C]=P[3*O],U[3*C+1]=P[3*O+1],U[3*C+2]=P[3*O+2],U[3*R]=P[3*S],U[3*R+1]=P[3*S+1],U[3*R+2]=P[3*S+2],U[3*B]=P[3*k],U[3*B+1]=P[3*k+1],U[3*B+2]=P[3*k+2],z[p]=C,z[p+1]=R,z[p+2]=B,r+=12):(z[p]=O,z[p+1]=S,z[p+2]=k,r+=6)):(p=9*v,I=3*O,U[p]=P[I],U[p+1]=P[I+1],U[p+2]=P[I+2],I=3*S,U[p+3]=P[I],U[p+4]=P[I+1],U[p+5]=P[I+2],I=3*k,U[p+6]=P[I],U[p+7]=P[I+1],U[p+8]=P[I+2],null!=m&&(p=6*v,m[p]=D[2*O],m[p+1]=D[2*O+1],m[p+2]=D[2*S],m[p+3]=D[2*S+1],m[p+4]=D[2*k],m[p+5]=D[2*k+1]),null!=x?(O=i[r+6]+(i[r+7]<<8),S=i[r+8]+(i[r+9]<<8),k=i[r+10]+(i[r+11]<<8),r+=12,p=6*v,x[p]=_[2*O],x[p+1]=_[2*O+1],x[p+2]=_[2*S],x[p+3]=_[2*S+1],x[p+4]=_[2*k],x[p+5]=_[2*k+1]):r+=6);n.vertices=U,n.internalUVs=x,n.externalUVs=m,n.indices=z,o=null,u=null,f=null,a.index=r,n.size=n.vertices.byteLength,n.internalUVs&&(n.size+=n.internalUVs.byteLength),n.externalUVs&&(n.size+=n.externalUVs.byteLength),n.indices&&(n.size+=n.indices.byteLength),n.faces=V}function l(e,n){var a=e[n[1]];128&a?(n[0]=127&a|e[n[1]+1]<<7,n[1]+=2):(n[0]=a,n[1]++)}function o(e,n){var a=e[n[1]];128&a?(a=127&a|e[n[1]+1]<<7,1&a?(n[0]=-(1+(a>>1)),n[1]+=2):(n[0]=a>>1,n[1]+=2)):1&a?(n[0]=-(1+(a>>1)),n[1]++):(n[0]=a>>1,n[1]++)}function f(e,n,a){var t,r,i,s=a.data,f=a.index,u=a.uint8Data,x=c.config.map16bitMeshes,m=c.config.mapOnlyOneUVs&&n.flags&d,b=s.getUint16(f,!0);f+=2;var U=s.getUint16(f,!0);f+=2,b||(n.valid=!1);var v,h,y,p,w=n.bboxMin,A=n.bboxMax,V=[.5*(w[0]+A[0]),.5*(w[1]+A[1]),.5*(w[2]+A[2])],z=Math.abs(Math.max(A[0]-w[0],A[1]-w[1],A[2]-w[2])),F=1/U,M=null,L=x?new Uint16Array(3*b):new Float32Array(3*b),O=0,S=0,k=0,C=V[0],R=V[1],B=V[2],I=w[0],P=w[1],D=w[2],_=1/(A[0]-w[0]),j=1/(A[1]-w[1]),E=1/(A[2]-w[2]),T=[0,f];if(x)for(h=0;h<b;h++)o(u,T),O+=T[0],o(u,T),S+=T[0],o(u,T),k+=T[0],v=3*h,p=(O*F*z+C-I)*_,p<0&&(p=0),p>1&&(p=1),L[v]=65535*p,p=(S*F*z+R-P)*j,p<0&&(p=0),p>1&&(p=1),L[v+1]=65535*p,p=(k*F*z+B-D)*E,p<0&&(p=0),p>1&&(p=1),L[v+2]=65535*p;else for(h=0;h<b;h++)o(u,T),O+=T[0],o(u,T),S+=T[0],o(u,T),k+=T[0],v=3*h,L[v]=(O*F*z+C-I)*_,L[v+1]=(S*F*z+R-P)*j,L[v+2]=(k*F*z+B-D)*E;if(f=T[1],n.flags&g)if(U=s.getUint16(f,!0),f+=2,T[1]=f,m)for(h=0;h<b;h++)o(u,T),o(u,T);else if(F=x?65535/U:1/U,M=x?new Uint16Array(2*b):new Float32Array(2*b),O=0,S=0,x)for(h=0;h<b;h++){o(u,T),O+=T[0],o(u,T),S+=T[0];var q=2*h;p=O*F,p<0&&(p=0),p>65535&&(p=65535),M[q]=p,p=S*F,p<0&&(p=0),p>65535&&(p=65535),M[q+1]=65535-p}else for(h=0;h<b;h++){o(u,T),O+=T[0],o(u,T),S+=T[0];var q=2*h;M[q]=O*F,M[q+1]=1-S*F}if(f=T[1],t=L,r=M,n.flags&d){var H=s.getUint16(f,!0);f+=2;var G=s.getUint16(f,!0);f+=2;var X=s.getUint16(f,!0);f+=2;var J=x?65536/G:1/G,K=x?65536/X:1/X;O=0,S=0;var N=x?new Uint16Array(2*H):new Float32Array(2*H);if(T[1]=f,x)for(h=0,y=2*H;h<y;h+=2)o(u,T),O+=T[0],o(u,T),S+=T[0],p=O*J,p<0&&(p=0),p>65535&&(p=65535),N[h]=p,p=S*K,p<0&&(p=0),p>65535&&(p=65535),N[h+1]=65535-p;else for(h=0,y=2*H;h<y;h+=2)o(u,T),O+=T[0],o(u,T),S+=T[0],N[h]=O*J,N[h+1]=1-S*K;f=T[1],i=N}var Q=s.getUint16(f,!0);f+=2;var W=null;N=null,M=null;var Y=c.config.mapIndexBuffers&&c.config.mapOnlyOneUVs&&!(n.flags&d),Z=c.config.mapIndexBuffers&&c.config.mapOnlyOneUVs&&n.flags&d,$=Y||Z;$?W=new Uint16Array(3*Q):(L=x?new Uint16Array(3*Q*3):new Float32Array(3*Q*3),n.flags&d&&(N=x?new Uint16Array(3*Q*2):new Float32Array(3*Q*2)),!m&&n.flags&g&&(M=x?new Uint16Array(3*Q*2):new Float32Array(3*Q*2)));var ee,ne,ae,te,re,ie,se=t,le=r,oe=i,fe=0;for(T[1]=f,h=0;h<Q;h++)if(l(u,T),ee=fe-T[0],T[0]||fe++,l(u,T),ne=fe-T[0],T[0]||fe++,l(u,T),ae=fe-T[0],T[0]||fe++,$)v=3*h,W[v]=ee,W[v+1]=ne,W[v+2]=ae;else{v=9*h;var ue=3*ee;L[v]=se[ue],L[v+1]=se[ue+1],L[v+2]=se[ue+2],ue=3*ne,L[v+3]=se[ue],L[v+4]=se[ue+1],L[v+5]=se[ue+2],ue=3*ae,L[v+6]=se[ue],L[v+7]=se[ue+1],L[v+8]=se[ue+2],null!=M&&(v=6*h,M[v]=le[2*ee],M[v+1]=le[2*ee+1],M[v+2]=le[2*ne],M[v+3]=le[2*ne+1],M[v+4]=le[2*ae],M[v+5]=le[2*ae+1])}if(Y&&(L=t,M=r),Z&&(L=x?new Uint16Array(oe.length/2*3):new Float32Array(oe.length/2*3),N=i),fe=0,null!=N)for(h=0;h<Q;h++)l(u,T),ee=fe-T[0],T[0]||fe++,l(u,T),ne=fe-T[0],T[0]||fe++,l(u,T),ae=fe-T[0],T[0]||fe++,Z?(v=3*h,te=3*W[v],re=3*W[v+1],ie=3*W[v+2],L[3*ee]=se[te],L[3*ee+1]=se[te+1],L[3*ee+2]=se[te+2],L[3*ne]=se[re],L[3*ne+1]=se[re+1],L[3*ne+2]=se[re+2],L[3*ae]=se[ie],L[3*ae+1]=se[ie+1],L[3*ae+2]=se[ie+2],W[v]=ee,W[v+1]=ne,W[v+2]=ae):(v=6*h,N[v]=oe[2*ee],N[v+1]=oe[2*ee+1],N[v+2]=oe[2*ne],N[v+3]=oe[2*ne+1],N[v+4]=oe[2*ae],N[v+5]=oe[2*ae+1]);f=T[1],n.vertices=L,n.internalUVs=N,n.externalUVs=M,n.indices=W,a.index=f,n.size=n.vertices.byteLength,n.internalUVs&&(n.size+=n.internalUVs.byteLength),n.externalUVs&&(n.size+=n.externalUVs.byteLength),n.indices&&(n.size+=n.indices.byteLength),n.faces=Q}var u=a(0);a.d(n,"a",function(){return t});var c=u.a,d=1,g=2},function(e,n,a){"use strict";function t(e,n){l.config.mapPackLoaderEvents?(f.push(e),n&&(u=u.concat(n))):n?postMessage(e,n):postMessage(e)}function r(e,n,a,r,i,s,l){var f=new XMLHttpRequest;f.onreadystatechange=function(){switch(f.readyState){case 0:case 1:case 2:case 3:break;case 4:if(f.status>=400||0==f.status){a&&t({command:"on-error",path:e,status:f.status});break}var r=f.response;if(!r){a&&t({command:"on-error",path:e});break}if(n)if("direct-texture"==l)createImageBitmap(r).then(function(n){t({command:"on-loaded",path:e,data:n,filesize:r.size},[n])}.bind(this));else if("direct-mesh"==l){var i=o({data:new DataView(r),index:0});t({command:"on-loaded",path:e,data:i.mesh},i.transferables)}else t({command:"on-loaded",path:e,data:r},[r]);break;default:a&&t({command:"on-error",path:e})}}.bind(this),f.open("GET",e,!0),f.responseType=s||"arraybuffer",f.withCredentials=r,i&&i.token&&f.setRequestHeader("Accept","token/"+i.token+", */*"),f.send("")}Object.defineProperty(n,"__esModule",{value:!0});var i=a(0),s=a(1),l=i.a,o=s.a,f=[],u=[];self.onmessage=function(e){var n=e.data;switch(n.command){case"config":l.config=n.data;break;case"tick":f.length>0&&(u.length>0?postMessage({command:"packed-events",messages:f},u):postMessage({command:"packed-events",messages:f})),f=[],u=[];break;case"load-binary":r(n.path,!0,!0,n.withCredentials,n.xhrParams,n.responseType,n.kind)}}}]);',null)}},function(e,t,i){"use strict";var r=function(e){this.inspector=e,this.core=e.core};r.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-graphs-panel {position:absolute;left:10px;top:10px;z-index: 7;background-color: #FFFFFF;padding: 5px;border-radius: 4px;font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;color:#000000;text-align: left;font-size: 12px;display:none;}.vts-graphs-canvas {border: solid 1px #bbb;image-rendering : pixelated;}.vts-graphs-info {padding: 5px 2px;font-size: 10px;}.vts-graphs-button {padding: 2px 5px;display:inline-block;margin-right: 4px;border-radius: 4px;cursor:pointer;}.vts-graphs-button:hover {box-shadow: 0 0 1px #0066ff;}'),this.element=document.createElement("div"),this.element.id="vts-graphs-panel",this.element.innerHTML='<canvas id="vts-graphs-render" class="vts-graphs-canvas" width="900" height="100" ></canvas><div id="vts-graphs-info" class="vts-graphs-info" >&FilledSmallSquare; Frame: 1234 &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Render: 1234 &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: 1234 &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Mesh: 1234 &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> GpuMesh: 1234</div><canvas id="vts-graphs-cache" class="vts-graphs-canvas" width="900" height="100" ></canvas><div id="vts-graphs-info2" class="vts-graphs-info" >&FilledSmallSquare; Cache: 1234 &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Used: 123 &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: 1234 &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> Mesh: &nbsp 1234</div><div id="vts-graphs-rec" class="vts-graphs-button" >Recording On</div><div id="vts-graphs-ref" class="vts-graphs-button" >Refresh On</div><div id="vts-graphs-res" class="vts-graphs-button" >Reset</div><div id="vts-graphs-zoom" class="vts-graphs-button" >Scale: Max value</div><div id="vts-graphs-magnify" class="vts-graphs-button" >Magnify Off</div><div id="vts-graphs-graph" class="vts-graphs-button" >Graph: Cache</div>',this.core.element.appendChild(this.element),this.canvasRender=document.getElementById("vts-graphs-render"),this.canvasCache=document.getElementById("vts-graphs-cache"),this.canvasRenderCtx=this.canvasRender.getContext("2d"),this.canvasCacheCtx=this.canvasCache.getContext("2d"),document.getElementById("vts-graphs-rec").onclick=this.recordingPressed.bind(this),document.getElementById("vts-graphs-rec").onclick=this.recordingPressed.bind(this),document.getElementById("vts-graphs-ref").onclick=this.refreshPressed.bind(this),document.getElementById("vts-graphs-res").onclick=this.resetPressed.bind(this),document.getElementById("vts-graphs-zoom").onclick=this.zoomPressed.bind(this),document.getElementById("vts-graphs-magnify").onclick=this.magnifyPressed.bind(this),document.getElementById("vts-graphs-graph").onclick=this.graphPressed.bind(this),document.getElementById("vts-graphs-render").onmousemove=this.onMouseMove.bind(this),document.getElementById("vts-graphs-render").onmouseout=this.onMouseOut.bind(this),document.getElementById("vts-graphs-cache").onmousemove=this.onMouseMove.bind(this),document.getElementById("vts-graphs-cache").onmouseout=this.onMouseOut.bind(this),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.zoom="max",this.graph="Cache",this.refresh=!0,this.panelVisible=!1},r.prototype.showPanel=function(){this.element.style.display="block",this.panelVisible=!0,this.recordingPressed(!0)},r.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1,this.recordingPressed(!0)},r.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},r.prototype.recordingPressed=function(e){var t=this.core.getMap();t&&(t.stats.recordGraphs=null==e?e:!t.stats.recordGraphs,this.updateGraphsPanel(),this.updateGraphs(null,!0))},r.prototype.refreshPressed=function(){this.refresh=!this.refresh,this.updateGraphsPanel(),this.updateGraphs()},r.prototype.resetPressed=function(){var e=this.core.getMap();e&&(e.stats.resetGraphs(),this.updateGraphs(null,!0))},r.prototype.zoomPressed=function(){switch(this.zoom){case"max":this.zoom="120avrg";break;case"120avrg":this.zoom="180avrg";break;case"180avrg":this.zoom="max"}this.updateGraphsPanel(),this.updateGraphs()},r.prototype.graphPressed=function(){switch(this.graph){case"Cache":this.graph="Polygons";break;case"Polygons":this.graph="Processing";break;case"Processing":this.graph="LODs";break;case"LODs":this.graph="Flux";break;case"Flux":this.graph="Cache"}this.updateGraphsPanel(),this.updateGraphs()},r.prototype.magnifyPressed=function(){this.magnify=!this.magnify,this.magnify?(this.canvasRender.style.width="1400px",this.canvasRender.style.height="200px",this.canvasCache.style.width="1400px",this.canvasCache.style.height="200px",document.getElementById("vts-graphs-magnify").innerHTML="Magnify On"):(this.canvasRender.style.width="900px",this.canvasRender.style.height="100px",this.canvasCache.style.width="900px",this.canvasCache.style.height="100px",document.getElementById("vts-graphs-magnify").innerHTML="Magnify Off"),this.updateGraphsPanel(),this.updateGraphs()},r.prototype.updateGraphsPanel=function(){var e=this.core.getMap();if(e){switch(e.stats.recordGraphs?document.getElementById("vts-graphs-rec").innerHTML="Recording On":document.getElementById("vts-graphs-rec").innerHTML="Recording Off",this.refresh?document.getElementById("vts-graphs-ref").innerHTML="Refresh On":document.getElementById("vts-graphs-ref").innerHTML="Refresh Off",this.zoom){case"max":document.getElementById("vts-graphs-zoom").innerHTML="Scale: Max value";break;case"120avrg":document.getElementById("vts-graphs-zoom").innerHTML="Scale: 100% Avrg";break;case"180avrg":document.getElementById("vts-graphs-zoom").innerHTML="Scale: 50% Avrg"}document.getElementById("vts-graphs-graph").innerHTML="Graph: "+this.graph}},r.prototype.onMouseMove=function(e){var t=e.clientX-this.canvasRender.getBoundingClientRect().left;this.showCursor=!0,this.magnify&&(t=Math.floor(900*t/1400)),this.cursorIndex=t;var i=this.core.getMap();i&&(i.stats.recordGraphs||this.updateGraphs(null))},r.prototype.onMouseOut=function(){this.showCursor=!1,this.updateGraphs(null)},r.prototype.updateGraphs=function(e,t){var i=this.core.getMap();if(i&&(this.refresh||t)&&this.panelVisible){e=e||i.stats;var r=this.canvasRender.width,s=this.canvasRender.height,a=this.canvasRenderCtx,n=e.graphsTimeSamples,o=e.graphsTimeIndex,h=r/n;a.clearRect(0,0,r,s);var l,u,c,d,p,f,g,m,v,y,b,x,w=0,S=0,M=0,A=0,C=0,T=0,P=0,F=e.graphsFrameTimes,L=e.graphsRenderTimes,E=e.graphsCreateTextureTimes,k=e.graphsCreateMeshTimes,N=e.graphsCreateGpuMeshTimes;for(l=0;l<n;l++){S+=F[l],M+=L[l],A+=E[l],C+=k[l],T+=N[l];var B=F[l];B>w&&(w=B),B>0&&P++}for("120avrg"==this.zoom&&(w=S/P*1),"180avrg"==this.zoom&&(w=S/P*.5),v=s/w,l=0;l<n;l++)d=o+l,d%=n,a.fillStyle="#000000",a.fillRect(l*h,s,1,-F[d]*v),a.fillStyle="#ff0000",a.fillRect(l*h,s,1,-L[d]*v),a.fillStyle="#0000ff",a.fillRect(l*h,s,1,-E[d]*v),m=s-E[d]*v,a.fillStyle="#007700",a.fillRect(l*h,m,1,-k[d]*v),m-=k[d]*v,a.fillStyle="#00ff00",a.fillRect(l*h,m,1,-N[d]*v);switch(this.showCursor?(a.fillStyle="#aa00aa",d=this.cursorIndex%n,a.fillRect(Math.floor(d*h)-1,0,1,s),a.fillRect(Math.floor(d*h)+1,0,1,s),d=(this.cursorIndex+o)%n,g="&FilledSmallSquare; Frame: "+F[d].toFixed(2)+' &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Render: '+L[d].toFixed(2)+' &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: '+E[d].toFixed(2)+' &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Meshes: '+k[d].toFixed(2)+' &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> GpuMeshes: '+N[d].toFixed(2)+"</div>"):g="&FilledSmallSquare; Frame: "+Math.round(S)+' &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Render: '+Math.round(M)+' &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Textures: '+Math.round(A)+' &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Meshes: '+Math.round(C)+' &nbsp <span style="color:#00bb00">&FilledSmallSquare;</span> GpuMeshes: '+Math.round(T)+"</div>",document.getElementById("vts-graphs-info").innerHTML=g,r=this.canvasCache.width,s=this.canvasCache.height,a=this.canvasCacheCtx,h=r/n,a.clearRect(0,0,r,s),this.graph){case"Cache":v=s/(i.gpuCache.maxCost+i.resourcesCache.maxCost+i.metatileCache.maxCost);var I=0,R=0,U=0,D=0,z=0,_=0,G=e.graphsCpuMemoryMetatiles,V=e.graphsCpuMemoryUsed,O=e.graphsGpuMemoryRender;for(x=e.graphsGpuMemoryGeodata,E=e.graphsGpuMemoryTextures,k=e.graphsGpuMemoryMeshes,l=0;l<n;l++)I=G[l]>I?G[l]:I,R=V[l]>R?V[l]:R,U=E[l]>U?E[l]:U,D=k[l]>D?k[l]:D,z=x[l]>z?x[l]:z,_=O[l]>_?O[l]:_;for(l=0;l<n;l++)d=o+l,d%=n,p=G[d]+k[d]+E[d]+x[d]+V[d],a.fillStyle="#000000",a.fillRect(l*h,s,1,-p*v),p-=V[d],a.fillStyle="#0000ff",a.fillRect(l*h,s,1,-p*v),p-=E[d],a.fillStyle="#009999",a.fillRect(l*h,s,1,-p*v),p-=x[d],a.fillStyle="#007700",a.fillRect(l*h,s,1,-p*v),p-=k[d],a.fillStyle="#ff0000",a.fillRect(l*h,s,1,-p*v),p=O[d],a.fillStyle="#ffff00",a.fillRect(l*h,s-p*v,1,1);this.showCursor?(d=(this.cursorIndex+o)%n,g='<span style="color:#555">&FilledSmallSquare;</span> Total: '+Math.ceil((G[d]+V[d]+E[d]+k[d])/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> CPU: '+Math.ceil(V[d]/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> GPU: '+Math.ceil((E[d]+k[d])/1048576)+'MB &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Te: '+Math.ceil(E[d]/1048576)+'MB &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Me: '+Math.ceil(k[d]/1048576)+'MB &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Ge: '+Math.ceil(x[d]/1048576)+'MB &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Met: '+Math.ceil(G[d]/1048576)+'MB &nbsp <span style="color:#ffff00">&FilledSmallSquare;</span> Render: '+Math.ceil(O[d]/1048576)+"MB</div>"):g='<span style="color:#555">&FilledSmallSquare;</span> Total: '+Math.round((I+R+U+D)/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> CPU: '+Math.ceil(R/1048576)+'MB &nbsp <span style="color:#000000">&FilledSmallSquare;</span> GPU: '+Math.ceil((U+D)/1048576)+'MB &nbsp <span style="color:#0000ff">&FilledSmallSquare;</span> Te '+Math.ceil(U/1048576)+'MB &nbsp <span style="color:#005500">&FilledSmallSquare;</span> Me: '+Math.ceil(D/1048576)+'MB &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Ge: '+Math.ceil(z/1048576)+'MB &nbsp <span style="color:#ff0000">&FilledSmallSquare;</span> Met: '+Math.ceil(I/1048576)+'MB &nbsp <span style="color:#ffff00">&FilledSmallSquare;</span> Render: '+Math.ceil(_/1048576)+"MB</div>";break;case"Polygons":case"Processing":y=0,b=99999999999,P=0,f="Polygons"==this.graph?e.graphsPolygons:e.graphsBuild;var j=0;for(l=0;l<n;l++)y=f[l]>y?f[l]:y,f[l]>0&&(b=f[l]<b?f[l]:b,j+=f[l],P++);for(v=s/y,l=0;l<n;l++)d=o+l,d%=n,a.fillStyle="#007700",a.fillRect(l*h,s,1,-f[d]*v);this.showCursor?(d=(this.cursorIndex+o)%n,g='<span style="color:#007700">&FilledSmallSquare;</span> '+this.graph+" Max: "+Math.round(f[d])+"</div>"):(g='<span style="color:#007700">&FilledSmallSquare;</span> '+this.graph+" Max: "+y+"</div>",g+=" &nbsp Min: "+b,g+=" &nbsp Avrg: "+Math.round(j/P)+"</div>");break;case"LODs":for(y=0,f=e.graphsLODs,l=0;l<n;l++)y=f[l][0]>y?f[l][0]:y;v=s/y,a.fillStyle="#000000",a.fillRect(0,0,r,s);var H;for(l=0;l<n;l++)for(d=o+l,d%=n,m=s,H=f[d][1],u=0,c=H.length;u<c;u++)H[u]&&(a.fillStyle="hsl("+23*u%360+",100%,50%)",p=Math.round(H[u]*v),a.fillRect(l*h,m,1,-p),m-=p);if(this.showCursor)for(d=(this.cursorIndex+o)%n,g="LODs:"+f[d][0],H=f[d][1],u=0,c=H.length;u<c;u++)H[u]&&(g+='<span style="color:hsl('+23*u%360+',100%,50%)">&FilledSmallSquare;</span>'+u+":"+H[u]);else g="LODs:"+f[d][0];g+="</div>";break;case"Flux":var Y=0,q=0,J=0,Z=0,X=0,W=0,Q=0,K=0,$=0,ee=0,te=0,ie=0,re=0,se=0;for(E=e.graphsFluxTextures,k=e.graphsFluxMeshes,x=e.graphsFluxGeodatas,l=0;l<n;l++){var ae=E[l][0][0]+k[l][0][0];Y=ae>Y?ae:Y,ae=E[l][1][0]+k[l][1][0],Y=ae>Y?ae:Y,ae=E[l][0][1]+k[l][0][1],q=ae>q?ae:q,ae=E[l][1][1]+k[l][1][1],q=ae>q?ae:q,J=E[l][0][0]>J?E[l][0][0]:J,Z=E[l][0][1]>Z?E[l][0][1]:Z,X=E[l][1][0]>X?E[l][1][0]:X,W=E[l][1][1]?E[l][1][1]:W,Q=k[l][0][0]>Q?k[l][0][0]:Q,K=k[l][0][1]>K?k[l][0][1]:K,$=k[l][1][0]>$?k[l][1][0]:$,ee=k[l][1][1]>ee?k[l][1][1]:ee,te=x[l][0][0]>te?x[l][0][0]:te,ie=x[l][0][1]>ie?x[l][0][1]:ie,re=x[l][1][0]>re?x[l][1][0]:re,se=x[l][1][1]>se?x[l][1][1]:se}v=(.25*s-2)/Y;var ne=(.25*s-2)/q,oe=Math.floor(.25*s),he=Math.floor(.75*s);for(l=0;l<n;l++){d=o+l,d%=n;var le=oe,ue=oe+1,ce=he,de=he+1;a.fillStyle="#0000aa",a.fillRect(l*h,le,1,-E[d][0][0]*v),a.fillRect(l*h,ue,1,E[d][1][0]*v),a.fillRect(l*h,ce,1,-E[d][0][1]*ne),a.fillRect(l*h,de,1,E[d][1][1]*ne),le-=E[d][0][0]*v,ue+=E[d][1][0]*v,ce-=E[d][0][1]*ne,de+=E[d][1][1]*ne,a.fillStyle="#007700",a.fillRect(l*h,le,1,-k[d][0][0]*v),a.fillRect(l*h,ue,1,k[d][1][0]*v),a.fillRect(l*h,ce,1,-k[d][0][1]*ne),a.fillRect(l*h,de,1,k[d][1][1]*ne),le-=k[d][0][0]*v,ue+=k[d][1][0]*v,ce-=k[d][0][1]*ne,de+=k[d][1][1]*ne,a.fillStyle="#009999",a.fillRect(l*h,le,1,-x[d][0][0]*v),a.fillRect(l*h,ue,1,x[d][1][0]*v),a.fillRect(l*h,ce,1,-x[d][0][1]*ne),a.fillRect(l*h,de,1,x[d][1][1]*ne),a.fillStyle="#aaaaaa",a.fillRect(0,Math.floor(.5*s),r,1),a.fillStyle="#dddddd",a.fillRect(0,oe,r,1),a.fillRect(0,he,r,1)}this.showCursor?(d=(this.cursorIndex+o)%n,g='<span style="color:#007700">&FilledSmallSquare;</span> Textures Count +/-: '+E[d][0][0]+"/"+E[d][1][0],g+=" &nbsp Size +/-: "+(E[d][0][1]/1024/1024).toFixed(2)+"/"+(E[d][1][1]/1024/1024).toFixed(2),g+=' &nbsp <span style="color:#0000aa">&FilledSmallSquare;</span> Meshes Count +/-: '+k[d][0][0]+"/"+k[d][1][0],g+=" &nbsp Size +/-: "+(k[d][0][1]/1024/1024).toFixed(2)+"/"+(k[d][1][1]/1024/1024).toFixed(2),g+=' &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Geodata Count +/-: '+x[d][0][0]+"/"+x[d][1][0],g+=" &nbsp Size +/-: "+(x[d][0][1]/1024/1024).toFixed(2)+"/"+(x[d][1][1]/1024/1024).toFixed(2),g+="</div>"):(g='<span style="color:#007700">&FilledSmallSquare;</span> Textures Count +/-: '+J+"/"+X,g+=" &nbsp Size +/-: "+(Z/1024/1024).toFixed(2)+"/"+(W/1024/1024).toFixed(2),g+=' &nbsp <span style="color:#0000aa">&FilledSmallSquare;</span> Meshes Count +/-: '+Q+"/"+$,g+=" &nbsp Size +/-: "+(K/1024/1024).toFixed(2)+"/"+(ee/1024/1024).toFixed(2),g+=' &nbsp <span style="color:#009999">&FilledSmallSquare;</span> Geodata Count +/-: '+te+"/"+re,g+=" &nbsp Size +/-: "+(ie/1024/1024).toFixed(2)+"/"+(se/1024/1024).toFixed(2),g+="</div>")}this.showCursor&&(a.fillStyle="#aa00aa",d=this.cursorIndex%n,a.fillRect(Math.floor(d*h)-1,0,1,s),a.fillRect(Math.floor(d*h)+1,0,1,s)),document.getElementById("vts-graphs-info2").innerHTML=g}},t.a=r},function(e,t,i){"use strict";var r=function(e){this.inspector=e,this.core=e.core};r.prototype.init=function(){document.addEventListener("keyup",this.onKeyUp.bind(this),!1),document.addEventListener("keypress",this.onKeyPress.bind(this),!1),document.addEventListener("keydown",this.onKeyDown.bind(this),!1)},r.prototype.onKeyDown=function(e){void 0===e&&(e=window.event),this.altDown=e.altKey,this.ctrlDown=e.ctrlKey,this.shiftDown=e.shiftKey,this.onKeyUp(e,!0)},r.prototype.onKeyPress=function(e){this.onKeyUp(e,!0)},r.prototype.onKeyUp=function(e,t){void 0===e&&(e=window.event);var i=this.core.getMap(),r=this.inspector;if(i){var s=i.draw.debug;this.altDown=e.altKey,this.ctrlDown=e.ctrlKey,this.shiftDown=e.shiftKey;var a=!1,n=!0;if(e){var o;if(o=window.event?window.event.keyCode:e.which?e.which:e.charCode,this.shiftDown&&this.ctrlDown)switch(o){case 68:case 100:r.preventDefault(e)}if(this.shiftDown&&!0!==t){if(this.ctrlDown)switch(o){case 68:case 100:r.enableInspector(),this.diagnosticMode=!0,a=!0}if(this.diagnosticMode){switch(n=!0,o){case 67:case 99:r.shakeCamera=!r.shakeCamera;break;case 49:case 50:case 51:case 48:break;case 72:case 104:s.heightmapOnly=!s.heightmapOnly;break;case 81:case 113:var h=i.getPosition();console.log("pos-before: "+JSON.stringify(h.pos)),i.convert.convertPositionViewMode(h,"obj"==h.getViewMode()?"subj":"obj"),console.log("new mode: "+h.getViewMode()),console.log("pos-after: "+JSON.stringify(h.pos)),i.setPosition(h),this.altDown&&"obj"!=h.getViewMode()?i.camera.near=.1:i.camera.near=2,r.preventDefault(e);break;case 80:case 112:i.renderer.saveScreenshot("file","vts-screenshot.png","png");break;case 83:case 115:r.stats.switchPanel();break;case 86:case 118:r.layers.switchPanel();break;case 69:case 101:r.stylesheets.switchPanel();break;case 84:case 116:r.replay.switchPanel();break;case 66:case 98:s.drawBBoxes=!s.drawBBoxes;break;case 65:case 97:s.drawLabelBoxes=!s.drawLabelBoxes;break;case 75:case 107:s.drawAllLabels=!s.drawAllLabels;break;case 73:case 105:s.drawHiddenLabels=!s.drawHiddenLabels;break;case 87:case 119:if(3==s.drawWireframe)s.drawWireframe=1;else{var l=s.drawWireframe+1;s.drawWireframe=l>2?0:l}break;case 70:case 102:s.drawWireframe=3!=s.drawWireframe?3:0;break;case 85:case 117:i.renderer.setSuperElevationState(!i.renderer.useSuperElevation);break;case 71:case 103:s.meshStats=!s.meshStats,a=!0;break;case 77:case 109:i.loaderSuspended=!i.loaderSuspended,console.log("loader state "+i.loaderSuspended);break;case 74:case 106:s.drawEarth=!s.drawEarth,a=!0;break;case 88:case 120:s.drawFog=!s.drawFog,a=!0;break;case 82:case 114:r.graphs.switchPanel();break;case 79:case 111:i.camera.camera.setOrtho(!i.camera.camera.getOrtho());break;case 76:case 108:r.drawRadar=!r.drawRadar;break;case 90:case 122:s.maxZoom=!s.maxZoom;break;case 78:case 110:s.drawNBBoxes=!s.drawNBBoxes;break;default:n=!1}n&&(a=!0)}}if(this.diagnosticMode&&s.drawWireframe&&!t&&o>=96&&o<=105&&(this.altDown?(s.drawTestData=o-96,this.ctrlDown&&(s.drawTestData+=10)):s.drawTestMode=o-96,a=!0),this.diagnosticMode&&r.drawRadar&&!this.shiftDown&&!t){switch(n=!0,o){case 43:case 107:null==r.radarLod&&(r.radarLod=8),r.radarLod++;break;case 45:case 109:null==r.radarLod&&(r.radarLod=8),r.radarLod=Math.max(0,r.radarLod-1);break;case 42:case 106:r.radarLod=null;break;default:n=!1}n&&(a=!0)}if(this.diagnosticMode&&(s.drawBBoxes||s.drawNBBoxes)&&!this.shiftDown&&!t){switch(n=!0,o){case 76:case 108:s.drawLods=!s.drawLods;break;case 80:case 112:s.drawPositions=!s.drawPositions;break;case 84:case 116:s.drawTextureSize=!s.drawTextureSize;break;case 70:case 102:s.drawFaceCount=!s.drawFaceCount;break;case 71:case 103:s.drawGeodataOnly=!s.drawGeodataOnly;break;case 68:case 100:s.drawDistance=!s.drawDistance;break;case 78:case 110:s.drawNodeInfo=!s.drawNodeInfo;break;case 77:case 109:s.drawMeshBBox=!s.drawMeshBBox;break;case 73:case 105:s.drawIndices=!s.drawIndices;break;case 66:case 98:s.drawBoundLayers=!s.drawBoundLayers;break;case 82:case 114:s.drawResources=!s.drawResources;break;case 83:case 115:s.drawSurfaces=!s.drawSurfaces;break;case 90:case 122:s.drawSurfaces2=!s.drawSurfaces2;break;case 67:case 99:s.drawCredits=!s.drawCredits;break;case 79:case 111:s.drawOrder=!s.drawOrder;break;case 69:case 101:s.debugTextSize=2==s.debugTextSize?3:2;break;case 88:case 120:i.config.mapPreciseBBoxTest=!i.config.mapPreciseBBoxTest;break;case 87:case 119:s.drawPolyWires=!s.drawPolyWires;break;case 90:case 122:i.config.mapPreciseDistanceTest=!i.config.mapPreciseDistanceTest;break;case 75:case 107:s.drawGPixelSize=!s.drawGPixelSize;break;default:n=!1}n&&(a=!0)}}a&&(i.markDirty(),r.preventDefault(e))}},r.prototype.setParameter=function(e,t){var i=this.core.getMap(),r=this.inspector;if(i){var s=i.draw.debug,a=function(e){return!0===t||"true"==t||"1"==t};switch(e){case"debugBBox":s.drawBBoxes=!0;case"debugNBBox":"debugNBBox"==e&&(s.drawNBBoxes=!0);var n=function(e){return-1!=t.indexOf(e)};n("L")&&(s.drawLods=!0),n("P")&&(s.drawPositions=!0),n("T")&&(s.drawTextureSize=!0),n("F")&&(s.drawFaceCount=!0),n("G")&&(s.drawGeodataOnly=!0),n("D")&&(s.drawDistance=!0),n("N")&&(s.drawNodeInfo=!0),n("M")&&(s.drawMeshBBox=!0),n("I")&&(s.drawIndices=!0),n("B")&&(s.drawBoundLayers=!0),n("S")&&(s.drawSurfaces=!0),n("Z")&&(s.drawSurfaces2=!0),n("C")&&(s.drawCredits=!0),n("O")&&(s.drawOrder=!0),n("E")&&(s.debugTextSize=3),n("K")&&(s.drawGPixelSize=!0);break;case"debugLBox":s.drawLabelBoxes=a();break;case"debugNoEarth":s.drawEarth=!a();break;case"debugShader":s.drawWireframe=parseInt(t);break;case"debugHeightmap":s.heightmapOnly=a();break;case"debugGridCells":s.drawGridCells=a();break;case"debugRadar":r.enableInspector(),r.drawRadar=!0,r.radarLod=parseInt(t),isNaN(r.radarLod)&&(r.radarLod=null)}i.markDirty()}},t.a=r},function(e,t,i){"use strict";var r=i(1),s=i(4),a=i(2),n=i(122),o=i(126),h=i(121),l=i(124),u=i(125),c=i(127),d=r.e,p=s.a,f=a.a,g=n.a,m=o.a,v=h.a,y=l.a,b=u.a,x=c.a,w=function(e){this.core=e,this.enabled=!1,this.input=new g(this),this.stats=new m(this),this.graphs=new v(this),this.layers=new y(this),this.replay=new b(this),this.stylesheets=new x(this),this.core.config.inspector&&this.input.init(),this.shakeCamera=!1,this.drawReplayCamera=!1,this.drawRadar=!1,this.radarLod=null,this.debugValue=0,this.measureMode=!1,this.measurePoints=[]};w.prototype.enableInspector=function(){this.enabled||(this.stats.init(),this.graphs.init(),this.layers.init(),this.replay.init(),this.stylesheets.init(),this.circleImage||(this.circleImage=f.loadImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QAAAAAAAD5Q7t/AAAACW9GRnMAAAAgAAAA4ACD+EAUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVRYw+2VPwqDMBTG3dz1Am56EnH2XLroETxGuwc3Z7cOdhY8QJpfSUBspUvStJAPPggvD973/uQligICAgL+DKViqygUV02hbaXLwJlio7gpyhNu2idzEXwwgfI8H+u6vnZdN/V9P3EuimLcCRlsiyArGcfxjWDLsmzyAGzc4aNFNDZ7/iw7AeQH4LNrh5WZYLgkJTaZCyHuVVVdkiSZ0zSdOWMzlaBFWkRrQ4A4Zk/A4wBie1MFYUMAz0wybCYAmR8FUAlzj6+2r18TgM2VAO8tOB1Cyk7mrofQ+zP0voheVjHtIBjDxjrmvCu7k1Xs/TP6ie84ICDAGR5uCYdPo0MWiAAAAABJRU5ErkJggg==",function(){this.circleTexture=this.core.getRendererInterface().createTexture({source:this.circleImage})}.bind(this))),this.core.on("map-update",this.onMapUpdate.bind(this)),this.enabled=!0)},w.prototype.setParameter=function(e,t){this.input.setParameter(e,t)},w.prototype.addStyle=function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},w.prototype.doNothing=function(e){return e.stopPropagation(),!1},w.prototype.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},w.prototype.onMapUpdate=function(){var e=this.core.getMapInterface();if(e){this.shakeCamera&&e.redraw();var t,i,r,s,a,n,o,h=this.core.getRendererInterface();if(this.replay.drawGlobe){o=e.convertCoordsFromPhysToCameraSpace([0,0,0]);var l=this.core.getRenderer();l.draw.drawTBall(o,6371e3,l.progStardome,this.replay.globeTexture,6371e3,!0)}if(this.replay.drawCamera){for(a=this.replay.cameraLines,n=[],h.drawLineString({points:a,size:2,color:[0,128,255,255],depthTest:!1,screenSpace:!1,blend:!1}),a=this.replay.cameraLines3,t=0,i=a.length;t<i;t++){for(n=[],r=0,s=a[t].length;r<s;r++)n.push(a[t][r]);h.drawLineString({points:n,size:2,color:[0,255,128,255],depthTest:!1,screenSpace:!1,blend:!1})}for(a=this.replay.cameraLines2,t=0,i=a.length;t<i;t++){for(n=[],r=0,s=a[t].length;r<s;r++)n.push(a[t][r]);h.drawLineString({points:n,size:2,color:[0,255,255,255],depthTest:!1,screenSpace:!1,blend:!1})}var u=e.getCameraInfo(),c=e.convertCoordsFromPhysToCameraSpace(this.replay.cameraLines[0]),f=d.create(this.replay.cameraMatrix);f[12]=c[0],f[13]=c[1],f[14]=c[2];var g=[255,128,128,0,0,0,0,0,0,0,0,0,0,.5,0,0];d.multiply(u.viewMatrix,f,f);var m=[0,0,0,0,0,0,0,0,0];d.toInverseMat3(f,m),h.setState(this.replay.frustumState),h.drawMesh({mesh:this.replay.frustumMesh,texture:null,shader:"shaded",shaderVariables:{uMV:["mat4",f],uNorm:["mat3",m],uMaterial:["mat4",g]}})}if(this.drawRadar&&this.circleTexture){var v=e.getPosition(),y=v.getViewExtent()/64,b=new Array(256);for(r=0;r<16;r++)for(t=0;t<16;t++){var x=t*y-8*y,w=r*y-8*y,S=Math.atan2(w,x),M=Math.sqrt(x*x+w*w),A=e.movePositionCoordsTo(v,p.degrees(S),M),C=A.getCoords(),T=e.convertCoordsFromNavToCanvas([C[0],C[1],0],"float",this.radarLod);b[16*r+t]=T}var P=new Array(16);for(r=0;r<16;r++){for(t=0;t<16;t++)P[t]=b[16*r+t];h.drawLineString({points:P,size:2,screenSpace:!0,color:[0,255,255,255],depthTest:!1,blend:!1})}for(t=0;t<16;t++){for(r=0;r<16;r++)P[r]=b[16*r+t];h.drawLineString({points:P,size:2,screenSpace:!0,color:[0,255,255,255],depthTest:!1,blend:!1})}for(t=0,i=b.length;t<i;t++)o=b[t],h.drawImage({rect:[o[0]-10,o[1]-10,20,20],texture:this.circleTexture,color:[255,0,255,255],depth:o[2],depthTest:!1,blend:!0})}}},t.a=w},function(e,t,i){"use strict";var r=function(e){this.inspector=e,this.core=e.core};r.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-layers-panel {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;display: none;padding:15px;font-size: 14px;position: absolute;right: 10px;bottom: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-layers-panel button {max-width: 23px;max-height: 21px;}#vts-layers-panel-title {margin-bottom: 3px;}#vts-layers-views-panel {margin-top: 5px;float: left;}#vts-layers-views-items {width: 191px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;}#vts-layers-surfaces-panel {margin-top: 5px;float: left;}#vts-layers-surfaces-items {width: 150px;overflow-y: scroll;overflow-x: hidden;height: 200px;border-top: 1px solid #ddd;border-bottom: 1px solid #ddd;}#vts-layers-boundlayers-panel {margin-top: 5px;float: left;}#vts-layers-boundlayers-items {width: 275px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;border-right: none;}#vts-layers-freelayers-panel {margin-top: 5px;float: left;}#vts-layers-freelayers-items {width: 150px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;}#vts-layers-fl-properties-panel {margin-top: 5px;float: left;}#vts-layers-fl-properties-items {width: 250px;overflow-y: scroll;overflow-x: hidden;height: 200px;border: 1px solid #ddd;border-right: none;}#vts-layers-json-panel {margin-top: 5px;float: right;}#vts-layers-json-text {width: 200px;resize: none;height: 180px;border: 1px solid #ddd;white-space: pre;padding: 0px;}#vts-layers-json-text2 {width: 200px;height: 21px;border: 1px solid #ddd;}.vts-layers-panel-title {margin: 0px;margin-bottom: 5px;}.vts-layers-item {width: 100%;}.vts-layers-item input[type=number]{width: 43px;}.vts-layers-name {width: 120px;display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}.vts-layers-name2 {width: 126px;display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}#vts-layers-fl-properties-style {width: 175px;height: 21px;}.vts-surface-item {width: 100%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}'),this.element=document.createElement("div"),this.element.id="vts-layers-panel",this.element.innerHTML='<div id="vts-layers-views-panel"><p class="vts-layers-panel-title">Named Views:</p><div id="vts-layers-views-items"></div></div><div id="vts-layers-surfaces-panel"><p class="vts-layers-panel-title">Surfaces:</p><div id="vts-layers-surfaces-items"></div></div><div id="vts-layers-boundlayers-panel"><p class="vts-layers-panel-title">Surface Bound Layers:</p><div id="vts-layers-boundlayers-items"></div></div><div id="vts-layers-freelayers-panel"><p class="vts-layers-panel-title">Free Layers:</p><div id="vts-layers-freelayers-items"></div></div><div id="vts-layers-fl-properties-panel"><p class="vts-layers-panel-title">Free Layer Properties:</p><div id="vts-layers-fl-properties-items"></div></div><div id="vts-layers-json-panel"><p class="vts-layers-panel-title">Definition:</p><textarea id="vts-layers-json-text" cols="48"></textarea><br/><input id="vts-layers-json-text2" type="text"></div>',this.core.element.appendChild(this.element),this.viewItems=document.getElementById("vts-layers-views-items"),this.surfacesItems=document.getElementById("vts-layers-surfaces-items"),this.boundLayersItems=document.getElementById("vts-layers-boundlayers-items"),this.freeLayersItems=document.getElementById("vts-layers-freelayers-items"),this.freeLayersPropertiesItems=document.getElementById("vts-layers-fl-properties-items"),this.jsonText=document.getElementById("vts-layers-json-text"),this.jsonText2=document.getElementById("vts-layers-json-text2"),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.views=[],this.panelVisible=!1,this.panelInitialized=!1,this.currentView="",this.currentSurface="",this.currentFreeLayer=""},r.prototype.initViews=function(){var e=this.core.getMap();if(e){var t,i,r,s,a,n,o,h,l,u,c,d=e.getNamedViews(),p="--initial--";for(this.views[p]={surfaces:{},freeLayers:{},options:{},original:JSON.parse(JSON.stringify(e.getView()))},i=0,r=d.length;i<r;i++)l=d[i],this.views[l]={surfaces:{},freeLayers:{},options:{},original:JSON.parse(JSON.stringify(e.getNamedView(l).getInfo()))};this.currentView=p,d=this.views;for(var f in d){for(l=d[f],u=e.getSurfaces(),i=0,r=u.length;i<r;i++){for(p=u[i],y=e.getSurface(p),n=e.getBoundLayers(),o=[],s=0,a=n.length;s<a;s++)o.push({id:n[s],alpha:100,options:"{}",enabled:!1});l.surfaces[p]={enabled:!1,layers:o}}var g=e.getFreeLayers();for(i=0,r=g.length;i<r;i++){for(p=g[i],n=e.getBoundLayers(),o=[],s=0,a=n.length;s<a;s++)o.push({id:n[s],alpha:100,options:"{}",enabled:!1});t=e.getFreeLayer(p);var m=t.getInfo();l.freeLayers[p]={enabled:!1,style:null,originalStyle:m.style,depthShift:0,depthShift2:0,depthShift3:0,layers:o}}var v=l.original.surfaces;for(c in v)if(n=v[c],l.surfaces[c]){var y=l.surfaces[c];for(y.enabled=!0,i=0,r=n.length;i<r;i++)"string"==typeof n[i]?-1!=(h=this.findIdInArray(y.layers,n[i]))&&y.layers[h]&&(y.layers[h].enabled=!0,y.layers.splice(i,0,y.layers.splice(h,1)[0])):(p=n[i].id,-1!=(h=this.findIdInArray(y.layers,p))&&y.layers[h]&&(y.layers[h].enabled=!0,y.layers[h].alpha=n[i].alpha?100*parseFloat(n[i].alpha):100,y.layers[h].options=n[i].options?JSON.stringify(n[i].options):"{}",y.layers.splice(i,0,y.layers.splice(h,1)[0])))}var b=l.original.freeLayers;for(c in b){var x=b[c];if(l.freeLayers[c]){t=l.freeLayers[c],t.enabled=!0;var w=x.depthOffset||[0,0,0];for(t.depthShift=w[0],t.depthShift2=w[1],t.depthShift3=w[2],t.style=x.style,n=x.boundLayers||[],i=0,r=n.length;i<r;i++)"string"==typeof n[i]?-1!=(h=this.findIdInArray(t.layers,n[i]))&&t.layers[h]&&(t.layers[h].enabled=!0,t.layers.splice(i,0,t.layers.splice(h,1)[0])):(p=n[i].id,-1!=(h=this.findIdInArray(t.layers,p))&&y.layers[h]&&(t.layers[h].enabled=!0,t.layers[h].alpha=n[i].alpha?100*parseFloat(n[i].alpha):100,t.layers[h].options=n[i].options?JSON.stringify(n[i].options):"{}",t.layers.splice(i,0,y.layers.splice(h,1)[0])))}}}}},r.prototype.findIdInArray=function(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i].id==t)return i;return-1},r.prototype.buildViews=function(){if(this.core.getMap()){var e=this.views,t="";for(var i in e)t+='<div class="vts-views-item" id="vts-views-item-'+i+'"><div class="vts-layers-name2">'+i+'</div><button id="vts-views-cbutton-'+i+'" type="button" title="Clone">C</button><button id="vts-views-xbutton-'+i+'" type="button" title="Remove">X</button></div>';this.viewItems.innerHTML=t;for(i in e){r="vts-views-cbutton-"+i,document.getElementById(r).onclick=this.switchView.bind(this,i,r,"clone"),r="vts-views-xbutton-"+i,document.getElementById(r).onclick=this.switchView.bind(this,i,r,"remove");var r="vts-views-item-"+i;document.getElementById(r).onclick=this.selectView.bind(this,i)}}},r.prototype.buildSurfaces=function(){var e,t,i=this.views[this.currentView],r=i.surfaces,s="",a=null;for(t in r)s+='<div id="vts-surface-item-'+t+'" class="vts-surface-item"><input id="vts-surface-checkbox-'+t+'" type="checkbox"/><span title='+t+">"+t+"</span></div>",null===a&&(a=t);this.surfacesItems.innerHTML=s,this.currentSurface=a;for(t in r)r[t].enabled&&(e="vts-surface-checkbox-"+t,document.getElementById(e).checked=!0);for(t in r)e="vts-surface-checkbox-"+t,document.getElementById(e).onchange=this.switchSurface.bind(this,t,e),e="vts-surface-item-"+t,document.getElementById(e).onclick=this.selectSurface.bind(this,t)},r.prototype.buildBoundLayers=function(e){var t=this.views[this.currentView],i="";if(t.surfaces[e])for(var r=t.surfaces[e].layers,s=0,a=r.length;s<a;s++){var n=r[s];i+='<div class="vts-layers-item"><input id="vts-boundlayer-checkbox-'+n.id+'" type="checkbox" '+(n.enabled?"checked":"")+'/><div class="vts-layers-name">'+n.id+'</div><input id="vts-boundlayer-spinner-'+n.id+'" type="number" title="Alpha" min="0" max="100" step="10" value="'+n.alpha+'"><button id="vts-boundlayer-obutton-'+n.id+'" type="button" title="Options">O</button><button id="vts-boundlayer-ubutton-'+n.id+'" type="button" title="Move Above">&uarr;</button><button id="vts-boundlayer-dbutton-'+n.id+'" type="button" title="Move Bellow">&darr;</button></div>'}if(this.boundLayersItems.innerHTML=i,t.surfaces[e])for(s=0,a=r.length;s<a;s++){var o="vts-boundlayer-checkbox-"+r[s].id;document.getElementById(o).onchange=this.switchBoundLayer.bind(this,r[s].id,o,"enable"),o="vts-boundlayer-spinner-"+r[s].id,document.getElementById(o).onchange=this.switchBoundLayer.bind(this,r[s].id,o,"alpha"),o="vts-boundlayer-obutton-"+r[s].id,document.getElementById(o).onclick=this.switchBoundLayer.bind(this,r[s].id,o,"options"),o="vts-boundlayer-ubutton-"+r[s].id,document.getElementById(o).onclick=this.switchBoundLayer.bind(this,r[s].id,o,"up"),o="vts-boundlayer-dbutton-"+r[s].id,document.getElementById(o).onclick=this.switchBoundLayer.bind(this,r[s].id,o,"down")}},r.prototype.buildFreeLayers=function(){var e=this.views[this.currentView],t=e.freeLayers,i="";for(var r in t)i+='<div class="vts-surface-item" id="vts-freelayer-item-'+r+'"><input id="vts-freelayer-checkbox-'+r+'" type="checkbox" '+(t[r].enabled?"checked":"")+"/><span title="+r+">"+r+"</span></div>";this.freeLayersItems.innerHTML=i;for(r in t){var s="vts-freelayer-checkbox-"+r;document.getElementById(s).onchange=this.switchFreeLayer.bind(this,r,s),s="vts-freelayer-item-"+r,document.getElementById(s).onclick=this.selectFreeLayer.bind(this,r)}},r.prototype.buildFreeLayerProperties=function(e){var t,i,r,s=this.core.getMap(),a=this.views[this.currentView],n=a.freeLayers[e].layers,o="";if(s&&s.getFreeLayer(e)){switch(s.getFreeLayer(e).getInfo().type){case"mesh":case"mesh-tiles":for(o+='<div class="vts-layers-item"><div class="vts-layers-name" style="width:90px">DepthOffset:</div><input id="vts-fl-properties-depth-shift" type="number" min="-100" max="100" step="1" value="'+a.freeLayers[e].depthShift+'"><input id="vts-fl-properties-depth-shift2" type="number" min="-100" max="100" step="1" value="'+a.freeLayers[e].depthShift2+'"><input id="vts-fl-properties-depth-shift3" type="number" min="-100" max="100" step="1" value="'+a.freeLayers[e].depthShift3+'"></div>',o+='<div class="vts-layers-item"><div class="vts-layers-name">BoundLayers:</div></div>',t=0,i=n.length;t<i;t++){var h=n[t];o+='<div class="vts-layers-item"><input id="vts-fl-properties-checkbox-'+h.id+'" type="checkbox" '+(h.enabled?"checked":"")+'/><div class="vts-layers-name">'+h.id+'</div><input id="vts-fl-properties-spinner-'+h.id+'" type="number" title="Alpha" min="0" max="100" step="10" value="'+h.alpha+'"><button id="vts-fl-properties-ubutton-'+h.id+'" type="button" title="Move Above">&uarr;</button><button id="vts-fl-properties-dbutton-'+h.id+'" type="button" title="Move Bellow">&darr;</button></div>'}for(this.freeLayersPropertiesItems.innerHTML=o,r="vts-fl-properties-depth-shift",document.getElementById(r).onchange=this.switchFreeLayerProperty.bind(this,r,"depthShift"),r="vts-fl-properties-depth-shift2",document.getElementById(r).onchange=this.switchFreeLayerProperty.bind(this,r,"depthShift2"),r="vts-fl-properties-depth-shift3",document.getElementById(r).onchange=this.switchFreeLayerProperty.bind(this,r,"depthShift3"),t=0,i=n.length;t<i;t++)r="vts-fl-properties-checkbox-"+n[t].id,document.getElementById(r).onchange=this.switchFreeLayerBoundLayer.bind(this,n[t].id,r,"enable"),r="vts-fl-properties-spinner-"+n[t].id,document.getElementById(r).onchange=this.switchFreeLayerBoundLayer.bind(this,n[t].id,r,"alpha"),r="vts-fl-properties-ubutton-"+n[t].id,document.getElementById(r).onclick=this.switchFreeLayerBoundLayer.bind(this,n[t].id,r,"up"),r="vts-fl-properties-dbutton-"+n[t].id,document.getElementById(r).onclick=this.switchFreeLayerBoundLayer.bind(this,n[t].id,r,"down");break;case"geodata":case"geodata-tiles":o+='<div class="vts-layers-item"><div class="vts-layers-name" style="width:50px">Style:</div><select id="vts-layers-fl-properties-style">';var l=s.getStylesheets(),u=l.indexOf(a.freeLayers[e].style||a.freeLayers[e].originalStyle);for(t=0,i=l.length;t<i;t++)o+='<option value="'+l[t]+'" '+(t==u?"selected":"")+">"+l[t]+"</option>";o+="</select></div>",this.freeLayersPropertiesItems.innerHTML=o,r="vts-layers-fl-properties-style",document.getElementById(r).onchange=this.switchFreeLayerProperty.bind(this,r,"style")}}},r.prototype.selectView=function(e){if(this.views[e]){var t;this.currentView&&(t=document.getElementById("vts-views-item-"+this.currentView))&&(t.style.backgroundColor="initial"),t=document.getElementById("vts-views-item-"+e),t.style.backgroundColor="#ddd",this.currentView=e,this.buildSurfaces(),this.selectSurface(this.currentSurface),this.buildFreeLayers(),this.applyMapView()}},r.prototype.switchView=function(e,t,i){var r=this.views;for(var s in this.views)if(s==e){switch(i){case"clone":for(var a=2;;){if(!r[e+" #"+a]){r[e+" #"+a]=JSON.parse(JSON.stringify(r[e]));break}a++}this.buildViews();break;case"remove":var n=0;for(s in r)n++;if(n>1)if(delete r[e],this.buildViews(),this.currentView==e)for(s in r){this.selectView(s);break}else this.selectView(this.currentView)}break}},r.prototype.switchSurface=function(e,t){var i=document.getElementById(t);this.views[this.currentView].surfaces[e].enabled=i.checked,this.applyMapView()},r.prototype.selectSurface=function(e){var t;this.currentSurface&&(t=document.getElementById("vts-surface-item-"+this.currentSurface),t.style.backgroundColor="initial"),t=document.getElementById("vts-surface-item-"+e),t&&(t.style.backgroundColor="#ddd"),this.currentSurface=e,this.buildBoundLayers(this.currentSurface)},r.prototype.switchBoundLayer=function(e,t,i){for(var r=document.getElementById(t),s=this.views[this.currentView],a=s.surfaces[this.currentSurface].layers,n=0,o=a.length;n<o;n++)if(a[n].id==e){switch(i){case"enable":a[n].enabled=r.checked;break;case"alpha":a[n].alpha=parseInt(r.value,10);break;case"options":break;case"up":a.splice(Math.max(0,n-1),0,a.splice(n,1)[0]),this.selectSurface(this.currentSurface);break;case"down":a.splice(Math.max(0,n+1),0,a.splice(n,1)[0]),this.selectSurface(this.currentSurface)}break}this.applyMapView()},r.prototype.switchFreeLayer=function(e,t){var i=document.getElementById(t);this.views[this.currentView].freeLayers[e].enabled=i.checked,this.applyMapView()},r.prototype.selectFreeLayer=function(e){var t;this.currentFreeLayer&&(t=document.getElementById("vts-freelayer-item-"+this.currentFreeLayer),t.style.backgroundColor="initial"),t=document.getElementById("vts-freelayer-item-"+e),t.style.backgroundColor="#ddd",this.currentFreeLayer=e,this.buildFreeLayerProperties(this.currentFreeLayer)},r.prototype.switchFreeLayerBoundLayer=function(e,t,i){for(var r=document.getElementById(t),s=this.views[this.currentView],a=s.freeLayers[this.currentFreeLayer].layers,n=0,o=a.length;n<o;n++)if(a[n].id==e){switch(i){case"enable":a[n].enabled=r.checked;break;case"alpha":a[n].alpha=parseInt(r.value,10);break;case"up":a.splice(Math.max(0,n-1),0,a.splice(n,1)[0]),this.selectFreeLayer(this.currentFreeLayer);break;case"down":a.splice(Math.max(0,n+1),0,a.splice(n,1)[0]),this.selectFreeLayer(this.currentFreeLayer)}break}this.applyMapView()},r.prototype.switchFreeLayerProperty=function(e,t){var i=document.getElementById(e),r=this.views[this.currentView],s=r.freeLayers[this.currentFreeLayer];switch(t){case"depthShift":s.depthShift=parseInt(i.value,10);break;case"depthShift2":s.depthShift2=parseInt(i.value,10);break;case"depthShift3":s.depthShift3=parseInt(i.value,10);break;case"style":s.style=i.value}this.applyMapView()},r.prototype.applyMapView=function(e){var t,i,r,s={surfaces:{},freeLayers:{},options:{}},a=this.views[this.currentView],n=a.surfaces;s.options=JSON.parse(JSON.stringify(a.options));for(var o in n)if(n[o].enabled){var h=[];for(r=n[o].layers,t=0,i=r.length;t<i;t++)if(r[t].enabled){var l=JSON.parse(JSON.stringify(r[t].options)),u=JSON.stringify(l);if(r[t].alpha<100){var c={id:r[t].id,alpha:(.01*r[t].alpha).toFixed(2)};"{}"!=u&&(c.options=l),h.push(c)}else h.push(r[t].id)}s.surfaces[o]=h}var d=a.freeLayers;for(o in d)if(d[o].enabled){var p=[];for(r=d[o].layers,t=0,i=r.length;t<i;t++)if(r[t].enabled)if(r[t].alpha<100){var c={id:r[t].id,alpha:(.01*r[t].alpha).toFixed(2)};"{}"!=u&&(c.options=l),p.push(c)}else p.push(r[t].id);s.freeLayers[o]={},p.length>0&&(s.freeLayers[o].boundLayers=p),d[o].style&&d[o].style!=d[o].originalStyle&&(s.freeLayers[o].style=d[o].style),0==d[o].depthShift&&0==d[o].depthShift2&&0==d[o].depthShift3||(s.freeLayers[o].depthOffset=[parseFloat(d[o].depthShift.toFixed(2)),parseFloat(d[o].depthShift2.toFixed(2)),parseFloat(d[o].depthShift3.toFixed(2))])}if(this.jsonText.value=JSON.stringify(s,null,"  "),this.jsonText2.value=encodeURIComponent(JSON.stringify(s)),!e){var f=this.core.getMap();if(!f)return;f.setView(s,null,!0)}},r.prototype.showPanel=function(){this.element.style.display="block",this.panelVisible=!0,this.updatePanel()},r.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},r.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},r.prototype.updatePanel=function(){this.panelInitialized||(this.panelInitialized=!1,this.initViews(),this.buildViews(),this.selectView(this.currentView))},t.a=r},function(e,t,i){"use strict";var r=i(6),s=i(4),a=i(1),n=s.a,o=r.a,h=a.b,l=a.e,u=function(e){this.inspector=e,this.core=e.core};u.prototype.init=function(){var e=this.inspector;e.addStyle("#vts-replay-panel {font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;display: none;padding:15px;width: 618px;font-size: 14px;position: absolute;right: 10px;top: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-replay-panel-left {width: 253px;height: 100%;float: left;}#vts-replay-panel-right {width: 340px;height: 100%;float: right;}#vts-replay-items {width: 240px;overflow-x: hidden;border: 1px solid #ddd;padding-right: 5px;}.vts-replay-item {width: 100%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}#vts-replay-lod-slider {width: 240px;}#vts-replay-lod-text {width: 60px;margin-left: 10px;margin-right: 10px;}#vts-replay-lod-single {margin-left: 10px;}#vts-replay-time-slider {width: 330px;}#vts-replay-time-text {width: 60px;margin-left: 10px;margin-right: 10px;}#vts-replay-time-single {margin-left: 10px;}#vts-replay-panel-gtime canvas{border: 1px solid #555;}#vts-replay-panel-gtime span{font-size: 10px;}#vts-replay-info {width: 240px;height: 140px;overflow-x: hidden;border: 1px solid #ddd;padding-right: 5px;margin-top: 10px;font-size: 12px;word-wrap: break-word;}"),this.element=document.createElement("div"),this.element.id="vts-replay-panel",this.element.innerHTML='<div id="vts-replay-panel-left"><div id="vts-replay-items"></div><div id="vts-replay-panel-lod"><input id="vts-replay-lod-slider" type="range" min="0" max="30" step="1" value="30" /><br/><span>LOD:</span><input id="vts-replay-lod-text" type="text" value="30"/><input id="vts-replay-lod-up" type="button" value="<"/><input id="vts-replay-lod-down" type="button" value=">"/><input id="vts-replay-lod-single" type="checkbox"/><span>Single</span></div><div id="vts-replay-info"></div></div><div id="vts-replay-panel-right"><div id="vts-replay-panel-gtime"><span id="vts-replay-info-meshes">Meshes Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-meshes" width=340 height=30></canvas><br/><span id="vts-replay-info-textures">Internal Textures Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-textures" width=340 height=30></canvas><br/><span id="vts-replay-info-textures2">External Textures Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-textures2" width=340 height=30></canvas><br/><span id="vts-replay-info-geodata">Geodata Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-geodata" width=340 height=30></canvas><br/><span id="vts-replay-info-metatiles">Metatiles Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-metatiles" width=340 height=30></canvas><br/><span id="vts-replay-info-intervals">Interval Count: 0 Min/Max: 0/0 Avg. 0</span><br/><canvas id="vts-replay-canvas-intervals" width=340 height=30></canvas><br/><span id="vts-replay-info-threads">Threads Min/Max: 0/0 Avg. 0 </span><br/><canvas id="vts-replay-canvas-threads" width=340 height=30></canvas><br/></div><div id="vts-replay-panel-time"><input id="vts-replay-time-slider" type="range" min="0" max="2000" value="0" /><br/><span>File:</span><input id="vts-replay-time-text" type="text" value="0"/><input id="vts-replay-time-up" type="button" value="<"/><input id="vts-replay-time-down" type="button" value=">"/><input id="vts-replay-time-single" type="checkbox"/><span>Single</span></div></div>',this.core.element.appendChild(this.element),this.items=document.getElementById("vts-replay-items"),this.lodSlider=document.getElementById("vts-replay-lod-slider"),this.lodSlider.onchange=this.onSliderChange.bind(this,"lod"),this.lodSlider.oninput=this.onSliderChange.bind(this,"lod"),this.lodText=document.getElementById("vts-replay-lod-text"),this.lodText.onchange=this.onTextChange.bind(this,"lod"),document.getElementById("vts-replay-lod-up").onclick=this.onSliderChange.bind(this,"lod","down"),document.getElementById("vts-replay-lod-down").onclick=this.onSliderChange.bind(this,"lod","up"),document.getElementById("vts-replay-lod-single").onclick=this.onSliderChange.bind(this,"lod","single"),this.timeSlider=document.getElementById("vts-replay-time-slider"),this.timeSlider.onchange=this.onSliderChange.bind(this,"time"),this.timeSlider.oninput=this.onSliderChange.bind(this,"time"),this.timeText=document.getElementById("vts-replay-time-text"),this.timeText.onchange=this.onTextChange.bind(this,"time"),this.timeInfo=document.getElementById("vts-replay-info"),document.getElementById("vts-replay-time-up").onclick=this.onSliderChange.bind(this,"time","down"),document.getElementById("vts-replay-time-down").onclick=this.onSliderChange.bind(this,"time","up"),document.getElementById("vts-replay-time-single").onclick=this.onSliderChange.bind(this,"time","single"),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.infoMeshes=document.getElementById("vts-replay-info-meshes"),this.ctxMeshes=document.getElementById("vts-replay-canvas-meshes").getContext("2d"),this.infoTextures=document.getElementById("vts-replay-info-textures"),this.ctxTextures=document.getElementById("vts-replay-canvas-textures").getContext("2d"),this.infoTextures2=document.getElementById("vts-replay-info-textures2"),this.ctxTextures2=document.getElementById("vts-replay-canvas-textures2").getContext("2d"),this.infoGeodata=document.getElementById("vts-replay-info-geodata"),this.ctxGeodata=document.getElementById("vts-replay-canvas-geodata").getContext("2d"),this.infoMetatiles=document.getElementById("vts-replay-info-metatiles"),this.ctxMetatiles=document.getElementById("vts-replay-canvas-metatiles").getContext("2d"),this.infoIntervals=document.getElementById("vts-replay-info-intervals"),this.ctxIntervals=document.getElementById("vts-replay-canvas-intervals").getContext("2d"),this.infoThreads=document.getElementById("vts-replay-info-threads"),this.ctxThreads=document.getElementById("vts-replay-canvas-threads").getContext("2d"),this.cameraLines=[],this.cameraLines2=[],this.cameraLines3=[],this.cameraGenarated=!1,this.panelVisible=!1},u.prototype.showPanel=function(){this.buildReplayCombo(),this.element.style.display="block",this.panelVisible=!0;var e=this.core.getMap();if(e){var t=e.draw.replay;this.updateFileInfo(t.loadedIndex),this.updateLoadGraphs()}},u.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},u.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},u.prototype.onSliderChange=function(e,t){if("lod"==e)switch(t){case"up":this.lodSlider.stepUp(),this.lodText.value=this.lodSlider.value;break;case"down":this.lodSlider.stepDown(),this.lodText.value=this.lodSlider.value;break;default:this.lodText.value=this.lodSlider.value}else switch(t){case"up":this.timeSlider.stepUp(),this.timeText.value=this.timeSlider.value;break;case"down":this.timeSlider.stepDown(),this.timeText.value=this.timeSlider.value;break;default:this.timeText.value=this.timeSlider.value}var i=this.core.getMap();if(i){var r=i.draw.replay;"lod"==e?(r.lod=parseFloat(this.lodText.value),r.singleLod=document.getElementById("vts-replay-lod-single").checked):(r.loadedIndex=parseFloat(this.timeText.value),r.singleLodedIndex=document.getElementById("vts-replay-time-single").checked,this.updateFileInfo(r.loadedIndex),this.updateLoadGraphs()),i.markDirty()}},u.prototype.onTextChange=function(e){"lod"==e?this.lodSlider.value=this.lodText.value:this.timeSlider.value=this.timeText.value;var t=this.core.getMap();if(t){var i=t.draw.replay;"lod"==e?i.lod=parseFloat(this.lodText.value):(i.loadedIndex=parseFloat(this.timeText.value),this.updateFileInfo(i.loadedIndex),this.updateLoadGraphs()),t.markDirty()}},u.prototype.generateCameraLines=function(e){var t=this.core.getRendererInterface(),i=e.position,r=e.center;this.cameraLines=[i,r],this.cameraLines2=[[i],[i],[i],[i]];var s=16,a=this.core.getMap(),o=a.camera.getRotationviewMatrix(),u=l.create();l.inverse(o,u),this.cameraMatrix=u;for(var c,d,p,f,g=Math.tan(n.radians(a.camera.getFov())),m=g*a.camera.getAspect(),v=Math.sqrt(g*g+m*m),y=Math.atan(v/1),b=e.cameraDistance/s,x=.5*b*Math.tan(y),w=x*a.camera.getAspect(),S=0;S<s;S++)c=[-w,-x,-b],d=[w,-x,-b],p=[w,x,-b],f=[-w,x,-b],h.scale(c,S+1),h.scale(d,S+1),h.scale(p,S+1),h.scale(f,S+1),l.multiplyVec3(u,c),l.multiplyVec3(u,d),l.multiplyVec3(u,p),l.multiplyVec3(u,f),h.add(c,i),h.add(d,i),h.add(p,i),h.add(f,i),this.cameraLines2[0].push(c),this.cameraLines2[1].push(d),this.cameraLines2[2].push(p),this.cameraLines2[3].push(f);for(this.cameraLines3=[[i],[i],[i],[i]],s=256,b=(e.distance+12742e3*1.1)/s,x=.5*b*Math.tan(y),w=x*a.camera.getAspect(),S=0;S<s;S++)c=[-w,-x,-b],d=[w,-x,-b],p=[w,x,-b],f=[-w,x,-b],h.scale(c,S+1),h.scale(d,S+1),h.scale(p,S+1),h.scale(f,S+1),l.multiplyVec3(u,c),l.multiplyVec3(u,d),l.multiplyVec3(u,p),l.multiplyVec3(u,f),h.add(c,i),h.add(d,i),h.add(p,i),h.add(f,i),this.cameraLines3[0].push(c),this.cameraLines3[1].push(d),this.cameraLines3[2].push(p),this.cameraLines3[3].push(f);c=[-w,-x,-b],d=[w,-x,-b],p=[w,x,-b],f=[-w,x,-b],h.scale(c,s),h.scale(d,s),h.scale(p,s),h.scale(f,s),i=[0,0,0];var M=[i[0],i[1],i[2],c[0],c[1],c[2],d[0],d[1],d[2],i[0],i[1],i[2],d[0],d[1],d[2],p[0],p[1],p[2],i[0],i[1],i[2],p[0],p[1],p[2],f[0],f[1],f[2],i[0],i[1],i[2],f[0],f[1],f[2],c[0],c[1],c[2]],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];this.frustumState=t.createState({blend:!0,zwrite:!1,ztest:!0,culling:!1}),this.frustumMesh=t.createMesh({vertices:M,uvs:A,normals:C}),this.cameraGenarated=!0},u.prototype.itemButton=function(e,t){var i=this.core.getMap();if(i){var r=i.draw.replay;switch(e){case"DrawnTiles":r.storeTiles=!0;break;case"DrawnTilesFreeLayers":r.storeFreeTiles=!0;break;case"TracedNodes":r.storeNodes=!0;break;case"TracedNodesFreeLayers":r.storeFreeNodes=!0;break;case"LoadSequence":r.storeLoaded="S"==t,"S"==t?(r.loadedIndex=0,r.loaded=[]):(this.updateFileInfo(r.loadedIndex),this.updateLoadGraphs());break;case"Camera":if("S"==t){var s=r.camera={distance:i.camera.distance,position:i.camera.position.slice(),vector:i.camera.vector.slice(),center:i.camera.center.slice(),height:i.camera.height};r.cameraPos=i.getPosition(),this.generateCameraLines(s)}else r.cameraPos&&i.setPosition(r.cameraPos)}i.markDirty()}},u.prototype.switchItem=function(e,t){var i=document.getElementById(t),r=this.core.getMap();if(r){var s=r.draw.replay;switch(e){case"DrawnTiles":s.drawTiles=i.checked;break;case"DrawnTilesFreeLayers":s.drawFreeTiles=i.checked;break;case"TracedNodes":s.drawNodes=i.checked;break;case"TracedNodesFreeLayers":s.drawFreeNodes=i.checked;break;case"LoadSequence":s.drawLoaded=i.checked;break;case"Camera":this.cameraGenarated||this.itemButton("Camera"),this.drawCamera=i.checked;break;case"Globe":var a=this.core.getRenderer();if(!this.globeTexture){this.globeTexture=new o(a.gpu,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAEACAMAAADyTj5VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0Mzk4RkVFMzlGNjUxMUU2OTBDM0I0OEM1NjU0RURBMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0Mzk4RkVFNDlGNjUxMUU2OTBDM0I0OEM1NjU0RURBMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjQzOThGRUUxOUY2NTExRTY5MEMzQjQ4QzU2NTRFREEzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjQzOThGRUUyOUY2NTExRTY5MEMzQjQ4QzU2NTRFREEzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+5rvbhAAAAAZQTFRFwcHBLS0tMDfv/wAAAiZJREFUeNrs2LENAEEIA0HTf9ME5DTgIZn8ta+TnLjymzuW6kMIwIcQgA8hAAqAAmBdAM4O4E/wBPgQAqAAKAAKgAKgHcDZAegJoAAoAAqAAqAAaAdwdgB6AigACoACoAAoANoBnB2AngAKgAKgACgACoB2AGcHoCeAAqAAKAAKgAKgHcDZAegJoAAoAAqAAqAAaAdwdgB6AigACoACoAAoANoBnB2AngAKgAKgACgACoB2AGcHoCeAAqAAKAAKgAKgHcDZAegJoAAoAAqAAqAAaAdwdgB6AigACoACEIAPIQAfwg7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABSAAH0IAPoQAfAgB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQALQDODsAPQEUAAVAAVAAFADtAM4OQE8ABUABUAAUAAVAO4CzA9ATQAFQABQABUAB0A7g7AD0BFAAFAAFQAFQAPxcAQYAZt2IEFFJhxsAAAAASUVORK5CYII=",this.core,null,!0)}this.drawGlobe=i.checked,this.drawGlobe=this.drawGlobe}r.markDirty()}},u.prototype.updateLoadGraphs=function(){var e=this.core.getMap();if(e){var t=e.draw.replay,i=t.loaded,r=t.loadedIndex;this.timeSlider.max=i.length;var s,a=340;this.ctxMeshes.fillStyle="#000000",this.ctxMeshes.fillRect(0,0,a,30),this.ctxTextures.fillStyle="#000000",this.ctxTextures.fillRect(0,0,a,30),this.ctxTextures2.fillStyle="#000000",this.ctxTextures2.fillRect(0,0,a,30),this.ctxGeodata.fillStyle="#000000",this.ctxGeodata.fillRect(0,0,a,30),this.ctxMetatiles.fillStyle="#000000",this.ctxMetatiles.fillRect(0,0,a,30),this.ctxIntervals.fillStyle="#000000",this.ctxIntervals.fillRect(0,0,a,30),this.ctxThreads.fillStyle="#000000",this.ctxThreads.fillRect(0,0,a,30);var n,o=Math.floor(t.loadedIndex/a)*a,h=339,l=o;for(o=0;o<h;o++)if(n=i[o+l]){switch(n.kind){case"mesh":s=this.ctxMeshes;break;case"texture-in":s=this.ctxTextures;break;case"texture-ex":s=this.ctxTextures2;break;case"geodata":s=this.ctxGeodata;break;case"metatile":s=this.ctxMetatiles;break;default:continue}var u=Math.round(Math.min(255,60+20*Math.max(1,n.duration/300)));s.fillStyle="rgb("+u+","+u+","+u+")";var c=n.duration/300*30;s.fillRect(o,30,1,-c),u=Math.round(Math.min(255,60+20*Math.max(1,n.interval/300))),this.ctxIntervals.fillStyle="rgb("+u+","+u+","+u+")",c=n.interval/300*30,this.ctxIntervals.fillRect(o,30,1,-c),this.ctxThreads.fillStyle="rgb(80,80,80)",c=n.threads/e.config.mapDownloadThreads*30,this.ctxThreads.fillRect(o,30,1,-c)}var d=Number.MAX_VALUE,p=0,f=0,g=0,m=Number.MAX_VALUE,v=0,y=0,b=0,x=Number.MAX_VALUE,w=0,S=0,M=0,A=Number.MAX_VALUE,C=0,T=0,P=0,F=Number.MAX_VALUE,L=0,E=0,k=0,N=Number.MAX_VALUE,B=0,I=0,R=0,U=Number.MAX_VALUE,D=0,z=0,_=0;for(h=i.length,o=0;o<h;o++)if(n=i[o]){switch(n.kind){case"mesh":n.duration<d&&(d=n.duration),n.duration>p&&(p=n.duration),f+=n.duration,g++;break;case"texture-in":n.duration<m&&(m=n.duration),n.duration>v&&(v=n.duration),y+=n.duration,b++;break;case"texture-ex":n.duration<x&&(x=n.duration),n.duration>w&&(w=n.duration),S+=n.duration,M++;break;case"geodata":n.duration<A&&(A=n.duration),n.duration>C&&(C=n.duration),T+=n.duration,P++;break;case"metatile":n.duration<F&&(F=n.duration),n.duration>L&&(L=n.duration),E+=n.duration,k++;break;default:continue}n.threads<N&&(N=n.threads),n.threads>B&&(B=n.threads),I+=n.threads,R++,n.threads<U&&(U=n.threads),n.threads>D&&(D=n.threads),z+=n.threads,_++}r-=l,this.ctxMeshes.fillStyle="#ff0000",this.ctxMeshes.fillRect(r-1,0,1,30),this.ctxMeshes.fillRect(r+1,0,1,30),this.ctxTextures.fillStyle="#ff0000",this.ctxTextures.fillRect(r-1,0,1,30),this.ctxTextures.fillRect(r+1,0,1,30),this.ctxTextures2.fillStyle="#ff0000",this.ctxTextures2.fillRect(r-1,0,1,30),this.ctxTextures2.fillRect(r+1,0,1,30),this.ctxGeodata.fillStyle="#ff0000",this.ctxGeodata.fillRect(r-1,0,1,30),this.ctxGeodata.fillRect(r+1,0,1,30),this.ctxMetatiles.fillStyle="#ff0000",this.ctxMetatiles.fillRect(r-1,0,1,30),this.ctxMetatiles.fillRect(r+1,0,1,30),this.ctxIntervals.fillStyle="#ff0000",this.ctxIntervals.fillRect(r-1,0,1,30),this.ctxIntervals.fillRect(r+1,0,1,30),this.ctxThreads.fillStyle="#ff0000",this.ctxThreads.fillRect(r-1,0,1,30),this.ctxThreads.fillRect(r+1,0,1,30),g||(d=0,p=0),b||(m=0,v=0),M||(x=0,w=0),P||(A=0,C=0),k||(F=0,L=0),R||(N=0,B=0),_||(U=0,D=0),f=g?f/g:0,y=b?y/b:0,S=M?S/M:0,T=P?T/P:0,E=k?E/k:0,z=_?z/_:0,I=R?I/R:0,this.infoMeshes.innerHTML="Meshes Min/Max/Avg/Count: "+d.toFixed(0)+"/"+p.toFixed(0)+"/"+f.toFixed(1)+"/"+g,this.infoTextures.innerHTML="Internal Textures Min/Max/Avg/Count: "+m.toFixed(0)+"/"+v.toFixed(0)+"/"+y.toFixed(1)+"/"+b,this.infoTextures2.innerHTML="External Textures Min/Max/Avg/Count: "+x.toFixed(0)+"/"+w.toFixed(0)+"/"+S.toFixed(1)+"/"+M,this.infoGeodata.innerHTML="Geodata Min/Max/Avg/Count: "+A.toFixed(0)+"/"+C.toFixed(0)+"/"+T.toFixed(1)+"/"+P,this.infoMetatiles.innerHTML="Metatiles Min/Max/Avg/Count: "+F.toFixed(0)+"/"+L.toFixed(0)+"/"+E.toFixed(1)+"/"+k,this.infoIntervals.innerHTML="Intervals Min/Max/Avg: "+U.toFixed(0)+"/"+D.toFixed(0)+"/"+z.toFixed(1),this.infoThreads.innerHTML="Threads Min/Max/Avg: "+N+"/"+B+"/"+I.toFixed(1)}},u.prototype.updateFileInfo=function(e){var t=this.core.getMap();if(t){var i=t.draw.replay,r=i.loaded[e];this.timeInfo.innerHTML=r?"Resource Kind: "+r.kind+"<br/>Time: "+r.time.toFixed(2)+"<br/>Duration: "+r.duration.toFixed(2)+"<br/>Interval: "+r.interval.toFixed(2)+"<br/>Priority: "+r.priority.toFixed(2)+"<br/>Threads: "+r.threads+"<br/>"+r.url:""}},u.prototype.buildReplayCombo=function(){if(this.core.getMap()){var e,t,i,r=[["Drawn Tiles",1],["Drawn Tiles - Free Layers",1],["Traced Nodes",1],["Traced Nodes - Free Layers",1],["Load Sequence",2],["Camera",2],["Globe",0]],s=["DrawnTiles","DrawnTilesFreeLayers","TracedNodes","TracedNodesFreeLayers","LoadSequence","Camera","Globe"],a="";for(e=0,t=r.length;e<t;e++)a+='<div id="vts-replay-item-'+s[e]+'" class="vts-replay-item"><input id="vts-replay-checkbox-'+s[e]+'" type="checkbox"/><span title='+r[e][0]+">"+r[e][0]+"&nbsp;&nbsp;</span>",r[e][1]>0&&(a+='<input id="vts-replay-sbutton-'+s[e]+'" type="button" value="S"/>'),r[e][1]>1&&(a+='<input id="vts-replay-fbutton-'+s[e]+'" type="button" value="'+("Camera"==s[e]?"R":"F")+'"/>'),a+="</div>";for(this.items.innerHTML=a,e=0,t=r.length;e<t;e++)i="vts-replay-checkbox-"+s[e],document.getElementById(i).onchange=this.switchItem.bind(this,s[e],i),r[e][1]>0&&(i="vts-replay-sbutton-"+s[e],document.getElementById(i).onclick=this.itemButton.bind(this,s[e],"S")),r[e][1]>1&&(i="vts-replay-fbutton-"+s[e],document.getElementById(i).onclick=this.itemButton.bind(this,s[e],"Camera"==s[e]?"R":"F"))}},t.a=u},function(e,t,i){"use strict";var r=i(13),s=function(e){this.inspector=e,this.core=e.core};s.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-stats-panel {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;display: none;padding:15px;width: 305px;font-size: 14px;position: absolute;right: 10px;top: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-stats-panel-info {margin-top: 5px;margin-bottom: 3px;overflow: hidden;}#vts-stats-panel-info table {color:#000000;text-align: left;font-size: 12px;}#vts-stats-panel-info table td {vertical-align: top;}#vts-stats-panel-pos {width: 100%;}'),this.element=document.createElement("div"),this.element.id="vts-stats-panel",this.element.innerHTML='<span id="vts-stats-panel-title">Render statistics &nbsp;&nbsp;&nbsp;v'+i.i(r.a)()+'</h3><p id="vts-stats-panel-info"></p><input id="vts-stats-panel-pos" type="text">',this.core.element.appendChild(this.element),this.infoElement=document.getElementById("vts-stats-panel-info"),this.posElement=document.getElementById("vts-stats-panel-pos"),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.panelVisible=!1},s.prototype.showPanel=function(){this.element.style.display="block",this.panelVisible=!0},s.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},s.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},s.prototype.updateStatsPanel=function(e){if(this.infoElement&&this.panelVisible){var t=this.inspector,i="FPS: "+Math.round(e.fps)+"<br/>Render time: "+Math.round(1e3*e.renderTime)+"<br/> - resources: "+Math.round(e.gpuRenderUsed/1048576)+"MB<br/> - topdown: "+Math.round(e.gpuNeeded/1048576)+"MB<br/>GPU Cache: "+Math.round(e.gpuUsed/1048576)+"MB<br/> - textures: "+Math.round(e.gpuTextures/1048576)+"MB<br/> - meshes: "+Math.round(e.gpuMeshes/1048576)+"MB<br/> - geodata: "+Math.round(e.gpuGeodata/1048576)+"MB<br/>CPU Cache: "+Math.round(e.resourcesUsed/1048576)+"MB<br/>Metaile Cache: "+Math.round(e.metaUsed/1048576)+"MB<br/>Draw calls: "+e.drawCalls+"<br/>Polygons: "+e.drawnFaces+"<br/><br/>Terrain Height: "+e.heightTerrain.toFixed(2)+"<br/>- float: "+e.heightDelta.toFixed(2)+"<br/>- desired lod: "+e.heightLod.toFixed(2)+"<br/>- used lod: "+e.heightNode.toFixed(2)+"<br/>- used source: "+(2==e.heightClass?"navtile":1==e.heightClass?"node":"---")+"<br/>Terrain Radar Lod: "+t.radarLod+"<br/><br/>Loaded/Errors: "+e.loadedCount+" / "+e.loadErrorCount+"<br/>Load time: "+(.001*(e.loadLast-e.loadFirst)).toFixed(2)+"s <br/>",r=this.core.renderer;r&&(i+="<br/>Render jobs: "+r.totalJobs+"<br/>Drawn jobs: "+r.drawnJobs+"<br/>Jobs total time: "+Math.round(1e3*(r.jobsTimer2-r.jobsTimer1))+"<br/>Jobs reduce time: "+Math.round(1e3*r.jobsTimer4)+"<br/>"),e.debugStr&&(i+=e.debugStr+"<br/>");var s="PixelRatio: "+(window.devicePixelRatio||1).toFixed(3)+"<br/>BFRate: "+Math.round(1e3/(e.frameTime+1e-5))+"<br/><br/>",a=this.core.getMap();a&&(s+="ReduceMode: <br/>"+a.config.mapFeaturesReduceMode+"<br/>ReduceParams: <br/>"+JSON.stringify(a.config.mapFeaturesReduceParams)+"<br/><br/>",a.draw.debug.meshStats&&(s+="TexelsPerPoly: "+(e.meshesUVArea/Math.max(1,e.meshesFaces)).toFixed(2)+"<br/><br/>")),s+="Metatiles: "+e.processedMetatiles+"<br/>Metanodes: "+e.processedNodes+" / "+e.usedNodes+"<br/>GeodataTiles: "+e.drawnGeodataTiles+"<br/><br/>",r&&(s+="Nodes: "+r.drawnNodes+"<br/><br/>"),s+="Tiles: "+e.drawnTiles+"<br/>";for(var n=0,o=e.renderedLods.length;n<o;n++)e.renderedLods[n]&&(s+="LOD "+n+": "+e.renderedLods[n]+"<br/>");var h='<table style="width:305px"><tr><td>'+i+"</td><td>"+s+"</td></tr></table>";if(this.infoElement.innerHTML=h,a){var l=a.getPosition(),u="";u+=l.getViewMode()+",";var c=l.getCoords();u+=c[0]+","+c[1]+","+l.getHeightMode()+","+c[2].toFixed(2)+",";var d=l.getOrientation();u+=d[0].toFixed(2)+","+d[1].toFixed(2)+","+d[2].toFixed(2)+",",u+=l.getViewExtent().toFixed(2)+","+l.getFov().toFixed(2),this.posElement.value!=u&&(this.posElement.value=u)}}},t.a=s},function(e,t,i){"use strict";var r=function(e){this.inspector=e,this.core=e.core};r.prototype.init=function(){var e=this.inspector;e.addStyle('#vts-stylesheets-panel * {all: initial;}#vts-stylesheets-panel {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;display: none;padding:15px;width: 1200px;height: 350px;font-size: 14px;position: absolute;right: 10px;bottom: 10px;cursor: default;background-color: rgba(255,255,255,0.95);border-radius: 5px;border: solid 1px #ccc;text-align: left;z-index: 7;padding: 10px;}#vts-stylesheets-panel-header {width: 100%;height: 28px;}#vts-stylesheets-panel-combo {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 13px;border: 1px solid #a9a9a9;width: 1070px;height: 17px;padding: 2px;margin-bottom: 5px;-webkit-appearance: menulist;-moz-appearance: menulist;}#vts-stylesheets-panel-combo option {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 13px;}#vts-stylesheets-panel-update-button {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 14px;float: right;background-color: #dedede;padding: 3px 2px 2px 2px;border: 1px solid #a0a0a0;border-radius: 2px;margin-right: 5px;}#vts-stylesheets-panel-hide-button {font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;font-size: 14px;float: right;background-color: #dedede;padding: 3px 2px 2px 2px;border: 1px solid #a0a0a0;border-radius: 2px;}#vts-stylesheets-panel-text {font-family: monospace;border: 1px solid #a9a9a9;padding: 2px 0px 0px 2px;width: 100%;height: 300px;resize: none;white-space: pre;}'),this.element=document.createElement("div"),this.element.id="vts-stylesheets-panel",this.element.innerHTML='<div id="vts-stylesheets-panel-header"><select id="vts-stylesheets-panel-combo"></select><button id="vts-stylesheets-panel-hide-button" type="button" title="Hide">Hide</button><button id="vts-stylesheets-panel-update-button" type="button" title="Update">Update</button></div><textarea id="vts-stylesheets-panel-text" rows="4" cols="50">aa\naa\n</textarea>',this.core.element.appendChild(this.element),this.optionsElement=document.getElementById("vts-stylesheets-panel-combo"),this.optionsElement.onchange=this.onComboSwitched.bind(this),this.textElement=document.getElementById("vts-stylesheets-panel-text"),document.getElementById("vts-stylesheets-panel-update-button").onclick=this.onUpdate.bind(this),document.getElementById("vts-stylesheets-panel-hide-button").onclick=this.hidePanel.bind(this),this.element.addEventListener("mouseup",e.doNothing.bind(this),!0),this.element.addEventListener("mousedown",e.doNothing.bind(this),!0),this.element.addEventListener("mousewheel",e.doNothing.bind(this),!1),this.element.addEventListener("dblclick",e.doNothing.bind(this),!1),this.textElement.addEventListener("keyup",e.doNothing.bind(this),!1),this.textElement.addEventListener("keydown",e.doNothing.bind(this),!1),this.panelVisible=!1},r.prototype.showPanel=function(){this.buildStylesheetsCombo(),this.element.style.display="block",this.panelVisible=!0},r.prototype.hidePanel=function(){this.element.style.display="none",this.panelVisible=!1},r.prototype.switchPanel=function(){this.panelVisible?this.hidePanel():this.showPanel()},r.prototype.onComboSwitched=function(){var e=this.core.getMap();if(e){var t=e.getStylesheet(this.optionsElement.value);this.textElement.value=this.niceStyleFormat(t)}},r.prototype.onUpdate=function(){var e=this.core.getMap();e&&e.setStylesheetData(this.optionsElement.value,JSON.parse(this.textElement.value))},r.prototype.niceStyleFormat=function(e){if(!e||!e.data)return"";e=e.data;var t="";t+="{\n";var i=[];e.constants&&i.push("constants"),e.bitmaps&&i.push("bitmaps"),e.fonts&&i.push("fonts"),e.layers&&i.push("layers");for(var r=0,s=i.length;r<s;r++){var a=i[r];t+='  "'+a+'": {\n';var n=e[a],o=[];for(var h in n)o.push(h);for(var l=0,u=o.length;l<u;l++)if("layers"==a){var c=n[o[l]],d=[];for(var p in c)d.push(p);t+='    "'+o[l]+'": {\n';for(var f=0,g=d.length;f<g;f++)t+='      "'+d[f]+'": '+JSON.stringify(c[d[f]])+(f==g-1?"":",")+"\n";t+="    }"+(l==u-1?"":",\n")}else t+='    "'+o[l]+'": '+JSON.stringify(n[o[l]])+(l==u-1?"":",")+"\n";t+="\n  }"+(r==s-1?"":",\n")}return t+="\n}"},r.prototype.buildStylesheetsCombo=function(){var e=this.core.getMap();if(e){for(var t="",i=e.getStylesheets(),r=0,s=i.length;r<s;r++)t+='<option value="'+i[r]+'">'+i[r]+"</option>";this.optionsElement.innerHTML=t;var a=e.getStylesheet(i[0]);this.textElement.value=this.niceStyleFormat(a)}},t.a=r},function(e,t,i){"use strict";var r=function(e,t){this.parse(t)};r.prototype.parse=function(e){this.class=e.class||"",this.comment=e.comment||"",this.parent=e.parent||"",this.atmosphere=e.atmosphere||null,this.atmosphere&&(this.atmosphere.colorHorizon||(this.atmosphere.colorHorizon=[0,0,0,0]),this.atmosphere.colorZenith||(this.atmosphere.colorZenith=[0,0,0,0]),this.atmosphere.thickness||(this.atmosphere.thickness=1e5),this.atmosphere.visibility||(this.atmosphere.visibility=1e5))},r.prototype.getInfo=function(){return{class:this.class,comment:this.comment,parent:this.parent,atmosphere:JSON.parse(JSON.stringify(this.atmosphere))}},t.a=r},function(e,t,i){"use strict";var r=function(e,t){this.map=e,this.maxCost=null!=t?t:Number.MAX_VALUE,this.skipCostCheck=!1,this.last=null,this.first=null,this.totalCost=0,this.totalItems=0};r.prototype.updateItem=function(e){if(null!=e&&this.first!=e){null!=e.prev&&(e.prev.next=e.next),null!=e.next&&(e.next.prev=e.prev),this.last==e&&(this.last=e.prev);var t=this.first;this.first=e,this.first.next=t,this.first.prev=null,t.prev=this.first}},r.prototype.getMaxCost=function(){return this.maxCost},r.prototype.setMaxCost=function(e){this.maxCost=e,this.checkCost()},r.prototype.clear=function(){for(var e=this.first;null!=e;)null!=e.destructor&&e.destructor(),e=e.next;this.last=null,this.first=null,this.totalCost=0,this.totalItems=0},r.prototype.insert=function(e,t){this.totalItems++;var i={destructor:e,cost:t,prev:null,next:this.first};return null!=this.first&&(this.first.prev=i),this.first=i,null==this.last&&(this.last=i),this.totalCost+=t,this.checkCost(),i},r.prototype.remove=function(e){this.totalItems++;var t=!1;e==this.first&&(this.first=e.next,t=!0,null!=this.first&&(this.first.prev=null)),e==this.last&&(this.last=e.prev,t=!0,null!=this.last&&(this.last.next=null)),t||(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev)),this.totalCost-=e.cost,e.destructor(),this.checkCost()},r.prototype.checkCost=function(){if(!this.skipCostCheck)for(;this.totalCost>this.maxCost;){this.totalItems--;var e=this.last;if(null==e)break;this.last=this.last.prev,null!=this.last&&(this.last.next=null),this.totalCost-=e.cost,e.destructor()}},r.prototype.addItem=function(e,t){return this.insert(t,e)},r.prototype.removeItem=function(e){return this.remove(e)},r.prototype.itemUsed=function(e){return this.updateItem(e)},t.a=r},function(e,t,i){"use strict";var r=i(1),s=i(4),a=r.b,n=s.a,o=function(e){this.map=e,this.camera=e.renderer.camera,this.distance=10,this.distance2=10,this.position=[0,0,0],this.vector=[0,0,1],this.vector2=[0,0,1,1],this.center=[0,0,0],this.height=0,this.terrainHeight=0,this.lastTerrainHeight=0,this.near=2};o.prototype.update=function(){var e=this.map;e.position.check();var t=e.position.getHeight(),i=e.measure.getOptimalHeightLod(e.position.getCoords(),e.position.getViewExtent(),e.config.mapNavSamplesPerViewExtent),r=e.measure.getSurfaceHeight(e.position.getCoords(),i,!0);e.stats.heightTerrain=r[0],e.stats.heightDelta=t,"float"==e.position.getHeightMode()&&(t+=r[0]),e.renderer.useSuperElevation&&(t=e.renderer.getSuperElevatedHeight(t));var s=e.measure.getPositionCameraInfo(e.position,e.getNavigationSrs().isProjected());this.camera.setPosition(s.orbitCoords),this.camera.setRotationMatrix(s.rotMatrix),this.vector=s.vector,this.vector2=s.vector2,this.position=s.orbitCoords,this.height=s.orbitHeight+t,this.terrainHeight=this.height-r[0],this.distance2=e.position.getViewDistance(),this.distance=Math.max(this.terrainHeight,this.distance2),this.distance=n.clamp(this.distance,.1,this.camera.getFar()),this.distanceFactor=Math.tan(n.radians(.5*e.position.getFov())),this.perceivedDistance=Math.max(this.terrainHeight,this.distance2*this.distanceFactor),e.renderer.cameraDistance=this.distance,e.renderer.viewExtent=e.position.getViewExtent(),this.camera.setViewHeight(e.position.getViewExtent());var o=e.position.getCoords(),h=e.convert.convertCoords([o[0],o[1],t],"navigation","physical");if(this.center=[h[0],h[1],h[2]],h[0]+=s.orbitCoords[0],h[1]+=s.orbitCoords[1],h[2]+=s.orbitCoords[2],this.camera.setPosition([0,0,0]),this.position=h,this.vector2=[-h[0],-h[1],-h[2],1],a.normalize(this.vector2),this.mapIsProjected=e.getNavigationSrs().isProjected(),this.mapIsProjected)this.vector2[3]=0;else{this.geocentDistance=a.length(this.position);var l=[0,0,0];a.normalize(this.position,l),this.geocentNormal=l}var u=Math.max(this.height,this.distance)/6e5,c=Math.max(this.near,this.near*(20*u));u=Math.max(1,u);var d=10*u*6e5;return this.camera.setParams(.5*e.position.getFov(),c,2*d),s},o.prototype.getCameraHeight=function(){return this.cameraHeight},o.prototype.getMvpMatrix=function(){return this.camera.getMvpMatrix()},o.prototype.getRotationMatrix=function(){return this.camera.getRotationMatrix()},o.prototype.getRotationviewMatrix=function(){return this.camera.getRotationviewMatrix()},o.prototype.getFar=function(){return this.camera.getFar()},o.prototype.getFov=function(){return this.camera.getFov()},o.prototype.getAspect=function(){return this.camera.getAspect()},t.a=o},function(e,t,i){"use strict";var r=i(48),s=i(30),a=i(148),n=i(59),o=i(53),h=i(128),l=i(57),u=i(157),c=i(54),d=s.a,p=r.a,f=a.a,g=n.a,m=o.a,v=h.a,y=l.a,b=u.a,x=c.a,w=function(e,t){this.map=e,this.mapConfig=t,this.parseConfig()};w.prototype.parseConfig=function(){this.parseSrses()&&this.parseBodies()&&this.parseReferenceFrame()&&this.parseCredits()&&this.parseStylesheets()&&this.parseSurfaces()&&this.parseGlues()&&this.parseVirtualSurfaces()&&this.parseBoundLayers()&&this.parseFreeLayers()&&this.parseViews()&&this.parseParams()&&this.parseBrowserOptions();var e=this.map.stats;e.loadedCount=0,e.loadErrorCount=0,e.loadFirst=performance.now(),e.loadLast=this.map.loadFirst},w.prototype.afterConfigParsed=function(){null!=this.mapConfig.position&&this.map.setPosition(this.mapConfig.position,!1),this.map.setView(this.map.initialView)},w.prototype.parseSrses=function(){var e=this.mapConfig.srses;if(this.map.srses={},null==e)return!1;for(var t in e)this.map.addSrs(t,new m(this.map,t,e[t]));return!0},w.prototype.parseBodies=function(){var e=this.mapConfig.bodies;if(this.map.bodies={},null==e)return!0;for(var t in e)this.map.addBody(t,new v(this.map,e[t]));return!0},w.prototype.parseReferenceFrame=function(){var e=this.mapConfig.referenceFrame;return null!=e&&(this.map.referenceFrame=new f(this.map,e),!!this.map.referenceFrame.valid)},w.prototype.parseCredits=function(){var e=this.mapConfig.credits;if(this.map.credits={},null==e)return!1;for(var t in e)this.map.addCredit(t,new d(this.map,e[t]));return!0},w.prototype.parseSurfaces=function(){var e=this.mapConfig.surfaces;if(this.map.surfaces=[],null==e)return!1;for(var t=0,i=e.length;t<i;t++){var r=new y(this.map,e[t]);this.map.addSurface(r.id,r)}return!0},w.prototype.parseVirtualSurfaces=function(){var e=this.mapConfig.virtualSurfaces;if(this.map.virtualSurfaces=[],!this.map.config.mapVirtualSurfaces)return!0;if(null==e)return!0;for(var t=0,i=e.length;t<i;t++){var r=new b(this.map,e[t]);this.map.virtualSurfaces[r.strId]=r}return!0},w.prototype.parseViews=function(){var e=this.mapConfig.namedViews;if(this.map.namedViews=[],e)for(var t in e)this.map.addNamedView(t,new g(this.map,e[t],!0));var i=this.mapConfig.view;return"string"==typeof i&&(i=this.map.namedViews[i]),!i||(i=new g(this.map,i,!0),this.map.initialView=i.getInfo(),!0)},w.prototype.parseGlues=function(){var e=this.mapConfig.glue;if(this.map.glues=[],null==e)return!0;for(var t=0,i=e.length;t<i;t++){var r=new y(this.map,e[t],"glue");this.map.addGlue(r.id.join(";"),r)}return!0},w.prototype.parseBoundLayers=function(){var e=this.mapConfig.boundLayers;if(this.map.boundLayers=[],null==e)return!0;for(var t in e){var i=new p(this.map,e[t],t);this.map.addBoundLayer(t,i)}return!0},w.prototype.parseFreeLayers=function(){var e=this.mapConfig.freeLayers;if(this.map.freeLayers=[],null==e)return!0;for(var t in e){var i=new y(this.map,e[t],"free");this.map.addFreeLayer(t,i)}return!0},w.prototype.parseStylesheets=function(){var e=this.mapConfig.stylesheets;if(this.map.stylesheets=[],null==e)return!0;for(var t in e){var i=new x(this.map,t,e[t]);this.map.addStylesheet(t,i)}return!0},w.prototype.parseParams=function(){return!0},w.prototype.parseBrowserOptions=function(){var e=this.mapConfig.browserOptions;return this.map.browserOptions={},null==e||(this.map.browserOptions=JSON.parse(JSON.stringify(e)),!0)},w.prototype.cloneConfig=function(){return JSON.parse(JSON.stringify(this.mapConfig))},t.a=w},function(e,t,i){"use strict";var r=i(1),s=i(4),a=i(23),n=i.n(a),o=r.e,h=s.a,l=(n.a,function(e){this.map=e,this.renderer=e.renderer,this.config=e.config,this.measure=e.measure,this.isProjected=this.map.getNavigationSrs().isProjected()});l.prototype.convertCoords=function(e,t,i){return this.map.referenceFrame.convertCoords(e,t,i)},l.prototype.movePositionCoordsTo=function(e,t,i,r){var s=e.getCoords();this.map.getNavigationSrs().getSrsInfo();if(r=null==r?1:r,this.isProjected){var a=h.radians(t),n=[-Math.sin(a),Math.cos(a)];e.setCoords2([s[0]+n[0]*i,s[1]+n[1]*i])}else{var o=this.measure.getGeodesic(),l=o.Direct(s[1],s[0],t,i);e.setCoords2([l.lon2,l.lat2]);var u=e.getOrientation();u[0]-=(l.azi1-l.azi2)*r,e.setOrientation(u)}return e},l.prototype.convertPositionViewMode=function(e,t){if(t==e.pos[0])return e;if("obj"==t){if("float"==e.getHeightMode()){var i=!0;this.convertPositionHeightMode(e,"fix",!0)}var r,s=e.getViewDistance(),a=e.getOrientation(),n=h.radians(-a[1]),o=s*Math.sin(n);if(s*=Math.cos(n),this.isProjected){var l=h.radians(a[0]),u=[-Math.sin(l),Math.cos(l)];r=e.getCoords(),r[0]=r[0]+u[0]*s,r[1]=r[1]+u[1]*s}else this.movePositionCoordsTo(e,-a[0],s),r=e.getCoords();r[2]-=o,e.setCoords(r),i&&this.convertPositionHeightMode(e,"float",!0)}else"subj"==t&&(r=this.getPositionCameraCoords(e,e.getHeightMode()),e.setCoords(r));return e.pos[0]=t,e},l.prototype.convertPositionHeightMode=function(e,t,i){if(e.pos[3]==t)return e;var r=this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent),s=this.measure.getSurfaceHeight(e.getCoords(),r);return s[1],"float"==t?(e.pos[3]=t,e.pos[4]=e.pos[4]-s[0]):"fix"==t&&(e.pos[3]=t,e.pos[4]=e.pos[4]+s[0]),e},l.prototype.getPositionCameraCoords=function(e,t){var i=e.getOrientation(),r=o.create();o.multiply(h.rotationMatrix(2,h.radians(-i[0])),h.rotationMatrix(0,h.radians(i[1])),r);var s,a,n=0,l=-1;if("obj"==e.getViewMode()){s=e.getCoords(),"float"==e.getHeightMode()&&(l=this.measure.getOptimalHeightLod(s,e.getViewExtent(),this.config.mapNavSamplesPerViewExtent),a=this.measure.getSurfaceHeight(s,l),n=a[0]);var u=this.measure.getPositionCameraInfo(e,this.isProjected);if(this.isProjected)s[0]+=u.orbitCoords[0],s[1]+=u.orbitCoords[1],s[2]+=u.orbitCoords[2]+n;else{var c=this.convertCoords([s[0],s[1],s[2]+n],"navigation","physical");c[0]+=u.orbitCoords[0],c[1]+=u.orbitCoords[1],c[2]+=u.orbitCoords[2],s=this.convertCoords(c,"physical","navigation")}return"fix"==t?s:(-1==l&&(l=this.measure.getOptimalHeightLod(s,e.getViewExtent(),this.config.mapNavSamplesPerViewExtent)),a=this.measure.getSurfaceHeight(s,l),s[2]-=a[0],s)}return e.getHeightMode()==t?e.getCoords():(l=this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent),a=this.measure.getSurfaceHeight(e.getCoords(),l),s=e.getCoords(),"fix"==t?s[2]+=a[0]:s[2]-=a[0],s)},l.prototype.getPositionNavCoordsFromPublic=function(e,t){var i=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var r=this.measure.getSurfaceHeight(e.getCoords(),t);i[2]+=r[0]}return this.convertCoords(i,"public","navigation")},l.prototype.getPositionPublicCoords=function(e,t){var i=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var r=this.measure.getSurfaceHeight(e.getCoords(),t);i[2]+=r[0]}return this.convertCoords(i,"navigation","public")},l.prototype.getPositionPhysCoords=function(e,t,i){var r=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var s=this.measure.getSurfaceHeight(e.getCoords(),t);r[2]+=s[0]}return this.renderer.useSuperElevation&&i&&(r[2]=this.renderer.getSuperElevatedHeight(r[2])),this.convertCoords(r,"navigation","physical")},l.prototype.getPositionCameraSpaceCoords=function(e,t){var i=e.getCoords();if("float"==e.getHeightMode()){t=null!=t?t:this.measure.getOptimalHeightLod(e.getCoords(),e.getViewExtent(),this.config.mapNavSamplesPerViewExtent);var r=this.measure.getSurfaceHeight(e.getCoords(),t);i[2]+=r[0]}this.renderer.useSuperElevation&&(i[2]=this.renderer.getSuperElevatedHeight(i[2]));var s=this.convertCoords(i,"navigation","physical"),a=this.map.camera.position;return s[0]-=a[0],s[1]-=a[1],s[2]-=a[2],s},l.prototype.getPositionCanvasCoords=function(e,t,i,r){var s;if(i){var a=this.map.camera.position,n=e.getCoords();this.renderer.useSuperElevation&&!r&&(n=this.renderer.transformPointBySE(n)),s=[n[0]-a[0],n[1]-a[1],n[2]-a[2]]}else s=this.getPositionCameraSpaceCoords(e,t);return this.map.renderer.project2(s,this.map.camera.getMvpMatrix())},l.prototype.transformPhysCoordsBySE=function(e){return this.renderer.useSuperElevation?this.renderer.transformPointBySE(e):e},l.prototype.convertCoordsFromPhysToNav=function(e,t,i,r){if(e=this.convertCoords(e,"physical","navigation"),this.renderer.useSuperElevation&&r&&(e[2]=this.renderer.getUnsuperElevatedHeight(e[2])),"float"==t){i=null!=i?i:this.measure.getOptimalHeightLod(e,10,this.config.mapNavSamplesPerViewExtent);var s=this.measure.getSurfaceHeight(e,i);e[2]-=s[0]}return e},l.prototype.getGeodesicLinePoints=function(e,t,i,r){var s,a,n,o,h,l,u=this.measure.navigationSrsInfo,c=t[0]-e[0],d=t[1]-e[1],p=t[2]-e[2];this.isProjected?(n=Math.sqrt(c*c+d*d+p*p),h=1e6):(s=this.measure.getGeodesic(),a=s.Inverse(e[1],e[0],t[1],t[0]),n=a.s12,o=a.azi1,h=2*u.a*Math.PI/4007.5*10);for(var f=[e],g=h;g<n;g+=h)l=g/n,this.isProjected?f.push([e[0]+c*l,e[1]+d*l,e[2]+p*l]):(a=s.Direct(e[1],e[0],o,g),f.push([a.lon2,a.lat2,e[2]+p*l]));return f.push(t),f},t.a=l},function(e,t,i){"use strict";var r=function(e,t,i,r,s,a){this.map=e,this.id=t,this.srs=this.map.getMapsSrs(i),this.extents=r,this.heightRange=s,this.partitioning=a,this.isPole=1==t[0]&&(0==t[1]&&1==t[2]||1==t[1]&&0==t[2])};r.prototype.getInnerCoords=function(e){return this.srs.convertCoordsFrom(e,this.map.getNavigationSrs())},r.prototype.getOuterCoords=function(e){return this.srs.convertCoordsTo(e,this.map.getNavigationSrs())},r.prototype.getPhysicalCoords=function(e,t){return this.srs.convertCoordsTo(e,this.map.getPhysicalSrs(),t)},r.prototype.getPhysicalCoordsFast=function(e,t,i,r,s){return this.srs.convertCoordsToFast(e,this.map.getPhysicalSrs(),t,i,r,s)},r.prototype.getExtents=function(e){return this.srs.convertCoordsFrom(e,this.map.getNavigationSrs())},t.a=r},function(e,t,i){"use strict";var r=i(50),s=i(2),a=r.a,n=s.a,o=function(e,t){this.map=e,this.config=e.config,this.isProjected=this.map.getNavigationSrs().isProjected(),this.stats=e.stats,this.draw=t,this.debug=t.debug,this.core=e.core,this.camera=e.camera,this.renderer=e.renderer,this.getTextSize=this.renderer.draw.getTextSize.bind(this.renderer.draw),this.drawText=this.renderer.draw.drawText.bind(this.renderer.draw)};o.prototype.drawSurfaceTile=function(e,t,i,r,s,a,n,o){if(this.stats.gpuRenderUsed>=this.draw.maxGpuUsed)return!1;if(e.renderReady=!1,e.surface){if(t.hasGeometry()){if(this.debug.drawBBoxes&&!a&&(!e.surface.geodata&&this.debug.drawGeodataOnly||this.drawTileInfo(e,t,i,e.surfaceMesh,r)),this.debug.heightmapOnly&&!a)return e.surface.geodata||e.drawGrid(i),!0;if(!a&&(this.stats.renderedLods[e.id[0]]++,this.stats.drawnTiles++,e.surface.geodata&&this.renderer.drawnGeodataTilesUsed)){var h=this.renderer.project2([.25*(t.bbox2[12]+t.bbox2[15]+t.bbox2[18]+t.bbox2[21])-i[0],.25*(t.bbox2[13]+t.bbox2[16]+t.bbox2[19]+t.bbox2[22])-i[1],.25*(t.bbox2[14]+t.bbox2[17]+t.bbox2[20]+t.bbox2[23])-i[2]],this.camera.getMvpMatrix());h[0]<0||h[1]<0||h[0]>this.renderer.curSize[0]||h[1]>this.renderer.curSize[1]||(this.stats.drawnGeodataTilesPerLayer++,this.stats.drawnGeodataTilesFactor+=Math.pow(Math.abs(e.tiltAngle*e.texelSize),.5)),this.stats.drawnGeodataTiles++}var l=0;do{if(e.resetDrawCommands){if(e.drawCommands=[[],[],[]],e.updateBounds=!0,e.bounds)for(var u in e.bounds)e.bounds[u].viewCoutner=0;e.resetDrawCommands=!1}var c;if(c=e.surface.geodata?this.drawGeodataTile(e,t,i,r,s,a,n,o):this.drawMeshTile(e,t,i,r,s,a,n,o),++l>10)break}while(e.resetDrawCommands);return c}return!0}if(!a&&e.lastRenderState){var d=this.draw.drawChannel;return this.draw.processDrawCommands(i,e.lastRenderState.drawCommands[d],s,!0,e),this.map.applyCredits(e),!0}},o.prototype.drawMeshTile=function(e,t,i,r,s,a,n,o){var h;if(!e.surfaceMesh){if(e.resourceSurface.virtual)return!0;h=e.resourceSurface.getMeshUrl(e.id),e.surfaceMesh=e.resources.getMesh(h,e)}var l,u,c,d=this.draw,p=d.drawChannel,f=!1;if(e.drawCommands[p].length>0&&this.draw.areDrawCommandsReady(e.drawCommands[p],s,n,o))return a||(d.processDrawCommands(i,e.drawCommands[p],s,null,e),this.map.applyCredits(e)),e.lastRenderState=null,!0;if(e.lastRenderState)if(e.surfaceMesh.isReady(!0,s,o)&&e.drawCommands[p].length>0){if(this.draw.areDrawCommandsReady(e.lastRenderState.drawCommands[p],s,n,o))return a||(d.processDrawCommands(i,e.lastRenderState.drawCommands[p],s,!0,e),this.map.applyCredits(e)),!0}else this.draw.areDrawCommandsReady(e.lastRenderState.drawCommands[p],s,n,o)&&(a||(d.processDrawCommands(i,e.lastRenderState.drawCommands[p],s,!0,e),this.map.applyCredits(e)),f=!0);if(e.drawCommands[p].length>0)return!(!this.config.mapHeightfiledWhenUnloaded||a)&&(e.drawGrid(i),!1);if(e.surfaceMesh.isReady(n,s,o)&&!n){var g=e.surfaceMesh.submeshes;e.drawCommands=[[],[],[]],e.imageryCredits={},e.boundsDebug={};var m,v,y,b,x,w,S,M=0;if(S=e.resourceSurface,S||(S=e.surface),S.glue){var A=S.id;for(m=0,v=A.length;m<v;m++){var C=this.map.getSurface(A[m]);C&&(M=Math.max(M,C.specificity))}for(x=0,w=t.credits.length;x<w;x++)e.glueImageryCredits[t.credits[x]]=M}else for(M=S.specificity,x=0,w=t.credits.length;x<w;x++)e.imageryCredits[t.credits[x]]=M;for(m=0,v=g.length;m<v;m++){var T=g[m];if(this.debug.drawBBoxes&&this.debug.drawMeshBBox&&!a&&T.drawBBox(i),T.externalUVs){if(e.updateBounds&&(e.updateBounds=!1,this.updateTileBounds(e,g)),S=e.resourceSurface,e.resourceSurface.glue&&(S=e.resourceSurface.getSurfaceReference(T.surfaceReference)),null!=S){var P=e.bounds[S.id];if(P)if(T.externalUVs)if(P.sequence.length>0)if(P.transparent){T.internalUVs&&(null==e.surfaceTextures[m]&&(h=e.resourceSurface.getTextureUrl(e.id,m),e.surfaceTextures[m]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:e.surfaceTextures[m],material:5})),e.drawCommands[0].push({type:1,state:d.drawBlendedTileState});var F=P.sequence;for(y=0,b=F.length;y<b;y++)if(l=e.boundTextures[F[y]]){for(e.boundsDebug[S.id]||(e.boundsDebug[S.id]=[]),e.boundsDebug[S.id].push(F[y]),u=e.boundLayers[F[y]],c=u.credits,x=0,w=c.length;x<w;x++)e.imageryCredits[c[x]]=u.specificity;e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:l,alpha:P.alpha[F[y]][1],material:7,layer:u,surface:S})}e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:null,material:3}),e.drawCommands[0].push({type:1,state:d.drawTileState})}else{var L=P.sequence[P.sequence.length-1];if(l=e.boundTextures[L]){for(e.boundsDebug[S.id]||(e.boundsDebug[S.id]=[]),e.boundsDebug[S.id].push(L),u=e.boundLayers[L],c=u.credits,x=0,w=c.length;x<w;x++)e.imageryCredits[c[x]]=u.specificity;e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:l,material:6,layer:u,surface:S})}}else if(T.textureLayer){if((u=this.map.getBoundLayerByNumber(T.textureLayer))&&(l=e.boundTextures[u.id])){for(e.boundsDebug[S.id]||(e.boundsDebug[S.id]=[]),e.boundsDebug[S.id].push(u.id),u=e.boundLayers[u.id],c=u.credits,x=0,w=c.length;x<w;x++)e.imageryCredits[c[x]]=u.specificity;e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:l,material:6,layer:u,surface:S})}}else T.internalUVs?(null==e.surfaceTextures[m]&&(h=e.resourceSurface.getTextureUrl(e.id,m),e.surfaceTextures[m]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:e.surfaceTextures[m],material:4})):e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:null,material:2});else T.internalUVs&&(null==e.surfaceTextures[m]&&(h=e.resourceSurface.getTextureUrl(e.id,m),e.surfaceTextures[m]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:e.surfaceTextures[m],material:4}))}}else T.internalUVs&&(null==e.surfaceTextures[m]&&(h=e.resourceSurface.getTextureUrl(e.id,m),e.surfaceTextures[m]=e.resources.getTexture(h,0,null,null,e,!0)),e.drawCommands[0].push({type:2,mesh:e.surfaceMesh,submesh:m,texture:e.surfaceTextures[m],material:4}));e.drawCommands[1].push({type:2,mesh:e.surfaceMesh,submesh:m,material:1})}if(S.pipeline>0)for(this.updateTileHmap(e,t),y=0;y<2;y++){var E=e.drawCommands[y];for(m=0,v=E.length;m<v;m++)2==E[m].type&&(E[m].pipeline=S.pipeline,E[m].hmap=e.hmap)}if(e.resetDrawCommands)return!1;if(d.areDrawCommandsReady(e.drawCommands[p],s,n,o)){if(e.resetDrawCommands)return!1;a||(d.processDrawCommands(i,e.drawCommands[p],s,null,e),this.map.applyCredits(e)),e.lastRenderState=null,f=!0}else e.lastRenderState?this.draw.areDrawCommandsReady(e.lastRenderState.drawCommands[p],s,n,o)&&(a||(d.processDrawCommands(i,e.lastRenderState.drawCommands[p],s,!0,e),this.map.applyCredits(e)),f=!0):this.config.mapHeightfiledWhenUnloaded&&!a&&(e.drawGrid(i),f=!(e.drawCommands[p].length>0))}else e.lastRenderState||!this.config.mapHeightfiledWhenUnloaded||a||(e.drawGrid(i),f=!(e.drawCommands[p].length>0));return f},o.prototype.drawGeodataTile=function(e,t,i,r,s,n,o,h){if(e.id[0]<=1)return!0;if(null==e.surfaceGeodata){var l;if(e.surface.geodataNavtileInfo){var u=this.tree.findNavTile(e.id);if(u&&u.surface){var c=u.surface.getNavUrl(u.id)+";"+u.id[0]+"-"+u.id[1]+"-"+u.id[2]+";"+u.metanode.minHeight+";"+u.metanode.maxHeight;l=e.surface.getGeodataUrl(e.id,encodeURIComponent(c))}}l||(l=e.resourceSurface.getGeodataUrl(e.id,"")),e.surfaceGeodata=e.resources.getGeodata(l,{tile:e,surface:e.surface})}var d=this.draw.drawChannel;if(e.geodataCounter!=e.surface.geodataCounter&&(e.drawCommands=[[],[],[]],null!=e.surfaceGeodataView&&e.surfaceGeodataView.kill(),e.surfaceGeodataView=null,e.geodataCounter=e.surface.geodataCounter),e.drawCommands[d].length>0&&this.draw.areDrawCommandsReady(e.drawCommands[d],s,o,h))return n||(this.draw.processDrawCommands(i,e.drawCommands[d],s,null,e),this.map.applyCredits(e)),e.lastRenderState=null,!0;if(e.surfaceGeodataView||e.surfaceGeodata.isReady(o,s,h)&&!o&&(e.surfaceGeodataView=new a(this.map,e.surfaceGeodata,{tile:e,surface:e.surface})),e.surfaceGeodataView){e.mapdataCredits={};for(var p=e.surface?e.surface.specificity:0,f=0,g=t.credits.length;f<g;f++)e.mapdataCredits[t.credits[f]]=p;return e.drawCommands[d][0]={type:3,geodataView:e.surfaceGeodataView},e.surfaceGeodataView.isReady()}return!1},o.prototype.updateTileHmap=function(e,t){if(t&&t.hasNavtile()&&e.surface){if(!e.surface||!e.resourceSurface)return!1;if(!e.resourceSurface.getHMapUrl)return!1;var i=e.resourceSurface.getHMapUrl(e.id,!0);e.hmap=e.resources.getTexture(i)}else{for(var r=e.parent,s=null;r&&r.id[0]>0;){if(r.metanode&&r.metanode.hasNavtile()){s={sourceTile:r,sourceTexture:null,hmap:!0,tile:e};break}r=r.parent}if(s){var i=e.resourceSurface.getHMapUrl(e.id,!0);e.hmap=e.resources.getTexture(i,null,s,{tile:e,hmap:!0},e,!1),e.hmap.neverReady&&(e.hmap=null)}else e.hmap=null}},o.prototype.updateTileBounds=function(e,t){for(var i=0,r=t.length;i<r;i++){var s=t[i];if(s.externalUVs){var a=e.resourceSurface;if(e.resourceSurface.glue&&(a=e.resourceSurface.getSurfaceReference(s.surfaceReference)),a){var n=e.bounds[a.id];n||(n={sequence:[],alpha:[],transparent:!1,viewCoutner:0},e.bounds[a.id]=n),n.viewCoutner!=e.viewCoutner&&this.updateTileSurfaceBounds(e,s,a,n,n.viewCoutner!=e.viewCoutner)}}}for(var o in e.bounds)e.bounds[o].viewCoutner=e.viewCoutner},o.prototype.getParentTile=function(e,t){for(;e&&e.id[0]>t;)e=e.parent;return e},o.prototype.getTileTextureTransform=function(e,t){var i=t.id[0]-e.id[0],r=e.id[1]<<i,s=e.id[2]<<i,a=1/Math.pow(2,i);return[a,a,(t.id[1]-r)*a,(t.id[2]-s)*a]},o.prototype.updateTileSurfaceBounds=function(e,t,i,r,s){var a,n,o,h;if(!this.config.mapNoTextures)if(i.boundLayerSequence.length>0){if(s){r.sequence=[];for(var l=[],u=[],c=0,d=0,p=i.boundLayerSequence.length;d<p;d++)if((o=i.boundLayerSequence[d][0])&&o.ready&&o.hasTileOrInfluence(e.id)&&i.boundLayerSequence[d][1]>0){if(n=null,e.id[0]>o.lodRange[1]&&(n={sourceTile:this.getParentTile(e,o.lodRange[1]),sourceTexture:null,layer:o,tile:e}),h=e.boundTextures[o.id],h||(a=o.getUrl(e.id),h=e.resources.getTexture(a,o.dataType,n,{tile:e,layer:o},e,!1),1==h.checkType&&(h.checkMask=!0),h.isReady(!0),e.boundTextures[o.id]=h),h.neverReady)continue;var f=!1,g=!1;h.isMaskPosible()&&(h.isMaskInfoReady()?h.getMaskTexture()&&(r.transparent=!0,f=!0):(g=!0,f=!0)),u.push(f);var m=!(i.boundLayerSequence[d][1]<1||f||o.isTransparent);if(m&&c++,l.push(m),r.sequence.push(o.id),r.alpha[o.id]=i.boundLayerSequence[d],e.boundLayers[o.id]=o,(r.alpha[o.id][1]<1||o.isTransparent)&&(r.transparent=!0),g)break}if(c>0){for(var v=[],y=r.sequence.length-1;y>=0;y--){var b=r.sequence[y];if(l[y]){v.unshift(b);break}h=e.boundTextures[b],(r.alpha[b][1]<1||e.boundLayers[b].isTransparent||u[y])&&v.unshift(b)}r.sequence=v}}}else null!=i.textureLayer?s&&(o=this.map.getBoundLayerById(i.textureLayer))&&o.hasTileOrInfluence(e.id)&&(n=null,e.id[0]>o.lodRange[1]&&(n={sourceTile:this.getParentTile(e,o.lodRange[1]),sourceTexture:null,layer:o,tile:e}),r.sequence.push(o.id),e.boundLayers[o.id]=o,e.boundTextures[o.id]||(a=o.getUrl(e.id),e.boundTextures[o.id]=e.resources.getTexture(a,o.dataType,n,{tile:e,layer:o},e,!1))):0!=t.textureLayer&&(o=this.map.getBoundLayerByNumber(t.textureLayer))&&o.hasTileOrInfluence(e.id)&&(n=null,e.id[0]>o.lodRange[1]&&(n={sourceTile:this.getParentTile(e,o.lodRange[1]),sourceTexture:null,layer:o,tile:e}),e.boundLayers[o.id]=o,e.boundTextures[o.id]||(a=o.getUrl(e.id),e.boundTextures[o.id]=e.resources.getTexture(a,o.dataType,n,{tile:e,layer:o},e,!1)))},o.prototype.drawTileInfo=function(e,t,i,r){var s,a=this.debug;if(a.drawMeshBBox||t.drawBBox(i),t.metatile.useVersion<4){var o=t.bbox.min,h=t.bbox.max;s=this.core.getRendererInterface().getCanvasCoords([o[0]+.5*(h[0]-o[0])-i[0],o[1]+.5*(h[1]-o[1])-i[1],h[2]-i[2]],this.camera.getMvpMatrix()),s[2]=.9992*s[2]}else{var l=t.bbox2[3]-t.bbox2[0],u=t.bbox2[4]-t.bbox2[1],c=t.bbox2[5]-t.bbox2[2],d=Math.sqrt(l*l+u*u+c*c);s=this.core.getRendererInterface().getCanvasCoords([.25*(t.bbox2[12]+t.bbox2[15]+t.bbox2[18]+t.bbox2[21])+t.diskNormal[0]*d*.1-i[0],.25*(t.bbox2[13]+t.bbox2[16]+t.bbox2[19]+t.bbox2[22])+t.diskNormal[1]*d*.1-i[1],.25*(t.bbox2[14]+t.bbox2[17]+t.bbox2[20]+t.bbox2[23])+t.diskNormal[2]*d*.1-i[2]],this.camera.getMvpMatrix())}var p,f,g,m,v=a.debugTextSize;if(a.drawLods&&(p=""+e.id[0],this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]-4*v),4*v,p,[1,0,0,1],s[2])),a.drawIndices&&(p=e.id[1]+" "+e.id[2],this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]-11*v),4*v,p,[0,1,1,1],s[2])),a.drawPositions){var y=t.border2;y&&(p=Math.floor(y[0])+" "+Math.floor(y[1])+" "+Math.floor(y[2])+" "+Math.floor(y[3])+" "+Math.floor(y[4])+" "+Math.floor(y[5])+" "+Math.floor(y[6])+" "+Math.floor(y[7])+" "+Math.floor(y[8]),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+3*v),4*v,p,[0,1,1,1],s[2])),y=t.border,y&&(draw.getDrawCommandsGpuSize(e.drawCommands[draw.drawChannel]||e.lastRenderState.drawCommands[draw.drawChannel]),Math.floor(y[0]),Math.floor(y[1]),Math.floor(y[2]),Math.floor(y[3]),Math.floor(y[4]),Math.floor(y[5]),Math.floor(y[6]),Math.floor(y[7]),Math.floor(y[8]),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[0,1,1,1],s[2]))}if(a.drawResources&&r&&(p=(this.draw.getDrawCommandsGpuSize(e.drawCommands[0]||e.lastRenderState.drawCommands[0])/1048576).toFixed(2)+"MB",this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[0,1,0,1],s[2])),a.drawFaceCount&&r&&(p=r.faces+" - "+r.submeshes.length+(e.surface&&e.surface.glue?" - 1":" - 0"),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[0,1,0,1],s[2])),a.drawGPixelSize&&(p=""+(Math.tan(e.metanode.diskAngle2A)*e.metanode.diskDistance*.70710678118/t.displaySize).toFixed(2),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[0,1,0,1],s[2])),a.drawOrder&&(p=this.drawTileCounter+" cmds: "+e.drawCommands[0].length,this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[0,1,0,1],s[2])),(a.drawSurfaces||a.drawSurfaces2)&&(p=JSON.stringify(e.surface.id),a.drawSurfaces2?(m=n.getHashColor2(e.surface.surfaceCounter),m=[m[0],m[1],m[2],1]):m=[1,1,1,1],t.alien&&(p="[A]"+p),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,m,s[2])),a.drawBoundLayers&&e.boundsDebug){var b=e.resourceSurface;if(b.glue)for(f=0,g=b.id.length;f<g;f++)e.boundsDebug[b.id[f]]&&(p="< "+b.id[f]+" >",this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+(10+7*f*2)*v),4*v,p,[1,1,1,1],s[2]),p=JSON.stringify(e.boundsDebug[b.id[f]]),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+(17+7*f*2)*v),4*v,p,[1,1,1,1],s[2]));else e.boundsDebug[b.id]&&(p="< "+b.id+" >",this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[1,1,1,1],s[2]),p=JSON.stringify(e.boundsDebug[b.id]),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+17*v),4*v,p,[1,1,1,1],s[2]))}if(a.drawCredits){p="{ ";for(var x in e.imageryCredits)e.imageryCredits[x]&&(p+=x+":"+e.imageryCredits[x]+", ");for(x in e.glueImageryCredits)e.imageryCredits[x]||(p+=x+":"+e.glueImageryCredits[x]+", ");p+="}",this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+10*v),4*v,p,[1,1,1,1],s[2])}if(a.drawDistance&&(p=e.distance.toFixed(2)+"  "+e.texelSize.toFixed(3)+"  "+t.pixelSize.toFixed(3),p+="--"+e.texelSize2.toFixed(3),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+17*v),4*v,p,[1,0,1,1],s[2])),a.drawNodeInfo){var w=(240&t.flags)>>4;p="v"+t.metatile.version+"-"+t.flags.toString(2)+"-"+(1&w?"1":"0")+(2&w?"1":"0")+(4&w?"1":"0")+(8&w?"1":"0"),p+="-"+t.minHeight+"/"+t.maxHeight+"-"+Math.floor(t.minZ)+"/"+Math.floor(t.maxZ)+"-"+Math.floor(t.surrogatez),this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]-18*v),4*v,p,[1,0,1,1],s[2])}if(a.drawTextureSize&&r){var S=r.submeshes;for(f=0,g=S.length;f<g;f++)if(S[f].internalUVs){var M=e.surfaceTextures[f];if(M){var A=M.getGpuTexture();A&&(p="["+f+"]: "+A.width+" x "+A.height,this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+(17+4*f*2)*v),4*v,p,[1,1,1,1],s[2]))}}else p="["+f+"]: 256 x 256",this.drawText(Math.round(s[0]-.5*this.getTextSize(4*v,p)),Math.round(s[1]+(17+4*f*2)*v),4*v,p,[1,1,1,1],s[2])}},t.a=o},function(e,t,i){"use strict";var r=i(1),s=i(4),a=i(51),n=i(50),o=i(134),h=r.b,l=s.a,u=o.a,c=n.a,d=a.a,p=function(e){this.map=e,this.config=e.config,this.isProjected=e.getNavigationSrs().isProjected(),this.isGeocent=e.isGeocent,this.renderer=e.renderer,this.stats=e.stats,this.camera=e.camera,this.tree=e.tree,this.ndcToScreenPixel=.5*this.renderer.curSize[0],this.debug={heightmapOnly:!1,blendHeightmap:!0,drawBBoxes:!1,drawNBBoxes:!1,drawMeshBBox:!1,drawLods:!1,drawPositions:!1,drawTexelSize:!1,drawWireframe:0,drawTestMode:0,drawTestData:0,drawFaceCount:!1,drawDistance:!1,drawMaxLod:!1,drawGeodataOnly:!1,drawTextureSize:!1,drawNodeInfo:!1,drawLayers:!0,drawBoundLayers:!1,drawSurfaces:!1,drawCredits:!1,drawOrder:!1,drawLabelBoxes:!1,drawAllLabels:!1,drawHiddenLabels:!1,drawEarth:!0,drawGridCells:!1,drawTileCounter:0,drawPolyWires:!1,drawFog:this.config.mapFog,drawGPixelSize:!1,debugTextSize:2,ignoreTexelSize:!1,maxZoom:!1},this.gridFlat=!1,this.gridGlues=!1,this.gridSkipped=!1,this.atmoColor=[216/255,232/255,243/255,1],this.atmoColor2=[72/255,154/255,1,1],this.atmoHeight=5e4,this.atmoHeightFactor=1,this.atmoDensity=1,this.fogDensity=0,this.zFactor=0,this.zFactor2=.003,this.zbufferOffset=null,this.zShift=0,this.zLastShift=0,this.bestMeshTexelSize=1,this.bestGeodataTexelSize=1,this.log8=Math.log(8),this.log2=Math.log(2),this.geodataTilesPerLayer=0,this.drawCounter=0,this.drawChannel=0,this.drawChannelNames=["base","hit"],this.planetRadius=this.isGeocent?e.getNavigationSrs().getSrsInfo().a:100,this.tileBuffer=new Array(500),this.processBuffer=new Array(6e4),this.processBuffer2=new Array(6e4),this.drawBuffer=new Array(6e4),this.drawBuffer2=new Array(6e4),this.tmpVec3=new Array(3),this.tmpVec5=new Array(5),this.bboxBuffer=new Float32Array(24),this.planeBuffer=new Float32Array(27);var t=this.renderer.gpu;this.drawTileState=t.createState({}),this.drawStardomeState=t.createState({zwrite:!1,ztest:!1}),this.drawBlendedTileState=t.createState({zequal:!0,blend:!0}),this.drawAuraState=t.createState({zwrite:!1,blend:!0}),this.drawAtmoState=t.createState({zwrite:!1,ztest:!1,blend:!0}),this.drawAtmoState2=t.createState({zwrite:!1,ztest:!0,blend:!1}),this.degradeHorizonFactor=0,this.degradeHorizonTiltFactor=0,this.replay={camera:null,drawnTiles:null,drawnFreeTiles:null,nodeBuffer:null,tracedNodes:null,tracedFreeNodes:null,storeTiles:!1,storeFreeTiles:!1,storeNodes:!1,storeFreeNodes:!1,storeLoaded:this.config.mapStoreLoadStats,drawGlobe:!1,drawTiles:!1,drawNodes:!1,drawFreeTiles:!1,drawFreeNodes:!1,drawLoaded:!1,lod:30,singleLod:!1,loadedIndex:0,singleLodedIndex:0,loaded:[],loadFirst:0,loadLast:0},this.drawTiles=new u(e,this)};p.prototype.drawMap=function(e){var t=this.map,i=this.renderer,r=this.camera,s=this.replay,a=i.gpu,n=this.debug;1!=this.drawChannel&&(a.setViewport(),t.visibleCredits={imagery:{},glueImagery:{},mapdata:{}});var o=this.isProjected;switch(this.config.mapGridMode){case"none":this.gridSkipped=!0,this.gridFlat=!1,this.gridGlues=!1;break;case"flat":this.gridSkipped=!1,this.gridFlat=!0,this.gridGlues=!1;break;case"linear":this.gridSkipped=!1,this.gridFlat=!1,this.gridGlues=!0;break;case"fastlinear":this.gridSkipped=!1,this.gridFlat=!1,this.gridGlues=!1}var u=this.drawTiles,c=r.update(),i=this.renderer;if(i.debugStr="AsyncImageDecode: "+this.config.mapAsyncImageDecode,i.dirty=!0,i.drawFog=this.debug.drawFog,i.debug=this.debug,i.mapHack=t,i.benevolentMargins=this.config.mapBenevolentMargins,this.config.mapForceFrameTime?-1!=this.config.mapForceFrameTime?i.frameTime=this.config.mapForceFrameTime:i.frameTime=0:i.frameTime=this.stats.frameTime,i.hoverFeatureCounter=0,i.hoverFeatureList=t.hoverFeatureList,i.hoverFeature=t.hoverFeature,i.cameraPosition=r.position,i.cameraOrientation=t.position.getOrientation(),i.cameraTiltFator=Math.cos(l.radians(i.cameraOrientation[1])),i.cameraVector=r.vector,i.cameraViewExtent=t.position.getViewExtent(),i.cameraViewExtent2=Math.pow(2,Math.max(1,Math.floor(Math.log(t.position.getViewExtent())/Math.log(2)))),i.drawLabelBoxes=this.debug.drawLabelBoxes,i.drawGridCells=this.debug.drawGridCells,i.drawAllLabels=this.debug.drawAllLabels,i.drawHiddenLabels=this.debug.drawHiddenLabels,i.debug=this.debug,i.fmaxDist=Number.NEGATIVE_INFINITY,i.fminDist=Number.POSITIVE_INFINITY,o){var d=l.radians(i.cameraOrientation[0]);i.labelVector=[-Math.sin(d),Math.cos(d),0,0,0]}else{var p=c.vector;i.labelVector=[p[0],p[1],p[2],0]}i.distanceFactor=1/Math.max(1,Math.log(r.distance)/Math.log(1.04)),i.tiltFactor=Math.abs(i.cameraOrientation[1]/-90),i.localViewExtentFactor=2*Math.tan(l.radians(.5*t.position.getFov())),this.degradeHorizonFactor=200*this.config.mapDegradeHorizonParams[0],this.degradeHorizonTiltFactor=.5*(1+Math.cos(l.radians(Math.min(180,Math.abs(2*i.cameraOrientation[1]*3))))),1!=this.drawChannel?2==n.drawWireframe?a.clear(!0,!0,[255,255,255,255]):a.clear(!0,!0,[0,0,0,255]):a.clear(!0,!0,[255,255,255,255]),a.setState(this.drawStardomeState),a.setState(this.drawTileState),this.setupDetailDegradation(),t.loader.setChannel(0),this.zFactor=0,this.ndcToScreenPixel=.5*i.curSize[0],this.updateFogDensity(),this.updateGridFactors(),this.maxGpuUsed=Math.max(3929856,t.gpuCache.getMaxCost()-3929856),this.stats.renderBuild=0,this.drawTileCounter=0;var f,g,m,v,y,b,x,w,S,M,A=r.position;if(t.freeLayersHaveGeodata&&0==this.drawChannel&&i.draw.clearJobBuffer(),this.debug.drawEarth){if((s.storeNodes||s.storeFreeNodes)&&(s.nodeBuffer=[]),s.drawGlobe||s.drawTiles||s.drawFreeTiles||s.drawNodes||s.drawFreeNodes||s.drawLoaded){var C=s.lod,T=s.singleLod;if(s.drawTiles&&s.drawnTiles)for(b=s.drawnTiles,f=0,g=b.length;f<g;f++)b[f][1]?(y=b[f][0],u.debug.drawBBoxes&&u.drawTileInfo(y,y.metanode,A),y.drawGrid(A)):(y=b[f][0])&&(T&&y.id[0]==C||!T&&y.id[0]<=C)&&u.drawSurfaceTile(y,y.metanode,A,y.pixelSize,y.priority,!1,!1);if(s.drawFreeTiles&&s.drawnFreeTiles)for(b=s.drawnFreeTiles,f=0,g=b.length;f<g;f++)b[f][1]||(y=b[f][0])&&(T&&y.id[0]==C||!T&&y.id[0]<=C)&&u.drawSurfaceTile(y,y.metanode,A,y.pixelSize,y.priority,!1,!1);if(s.drawNodes&&s.tracedNodes){for(b=s.tracedNodes,x=n.drawBBoxes,n.drawBBoxes=!0,f=0,g=b.length;f<g;f++)(y=b[f])&&(T&&y.id[0]==C||!T&&y.id[0]<=C)&&u.drawTileInfo(y,y.metanode,A,y.surfaceMesh,y.pixelSize);n.drawBBoxes=x}if(s.drawFreeNodes&&s.tracedFreeNodes){for(b=s.tracedFreeNodes,x=n.drawBBoxes,n.drawBBoxes=!0,f=0,g=b.length;f<g;f++)y=b[f],(T&&y.id[0]==C||!T&&y.id[0]<=C)&&u.drawTileInfo(y,y.metanode,A,y.surfaceMesh,y.pixelSize);n.drawBBoxes=x}var P=s.loadedIndex,F=s.singleLodedIndex;if(s.drawLoaded&&s.loaded){var L=s.loaded;for(n.drawBBoxes=!0,f=0,g=L.length;f<g;f++){var E=L[f];E&&E.tile&&E.tile.id&&(y=E.tile,(F&&f==P||!F&&f<=P)&&(T&&y.id[0]==C||!T&&y.id[0]<=C)&&y.metanode&&(y.metanode.hasGeometry()?u.drawSurfaceTile(y,y.metanode,A,y.pixelSize,y.priority,!1,!1):u.drawTileInfo(y,y.metanode,A,y.surfaceMesh,y.pixelSize)))}n.drawBBoxes=x}return void((s.drawFreeTiles&&s.drawnFreeTiles||s.drawLoaded&&s.loaded)&&this.freeLayersHaveGeodata&&0==this.drawChannel&&(i.drawnGeodataTiles=this.stats.drawnGeodataTilesPerLayer,i.drawnGeodataTilesFactor=this.stats.drawnGeodataTilesFactor,i.draw.drawGpuJobs()))}for(f=0,g=this.tileBuffer.length;f<g;f++)this.tileBuffer[f]=null;if(this.tree.surfaceSequence.length>0&&this.tree.draw(),s.storeTiles){for(S=[],f=0,g=this.tileBuffer.length;f<g;f++)if(b=this.tileBuffer[f])for(m=0,v=b.length;m<v;m++)S.push(b[m]);s.cameraPos=A,s.drawnTiles=S,s.storeTiles=!1}if(s.storeNodes){for(M=[],f=0,g=s.nodeBuffer.length;f<g;f++)y=s.nodeBuffer[f],M.push(y);s.cameraPos=A,s.tracedNodes=M,s.storeNodes=!1}for(f=0,g=t.freeLayerSequence.length;f<g;f++)w=t.freeLayerSequence[f],w.ready&&w.tree&&(!w.geodata||w.stylesheet&&w.stylesheet.isReady())&&0==this.drawChannel&&(w.zFactor&&(this.zbufferOffset=w.zFactor),"geodata"==w.type?this.drawMonoliticGeodata(w):w.tree.draw(),this.zbufferOffset=null);if(s.storeFreeTiles){for(S=[],f=0,g=this.tileBuffer.length;f<g;f++)if(b=this.tileBuffer[f])for(m=0,v=b.length;m<v;m++)y=b[m],y.surface&&y.surface.free&&S.push(y);s.cameraPos=A,s.drawnFreeTiles=S,s.storeFreeTiles=!1}if(s.storeFreeNodes){for(M=[],f=0,g=s.nodeBuffer.length;f<g;f++)y=s.nodeBuffer[f],y.surface&&y.surface.free&&M.push(y);s.cameraPos=A,s.tracedFreeNodes=M,s.storeFreeNodes=!1}}var k=t.referenceFrame.body;if(1!=this.drawChannel&&!o&&n.drawFog&&(k&&k.atmosphere||"melown2015"==t.referenceFrame.id||"mars-qsc"==t.referenceFrame.id||"earth-qsc"==t.referenceFrame.id)&&i.progAtmo.isReady()&&i.progAtmo2.isReady()){var N=t.getNavigationSrs().getSrsInfo(),B=N.a,I=N.b,R=this.atmoHeight;i.earthRadius=B,i.earthRadius2=I,i.earthERatio=B/I;var U=[0,0,0,0];h.normalize(r.position,U);var D,z,_=t.getPosition(),G=1-l.clamp(Math.max(.1*R,r.geocentDistance-B)/(10*R),0,1),V=[Math.max(2,128*G),0,0,0];V=[2,(B+R)/B*2,.25,(B+R)/B*2];var O=1/B*2;D=[r.position[0]*O,r.position[1]*O,r.position[2]*O,1];var j=.5*_.getViewExtent()/Math.tan(l.radians(.5*_.getFov())),H=B/(j+B);z=[l.mix(4.4,1.01,H),1,l.mix(5,1.05,H),0],a.setState(this.drawAuraState),i.draw.drawBall([-r.position[0],-r.position[1],-r.position[2]],B+R,I+R,i.progAtmo,V,D,z,this.atmoColor,this.atmoColor2),a.setState(this.drawTileState)}n.drawEarth&&(e||t.freeLayersHaveGeodata&&0==this.drawChannel&&(i.drawnGeodataTiles=this.stats.drawnGeodataTilesPerLayer,i.drawnGeodataTilesFactor=this.stats.drawnGeodataTilesFactor,i.draw.drawGpuJobs())),this.config.mapForceFrameTime&&-1!=this.config.mapForceFrameTime&&(i.frameTime=0,this.config.mapForceFrameTime=-1)},p.prototype.drawToTexture=function(e){this.renderer.switchToFramebuffer("texture",e),this.drawChannel=0,this.map.renderSlots.processRenderSlots(),this.renderer.switchToFramebuffer("base")},p.prototype.drawHitmap=function(){this.drawChannel=1,this.renderer.switchToFramebuffer("depth"),this.map.renderSlots.processRenderSlots(),this.renderer.switchToFramebuffer("base"),this.renderer.hitmapMode>2&&this.renderer.copyHitmap(),this.drawChannel=0,this.map.hitMapDirty=!1},p.prototype.drawGeodataHitmap=function(){this.renderer.gpu.setState(this.drawTileState),this.renderer.switchToFramebuffer("geo"),this.renderer.draw.drawGpuJobs(),this.renderer.advancedPassNeeded&&(this.renderer.switchToFramebuffer("geo2"),this.renderer.draw.drawGpuJobs()),this.renderer.switchToFramebuffer("base"),this.map.geoHitMapDirty=!1},p.prototype.getDrawCommandsGpuSize=function(e){for(var t=0,i=0,r=e.length;i<r;i++){var s=e[i];switch(s.type){case 2:var a=s.mesh,n=this.config.mapNoTextures?0:s.texture;a&&(t+=a.gpuSize),n&&(t+=n.getGpuSize());break;case 3:var o=s.geodataView;o&&(t+=o.size)}}return t},p.prototype.areDrawCommandsReady=function(e,t,i,r){for(var s=!0,a=!!r,n=0,o=e.length;n<o;n++){var h=e[n];switch(h.type){case 2:if(h.pipeline){var l=h.hmap;if(l&&l.isReady(i,t)||(s=!1),9==this.debug.drawTestMode){var u=h.texture,c=!!this.config.mapNoTextures||(!u||u&&u.isReady(i,t,a));c||(s=!1)}break}var d=h.mesh,u=h.texture,p=d&&d.isReady(i,t,a),c=!!this.config.mapNoTextures||(!u||u&&u.isReady(i,t,a));p&&c||(s=!1);break;case 3:var f=h.geodataView;f&&f.isReady(i,t,a)||(s=!1)}}return s},p.prototype.processDrawCommands=function(e,t,i,r,s){t.length>0&&this.drawTileCounter++;for(var a=0,n=t.length;a<n;a++){var o=t[a];switch(o.type){case 1:this.renderer.gpu.setState(o.state);break;case 2:var h=o.pipeline;if(h){var l=o.hmap;if(9==this.debug.drawTestMode){var u=o.texture,c=!!this.config.mapNoTextures||(!u||u&&u.isReady(r,i));c&&l&&l.isReady(r,i)&&s.drawHmapTile(e,null,null,h,u)}else l&&l.isReady(r,i)&&s.drawHmapTile(e,null,null,h);return}var c,d=o.mesh,u=o.texture,p=d&&d.isReady(r,i);if(this.config.mapNoTextures?(c=!0,u=null):c=!u||u&&u.isReady(r,i),p&&c)if(this.debug.drawBBoxes&&this.debug.drawMeshBBox&&d.submeshes[o.submesh].drawBBox(e),u)d.drawSubmesh(e,o.submesh,u,o.material,o.alpha,o.layer,o.surface,s.splitMask);else{var f=o.material;switch(f){case 6:case 4:f=2}d.drawSubmesh(e,o.submesh,u,f,o.alpha,o.layer,o.surface,s.splitMask)}break;case 3:var g=o.geodataView;g&&g.isReady(r,i,!0)&&g.draw(e)}}},p.prototype.drawMonoliticGeodata=function(e){if(e&&0==this.drawChannel&&this.camera.camera.bboxVisible(e.extents,this.camera.position)){var t;if(null==e.monoGeodata&&(t="object"==typeof e.geodataUrl?e.geodataUrl:e.getMonoGeodataUrl(e.id),e.monoGeodata=new d(this.map,t,{tile:null,surface:e})),e.monoGeodataCounter!=e.geodataCounter&&(e.monoGeodataView=null,e.monoGeodataCounter=e.geodataCounter),e.monoGeodata.isReady()&&(e.monoGeodataView||(e.monoGeodataView=new c(this.map,e.monoGeodata,{tile:null,surface:e})),e.monoGeodataView.isReady())){for(var i=this.map.visibleCredits.mapdata,r=0,s=e.credits.length;r<s;r++){var a=e.credits[r],n=i[a];i[a]=n?10>n?10:n:10}e.monoGeodataView.draw(this.camera.position)}}},p.prototype.updateFogDensity=function(){var e=this.map.getPosition(),t=e.getOrientation(),i=this.camera.getFar(),r=Math.max(5,-t[1])/90,s=Math.log(.05)/(this.atmoDensity*i*this.atmoHeightFactor*Math.max(1,1e-4*this.camera.height)*r);s*=5/(Math.min(5e4,Math.max(this.camera.distance,1e3))/5e3),this.debug.drawFog||(s=0),this.fogDensity=s,this.renderer.fogDensity=s},p.prototype.updateGridFactors=function(){for(var e=this.map.referenceFrame.getSpatialDivisionNodes(),t=0,i=e.length;t<i;t++){var r=e[t],s=Math.max(10,this.camera.distance+20),a=2*(r.extents.ur[0]-r.extents.ll[0]),n=Math.log(Math.min(a,s))/this.log8;n=Math.log(a)/this.log8-n,r.gridBlend=n-Math.floor(n),n=Math.floor(Math.floor(n))+1,r.gridStep1=Math.pow(8,n),r.gridStep2=8*r.gridStep1}},p.prototype.setupDetailDegradation=function(e){var t=0;this.map.mobile&&(t=this.config.mapMobileDetailDegradation),e&&(t+=e);this.texelSizeFit=this.config.mapTexelSizeFit*Math.pow(2,t)*1},t.a=p},function(e,t,i){"use strict";var r=i(1),s=r.b,a=function(e,t){switch(this.map=e,this.data=t,this.camera=e.camera,this.renderer=e.renderer,t.type){case"point-geometry":this.type=1,this.vertexBuffer=this.data.geometryBuffer;break;case"line-geometry":this.type=2,this.vertexBuffer=this.data.geometryBuffer,this.indicesBuffer=this.data.indicesBuffer;break;case"polygon-geometry":this.type=3,this.vertexBuffer=this.data.geometryBuffer,this.surface=this.data.surface,this.borders=this.data.borders}};a.prototype.getType=function(){switch(this.type){case 1:return"point";case 2:return"line";case 3:return"polygon"}},a.prototype.getElement=function(e){var t=this.vertexBuffer,i=3*e;switch(this.type){case 1:return[t[i],t[i+1],t[i+2]];case 2:return[[t[i],t[i+1],t[i+2]],[t[i+3],t[i+4],t[i+5]]];case 3:var r=this.surface,s=r[i],a=r[i+1],n=r[i+2];return[[t[s][0],t[s][1],t[s][2]],[t[a][0],t[a][1],t[a][2]],[t[n][0],t[n][1],t[n][2]]]}},a.prototype.getElements=function(e){switch(this.type){case 1:case 3:return this.surface.length/3;case 2:e=e||0;var t=3*this.indicesBuffer[e],i=e+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[e];return Math.max(0,(i-t)/3-1)}},a.prototype.getRelationToCanvasPoint=function(e,t,i){var r,a,n,o,h,l,u,c,d,p,f,g,m,v,m=this.vertexBuffer,y=3*e,b=[0,0,0];switch(r=this.camera.position,a=this.renderer.getScreenRay(t,i),this.type){case 1:var n=[m[y],m[y+1],m[y+2]],x=[n[0]-l[0],n[0]-l[0]];return s.cross(a,x,b),u=s.length(n),{distance:u,point:n};case 2:var w=[m[y],m[y+1],m[y+2]],S=[m[y+3],m[y+4],m[y+5]];g=a,m=[S[0]-w[0],S[1]-w[1],S[2]-w[2]],v=[r[0]-w[0],r[1]-w[1],r[2]-w[2]],o=s.dot(g,g),h=s.dot(g,m),l=s.dot(m,m),u=s.dot(g,v),c=s.dot(m,v),d=o*l-h*h,d<1e-7?(p=0,f=h>l?u/h:c/l):(p=(h*c-l*u)/d,f=(o*c-h*u)/d);var M=[v[0]+g[0]*p-m[0]*f,v[1]+g[1]*p-m[1]*f,v[2]+g[2]*p-m[2]*f];return{closest:[w[0]+m[0]*f,w[1]+m[1]*f,w[2]+m[2]*f],"line-distance":s.length(M),distance:f,line:[w,S]}}},a.prototype.getPathElement=function(e,t){if(2!=this.type)return null;var i=3*(this.indicesBuffer[t||0]+e),r=this.vertexBuffer;return[[r[i],r[i+1],r[i+2]],[r[i+3],r[i+4],r[i+5]]]},a.prototype.getPathPoint=function(e,t){t=t||0;for(var i,r,a=3*this.indicesBuffer[t],n=t+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[t],o=0,h=this.vertexBuffer,l=a;l<n-3;l+=3){if(i=[h[l+3]-h[l],h[l+4]-h[l+1],h[l+5]-h[l+2]],r=s.length(i),o+r>e){var u=(e-o)/r;return[h[l]+i[0]*u,h[l+1]+i[1]*u,h[l+2]+i[2]*u]}o+=r}return[h[n-3],h[n-2],h[n-1]]},a.prototype.getPathNED=function(e,t,i){i=i||0;for(var r,a,n,o=3*this.indicesBuffer[i],h=i+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[i],l=0,u=this.vertexBuffer,c=o;c<h-5;c+=3){if(a=[u[c+3]-u[c],u[c+4]-u[c+1],u[c+5]-u[c+2]],n=s.length(a),l+n>e){var p=(l+n)/e;r=[u[c]+d[0]*p,u[c+1]+d[1]*p,u[c+2]+d[2]*p];break}l+=n}r||(r=[u[h-3],u[h-2],u[h-1]]);var f=[0,0,0],g=[0,0,0],m=[0,0,0];s.nomalize(a,f),s.nomalize(r,m),s.cross(m,f,g),t&&s.cross(m,g,f);var v=g,y=f,b=m;return{east:v,direction:y,north:b,position:r,matrix:[v[0],v[1],v[2],0,b[0],b[1],b[2],0,y[0],y[1],y[2],0,0,0,0,1]}},a.prototype.getPathLengthToElement=function(e,t){t=t||0;for(var i,r,a=3*this.indicesBuffer[t],n=t+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[t],o=0,h=this.vertexBuffer,l=0,u=a;u<n-5;u+=3){if(i=[h[u+3]-h[u],h[u+4]-h[u+1],h[u+5]-h[u+2]],r=s.length(i),e==l)return{lengthToElement:o,elementLengh:r};l++,o+=r}return o},a.prototype.getPathLength=function(e){e=e||0;for(var t,i,r=3*this.indicesBuffer[e],a=e+1>=this.indicesBuffer.length?this.vertexBuffer.length:3*this.indicesBuffer[e],n=0,o=this.vertexBuffer,h=r;h<a-5;h+=3)t=[o[h+3]-o[h],o[h+4]-o[h+1],o[h+5]-o[h+2]],i=s.length(t),n+=i;return n},a.prototype.getPathsCount=function(){return 2!=this.type?0:this.indicesBuffer.length},a.prototype.getSurfaceArea=function(){if(3!=this.type)return 0;if(!this.surfaceArea){var e,t,i,r,s,a,n,o,h,l,u,c=this.vertexBuffer,d=this.surface;this.surfaceArea=0;for(var p=0,f=d.length;p<f;p+=3)e=c[d[p]],t=c[d[p+1]],i=c[d[p+2]],n=t[0]-e[0],o=t[1]-e[1],h=t[2]-e[2],r=Math.sqrt(n*n+o*o+h*h),n=t[0]-i[0],o=t[1]-i[1],h=t[2]-i[2],s=Math.sqrt(n*n+o*o+h*h),n=i[0]-e[0],o=i[1]-e[1],h=i[2]-e[2],a=Math.sqrt(n*n+o*o+h*h),l=(r+s+a)/2,u=Math.sqrt(l*((l-r)*(l-s)*(l-a))),this.surfaceArea+=u}return this.surfaceArea},t.a=a},function(e,t,i){"use strict";var r=i(4),s=i(1),a=i(2),n=i(9),o=r.a,h=s.b,l=a.a,u=n.a,c=function(e,t){this.builder=e,this.map=e.map,this.navSrs=this.map.getNavigationSrs(),this.physSrs=this.map.getPhysicalSrs(),this.srs=this.navSrs,this.rootPath="",this.filesToLoad=0,t=t||{}};c.prototype.processNode=function(e,t,i){var r,s=t.boundingVolume;if(s&&s.region){var a,n=s.region,l=[o.degrees(n[0]),o.degrees(n[1]),n[4]],c=[o.degrees(n[2]),o.degrees(n[3]),n[5]],d=[];d[0]=this.physSrs.convertCoordsFrom([l[0],c[1],c[2]],this.srs),d[1]=this.physSrs.convertCoordsFrom([c[0],c[1],c[2]],this.srs),d[2]=this.physSrs.convertCoordsFrom([c[0],l[1],c[2]],this.srs),d[3]=this.physSrs.convertCoordsFrom([l[0],l[1],c[2]],this.srs),d[4]=this.physSrs.convertCoordsFrom([l[0],c[1],l[2]],this.srs),d[5]=this.physSrs.convertCoordsFrom([c[0],c[1],l[2]],this.srs),d[6]=this.physSrs.convertCoordsFrom([c[0],l[1],l[2]],this.srs),d[7]=this.physSrs.convertCoordsFrom([l[0],l[1],l[2]],this.srs);var p=this.physSrs.convertCoordsFrom([.5*(c[0]+l[0]),.5*(c[1]+l[1]),.5*(c[2]+l[2])],this.srs);a=h.length([d[0][0]-p[0],d[0][1]-p[1],d[0][2]-p[2]]),r={points:d,center:p,radius:a,halfAxis:[[.5*(d[1][0]-d[0][0]),.5*(d[1][1]-d[0][1]),.5*(d[1][2]-d[0][2])],[.5*(d[2][0]-d[1][0]),.5*(d[2][1]-d[1][1]),.5*(d[2][2]-d[1][2])],[.5*(d[4][0]-d[0][0]),.5*(d[4][1]-d[0][1]),.5*(d[4][2]-d[0][2])]]}}var f=t.geometricError;i||(e=this.builder.addNode(e,r,f));var g=t.content;if(g&&g.uri){var m=g.uri;m=u.getProcessUrl(m,this.rootPath),-1!=m.indexOf(".json")?this.loadJSON(m,{internal:!0,node:e}):-1!=m.indexOf(".mesh")&&this.builder.addMesh(e,m)}var v=t.children;if(v)for(var y=0,b=v.length;y<b;y++)this.processNode(e,v[y])},c.prototype.processJSON=function(e){e&&(this.rootPath=rootPath||"",this.processNode(null,e.root))},c.prototype.loadJSON=function(e,t,i){this.filesToLoad++,t=t||{},t.internal||(this.onFinished=i,this.baseOptions=t,t={internal:!0,node:null}),l.loadJSON(e,this.onLoaded.bind(this,e,t),this.onError.bind(this,t))},c.prototype.onLoaded=function(e,t,i){this.rootPath=u.makeAbsolute(e),this.rootPath=u.getBase(this.rootPath),this.processNode(t.node,i.root,!!t.node),!--this.filesToLoad&&this.onFinished&&this.onFinished()},c.prototype.onError=function(){!--this.filesToLoad&&this.onFinished&&this.onFinished()},t.a=c},function(e,t,i){"use strict";var r=function(e,t,i,r){this.builder=e,this.map=e.map,this.heightMode=t||"float",this.srs=i,r=r||{},this.groupIdPrefix=r.groupIdPrefix||"",this.dontCreateGroups=r.dontCreateGroups,this.tesselation=r.tesselation};r.prototype.processGeometry=function(e,t){var i=e.coordinates;if(i)switch(e.type){case"Point":this.builder.addPoint(i,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"MultiPoint":this.builder.addPointArray(i,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"LineString":this.builder.addLineString(i,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"MultiLineString":this.builder.addLineStringArray(i,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs);break;case"Polygon":i.length>0&&this.builder.addPolygon(i[0],i.length>1?i.slice(1):[],null,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs,this.tesselation);break;case"MultiPolygon":for(var r=0,s=i.length;r<s;r++){var a=i[r];a.length>0&&this.builder.addPolygon(a[0],a.length>1?a.slice(1):[],null,this.heightMode,t.properties,t.properties?t.properties.id:null,this.srs,this.tesselation)}break;case"GeometryCollection":var n=e.gemetries;if(n)for(var r=0,s=n.length;r<s;r++)this.processGeometry(n[r],t)}},r.prototype.processFeature=function(e){var t=e.geometry;t&&this.processGeometry(t,e)},r.prototype.processCollection=function(e){var t=e.features;if(t)for(var i=0,r=t.length;i<r;i++)this.processFeature(t[i])},r.prototype.processJSON=function(e){if(e)if(e.type)switch(e.type){case"FeatureCollection":this.dontCreateGroups||this.builder.addGroup(""!=this.groupIdPrefix?this.groupIdPrefix:null),this.processCollection(e);break;case"Feature":this.dontCreateGroups||this.builder.addGroup(""!=this.groupIdPrefix?this.groupIdPrefix:null),this.processFeature(e)}else for(var t in e){var i=e[t];switch(this.dontCreateGroups||this.builder.addGroup(this.groupIdPrefix+t),e.type){case"FeatureCollection":this.processCollection(i);break;case"Feature":this.processFeature(i)}}},t.a=r},function(e,t,i){"use strict";var r=function(e,t,i){this.builder=e,this.map=e.map,this.groupIdPrefix=t||"",this.dontCreateGroups=i};r.prototype.processJSON=function(e){if(e){var t,i,r,s,a,n,o,h,l,u=e.groups,c=this.builder;if(u)for(t=0,i=u.length;t<i;t++){var d=u[t],p=d.bbox,f=d.resolution;if(p&&f){var g=p[0],m=p[1];if(g&&m){this.dontCreateGroups||c.addGroup(this.groupIdPrefix+(d.id||""));var v=(m[0]-g[0])/f,y=(m[1]-g[1])/f,b=(m[2]-g[2])/f,x=d.points;if(x)for(l=x.points,r=0,s=x.length;r<s;r++){var w=x[r],S=w.points,M=new Array(S.length);for(a=0,n=S.length;a<n;a++)o=S[a],M[a]=[g[0]+o[0]*v,g[1]+o[1]*y,g[2]+o[2]*b];c.addPointArray(M,"fix",w.properties,w.id,null,!0)}var A=d.lines;if(A)for(r=0,s=A.length;r<s;r++){var C=A[r],T=C.lines,P=new Array(T.length);for(a=0,n=T.length;a<n;a++){l=T[a],h=new Array(l.length);for(var F=0,L=l.length;F<L;F++)o=l[F],h[F]=[g[0]+o[0]*v,g[1]+o[1]*y,g[2]+o[2]*b];P[a]=h}c.addLineStringArray(P,"fix",C.properties,C.id,null,!0)}var E=d.polygons;if(E){var k={sx:v,sy:y,sz:b,px:g[0],py:g[1],pz:g[2]};for(r=0,s=E.length;r<s;r++){var N=E[r];c.addPolygonRAW(N.vertices,N.surface,N.borders,N.middle,"fix",N.properties,N.id,null,!0,k)}}}}}}},t.a=r},function(e,t,i){"use strict";var r=function(e,t){this.layer=e,this.map=e.map,this.renderer=this.map.renderer,this.killed=!1,this.listener=t,this.busy=!1,this.ready=!0,this.waitingForStylesheet=!1,this.stylesheet=null,this.fonts={},this.processCounter=0;var r=i(119);this.processWorker=new r,this.processWorker.onerror=function(e){throw new Error(e.message+" ("+e.filename+":"+e.lineno+")")},this.processWorker.onmessage=this.onMessage.bind(this),this.processWorker.postMessage({command:"config",data:this.map.config})};r.prototype.kill=function(){this.killed||(this.killed=!0,null!=this.processWorker&&this.processWorker.terminate())},r.prototype.isReady=function(){return this.waitingForStylesheet&&(this.waitingForStylesheet=!this.stylesheet.isReady()),(this.ready&&!this.busy||this.killed)&&!this.waitingForStylesheet},r.prototype.onMessage=function(e,t){if(!this.killed){t||(e=e.data);var i=e.command;if("ready"==i)this.ready=!0;else if("styleDone"==i)this.busy=!1;else if("loadBitmaps"==i){var r=e.bitmaps;for(var s in r){var a=r[s];this.renderer.getBitmap(a.url,a.filter||"linear",a.tiled||!1,a.hash,!0)}}if(null!=this.listener){if("packed-events"==i){for(var n=e.messages,o=0,h=n.length;o<h;o++)this.onMessage(n[o],!0);return}this.listener(i,e)}}},r.prototype.setListener=function(e){this.listener=e},r.prototype.sendCommand=function(e,t,i,r){if(!this.killed){this.ready=!1;var s={command:e,data:t};i&&i.id&&(s.lod=i.id[0],s.ix=i.id[1],s.iy=i.id[2],i.metanode&&(s.tileSize=Math.tan(i.metanode.diskAngle2A)*i.metanode.diskDistance,s.pixelSize=.70710678118*s.tileSize/i.metanode.displaySize)),r&&(s.dpr=r),this.processWorker.postMessage(s)}},r.prototype.setStylesheet=function(e,t){if(this.stylesheet=e,!e.isReady())return void(this.waitingForStylesheet=!0);this.busy=!0;var i=96*(window.devicePixelRatio||1),r=this.map.config,s=r.mapFeaturesReduceParams,a=function(e){return void 0!==e},n=r.mapFeaturesReduceMode;switch(n){case"scr-count1":case"scr-count2":s?(s[0]=a(s[0])?s[0]:1,s[1]=a(s[1])?s[1]:50,s[2]=a(s[2])?s[2]:0):s=[1,50,0],r.mapFeaturesSortByTop="scr-count2"==n;break;case"scr-count4":s?(s[0]=a(s[0])?s[0]:.18,s[1]=a(s[1])?s[1]:0,s[2]=a(s[2])?s[2]:1):s=[.18,0,0],r.mapFeaturesSortByTop=!0;break;case"scr-count5":s?(s[0]=a(s[0])?s[0]:2,s[1]=a(s[1])?s[1]:1,s[2]=a(s[2])?s[2]:1):s=[2,1,0],r.mapFeaturesSortByTop=!0;break;case"scr-count6":case"scr-count7":s?(s[0]=a(s[0])?s[0]:.2,s[1]=a(s[1])?s[1]:0,s[2]=a(s[2])?s[2]:"scr-count6"==n?1:2,s[3]=a(s[3])?s[3]:1,s[4]=a(s[4])?s[4]:1,s[5]=i,r.mapFeaturesSortByTop=!0):s=[.2,0,"scr-count6"==n?1:2,1,1];break;case"scr-count8":s?(s[0]=a(s[0])?s[0]:.2,s[1]=a(s[1])?s[1]:.6,s[2]=a(s[2])?s[2]:11,s[3]=a(s[3])?s[3]:1,s[4]=a(s[4])?s[4]:1e3,s[5]=a(s[5])?s[5]:5,s[6]=i,r.mapFeaturesSortByTop=!0):s=[.2,.6,11,1,1e3,5]}r.mapFeaturesReduceParams=s,r.mapFeaturesReduceFactor=s[2],r.mapFeaturesReduceFactor2=s[3],r.mapFeaturesReduceFactor3=s[4],this.sendCommand("setStylesheet",{data:e.data,geocent:!this.map.getNavigationSrs().isProjected(),metric:r.mapMetricUnits,language:r.mapLanguage,reduceMode:n,reduceParams:r.mapFeaturesReduceParams,log:r.mapLogGeodataStyles});var o=e.fonts,h={};for(var l in o){var u=o[l],c=this.renderer.fonts[u];h[l]=u,c&&this.setFont(u,c)}this.processCounter++,this.sendCommand("setFontMap",{map:h})},r.prototype.setFont=function(e,t){this.fonts[e]||(this.fonts[e]=t,this.sendCommand("setFont",{url:e,data:t.data},[t.data]))},t.a=r},function(e,t,i){"use strict";var r=i(155),s=i(48),a=i(57),n=i(31),o=i(49),h=r.a,l=s.a,u=a.a,c=n.a,d=o.a,p=function(e){this.map=e,this.config=e.config};p.prototype.setPosition=function(e){return this.map.setPosition(e),this},p.prototype.getPosition=function(){return this.map.getPosition()},p.prototype.setView=function(e,t,i){return this.map.setView(e,t,i),this},p.prototype.getView=function(){return this.map.getView()},p.prototype.getCredits=function(){return this.map.getCredits()},p.prototype.getCurrentCredits=function(){return this.map.getVisibleCredits()},p.prototype.getCreditInfo=function(e){var t=this.map.getCreditById(e);return t?t.getInfo():{}},p.prototype.getViews=function(){return this.map.getNamedViews()},p.prototype.getViewInfo=function(e){var t=this.map.getNamedView(e);return t?t.getInfo():{}},p.prototype.getBoundLayers=function(){return this.map.getBoundLayers()},p.prototype.getBoundLayerInfo=function(e){return this.map.getBoundLayerInfo(e)},p.prototype.getFreeLayers=function(){return this.map.getFreeLayers()},p.prototype.getFreeLayerInfo=function(e){var t=this.map.getFreeLayer(e);return t?t.getInfo():{}},p.prototype.getSurfaces=function(){return this.map.getSurfaces()},p.prototype.getSurfaceInfo=function(e){var t=this.map.getFreeLayer(e);return t?t.getInfo():{}},p.prototype.getSrses=function(){return this.map.getSrses()},p.prototype.getSrsInfo=function(e){var t=this.map.getSrs(e);return t?t.getInfo():{}},p.prototype.getReferenceFrame=function(){return this.map.referenceFrame.getInfo()},p.prototype.addFreeLayer=function(e,t){var i=new u(this.map,t,"free");this.map.addFreeLayer(e,i)},p.prototype.removeFreeLayer=function(e){this.map.removeFreeLayer(e)},p.prototype.addBoundLayer=function(e,t){var i=new l(this.map,t,e);this.map.addBoundLayer(e,i)},p.prototype.removeBoundLayer=function(e){this.map.removeBoundLayer(e)},p.prototype.convertPositionViewMode=function(e,t){return this.map.convert.convertPositionViewMode(new c(e),t)},p.prototype.convertPositionHeightMode=function(e,t,i){return this.map.convert.convertPositionHeightMode(new c(e),t,i)},p.prototype.convertCoords=function(e,t,i){var r=this.map.getSrs(e),s=this.map.getSrs(t);return r&&s?s.convertCoordsFrom(i,r):null},p.prototype.convertCoordsFromNavToPublic=function(e,t,i){var r=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionPublicCoords(new c(r),i)},p.prototype.convertCoordsFromPublicToNav=function(e,t,i){var r=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionNavCoordsFromPublic(new c(r),i)},p.prototype.convertCoordsFromPhysToPublic=function(e,t){if(t&&this.map.renderer.useSuperElevation){var i=this.map.renderer.transformPointBySE(e);return this.map.convert.convertCoords(i,"physical","public")}return this.map.convert.convertCoords(e,"physical","public")},p.prototype.convertCoordsFromNavToPhys=function(e,t,i,r){var s=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionPhysCoords(new c(s),i,r)},p.prototype.convertCoordsFromPhysToNav=function(e,t,i,r){return this.map.convert.convertCoordsFromPhysToNav(e,t,i,r)},p.prototype.convertCoordsFromNavToCanvas=function(e,t,i){var r=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionCanvasCoords(new c(r),i)},p.prototype.convertCoordsFromPhysToCanvas=function(e,t){var i=["obj",e[0],e[1],"fix",e[2],0,0,0,10,45];return this.map.convert.getPositionCanvasCoords(new c(i),null,!0,t)},p.prototype.convertCoordsFromNavToCameraSpace=function(e,t,i){var r=["obj",e[0],e[1],t,e[2],0,0,0,10,45];return this.map.convert.getPositionCameraSpaceCoords(new c(r),i)},p.prototype.convertCoordsFromPhysToCameraSpace=function(e){var t=this.map.camera.position;return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},p.prototype.transformPhysCoordsBySE=function(e){return this.map.convert.transformPhysCoordsBySE(e)},p.prototype.getPositionCanvasCoords=function(e,t){return this.map.convert.getPositionCanvasCoords(new c(e),t)},p.prototype.getPositionCameraCoords=function(e,t){return this.map.convert.getPositionCameraCoords(new c(e),t)},p.prototype.movePositionCoordsTo=function(e,t,i,r){return this.map.convert.movePositionCoordsTo(new c(e),t,i,r)},p.prototype.getGeodesicLinePoints=function(e,t,i,r){return this.map.convert.getGeodesicLinePoints(e,t,i,r)},p.prototype.getSurfaceHeight=function(e,t){return this.map.measure.getSurfaceHeight(e,this.map.measure.getOptimalHeightLodBySampleSize(e,t))},p.prototype.getSurfaceAreaGeometry=function(e,t,i,r,s,a){var n=this.map.measure.getSurfaceAreaGeometry(e,t,i,r,!0,a);if(n[0]){var o=n[1],h=[],l=this.map;return l.tree&&(l.storedTilesRes=[],l.tree.storeGeometry(o,o.length),h=l.storedTilesRes,l.storedTilesRes=[]),s(h),function(){}}return this.map.core.once("map-update",this.getSurfaceAreaGeometry.bind(this,e,t,i,r,s,a),1)},p.prototype.getDistance=function(e,t,i,r){return this.map.measure.getDistance(e,t,i,r)},p.prototype.getAzimuthCorrection=function(e,t){return this.map.measure.getAzimuthCorrection(e,t)},p.prototype.getNED=function(e,t){return this.map.measure.getNewNED(e,!1!==t)},p.prototype.getCameraInfo=function(){var e=this.map.camera;return{projectionMatrix:e.camera.projection.slice(),viewMatrix:e.camera.modelview.slice(),viewProjectionMatrix:e.camera.mvp.slice(),rotationMatrix:e.camera.rotationview.slice(),position:this.map.camera.position.slice(),vector:this.map.camera.vector.slice(),distance:this.map.camera.distance,height:this.map.camera.height}},p.prototype.isPointInsideCameraFrustum=function(e){return this.map.camera.camera.pointVisible(e,this.map.camera.position)},p.prototype.isBBoxInsideCameraFrustum=function(e){return this.map.camera.camera.bboxVisible({min:e[0],max:e[1]},this.map.camera.position)},p.prototype.generateTrajectory=function(e,t,i){return e=new c(e),t=new c(t),new h(this.map,e,t,i).generate()},p.prototype.generatePIHTrajectory=function(e,t,i,r){var s=new c(e);return r.distance=i,r.azimuth=t,r.distanceAzimuth=!0,new h(this.map,s,s,r).generate()},p.prototype.setConfigParams=function(e){return this.map.setConfigParams(e),this},p.prototype.setConfigParam=function(e,t){return this.map.setConfigParam(e,t),this},p.prototype.getConfigParam=function(e){return this.map.getConfigParam(e)},p.prototype.redraw=function(){return this.map.markDirty(),this},p.prototype.addRenderSlot=function(e,t,i){return this.map.renderSlots.addRenderSlot(e,t,i),this},p.prototype.moveRenderSlotBefore=function(e,t){return this.map.renderSlots.moveRenderSlotBefore(e,t),this},p.prototype.moveRenderSlotAfter=function(e,t){return this.map.renderSlots.moveRenderSlotAfter(e,t),this},p.prototype.removeRenderSlot=function(e){return this.map.renderSlots.removeRenderSlot(e),this},p.prototype.setRenderSlotEnabled=function(e,t){return this.map.renderSlots.setRenderSlotEnabled(e,t),this},p.prototype.getRenderSlotEnabled=function(e){return this.map.renderSlots.getRenderSlotEnabled(e)},p.prototype.setLoaderSuspended=function(e){return this.map.loaderSuspended=e,this},p.prototype.getLoaderSuspended=function(){return this.map.loaderSuspended},p.prototype.getGpuCache=function(){return this.map.gpuCache},p.prototype.getHitCoords=function(e,t,i,r){return this.map.getHitCoords(e,t,i,r)},p.prototype.getScreenRay=function(e,t){return this.map.getScreenRay(e,t)},p.prototype.renderToImage=function(){return this.map.renderToImage()},p.prototype.getCurrentGeometry=function(){return this.map.getCurrentGeometry()},p.prototype.getStats=function(e){if(e)return{maxZoom:this.map.draw.debug.maxZoom};for(var t=0,i=0,r=this.map.geodataProcessors;i<r;i++)this.map.geodataProcessors[i].busy&&t++;return{bestMeshTexelSize:this.map.bestMeshTexelSize,bestGeodataTexelSize:this.map.bestGeodataTexelSize,downloading:this.map.loader.downloading.length,lastDownload:this.map.loader.lastDownloadTime,surfaces:this.map.tree.surfaceSequence.length,freeLayers:this.map.freeLayerSequence.length,texelSizeFit:this.map.texelSizeFit,loadMode:this.map.config.mapLoadMode,processingTasks:this.map.processingTasks.length,busyWorkers:t,dirty:this.map.dirty,drawnTiles:this.map.stats.drawnTiles,drawnGeodataTiles:this.map.stats.drawnGeodataTiles,renderTime:this.map.stats.rendererTime,frameTime:this.map.stats.frameTime}},p.prototype.click=function(e,t,i){this.map.click(e,t,i)},p.prototype.hover=function(e,t,i,r){this.map.hover(e,t,i,r)},p.prototype.createGeodata=function(){return new d(this.map)},p.prototype.getGeodataGeometry=function(e){return this.map.renderer.geometries[e]},p.prototype.setGeodataSelection=function(e){return this.map.renderer.geodataSelection=e,this.map.markDirty(),this},p.prototype.getGeodataSelection=function(){return this.map.renderer.geodataSelection},t.a=p},function(e,t,i){"use strict";var r=i(2),s=r.a,a=function(e,t){if(this.map=e,this.core=e.core,this.killed=!1,this.config=e.config,this.maxThreads=t||1,this.usedThreads=0,this.maxPending=2*this.maxThreads,this.fadeout=.95,this.pending=[[],[]],this.channel=0,this.downloading=[],this.downloadingTime=[],this.workerTask={},this.lastDownloadTime=0,this.downloaded=0,this.processWorker=null,this.updateThreadCount(),this.config.mapSeparateLoader){var r=i(120);this.processWorker=new r,this.processWorker.onerror=function(e){throw new Error(e.message+" ("+e.filename+":"+e.lineno+")")},this.processWorker.onmessage=this.onWorkerMessage.bind(this),this.processWorker.postMessage({command:"config",data:this.config})}};a.prototype.updateThreadCount=function(){this.maxThreads=this.config.mapDownloadThreads,this.maxPending=Math.max(20,2*this.maxThreads),this.fadeout=(this.maxPending-1)/this.maxPending},a.prototype.setChannel=function(e){this.channel=e},a.prototype.onWorkerMessage=function(e,t){if(!this.killed){t||(e=e.data);var i=e.command;if("packed-events"!=i){var r=e.path,s=this.workerTask[r];if(s){switch(i){case"on-loaded":if(s.onLoaded)switch(s.kind){case"direct-texture":s.onLoaded(e.data,!0,e.filesize);break;case"direct-mesh":s.onLoaded(e.data,!1,!0,e.filesize);break;case"texture":s.onLoaded(new Blob([e.data]));break;default:s.onLoaded(e.data)}break;case"on-error":s.onError&&s.onError()}delete this.workerTask[r]}}else for(var a=e.messages,n=0,o=a.length;n<o;n++)this.onWorkerMessage(a[n],!0)}},a.prototype.processLoadBinary=function(e,t,i,r,a){var n=!!s.useCredentials&&-1!=this.mapLoaderUrl.indexOf(this.map.url.baseUrl);if(this.processWorker){switch(a){case"texture":this.config.mapAsyncImageDecode&&(r="blob",a="direct-texture");break;case"mesh":this.config.mapParseMeshInWorker&&(a="direct-mesh")}switch(a){case"texture":case"direct-texture":case"mesh":case"direct-mesh":case"metadata":case"geodata":this.workerTask[e]={onLoaded:t,onError:i,kind:a},this.processWorker.postMessage({command:"load-binary",path:e,withCredentials:n,xhrParams:this.map.core.xhrParams,responseType:r,kind:a});break;default:s.loadBinary(e,t,i,n,this.map.core.xhrParams,r)}}else"texture"==a&&this.config.mapAsyncImageDecode&&(r="blob"),s.loadBinary(e,t,i,n,this.map.core.xhrParams,r)},a.prototype.load=function(e,t,i,r,s){var a=this.downloading.indexOf(e);if(-1==a){var n=this.pending[this.channel];a=this.map.searchArrayIndexById(n,e),-1!=a?n[a].priority=i:n.unshift({id:e,call:t,priority:i||0,tile:r,kind:s});do{for(var o=!0,h=0,l=n.length-1;h<l;h++)if(n[h].priority>n[h+1].priority){var u=n[h];n[h]=n[h+1],n[h+1]=u,o=!1}}while(!o);n.length>this.maxPending&&n.pop()}},a.prototype.remove=function(e){var t=this.map.searchArrayIndexById(this.pending[this.channel],e);-1!=t&&this.pending[this.channel].splice(t,1)},a.prototype.onLoaded=function(e){var t=this.downloading.indexOf(e.id),i=performance.now(),r=this.map.stats;this.map.draw.replay.storeLoaded&&this.map.draw.replay.loaded.push({url:e.id,kind:e.kind,tile:e.tile,priority:e.priority,time:i,duration:i-this.downloadingTime[t],interval:i-this.lastDownloadTime,threads:this.downloading.length}),this.downloading.splice(t,1),this.downloadingTime.splice(t,1),this.lastDownloadTime=i,this.usedThreads--,this.map.markDirty(),this.update(!0),r.loadedCount++,r.loadLast=i},a.prototype.onLoadError=function(e){var t=this.downloading.indexOf(e.id),i=performance.now(),r=this.map.stats;this.map.draw.replay.storeLoaded&&this.map.draw.replay.loaded.push({url:e.id,kind:e.kind,tile:e.tile,priority:e.priority,time:i,duration:i-this.downloadingTime[t],interval:i-this.lastDownloadTime,threads:this.downloading.length}),this.downloading.splice(t,1),this.downloadingTime.splice(t,1),this.lastDownloadTime=i,this.usedThreads--,this.map.markDirty(),this.update(!0),r.loadErrorCount++,r.loadLast=i},a.prototype.updateChannel=function(e){var t=this.pending[e];this.updateThreadCount();for(var i=0,r=t.length;i<r;i++)t[i].priority*=this.fadeout;for(var s=performance.now();t.length>0&&this.usedThreads<this.maxThreads;){var a=t.shift();-1==this.downloading.indexOf(a.id)&&null!=a.call&&(this.downloading.push(a.id),this.downloadingTime.push(s),this.usedThreads++,this.downloaded++,a.call(a.id,this.onLoaded.bind(this,a),this.onLoadError.bind(this,a)))}},a.prototype.update=function(e){if(!this.map.loaderSuspended&&!this.core.contextLost){!e&&this.processWorker&&this.config.mapPackLoaderEvents&&this.downloading.length&&this.processWorker.postMessage({command:"tick"});for(var t=this.pending.length-1;t>=0;t--)if(this.pending[t].length>0){this.updateChannel(t);break}}},t.a=a},function(e,t,i){"use strict";var r=i(1),s=i(2),a=i(22),n=i(59),o=i(56),h=i(150),l=i(53),u=i(129),c=i(130),d=i(131),p=i(132),f=i(144),g=i(135),m=i(142),v=i(31),y=i(149),b=i(151),x=i(153),w=i(156),S=i(6),M=r.b,A=s.a,C=a.a,T=n.a,P=o.a,F=h.a,L=l.a,E=u.a,k=c.a,N=d.a,B=p.a,I=f.a,R=g.a,U=m.a,D=v.a,z=y.a,_=b.a,G=x.a,V=w.a,O=S.a,j=function(e,t,i,r,s){this.config=r||{},this.setConfigParams(r),this.setLoaderParams(t,s),this.core=e,this.proj4=this.core.getProj4(),this.coreConfig=e.coreConfig,this.killed=!1,this.config=r||{},this.loaderSuspended=!1,this.url=new V(this,i),this.position=new D(["obj",0,0,"fix",0,0,0,0,0,0]),this.lastPosition=this.position.clone(),this.srses={},this.bodies={},this.referenceFrame={},this.credits={},this.creditsByNumber={},this.surfaces={},this.virtualSurfaces={},this.glues={},this.freeLayers={},this.boundLayers={},this.stylesheets={},this.processingTasks=[],this.processingTasks2=[],this.geodataProcessors=[],this.surfaceSequence=new G(this),this.initialView=null,this.currentView=new T(this,{}),this.currentViewString="",this.namedViews={},this.viewCounter=0,this.srsReady=!1,this.surfaceCounter=0,this.freeLayerSequence=[],this.freeLayersHaveGeodata=!1,this.visibleCredits={imagery:{},glueImagery:{},mapdata:{}},this.mobile=!1,this.metanodeBuffer=new Uint8Array(1024),this.gpuCache=new E(this,1024*this.config.mapGPUCache*1024),this.resourcesCache=new E(this,1024*this.config.mapCache*1024),this.metatileCache=new E(this,1024*this.config.mapMetatileCache*1024),this.setupMobileMode(this.config.mapMobileMode),this.setupCache(),this.loader=new U(this,this.config.mapDownloadThreads),this.renderer=this.core.renderer,this.camera=new k(this),this.stats=new _(this),this.resourcesTree=new F(this),this.mapConfig=new N(this,t),this.convert=new B(this),this.measure=new I(this),this.convert.measure=this.measure,this.isGeocent=!this.getNavigationSrs().isProjected(),this.tree=new P(this,!1),this.mapConfig.afterConfigParsed(),this.updateCoutner=0,this.dirty=!0,this.dirtyCountdown=0,this.hitMapDirty=!0,this.geoHitMapDirty=!0,this.clickEvent=null,this.hoverEvent=null,this.hoverFeature=null,this.hoverFeatureId=null,this.lastHoverFeature=null,this.lastHoverFeatureId=null,this.hoverFeatureCounter=0,this.hoverFeatureList=[],this.draw=new R(this),this.draw.setupDetailDegradation();var a,n=this.referenceFrame.body;if(n&&n.atmosphere)a=n.atmosphere.colorHorizon,this.draw.atmoColor=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],a=n.atmosphere.colorZenith,this.draw.atmoColor2=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],this.draw.atmoHeight=n.atmosphere.thickness/1e5*5e4,this.draw.atmoDensity=n.atmosphere.visibility/1e5*(1e5/n.atmosphere.thickness);else switch(this.referenceFrame.id){case"melown2015":case"earth-qsc":this.draw.atmoColor=[216/255,232/255,243/255,1],this.draw.atmoColor2=[72/255,154/255,1,1],this.draw.atmoHeight=5e4;break;case"mars-qsc":this.draw.atmoColor=[1,187/255,157/255,1],this.draw.atmoColor2=[1,155/255,113/255,1],this.draw.atmoHeight=25e3,this.draw.atmoDensity=4}this.draw.atmoHeightFactor=this.draw.atmoHeight/5e4,this.renderSlots=new z(this),this.renderSlots.addRenderSlot("map",this.drawMap.bind(this),!0)};j.prototype.kill=function(){this.killed=!0,this.tree&&this.tree.kill();for(var e in this.freeLayers){var t=this.freeLayers[e];t&&t.tree&&t.tree.kill()}this.gpuCache.clear(),this.resourcesCache.clear(),this.metatileCache.clear(),null!=this.renderer&&(this.renderer.kill(),this.renderer=null)},j.prototype.setupMobileMode=function(){this.mobile=this.config.mapMobileMode,!this.mobile&&this.config.mapMobileModeAutodect&&(this.mobile=C.isMobile()),this.setupCache()},j.prototype.setupCache=function(){if(this.resourcesCache){var e=1/(this.mobile?Math.pow(2,Math.max(0,this.config.mapMobileDetailDegradation-1)):1);e=.5*(e+1/(this.mobile?Math.pow(2,this.config.mapMobileDetailDegradation):1)),this.resourcesCache.setMaxCost(1024*this.config.mapCache*1024*e),this.gpuCache.setMaxCost(1024*this.config.mapGPUCache*1024*e),this.metatileCache.setMaxCost(1024*this.config.mapMetatileCache*1024*(e<.8?.5:1))}},j.prototype.getCoreInterface=function(){return this.core.interface},j.prototype.getRendererInterface=function(){return this.core.interface.getRendererInterface()},j.prototype.setOption=function(){},j.prototype.getOption=function(){},j.prototype.addSrs=function(e,t){this.srses[e]=t},j.prototype.getSrs=function(e){return this.srses[e]},j.prototype.getSrses=function(){return this.getMapKeys(this.srses)},j.prototype.addBody=function(e,t){this.bodies[e]=t},j.prototype.getBody=function(e){return this.bodies[e]},j.prototype.getBodies=function(){return this.getMapKeys(this.bodies)},j.prototype.setReferenceFrame=function(e){this.referenceFrame=e},j.prototype.addCredit=function(e,t){this.credits[e]=t,this.creditsByNumber[t.id]=t,t.key=e},j.prototype.getCreditByNumber=function(e){return this.creditsByNumber[e]},j.prototype.getCreditById=function(e){return this.credits[e]},j.prototype.getCredits=function(){return this.getMapKeys(this.credits)},j.prototype.getVisibleCredits=function(){var e,t,i,r,s=this.visibleCredits.imagery,a=this.visibleCredits.glueImagery,n=[],o=[];for(var h in a)s[h]||(s[h]=a[h]);this.visibleCredits.glueImagery={};for(h in s)n.push(h),o.push(s[h]);do{for(r=!0,e=0,t=o.length-1;e<t;e++)o[e]<o[e+1]&&(i=o[e],o[e]=o[e+1],o[e+1]=i,i=n[e],n[e]=n[e+1],n[e+1]=i,r=!1)}while(!r);var l=this.visibleCredits.mapdata,u=[],c=[];for(h in l)u.push(h),c.push(l[h]);do{for(r=!0,e=0,t=c.length-1;e<t;e++)c[e]<c[e+1]&&(i=c[e],c[e]=c[e+1],c[e+1]=i,i=u[e],u[e]=u[e+1],u[e+1]=i,r=!1)}while(!r);return{"3D":[],imagery:n,mapdata:u}},j.prototype.addSurface=function(e,t){this.surfaces.push(t),t.index=this.surfaces.length-1},j.prototype.getSurface=function(e){return this.searchArrayById(this.surfaces,e)},j.prototype.getSurfaces=function(){for(var e=[],t=0,i=this.surfaces.length;t<i;t++)e.push(this.surfaces[t].id);return e},j.prototype.addGlue=function(e,t){this.glues[e]=t},j.prototype.getGlue=function(e){return this.glues[e]},j.prototype.addBoundLayer=function(e,t){this.boundLayers[e]=t},j.prototype.setBoundLayerOptions=function(e,t){this.boundLayers[e]&&this.boundLayers[e].setOptions(t)},j.prototype.getBoundLayerOptions=function(e){return this.boundLayers[e]?this.boundLayers[e].getOptions():null},j.prototype.removeBoundLayer=function(e){this.boundLayers[e]&&(this.boundLayers[e].kill(),this.boundLayers[e]=null)},j.prototype.getBoundLayerByNumber=function(e){var t=this.boundLayers;for(var i in t)if(t[i].numberId==e)return t[i];return null},j.prototype.getBoundLayerById=function(e){return this.boundLayers[e]},j.prototype.getBoundLayers=function(){return this.getMapKeys(this.boundLayers)},j.prototype.addFreeLayer=function(e,t){this.freeLayers[e]=t,this.setView(this.getView()),this.markDirty()},j.prototype.removeFreeLayer=function(e){this.freeLayers[e]&&(this.freeLayers[e].kill(),this.freeLayers[e]=null,this.setView(this.getView()),this.markDirty())},j.prototype.setFreeLayerOptions=function(e,t){this.freeLayers[e]&&this.freeLayers[e].setOptions(t)},j.prototype.getFreeLayerOptions=function(e){return this.freeLayers[e]?this.freeLayers[e].getOptions():null},j.prototype.getFreeLayer=function(e){return this.freeLayers[e]},j.prototype.getFreeLayers=function(){var e=[];for(var t in this.freeLayers)e.push(t);return e},j.prototype.getMapsSrs=function(e){return null==e?null:-1!=e.indexOf("+proj")?new L(this,{srsDef:e}):this.srses[e]},j.prototype.addNamedView=function(e,t){this.namedViews[e]=t},j.prototype.getNamedView=function(e){return this.namedViews[e]},j.prototype.getNamedViews=function(){return this.getMapKeys(this.namedViews)},j.prototype.setView=function(e,t,i){if(null!=e){if(i&&this.convert){var r=this.getPosition();r=this.convert.convertPositionHeightMode(r,"fix",!0),this.setPosition(r)}if("string"==typeof e)if(e=e.trim(),"{"==e.charAt(0))try{e=JSON.parse(e)}catch(e){return}else{if(!(e=this.getNamedView(e)))return;e=e.getInfo()}var s={};e.surfaces&&(s.surfaces=e.surfaces),e.freeLayers&&(s.freeLayers=e.freeLayers),s=JSON.stringify(s);var a=this.renderer;if(e.options){var n=e.options.superelevation;n&&n[0]&&n[1]&&n[0].length>=2&&n[1].length>=2?(a.setSuperElevationState(!0),a.setSuperElevation(n[0][0],n[1][0],n[0][1],n[1][1])):a.setSuperElevationState(!1)}else a.setSuperElevationState(!1);(s!=this.currentViewString||t)&&(this.currentView.parse(e),this.currentViewString=s,this.viewCounter++,a.draw.clearJobHBuffer()),this.surfaceSequence.generateSurfaceSequence(),this.surfaceSequence.generateBoundLayerSequence(),this.refreshFreelayesInView(),this.markDirty()}},j.prototype.addStylesheet=function(e,t){this.stylesheets[e]=t},j.prototype.getStylesheet=function(e){return this.stylesheets[e]},j.prototype.getStylesheets=function(){var e=[];for(var t in this.stylesheets)e.push(t);return e},j.prototype.getStylesheetData=function(e){var t=this.getStylesheet(e);return t?{url:t.url,data:t.data}:{url:null,data:{}}},j.prototype.setStylesheetData=function(e,t){var i=this.getStylesheet(e);if(this.renderer.draw.clearJobHBuffer(),i){t&&i.setData(t);for(var r in this.freeLayers){var s=this.getFreeLayer(r);s&&s.geodata&&s.stylesheet==i&&(s.geodataProcessor&&s.geodataProcessor.setStylesheet(s.stylesheet),s.geodataCounter++)}}this.markDirty()},j.prototype.getView=function(){return this.currentView.getInfo()},j.prototype.refreshFreelayesInView=function(){var e=this.currentView.freeLayers;this.freeLayerSequence=[];for(var t in e){var i=this.getFreeLayer(t);i&&(i.zFactor=e[t].depthOffset,i.maxLod=e[t].maxLod,this.freeLayerSequence.push(i),e[t].style?i.setStyle(e[t].style):i.setStyle(i.originalStyle))}},j.prototype.refreshView=function(){this.viewCounter++,this.surfaceSequence.generateSurfaceSequence(),this.surfaceSequence.generateBoundLayerSequence(),this.refreshFreelayesInView(),this.markDirty()},j.prototype.searchArrayIndexById=function(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i].id==t)return i;return-1},j.prototype.searchArrayById=function(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i].id==t)return e[i];return null},j.prototype.searchMapByInnerId=function(e,t){for(var i in e)if(e[i].id==t)return e[i];return null},j.prototype.getMapKeys=function(e){var t=[];for(var i in e)t.push(i);return t},j.prototype.getMapIds=function(e){var t=[];for(var i in e)t.push(i.id);return t},j.prototype.setPosition=function(e){this.position=new D(e),this.markDirty()},j.prototype.isReferenceFrameReady=function(){return this.referenceFrame.model.physicalSrs.isReady()&&this.referenceFrame.model.publicSrs.isReady()&&this.referenceFrame.model.navigationSrs.isReady()},j.prototype.getPhysicalSrs=function(){return this.referenceFrame.model.physicalSrs},j.prototype.getPublicSrs=function(){return this.referenceFrame.model.publicSrs},j.prototype.getNavigationSrs=function(){return this.referenceFrame.model.navigationSrs},j.prototype.getPosition=function(){return this.position.clone()},j.prototype.setLoaderParams=function(e,t){var i=[];e&&e.browserOptions&&i.push(e.browserOptions),t&&i.push(t);for(var r=0,s=i.length;r<s;r++){var a=i[r];for(var n in a)switch(n){case"mapSeparateLoader":case"mapGeodataBinaryLoad":case"mapPackLoaderEvents":case"mapParseMeshInWorker":case"mapPackGeodataEvents":this.setConfigParam(n,a[n])}}},j.prototype.setConfigParams=function(e){if("object"==typeof e&&null!==e)for(var t in e)this.setConfigParam(t,e[t])},j.prototype.setConfigParam=function(e,t){switch(e){case"map":this.config.map=A.validateString(t,null);break;case"mapCache":this.config.mapCache=A.validateNumber(t,10,Number.MAXINTEGER,900),this.setupCache();break;case"mapGPUCache":this.config.mapGPUCache=A.validateNumber(t,10,Number.MAXINTEGER,360),this.setupCache();break;case"mapMetatileCache":this.config.mapMetatileCache=A.validateNumber(t,10,Number.MAXINTEGER,60),this.setupCache();break;case"mapTexelSizeFit":this.config.mapTexelSizeFit=A.validateNumber(t,1e-4,Number.MAXINTEGER,1.1);break;case"mapDownloadThreads":this.config.mapDownloadThreads=A.validateNumber(t,1,Number.MAXINTEGER,6);break;case"mapMaxProcessingTime":this.config.mapMaxProcessingTime=A.validateNumber(t,1,Number.MAXINTEGER,50);break;case"mapMaxGeodataProcessingTime":this.config.mapMaxGeodataProcessingTime=A.validateNumber(t,1,Number.MAXINTEGER,10);break;case"mapMobileMode":this.config.mapMobileMode=A.validateBool(t,!1),this.setupMobileMode();break;case"mapMobileModeAutodect":this.config.mapMobileModeAutodect=A.validateBool(t,!1);break;case"mapMobileDetailDegradation":this.config.mapMobileDetailDegradation=A.validateNumber(t,1,Number.MAXINTEGER,2);break;case"mapNavSamplesPerViewExtent":this.config.mapNavSamplesPerViewExtent=A.validateNumber(t,1e-11,Number.MAXINTEGER,4);break;case"mapFog":this.config.mapFog=A.validateBool(t,!1),this.draw&&(this.draw.debug.drawFog=this.config.mapFog,this.dirty=!0);break;case"mapFlatshade":this.config.mapFlatshade=A.validateBool(t,!1),this.draw&&(this.draw.debug.drawWireframe=this.config.mapFlatshade?3:0,this.dirty=!0);break;case"mapIgnoreNavtiles":this.config.mapIgnoreNavtiles=A.validateBool(t,!1);break;case"mapAllowHires":this.config.mapAllowHires=A.validateBool(t,!0);break;case"mapAllowLowres":this.config.mapAllowLowres=A.validateBool(t,!0);break;case"mapAllowSmartSwitching":this.config.mapAllowSmartSwitching=A.validateBool(t,!0);break;case"mapDisableCulling":this.config.mapDisableCulling=A.validateBool(t,!1);break;case"mapPreciseCulling":this.config.mapPreciseCulling=A.validateBool(t,!1);break;case"mapHeightLodBlend":this.config.mapHeightLodBlend=A.validateBool(t,!0);break;case"mapHeightNodeBlend":this.config.mapHeightNodeBlend=A.validateBool(t,!0);break;case"mapBasicTileSequence":this.config.mapBasicTileSequence=A.validateBool(t,!0);break;case"mapSmartNodeParsing":this.config.mapSmartNodeParsing=A.validateBool(t,!0);break;case"mapStoreLoadStats":this.config.mapStoreLoadStats=A.validateBool(t,!0),this.draw&&this.draw.replay&&(this.draw.replay.storeLoaded=this.config.mapStoreLoadStats);break;case"mapXhrImageLoad":this.config.mapXhrImageLoad=A.validateBool(t,!1);break;case"mapLoadMode":this.config.mapLoadMode=A.validateString(t,"topdown");break;case"mapGeodataLoadMode":this.config.mapGeodataLoadMode=A.validateString(t,"fit");break;case"mapGridMode":this.config.mapGridMode=A.validateString(t,"linear");break;case"mapGridSurrogatez":this.config.mapGridSurrogatez=A.validateBool(t,!1);break;case"mapGridUnderSurface":this.config.mapGridUnderSurface=A.validateNumber(t,-Number.MAXINTEGER,Number.MAXINTEGER,0);break;case"mapGridTextureLevel":this.config.mapGridTextureLevel=A.validateNumber(t,-Number.MAXINTEGER,Number.MAXINTEGER,-1);break;case"mapGridTextureLayer":this.config.mapGridTextureLayer=A.validateString(t,"");break;case"mapPreciseBBoxTest":this.config.mapPreciseBBoxTest=A.validateBool(t,!0);break;case"mapPreciseDistanceTest":this.config.mapPreciseDistanceTest=A.validateBool(t,!1);break;case"mapHeightfiledWhenUnloaded":this.config.mapHeightfiledWhenUnloaded=A.validateBool(t,!1);break;case"mapForceMetatileV3":this.config.mapForceMetatileV3=A.validateBool(t,!1);break;case"mapVirtualSurfaces":this.config.mapVirtualSurfaces=A.validateBool(t,!0);break;case"mapDegradeHorizon":this.config.mapDegradeHorizon=A.validateBool(t,!0);break;case"mapDegradeHorizonParams":this.config.mapDegradeHorizonParams=A.validateNumberArray(t,4,[0,1,1,1],[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[1,3e3,15e3,7e3]);break;case"mapRefreshCycles":this.config.mapRefreshCycles=A.validateNumber(t,0,Number.MAXINTEGER,3);break;case"mapDefaultFont":this.config.mapDefaultFont=A.validateString(t,"");break;case"mapMetricUnits":this.config.mapMetricUnits=A.validateBool(t,!0);break;case"mapLanguage":this.config.mapLanguage=A.validateString(t,"en");break;case"mapNoTextures":this.config.mapNoTextures=this.config.mapDisableCulling=A.validateBool(t,!1);break;case"mapForceFrameTime":this.config.mapForceFrameTime=A.validateNumber(t,-1,Number.MAXINTEGER,0);break;case"mapForcePipeline":this.config.mapForcePipeline=A.validateNumber(t,0,Number.MAXINTEGER,0);break;case"mapFeatureGridCells":this.config.mapFeatureGridCells=A.validateNumber(t,-Number.MAXINTEGER,Number.MAXINTEGER,0);break;case"mapFeaturesPerSquareInch":this.config.mapFeaturesPerSquareInch=A.validateNumber(t,1e-6,Number.MAXINTEGER,0);break;case"mapFeaturesSortByTop":this.config.mapFeaturesSortByTop=A.validateBool(t,!1);break;case"mapFeaturesReduceParams":this.config.mapFeaturesReduceParams=t;break;case"mapLogGeodataStyles":this.config.mapLogGeodataStyles=A.validateBool(t,!0);break;case"map16bitMeshes":this.config.map16bitMeshes=A.validateBool(t,!1);break;case"mapOnlyOneUVs":this.config.mapOnlyOneUVs=A.validateBool(t,!1);break;case"mapIndexBuffers":this.config.mapIndexBuffers=A.validateBool(t,!1);break;case"mapSoftViewSwitch":this.config.mapSoftViewSwitch=A.validateBool(t,!0);break;case"mapAsyncImageDecode":this.config.mapAsyncImageDecode=!(!A.validateBool(t,!1)||"undefined"==typeof createImageBitmap);break;case"mapFeatureStickMode":this.config.mapFeatureStickMode=A.validateNumberArray(t,2,[0,1],[Number.MAX_VALUE,Number.MAX_VALUE],[0,1]);break;case"mapSeparateLoader":this.config.mapSeparateLoader=A.validateBool(t,!0);break;case"mapGeodataBinaryLoad":this.config.mapGeodataBinaryLoad=A.validateBool(t,!0);break;case"mapPackLoaderEvents":this.config.mapPackLoaderEvents=A.validateBool(t,!0);break;case"mapParseMeshInWorker":this.config.mapParseMeshInWorker=A.validateBool(t,!0);break;case"mapPackGeodataEvents":this.config.mapPackGeodataEvents=A.validateBool(t,!0);break;case"mapSortHysteresis":this.config.mapSortHysteresis=A.validateBool(t,!1);break;case"mapHysteresisWait":this.config.mapHysteresisWait=A.validateNumber(t,0,Number.MAXINTEGER,0);break;case"mapBenevolentMargins":this.config.mapBenevolentMargins=A.validateBool(t,!1);break;case"mapCheckTextureSize":this.config.mapCheckTextureSize=A.validateBool(t,!1);break;case"mapDMapSize":this.config.mapDMapSize=A.validateNumber(t,16,Number.MAXINTEGER,512);break;case"mapDMapMode":this.config.mapDMapMode=A.validateNumber(t,1,Number.MAXINTEGER,1);break;case"mario":this.config.mario=A.validateBool(t,!0);break;case"mapFeaturesReduceMode":t=A.validateString(t,"scr-count4"),"auto"==t&&(t="scr-count2"),"legacy"==t&&(t="scr-count2"),"gridcells"==t&&(t="scr-count4"),"singlepass"==t&&(t="scr-count5"),"margin"==t&&(t="scr-count6"),this.config.mapFeaturesReduceMode=t}},j.prototype.getConfigParam=function(e){switch(e){case"map":return this.config.map;case"mapCache":return this.config.mapCache;case"mapGPUCache":return this.config.mapGPUCache;case"mapMetatileCache":return this.config.mapMetatileCache;case"mapTexelSizeFit":return this.config.mapTexelSizeFit;case"mapDownloadThreads":return this.config.mapDownloadThreads;case"mapMaxProcessingTime":return this.config.mapMaxProcessingTime;case"mapMaxGeodataProcessingTime":return this.config.mapMaxGeodataProcessingTime;case"mapMobileMode":return this.config.mapMobileMode;case"mapMobileModeAutodect":return this.config.mapMobileModeAutodect;case"mapMobileDetailDegradation":return this.config.mapMobileDetailDegradation;case"mapNavSamplesPerViewExtent":return this.config.mapNavSamplesPerViewExtent;case"mapFog":return this.config.mapFog;case"mapFlatshade":return this.config.mapFlatshade;case"mapIgnoreNavtiles":return this.config.mapIgnoreNavtiles;case"mapAllowHires":return this.config.mapAllowHires;case"mapAllowLowres":return this.config.mapAllowLowres;case"mapAllowSmartSwitching":return this.config.mapAllowSmartSwitching;case"mapDisableCulling":return this.config.mapDisableCulling;case"mapPreciseCulling":return this.config.mapPreciseCulling;case"mapHeightLodBlend":return this.config.mapHeightLodBlend;case"mapHeightNodeBlend":return this.config.mapHeightNodeBlend;case"mapBasicTileSequence":return this.config.mapBasicTileSequence;case"mapSmartNodeParsing":return this.config.mapSmartNodeParsing;case"mapStoreLoadStats":return this.config.mapStoreLoadStats;case"mapXhrImageLoad":return this.config.mapXhrImageLoad;case"mapLoadMode":return this.config.mapLoadMode;case"mapGeodataLoadMode":return this.config.mapGeodataLoadMode;case"mapGridMode":return this.config.mapGridMode;case"mapGridSurrogatez":return this.config.mapGridSurrogatez;case"mapGridUnderSurface":return this.config.mapGridUnderSurface;case"mapGridTextureLevel":return this.config.mapGridTextureLevel;case"mapGridTextureLayer":return this.config.mapGridTextureLayer;case"mapPreciseBBoxTest":return this.config.mapPreciseBBoxTest;case"mapPreciseDistanceTest":return this.config.mapPreciseDistanceTest;case"mapHeightfiledWhenUnloaded":return this.config.mapHeightfiledWhenUnloaded;case"mapForceMetatileV3":return this.config.mapForceMetatileV3;case"mapVirtualSurfaces":return this.config.mapVirtualSurfaces;case"mapDegradeHorizon":return this.config.mapDegradeHorizon;case"mapDegradeHorizonParams":return this.config.mapDegradeHorizonParams;case"mapRefreshCycles":return this.config.mapRefreshCycles;case"mapDefaultFont":return this.config.mapDefaultFont;case"mapMetricUnits":return this.config.mapMetricUnits;case"mapLanguage":return this.config.mapLanguage;case"mapNoTextures":return this.config.mapNoTextures;case"mapForceFrameTime":return this.config.mapForceFrameTime;case"mapForcePipeline":return this.config.mapForcePipeline;case"mapFeatureGridCells":return this.config.mapFeatureGridCells;case"mapFeaturesPerSquareInch":return this.config.mapFeaturesPerSquareInch;case"mapFeaturesSortByTop":return this.config.mapFeaturesSortByTop;case"mapFeaturesReduceMode":return this.config.mapFeaturesReduceMode;case"mapFeaturesReduceParams":return this.config.mapFeaturesReduceParams;case"mapLogGeodataStyles":return this.config.mapLogGeodataStyles;case"map16bitMeshes":return this.config.map16bitMeshes;case"mapOnlyOneUVs":return this.config.mapOnlyOneUVs;case"mapIndexBuffers":return this.config.mapIndexBuffers;case"mapSoftViewSwitch":return this.config.mapSoftViewSwitch;case"mapAsyncImageDecode":return this.config.mapAsyncImageDecode;case"mapFeatureStickMode":return this.config.mapFeatureStickMode;case"mapSeparateLoader":return this.config.mapSeparateLoader;case"mapGeodataBinaryLoad":return this.config.mapGeodataBinaryLoad;case"mapPackLoaderEvents":return this.config.mapPackLoaderEvents;case"mapParseMeshInWorker":return this.config.mapParseMeshInWorker;case"mapPackGeodataEvents":return this.config.mapPackGeodataEvents;case"mapSortHysteresis":return this.config.mapSortHysteresis;case"mapHysteresisWait":return this.config.mapHysteresisWait;case"mapBenevolentMargins":return this.config.mapBenevolentMargins;case"mapDMapSize":return this.config.mapDMapSize;case"mapDMapMode":return this.config.mapDMapMode;case"mario":return this.config.mario}},j.prototype.click=function(e,t,i){this.clickEvent=[e,t,i]},j.prototype.hover=function(e,t,i,r){this.hoverEvent=[e,t,i,r]},j.prototype.markDirty=function(){this.dirty=!0,this.hitMapDirty=!0,this.geoHitMapDirty=!0},j.prototype.getScreenRay=function(e,t){return this.renderer.getScreenRay(e,t)},j.prototype.renderToImage=function(e){var t=this.renderer.gpu.canvas,i=t.width,r=t.height,s=A.fitToPowerOfTwo(i),a=A.fitToPowerOfTwo(r),n=new Uint8Array(s*a*4),e=new O(this.renderer.gpu);e.createFromData(s,a,n),e.createFramebuffer(s,a),this.draw.drawToTexture(e),n=e.readFramebufferPixels(0,0,i,r),e.kill();for(var o=new Uint8Array(i*r*4),h=0;h<r;h++)for(var l=h*i*4,u=(r-h-1)*i*4,c=0;c<i;c++)o[u]=n[l],o[u+1]=n[l+1],o[u+2]=n[l+2],o[u+3]=n[l+3],l+=4,u+=4;return{width:i,height:r,data:o}},j.prototype.getScreenDepth=function(e,t,i){if(i){var r,s,a=this.camera.position,n=this.renderer.getScreenRay(e,t);if(this.getNavigationSrs().isProjected()){var o=[0,0,Math.min(-1e3,this.referenceFrame.getGlobalHeightRange()[0])],h=[0,0,1];return s=M.dot(h,n),r=[o[0]-a[0],o[1]-a[1],o[2]-a[2]],g=M.dot(r,h)/s,g>=0?[!0,g]:[!1,1]}var l=this.getNavigationSrs().getSrsInfo(),u=l.b+this.referenceFrame.getGlobalHeightRange()[0],c=[a[0],a[1],a[2]];r=M.dot(n,n);var d=2*M.dot(n,c);if((s=d*d-4*r*(M.dot(c,c)-u*u))>0){s=Math.sqrt(s);var p=(-d-s)/(2*r),f=(-d+s)/(2*r),g=p<f?p:f;return[!0,g]}return[!1,1]}if(this.hitMapDirty){var m=this.draw.ndcToScreenPixel;this.draw.drawHitmap(),this.draw.ndcToScreenPixel=m;var v=this.renderer.curSize[0],y=this.renderer.curSize[1],b=new Float32Array(16);b[0]=2/v,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2/y,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=.5*-v*b[0],b[13]=.5*-y*b[5],b[14]=0,b[15]=1,this.renderer.imageProjectionMatrix=b,this.renderer.camera.update()}return this.renderer.getDepth(e,t)},j.prototype.getHitCoords=function(e,t,i,r){this.hitMapDirty&&this.draw.drawHitmap();var s,a,n,o=this.renderer.hitTest(e,t),h=!1,l=this.camera.position,u=o[4];if(this.getNavigationSrs().isProjected()){var c=[0,0,Math.min(-1e3,this.referenceFrame.getGlobalHeightRange()[0])],d=[0,0,1];n=M.dot(d,u),a=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],b=M.dot(a,d)/n,b>=0&&(!o[3]||b<o[5])&&(s=[u[0]*b+l[0],u[1]*b+l[1],u[2]*b+l[2]],h=!0)}else{var p=this.getNavigationSrs().getSrsInfo(),f=p.b+this.referenceFrame.getGlobalHeightRange()[0],g=[l[0],l[1],l[2]];a=M.dot(u,u);var m=2*M.dot(u,g);if((n=m*m-4*a*(M.dot(g,g)-f*f))>0){n=Math.sqrt(n);var v=(-m-n)/(2*a),y=(-m+n)/(2*a),b=v<y?v:y;(!o[3]||b<o[5])&&(s=[u[0]*b+l[0],u[1]*b+l[1],u[2]*b+l[2]],h=!0)}}if(!o[3]&&!h)return null;h||(s=[o[0]+l[0],o[1]+l[1],o[2]+l[2]]);var x=this.convert.convertCoords(s,"physical","navigation");if(this.renderer.useSuperElevation&&(x[2]=this.renderer.getUnsuperElevatedHeight(x[2])),"float"==i){r=null!=r?r:this.measure.getOptimalHeightLod(x,100,this.config.mapNavSamplesPerViewExtent);var w=this.measure.getSurfaceHeight(x,r);x[2]-=w[0]}return x},j.prototype.hitTestGeoLayers=function(e,t,i){if(this.geoHitMapDirty&&this.freeLayersHaveGeodata&&this.draw.drawGeodataHitmap(),!this.freeLayersHaveGeodata)return this.lastHoverFeature=null,this.lastHoverFeatureId=null,this.hoverFeature=null,this.hoverFeatureId=null,[null,!1,[]];var r,s,a=this.renderer.hitTestGeoLayers(e,t);if(!a[0])return r=[],"hover"==i&&(this.lastHoverFeature=this.hoverFeature,this.lastHoverFeatureId=this.hoverFeatureId,this.hoverFeature=null,this.hoverFeatureId=null,null!=this.lastHoverFeatureId&&(null!=this.lastHoverFeatureId&&r.push(["leave",this.lastHoverFeature,this.lastHoverFeatureId]),this.dirty=!0)),[null,!1,r,s];var n=a[1]+(a[2]<<8),o=this.hoverFeatureList[n];return o?(o[6]&&(a=this.renderer.hitTestGeoLayers(e,t,!0),a[0]&&(s=a[1]+(a[2]<<8))),"hover"==i?(this.lastHoverFeature=this.hoverFeature,this.lastHoverFeatureId=this.hoverFeatureId,o&&o[3]?(this.hoverFeature=o,this.hoverFeatureId=null!=o?o[0]["#id"]:null):(this.hoverFeature=null,this.hoverFeatureId=null),r=[],this.hoverFeatureId!=this.lastHoverFeatureId&&(null!=this.lastHoverFeatureId&&r.push(["leave",this.lastHoverFeature,this.lastHoverFeatureId]),null!=this.hoverFeatureId&&r.push(["enter",this.hoverFeature,this.hoverFeatureId]),this.dirty=!0),null!=this.hoverFeature&&this.hoverFeature[3]?[this.hoverFeature,!0,r,s]:[null,!1,r,s]):"click"==i?null!=o&&o[2]?[o,!0,[],s]:[null,!1,[],s]:void 0):[null,!1,[],s]},j.prototype.getCurrentGeometry=function(){if(this.draw.tree.surfaceSequence.length>0){this.draw.tree.draw(!0);var e=this.storedTilesRes;return this.storedTilesRes=[],e}return e},j.prototype.applyCredits=function(e){var t,i;for(var r in e.imageryCredits)t=e.imageryCredits[r],i=this.visibleCredits.imagery[r],this.visibleCredits.imagery[r]=i?t>i?t:i:t;for(r in e.glueImageryCredits)t=e.glueImageryCredits[r],i=this.visibleCredits.imagery[r],this.visibleCredits.glueImagery[r]=i?t>i?t:i:t;for(r in e.mapdataCredits)t=e.mapdataCredits[r],i=this.visibleCredits.mapdata[r],this.visibleCredits.mapdata[r]=i?t>i?t:i:t},j.prototype.drawMap=function(){this.draw.drawMap(null)},j.prototype.processProcessingTasks=function(){for(;this.processingTasks.length>0;){if(this.stats.renderBuild>this.config.mapMaxProcessingTime)return void this.markDirty();this.processingTasks[0](),this.processingTasks.shift()}for(;this.processingTasks2.length>0&&-123!=this.processingTasks2[0]();)this.processingTasks2.shift()},j.prototype.addProcessingTask=function(e){this.processingTasks.push(e)},j.prototype.addProcessingTask2=function(e){this.processingTasks2.push(e)},j.prototype.update=function(){if(!this.killed){if(this.core.tokenExpiration&&Date.now()>this.core.tokenExpiration-6e4&&this.core.tokenExpirationCallback(),!this.srsReady)return void this.loader.update();if(!this.div||"hidden"!=this.div.style.visibility){this.position.isSame(this.lastPosition)||this.core.callListener("map-position-changed",{position:this.position.toArray(),"last-position":this.lastPosition.toArray()}),this.camera.lastTerrainHeight!=this.camera.terrainHeight&&this.core.callListener("map-position-fixed-height-changed",{height:this.camera.terrainHeight,"last-height":this.camera.lastTerrainHeight}),this.lastPosition=this.position.clone(),this.camera.lastTerrainHeight=this.camera.terrainHeight,this.drawFog=this.config.mapFog;var e,t=this.renderer.div.getBoundingClientRect(),i=this.renderer,r=i.cameraPosition;i.curSize[0]==t.width&&i.curSize[1]==t.height||(i.onResize(),this.dirty=!0);var s,a=this.dirty||this.dirtyCountdown>0;if(this.stats.begin(a),this.loader.update(),this.processProcessingTasks(),a&&(this.dirty?this.dirtyCountdown=this.config.mapRefreshCycles:this.dirtyCountdown--,this.dirty=!1,this.bestMeshTexelSize=0,this.bestGeodataTexelSize=0,this.renderSlots.processRenderSlots(),this.loader.update(),this.core.callListener("map-update",{})),null!=this.clickEvent||null!=this.hoverEvent){if(null!=this.hoverEvent){s=this.hitTestGeoLayers(this.hoverEvent[0],this.hoverEvent[1],"hover");var n=s[2];if(null!=n)for(var o=0,h=n.length;o<h;o++){var l=n[o];switch(l[0]){case"enter":e=l[1][1],this.core.callListener("geo-feature-enter",{feature:l[1][0],"canvas-coords":i.project2(l[1][1],i.camera.mvp,r),"physical-coords":[e[0]+r[0],e[1]+r[1],e[2]+r[2]],state:this.hoverEvent[3],element:s[3]});break;case"leave":e=l[1][1],this.core.callListener("geo-feature-leave",{feature:l[1][0],"canvas-coords":i.project2(l[1][1],i.camera.mvp,r),"physical-coords":[e[0]+r[0],e[1]+r[1],e[2]+r[2]],state:this.hoverEvent[3],element:s[3]})}}s[1]&&null!=s[0]&&(e=s[0][1],this.core.callListener("geo-feature-hover",{feature:s[0][0],"canvas-coords":i.project2(s[0][1],i.camera.mvp,r),"physical-coords":[e[0]+r[0],e[1]+r[1],e[2]+r[2]],state:this.hoverEvent[3],element:s[3]})),!0!==this.hoverEvent[2]&&(this.hoverEvent=null)}null!=this.clickEvent&&(s=this.hitTestGeoLayers(this.clickEvent[0],this.clickEvent[1],"click"),s[1]&&null!=s[0]&&(e=s[0][1],this.core.callListener("geo-feature-click",{feature:s[0][0],"canvas-coords":i.project2(s[0][1],i.camera.mvp,r),"physical-coords":[e[0]+r[0],e[1]+r[1],e[2]+r[2]],state:this.clickEvent[2],element:s[3]})),this.clickEvent=null)}this.stats.end(a)}}},t.a=j},function(e,t,i){"use strict";var r=i(1),s=i(4),a=i(23),n=i.n(a),o=r.b,h=r.e,l=s.a,u=n.a,c=function(e){this.map=e,this.config=e.config,this.convert=e.convert,this.getPhysicalSrs=this.map.getPhysicalSrs(),this.navigationSrs=this.map.getNavigationSrs(),this.publicSrs=this.map.getPublicSrs(),this.navigationSrsInfo=this.navigationSrs.getSrsInfo(),this.isProjected=this.navigationSrs.isProjected();var t=this.getSpatialDivisionNodeDepths();this.minDivisionNodeDepth=t[0],this.maxDivisionNodeDepth=t[1]};c.prototype.getSurfaceAreaGeometry=function(e,t,i,r,s,a){var n=this.map.tree;0==n.surfaceSequence.length&&reurn[[]];var h=this.convert.convertCoords(e,"navigation","physical"),l=[0,0,0];o.normalize(h,l);var u=o.length(h),c=Math.atan(Math.tan(t/u));return n.params={coneVec:l,coneAngle:c,mode:i,limit:r,loaded:!0,areaTiles:[],loadMeshes:!0===s,loadTextures:!0===a},n.traceAreaTiles(n.surfaceTree,0,!1),[n.params.loaded,n.params.areaTiles]},c.prototype.getSurfaceHeight=function(e,t,i,r,s,a,n){var o=this.map.tree;if(0==o.surfaceSequence.length)return[0,!0,!0,null,null,null];if(!r){var h=this.getSpatialDivisionNode(e);r=h[0],s=h[1]}if(this.config.mapHeightLodBlend||(t=Math.floor(t)),n||this.config.mapIgnoreNavtiles)return this.getSurfaceHeightNodeOnly(null,t+8,i,t,null,r,s,a);if(null!=r&&null!==t){var l=o.findSurfaceTile(r.id),u={ll:r.extents.ll.slice(),ur:r.extents.ur.slice()},c={coords:s,desiredLod:Math.ceil(t),extents:u,metanode:null,heightMap:null,heightMapExtents:null,traceHeight:!0,waitingForNode:!1,finalNode:!1,bestHeightMap:999};o.traceHeight(l,c,!1);var d,p,f,g=c.metanode;if(c.heightMap){if(i){var m=this.map.stats;m.heightClass=2,m.heightLod=t,m.heightNode=g.id[0]}var v,y,b,x=g.id[0]>=Math.ceil(t);if(this.config.mapHeightLodBlend&&g.id[0]>0&&c.parent&&c.parent.heightMap&&t<=g.id[0]){y=this.getHeightmapValue(s,c.parent.metanode,c.parent),b=this.getHeightmapValue(s,g,c);var w=t-Math.floor(t);if(f=y+(b-y)*w,a)for(v=new Array(a.length),d=0,p=a.length;d<p;d++){var S=a[d];y=this.getHeightmapValue(S,c.parent.metanode,c.parent),b=this.getHeightmapValue(S,g,c),v[d]=[y+(b-y)*w,x,!0]}}else if(f=this.getHeightmapValue(s,g,c),a)for(v=new Array(a.length),d=0,p=a.length;d<p;d++)b=this.getHeightmapValue(a[d],g,c),v[d]=[b,x,!0];return[f,x,!0,null,null,v]}if(g)return x=this.getSurfaceHeightNodeOnly(e,t+8,i,t,null,r,s,a),[x[0],x[1],x[2],null,null,x[5]]}return[0,!1,!1,null,null,null]},c.prototype.getSurfaceHeightNodeOnly=function(e,t,i,r,s,a,n,o){var h,l,u=this.map.stats,c=this.map.tree;if(0==c.surfaceSequence.length)return[0,!0,!0,null,null,null];if(s)a=s[0],n=s[1];else{if(!a){var d=this.getSpatialDivisionNode(e);a=d[0],n=d[1]}if(o){h=new Array(o.length);for(var p=0,f=o.length;p<f;p++)h[p]=this.getSurfaceHeightNodeOnly(null,t,i,r,s,a,o[p])}}if(this.config.mapHeightLodBlend||(t=Math.floor(t)),!s&&this.config.mapHeightNodeBlend){var g=this.getSurfaceHeightNodeOnly(null,t,i,r,[a,[n[0],n[1],n[2]]]);if(g[2]){var m=g[3].ur[0]-g[3].ll[0],v=g[3].ur[1]-g[3].ll[1],y=(n[0]-g[3].ll[0])/m,b=(n[1]-g[3].ll[1])/v,x=this.getSurfaceHeightNodeOnly(null,t,i,r,[a,[n[0]+m,n[1],n[2]]]),w=this.getSurfaceHeightNodeOnly(null,t,i,r,[a,[n[0],n[1]+v,n[2]]]),S=this.getSurfaceHeightNodeOnly(null,t,i,r,[a,[n[0]+m,n[1]+v,n[2]]]),M=g[0]+(x[0]-g[0])*y;return l=M+(w[0]+(S[0]-w[0])*y-M)*b,[l,g[1],g[2],g[3],null,h]}return[g[0],g[1],g[2],g[3],null,h]}if(null!=a&&null!==t){var A=c.findSurfaceTile(a.id),C={ll:a.extents.ll.slice(),ur:a.extents.ur.slice()},T={coords:n,desiredLod:Math.ceil(t),extents:C,metanode:null,heightMap:null,heightMapExtents:null,traceHeight:!0,waitingForNode:!1,finalNode:!1,bestHeightMap:999};c.traceHeight(A,T,!0);var P,F,L=T.metanode;if(null!=L){if(L.bbox.maxSize<8e3?(P=L.bbox.center(),P=this.convert.convertCoords(P,"physical","navigation")):P=[0,0,n[2]],i&&(u.heightClass=1,u.heightLod=r,u.heightNode=L.id[0]),this.config.mapHeightLodBlend&&L.id[0]>0&&T.parent&&T.parent.metanode){F=T.parent.metanode.bbox.maxSize<8e3?this.convert.convertCoords(T.parent.metanode.bbox.center(),"physical","navigation"):[0,0,n[2]];var E=t-Math.floor(t);return l=P[2]+(F[2]-P[2])*E,[l,L.id[0]>=Math.floor(t)||T.finalNode,!T.waitingForNode||L.id[0]>=Math.floor(t)||T.finalNode,T.extents,L,h]}return[P[2],L.id[0]>=Math.floor(t)||T.finalNode,!T.waitingForNode||L.id[0]>=Math.floor(t)||T.finalNode,T.extents,L,h]}}return i&&(u.heightClass=0,u.heightLod=r,u.heightNode=0),[0,!1,!1,null,null,h]},c.prototype.getHeightmapValue=function(e,t,i){var r=i.heightMap,s=r.getImageData(),a=r.getImageExtents(),n=i.heightMapExtents,o=e[0]-n.ll[0],h=n.ur[1]-e[1],l=a[0]-1,u=a[1]-1;o=l*(o/(n.ur[0]-n.ll[0])),h=u*(h/(n.ur[1]-n.ll[1])),o<0&&(o=0),h<0&&(h=0),o>l&&(o=l),h>u&&(h=u);var c=Math.floor(o),d=Math.floor(h),p=o-c,f=h-d,g=d*a[0],m=d==u?g:g+a[0],v=c==l?c:c+1,y=s[4*(g+c)],b=s[4*(g+v)],x=s[4*(m+c)],w=s[4*(m+v)],S=y+(b-y)*p,M=x+(w-x)*p,A=S+(M-S)*f;return A=t.minHeight+(t.maxHeight-t.minHeight)*(A/255)},c.prototype.getSpatialDivisionNode=function(e){for(var t=this.map.referenceFrame.getSpatialDivisionNodes(),i=null,r=-1,s=[0,0],a=0,n=t.length;a<n;a++){var o=t[a],h=o.getInnerCoords(e),l=o.extents;h[0]>=l.ll[0]&&h[0]<=l.ur[0]&&h[1]>=l.ll[1]&&h[1]<=l.ur[1]&&o.id[0]>r&&(i=o,r=o.id[0],s=h)}return[i,s]},c.prototype.getSpatialDivisionNodeAndExtents=function(e){for(var t,i=this.map.referenceFrame.getSpatialDivisionNodes(),r=null,s=[0,0],a=0,n=i.length;a<n;a++){var o=i[a];if((t=e[0]-o.id[0])>=0){var h=e[1]>>t,l=e[2]>>t;o.id[1]==h&&o.id[2]==l&&(r=o,s=[o.id[1]<<t,o.id[2]<<t])}}if(!r)return null;t=e[0]-r.id[0];var u=1/Math.pow(2,t),c=r.extents.ur,d=r.extents.ll,p=(c[0]-d[0])*u,f=(d[1]-c[1])*u,g=e[1]-s[0],m=e[2]-s[1];return[r,[[d[0]+p*g,c[1]+f*m],[d[0]+p*(g+1),c[1]+f*(m+1)]]]},c.prototype.getSpatialDivisionNodeFromId=function(e){var t=e[0]-this.maxDivisionNodeDepth,i=e[1]>>t,r=e[2]>>t;return this.map.referenceFrame.nodesMap[this.maxDivisionNodeDepth+"."+i+"."+r]},c.prototype.getSpatialDivisionNodeAndExtents2=function(e,t,i){if(!i)return[null,0,0,0,0];var r=e[0]-i.id[0],s=1/Math.pow(2,r),a=i.extents.ur,n=i.extents.ll,o=(a[0]-n[0])*s,h=(n[1]-a[1])*s,l=e[1]-(i.id[1]<<r),u=e[2]-(i.id[2]<<r);t[0]=i,t[1]=n[0]+o*l,t[2]=a[1]+h*u,t[3]=n[0]+o*(l+1),t[4]=a[1]+h*(u+1)},c.prototype.getSpatialDivisionNodeDepths=function(){for(var e=this.map.referenceFrame.getSpatialDivisionNodes(),t=-1,i=Number.MAX_VALUE,r=0,s=e.length;r<s;r++){var a=e[r];a.id[0]<i&&(i=a.id[0]),a.id[0]>t&&(t=a.id[0])}return[i,t]},c.prototype.getOptimalHeightLodBySampleSize=function(e,t){var i=this.getSpatialDivisionNode(e),r=i[0];if(null!=r){var s=r.id[0],a=r.extents.ur[1]-r.extents.ll[1],n=Math.log(a/t)/Math.log(2);return n=n-8+s,Math.max(0,n)}return null},c.prototype.getOptimalHeightLod=function(e,t,i){var r=this.getSpatialDivisionNode(e),s=r[0];if(null!=s){var a=s.id[0],n=s.extents.ur[1]-s.extents.ll[1],o=Math.log(i*n/t)/Math.log(2);return o=o-8+a,Math.max(0,o)}return null},c.prototype.getDistance=function(e,t,i,r){var s=r?this.publicSrs:this.navigationSrs,a=this.getPhysicalSrs.convertCoordsFrom(e,s),n=this.getPhysicalSrs.convertCoordsFrom(t,s),o=n[0]-a[0],h=n[1]-a[1],u=n[2]-a[2],c=Math.sqrt(o*o+h*h+u*u),d=this.navigationSrsInfo;if(this.isProjected)return[Math.sqrt(o*o+h*h),l.degrees(Math.atan2(o,h)),c];var p=this.getGeodesic(),f=p.Inverse(e[1],e[0],t[1],t[0]);return f.s12>2*d.a*Math.PI/4007.5?i?[Math.sqrt(f.s12*f.s12+u*u),-f.azi1,c]:[f.s12,-f.azi1,c]:i?[Math.sqrt(o*o+h*h+u*u),-f.azi1,c]:[f.s12,-f.azi1,c]},c.prototype.getGeodesic=function(){var e=this.navigationSrsInfo;return new u.Geodesic.Geodesic(e.a,e.a/e.b-1)},c.prototype.getAzimuthCorrection=function(e,t){if(!this.getNavigationSrs().isProjected()){var i=this.getGeodesic(),r=i.Inverse(e[0],e[1],t[0],t[1]),s=r.azi1-r.azi2;return isNaN(s)&&(s=0),s}return 0},c.prototype.getNED=function(e){var t,i,r=this.convert.convertCoords([e[0],e[1],0],"navigation","physical");if(this.isProjected)t=this.convert.convertCoords([e[0],e[1]+100,0],"navigation","physical"),i=this.convert.convertCoords([e[0]+100,e[1],0],"navigation","physical");else{var s=e[1]+90-1e-4,a=e[0]+180+1e-4;if(s<0||a>180){var n=this.getGeodesic(),h=n.Direct(e[1],e[0],0,-100);t=this.convert.convertCoords([h.lon2,h.lat2,0],"navigation","physical"),h=n.Direct(e[1],e[0],90,100),i=this.convert.convertCoords([h.lon2,h.lat2,0],"navigation","physical")}else t=this.convert.convertCoords([e[0],e[1]-1e-4,0],"navigation","physical"),i=this.convert.convertCoords([e[0]+1e-4,e[1],0],"navigation","physical")}var l=[t[0]-r[0],t[1]-r[1],t[2]-r[2]],u=[i[0]-r[0],i[1]-r[1],i[2]-r[2]],c=[0,0,0];return o.normalize(l),o.normalize(u),o.cross(l,u,c),o.normalize(c),{east:u,direction:l,north:c}},c.prototype.getNewNED=function(e,t){var i,r,s=this.convert.convertCoords([e[0],e[1],0],"navigation","physical");if(this.isProjected)i=this.convert.convertCoords([e[0],e[1]+100,0],"navigation","physical"),r=this.convert.convertCoords([e[0]+100,e[1],0],"navigation","physical");else{var a=e[1]+90+1e-4,n=e[0]+180+1e-4;if(a<0||n>180){var h=this.getGeodesic(),l=h.Direct(e[1],e[0],0,-100);i=this.convert.convertCoords([l.lon2,l.lat2,0],"navigation","physical"),l=h.Direct(e[1],e[0],90,-100),r=this.convert.convertCoords([l.lon2,l.lat2,0],"navigation","physical")}else i=this.convert.convertCoords([e[0],e[1]+1e-4,0],"navigation","physical"),r=this.convert.convertCoords([e[0]+1e-4,e[1],0],"navigation","physical")}var u=[i[0]-s[0],i[1]-s[1],i[2]-s[2]],c=[r[0]-s[0],r[1]-s[1],r[2]-s[2]],d=[0,0,0];if(o.normalize(u),o.normalize(c),o.cross(u,c,d),o.normalize(d),t){var p=c,f=u,g=d;return[p[0],p[1],p[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1]}return{east:c,direction:u,north:d}},c.prototype.getPositionCameraInfo=function(e,t,i){var r=e.getOrientation(),s=e.getViewDistance();i&&(r[1]=l.clamp(r[1],-89,90));var a=l.clamp(r[1],-89.5,89.5),n=h.create();h.multiply(l.rotationMatrix(2,l.radians(-r[0])),l.rotationMatrix(0,l.radians(a)),n);var u,c,d,p,f,g,m,v,y,b,x,w,S;"obj"==e.getViewMode()?(u=[0,-s,0],h.multiplyVec3(n,u)):u=[0,0,0];var M={orbitCoords:null,distance:s,rotMatrix:null,vector:null,orbitHeight:u[2]},A=e.getCoords();if(t){n=h.create(),h.multiply(l.rotationMatrix(0,l.radians(-a-90)),l.rotationMatrix(2,l.radians(r[0])),n),c=this.getNED(A),d=c.north,p=c.east,f=c.direction,g=[p[0],p[1],p[2],0,f[0],f[1],f[2],0,d[0],d[1],d[2],0,0,0,0,1],v=[1,0,0],b=[0,1,0],y=[0,0,1],x=[1,0,0],w=[0,0,-1],S=[0,0,0],o.cross(x,w,S),h.multiplyVec3(n,y),h.multiplyVec3(n,v),h.multiplyVec3(n,b),h.multiplyVec3(n,x),h.multiplyVec3(n,w),h.multiplyVec3(n,S);var C=0;C=x[0],x[0]=x[1],x[1]=C,C=w[0],w[0]=w[1],w[1]=C,C=S[0],S[0]=S[1],S[1]=C,x[2]=-x[2],w[2]=-w[2],S[2]=-S[2],m=[v[0],v[1],v[2],0,b[0],b[1],b[2],0,y[0],y[1],y[2],0,0,0,0,1],M.vector=o.normalize([-u[0],-u[1],-u[2]]),M.vector2=M.vector,M.orbitCoords=u,M.rotMatrix=m}else{c=this.getNED(A),d=c.north,p=c.east,f=c.direction,g=[p[0],p[1],p[2],0,f[0],f[1],f[2],0,d[0],d[1],d[2],0,0,0,0,1];var T=h.create();h.multiply(l.rotationMatrix(0,l.radians(-a-90)),l.rotationMatrix(2,l.radians(r[0])),T),v=[1,0,0],b=[0,1,0],y=[0,0,1],A=e.getCoords();var P=h.create();h.multiply(l.rotationMatrix(0,l.radians(A[1]-90)),l.rotationMatrix(2,l.radians(-A[0]-90)),P),h.multiplyVec3(P,y),h.multiplyVec3(P,v),h.multiplyVec3(P,b),g=[v[0],v[1],v[2],0,b[0],b[1],b[2],0,y[0],y[1],y[2],0,0,0,0,1],S=[1,0,0],x=[0,1,0],w=[0,0,1],h.multiplyVec3(g,x),h.multiplyVec3(g,w),h.multiplyVec3(g,S),h.multiplyVec3(T,S),h.multiplyVec3(T,x),h.multiplyVec3(T,w),m=[S[0],S[1],S[2],0,x[0],x[1],x[2],0,w[0],w[1],w[2],0,0,0,0,1],g=h.inverse(g),h.multiplyVec3(g,u),M.vector=[-m[2],-m[6],-m[10]]}return M.orbitCoords=u,M.rotMatrix=m,M},t.a=c},function(e,t,i){"use strict";var r=i(1),s=i(2),a=i(152),n=i(5),o=i(33),h=i(61),l=r.e,u=n.a,c=a.a,d=(s.a,o.a),p=h.a,f=function(e,t,i){this.generateLines=!0,this.map=e,this.stats=e.stats,this.mapLoaderUrl=t,this.tile=i,this.use16bit=e.config.map16bitMeshes,this.bbox=new u,this.size=0,this.gpuSize=0,this.fileSize=0,this.faces=0,this.cacheItem=null,this.gpuCacheItem=null,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.mBuffer=new Float32Array(16),this.mBuffer2=new Float32Array(16),this.vBuffer=new Float32Array(4),this.submeshes=[],this.gpuSubmeshes=[],this.submeshesKilled=!1};f.prototype.kill=function(){this.bbox=null,this.killSubmeshes(),this.killGpuSubmeshes()},f.prototype.killSubmeshes=function(e){for(var t=0,i=this.submeshes.length;t<i;t++)this.submeshes[t].kill();this.submeshesKilled=!0,!0!==e&&this.cacheItem&&this.map.resourcesCache.remove(this.cacheItem),0==this.gpuSubmeshes.length&&(this.loadState=0),this.cacheItem=null},f.prototype.killGpuSubmeshes=function(e){for(var t=0,i=0,r=this.gpuSubmeshes.length;i<r;i++)this.gpuSubmeshes[i].kill(),t+=this.gpuSubmeshes[i].getSize();r>0&&(this.stats.gpuMeshes-=t,this.stats.graphsFluxMesh[1][0]++,this.stats.graphsFluxMesh[1][1]+=t),this.gpuSubmeshes=[],!0!==e&&this.gpuCacheItem&&this.map.gpuCache.remove(this.gpuCacheItem),this.submeshesKilled&&(this.loadState=0),this.gpuCacheItem=null},f.prototype.isReady=function(e,t,i){var r=this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed;if(e=e||r,2==this.loadState){if(this.cacheItem&&this.map.resourcesCache.updateItem(this.cacheItem),i)return!0;if(0==this.gpuSubmeshes.length){if(this.map.stats.gpuRenderUsed>=this.map.draw.maxGpuUsed)return!1;if(r)return!1;var s=performance.now();this.buildGpuSubmeshes(),this.stats.renderBuild+=performance.now()-s}return!e&&this.gpuCacheItem&&this.map.gpuCache.updateItem(this.gpuCacheItem),!0}return 0==this.loadState?e||this.scheduleLoad(t):3==this.loadState&&this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(t),!1},f.prototype.scheduleLoad=function(e){this.mapLoaderUrl||(this.mapLoaderUrl=this.map.url.makeUrl(this.tile.resourceSurface.meshUrl,{lod:this.tile.id[0],ix:this.tile.id[1],iy:this.tile.id[2]})),this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this),e,this.tile,"mesh")},f.prototype.onLoad=function(e,t,i){this.mapLoaderCallLoaded=t,this.mapLoaderCallError=i,this.map.loader.processLoadBinary(e,this.onLoaded.bind(this),this.onLoadError.bind(this),null,"mesh"),this.loadState=1},f.prototype.onLoadError=function(){this.map.killed||(this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},f.prototype.onLoaded=function(e,t,i){if(!this.map.killed){if(!t)return this.map.markDirty(),void this.map.addProcessingTask(this.onLoaded.bind(this,e,!0,i));var r=performance.now();if(i)this.parseWorkerData(e);else{this.fileSize=e.byteLength;var s={data:new DataView(e),buffer:e,index:0};this.parseMapMesh(s)}this.map.stats.renderBuild+=performance.now()-r,this.submeshesKilled=!1,this.cacheItem=this.map.resourcesCache.insert(this.killSubmeshes.bind(this,!0),this.size),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},f.prototype.parseWorkerData=function(e){this.faces=e.faces,this.gpuSize=e.gpuSize,this.meanUndulation=e.meanUndulation,this.numSubmeshes=e.numSubmeshes,this.size=e.size,this.version=e.version,this.submeshes=[];for(var t=e.submeshes,i=0,r=t.length;i<r;i++){var s=new c(this),a=t[i];s.bbox.min=a.bboxMin,s.bbox.max=a.bboxMax,s.externalUVs=a.externalUVs,s.faces=a.faces,s.flags=a.flags,s.gpuSize=a.gpuSize,s.indices=a.indices,s.internalUVs=a.internalUVs,s.size=a.size,s.surfaceReference=a.surfaceReference,s.textureLayer=a.textureLayer,s.textureLayer2=a.textureLayer2,s.vertices=a.vertices,this.submeshes.push(s)}this.bbox.updateMaxSize()},f.prototype.parseMapMesh=function(e){this.killSubmeshes();var t=e.data,i="";if(t.length<2)return!1;if(i+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,i+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,"ME"!=i)return!1;if(this.version=t.getUint16(e.index,!0),e.index+=2,this.version>3)return!1;e.uint8Data=new Uint8Array(e.buffer),this.meanUndulation=t.getFloat64(e.index,!0),e.index+=8,this.numSubmeshes=t.getUint16(e.index,!0),e.index+=2,this.submeshes=[],this.gpuSize=0,this.faces=0;for(var r=0,s=this.numSubmeshes;r<s;r++){var a=new c(this,e);a.valid&&(this.submeshes.push(a),this.size+=a.getSize(),this.faces+=a.faces,this.gpuSize+=a.getSize())}this.numSubmeshes=this.submeshes.length},f.prototype.addSubmesh=function(e){this.submeshes.push(e),this.size+=e.size,this.faces+=e.faces},f.prototype.buildGpuSubmeshes=function(){var e=0;this.gpuSubmeshes=new Array(this.submeshes.length);for(var t=0,i=this.submeshes.length;t<i;t++)this.gpuSubmeshes[t]=this.submeshes[t].buildGpuMesh(),e+=this.gpuSubmeshes[t].getSize();this.stats.gpuMeshes+=e,this.stats.graphsFluxMesh[0][0]++,this.stats.graphsFluxMesh[0][1]+=e,this.gpuCacheItem=this.map.gpuCache.insert(this.killGpuSubmeshes.bind(this,!0),e),this.gpuSize=e},f.prototype.generateTileShader=function(e,t,i,r){var s="";r&&(s+="#define clip4\n"),i&&(s+="#define applySE\n");var a=new d(this.map.renderer.gpu,e[0].vertex.replace("#define variants\n",s),e[0].fragment.replace("#define variants\n",s));return e[t]=a,a},f.prototype.drawSubmesh=function(e,t,i,r,s,a,n,o){null!=this.gpuSubmeshes[t]||null==this.submeshes[t]||this.submeshes[t].killed||(this.gpuSubmeshes[t]=this.submeshes[t].buildGpuMesh());var h=this.submeshes[t],u=this.gpuSubmeshes[t];if(u){var c=this.map.renderer,f=this.map.draw,g=null,m=null,v=null,y=null,b=f.debug.drawWireframe,x=c.useSuperElevation,w=["aPosition"],S=x?4:0;if(o&&(S|=1,6!=r&&5!=r&&(y="aTexCoord2",w.push("aTexCoord2"))),i&&f.debug.meshStats&&(h.uvAreaComputed||h.computeUVArea(i.getGpuTexture()),this.stats.meshesUVArea+=h.uvArea,this.stats.meshesFaces+=h.faces),1==r)(g=c.progDepthTile[S])||(g=this.generateTileShader(c.progDepthTile,S,x,o));else if(2==r)(g=c.progFlatShadeTile[S])||(g=this.generateTileShader(c.progFlatShadeTile,S,x,o));else{if(b>0&&3==r)return;if(1==b||3==b)(g=c.progFlatShadeTile[S])||(g=this.generateTileShader(c.progFlatShadeTile,S,x,o));else switch(r){case 4:case 5:v="aTexCoord",w.push("aTexCoord"),g=c.progTile[S],g||(g=this.generateTileShader(c.progTile,S,x,o));break;case 6:case 7:var M=c.progTile2;if(i&&(m=i.getGpuMaskTexture())&&(M=c.progTile3),g=M[S],g||(g=this.generateTileShader(M,S,x,o)),a&&(a.shaderFilters||a.shaderFilter)){var A,C,T;if(n&&a.shaderFilters&&(A=a.shaderFilters[n.id])&&(A.varFlatShade&&(T=!0),A=A.filter),A||(A=a.shaderFilter),A){var C=m?"progTile3":"progTile2",c=this.map.renderer;if(x&&(C+="se"),T&&(C+="fs"),C+=A,!(g=c.progMap[C])){var P,F=c.gpu,L=splipMask?"#define clip4\n":"",E="#define externalTex\n"+L+(x?"#define applySE\n":"")+p.tileVertexShader;P=m?"#define externalTex\n#define mask\n"+L+p.tileFragmentShader:"#define externalTex\n"+L+p.tileFragmentShader,T&&(P="#extension GL_OES_standard_derivatives : enable\n#define flatShadeVar\n"+L+P,E="#define flatShadeVar\n"+L+E,P=P.replace("mediump","highp")),g=new d(F,E,P.replace("__FILTER__",A)),c.progMap[C]=g}}}y="aTexCoord2",w.push("aTexCoord2");break;case 3:g=c.progFogTile[S],g||(g=this.generateTileShader(c.progFogTile,S,x,o))}}if(g&&g.isReady()){if(c.gpu.useProgram(g,w,m),i){var k=i.getGpuTexture();if(!k)return;i.statsCoutner!=this.stats.counter&&(i.statsCoutner=this.stats.counter,this.stats.gpuRenderUsed+=k.getSize()),c.gpu.bindTexture(k),m&&c.gpu.bindTexture(m,1)}else if(3!=r&&1!=r&&2!=r)return;var N=this.mBuffer,B=this.mBuffer2,S=this.vBuffer;if(x){var B=this.mBuffer,I=c.superElevation;B[0]=h.bbox.min[0],B[1]=h.bbox.min[1],B[2]=h.bbox.min[2],B[3]=h.bbox.side(0),B[4]=h.bbox.side(1),B[5]=h.bbox.side(2),B[9]=I[0],B[10]=I[1],B[11]=I[2],B[12]=I[6],B[13]=I[5],B[14]=c.earthRadius,B[15]=c.earthERatio,g.setMat4("uParamsSE",B),l.multiply(c.camera.getModelviewFMatrix(),h.getWorldMatrixSE(e,B),N)}else l.multiply(c.camera.getModelviewFMatrix(),h.getWorldMatrix(e,B),N);var R=c.camera.getProjectionFMatrix();if(g.setMat4("uMV",N),f.zbufferOffset?g.setMat4("uProj",R,c.getZoffsetFactor(f.zbufferOffset)):g.setMat4("uProj",R),o&&g.setFloatArray("uClip",o),0==b){var U,D=this.map.camera.vector2,z=f.atmoColor,_=h.bbox.min,G=h.bbox.max;switch(r){case 4:case 3:case 5:B[0]=f.zFactor,B[1]=5==r?0:f.fogDensity,B[2]=G[0]-_[0],B[3]=G[1]-_[1],B[4]=D[0],B[5]=D[1],B[6]=D[2],B[7]=D[3],B[12]=G[2]-_[2],B[13]=_[0],B[14]=_[1],B[15]=_[2],g.setMat4("uParams",B),S[0]=z[0],S[1]=z[1],S[2]=z[2],g.setVec4("uParams2",S);break;case 6:case 7:U=i.getTransform(),B[0]=f.zFactor,B[1]=6==r?f.fogDensity:0,B[2]=G[0]-_[0],B[3]=G[1]-_[1],B[4]=D[0],B[5]=D[1],B[6]=D[2],B[7]=D[3],B[8]=U[0],B[9]=U[1],B[10]=U[2],B[11]=U[3],B[12]=G[2]-_[2],B[13]=_[0],B[14]=_[1],B[15]=_[2],g.setMat4("uParams",B),S[0]=z[0],S[1]=z[1],S[2]=z[2],S[3]=6==r?1:s,g.setVec4("uParams2",S)}}if(h.statsCoutner!=this.stats.counter&&(h.statsCoutner=this.stats.counter,this.stats.gpuRenderUsed+=u.getSize()),u.draw(g,"aPosition",v,y,0!=b?"aBarycentric":null,2==b),1==b||2==b){g=c.progWireFrameBasic[S],g||(g=this.generateTileShader(c.progWireFrameBasic,S,x,o)),c.gpu.useProgram(g,w,m),x&&g.setMat4("uParamsSE",B),g.setMat4("uMV",N),g.setVec4("uColor",[0,0,0,1]),g.setMat4("uProj",R,c.getZoffsetFactor([-.001,0,0])),o&&g.setFloatArray("uClip",o);var V=u.gl;if(u.indexBuffer)for(var O=0,j=2*u.indexBuffer.numItems;O<j;O+=3)V.drawElements(V.LINE_LOOP,3,V.UNSIGNED_SHORT,O);else for(var O=0,j=2*u.vertexBuffer.numItems;O<j;O+=3)V.drawArrays(V.LINE_LOOP,O,3)}this.stats.drawnFaces+=this.faces,this.stats.drawCalls++}}},t.a=f},function(e,t,i){"use strict";var r=i(1),s=i(2),a=i(4),n=i(5),o=r.b,h=r.e,l=n.a,u=a.a,c=s.a,d=function(e,t,i,r){this.metatile=e,this.map=e.map,this.id=t,this.credits=[],this.alien=!1,this.ready=!1,this.heightReady=!1,this.divisionNode=r,this.diskPos=new Array(3),this.diskDistance=1,this.diskNormal=new Array(3),this.diskAngle=1,this.diskAngle2=1,this.diskAngle2A=1,this.bbox2=new Array(24),i&&this.parseMetanode(i)};d.prototype.kill=function(){},d.prototype.hasChild=function(e){return 0!=(this.flags&1<<e+4)},d.prototype.hasChildById=function(e){var t=e[1]-(this.id[1]<<1),i=e[2]-(this.id[2]<<1);return this.hasChild((i<<1)+t)},d.prototype.hasChildren=function(){return 0!=(240&this.flags)},d.prototype.parseExtentBits=function(e,t,i){for(var r=0,s=0,a=t;s<a;s++){var n=i>>3,o=7&i;e[n]&1<<7-o&&(r|=1<<a-s-1),i++}return r/=(1<<a)-1},d.prototype.hasGeometry=function(){return 0!=(1&this.flags)},d.prototype.hasNavtile=function(){return 0!=(2&this.flags)},d.prototype.usedTexelSize=function(){return 0!=(4&this.flags)},d.prototype.usedDisplaySize=function(){return 0!=(8&this.flags)},d.prototype.parseMetanode=function(e){var t=e.data,i=this.metatile.version;if(this.flags=t.getUint8(e.index,!0),e.index+=1,i<5){for(var r=6*(this.id[0]+2)+7>>3,s=this.map.metanodeBuffer,a=0,n=r;a<n;a++)s[a]=t.getUint8(e.index,!0),e.index+=1;var o=this.id[0]+2,h=[0,0,0],u=[0,0,0],d=0,p=this.map.spaceExtentSize,f=this.map.spaceExtentOffset;for(a=0;a<3;a++)h[a]=this.parseExtentBits(s,o,d)*p[a]+f[a],d+=o,u[a]=this.parseExtentBits(s,o,d)*p[a]+f[a],d+=o;var g=0;for(a=0,n=s.length;a<n;a++)g+=s[a];0==g&&(h[0]=Number.POSITIVE_INFINITY,h[1]=Number.POSITIVE_INFINITY,h[2]=Number.POSITIVE_INFINITY,u[0]=Number.NEGATIVE_INFINITY,u[1]=Number.NEGATIVE_INFINITY,u[2]=Number.NEGATIVE_INFINITY),this.bbox=new l(h[0],h[1],h[2],u[0],u[1],u[2])}i>=4&&(this.minZ=t.getFloat32(e.index,!0),e.index+=4,this.maxZ=t.getFloat32(e.index,!0),e.index+=4,this.surrogatez=t.getFloat32(e.index,!0),e.index+=4),this.internalTextureCount=t.getUint8(e.index,!0),e.index+=1,this.pixelSize=c.decodeFloat16(t.getUint16(e.index,!0)),e.index+=2,this.displaySize=t.getUint16(e.index,!0),e.index+=2,this.displaySize=this.metatile.surface.displaySize,0==(4&this.flags)&&(this.pixelSize=Number.POSITIVE_INFINITY),0==(8&this.flags)&&(this.displaySize=256),this.minHeight=t.getInt16(e.index,!0),e.index+=2,this.maxHeight=t.getInt16(e.index,!0),e.index+=2,i<4&&(this.minZ=this.minHeight,this.maxZ=this.maxHeight,this.surrogatez=this.minHeight),this.minZ2=this.minZ,this.maxZ2=this.maxZ,this.metatile.version>=3&&(128&this.metatile.flags?(this.sourceReference=t.getUint16(e.index,!0),e.index+=2):64&this.metatile.flags&&(this.sourceReference=t.getUint8(e.index,!0),e.index+=1)),this.heightReady=this.hasNavtile(),this.alien=!1,this.generateCullingHelpers()},d.prototype.clone=function(){var e=new d(this.metatile,this.id);e.flags=this.flags,e.minHeight=this.minHeight,e.maxHeight=this.maxHeight,e.minZ=this.minZ,e.maxZ=this.maxZ,e.minZ2=this.minZ2,e.maxZ2=this.maxZ2,e.llx=this.llx,e.lly=this.lly,e.urx=this.urx,e.ury=this.ury,e.surrogatez=this.surrogatez,e.internalTextureCount=this.internalTextureCount,e.pixelSize=this.pixelSize,e.displaySize=this.displaySize,e.ready=this.ready,e.stream=this.stream,e.heightReady=this.heightReady,e.credits=new Array(this.credits.length);for(var t=0,i=this.credits.length;t<i;t++)e.credits[t]=this.credits[t];return this.bbox&&(e.bbox=this.bbox.clone()),e.diskPos=this.diskPos,e.diskNormal=this.diskNormal,e.diskAngle=this.diskAngle,e.diskAngle2=this.diskAngle2,e.diskAngle2A=this.diskAngle2A,e.diskDistance=this.diskDistance,e.bbox2=this.bbox2,e.divisionNode=this.divisionNode,this.plane&&(e.plane=this.plane.slice()),e},d.prototype.generateCullingHelpers=function(e){this.ready=!0;var t=this.map,i=t.draw,r=t.isGeocent,s=this.metatile.useVersion;if(!(this.id[0]<t.measure.minDivisionNodeDepth||!r&&s<4)&&(t.config.mapPreciseCulling||s>=4)){if(e)return;var a,n,h,l,u,c=i.tmpVec3;if(this.id[0]>t.measure.maxDivisionNodeDepth){var d=i.tmpVec5;if(!(a=t.measure.getSpatialDivisionNodeFromId(this.id)))return;t.measure.getSpatialDivisionNodeAndExtents2(this.id,d,a),n=d[1],h=d[2],l=d[3],u=d[4],this.divisionNode=a}else{var p=t.measure.getSpatialDivisionNodeAndExtents(this.id);if(!(a=p?p[0]:null))return;n=p[1][0][0],h=p[1][0][1],l=p[1][1][0],u=p[1][1][1],this.divisionNode=a}this.llx=n,this.lly=h,this.urx=l,this.ury=u;var f=this.minZ;c[0]=.5*(l+n),c[1]=.5*(u+h),c[2]=f,a.getPhysicalCoordsFast(c,!0,this.diskPos,0,0),r?(this.diskDistance=o.length(this.diskPos),o.normalize(this.diskPos,this.diskNormal)):(this.diskNormal[0]=0,this.diskNormal[1]=0,this.diskNormal[2]=1);var g=this.diskNormal;c[0]=l,c[1]=u,c[2]=f;var m=this.bbox2;a.getPhysicalCoordsFast(c,!0,m,0,0),c[1]=h,a.getPhysicalCoordsFast(c,!0,m,0,3),c[0]=n,a.getPhysicalCoordsFast(c,!0,m,0,6),c[1]=u,a.getPhysicalCoordsFast(c,!0,m,0,9);var v;if(!r)return v=this.maxZ-f,m[12]=m[0],m[13]=m[1],m[14]=m[2]+v,m[15]=m[3],m[16]=m[4],m[17]=m[5]+v,m[18]=m[6],m[19]=m[7],m[20]=m[8]+v,m[21]=m[9],m[22]=m[10],void(m[23]=m[11]+v);var y,b,x,w,S,M,A=o.dot;if(t.config.mapPreciseBBoxTest||s>=4)if(v=this.maxZ-f,this.id[0]<=3){y=o.normalize2,y(m,0,c),b=A(g,c),y(m,3,c),x=A(g,c),y(m,6,c),w=A(g,c),y(m,9,c),S=A(g,c),M=Math.min(b,x,w,S),c[0]=.5*(l+n),c[1]=u,c[2]=f,a.getPhysicalCoordsFast(c,!0,m,0,12),c[1]=h,a.getPhysicalCoordsFast(c,!0,m,0,15),c[0]=l,c[1]=.5*(u+h),a.getPhysicalCoordsFast(c,!0,m,0,18),c[0]=n,a.getPhysicalCoordsFast(c,!0,m,0,21);var C=this.diskPos,T=Math.max(m[0],m[3],m[6],m[9],m[12],m[15],m[18],m[21],C[0]),P=Math.min(m[0],m[3],m[6],m[9],m[12],m[15],m[18],m[21],C[0]),F=Math.max(m[1],m[4],m[7],m[10],m[13],m[16],m[19],m[22],C[1]),L=Math.min(m[1],m[4],m[7],m[10],m[13],m[16],m[19],m[22],C[1]),E=Math.max(m[2],m[5],m[8],m[11],m[14],m[17],m[20],m[23],C[2]),k=Math.min(m[2],m[5],m[8],m[11],m[14],m[17],m[20],m[23],C[2]);this.id[0]<=1&&(c[0]=l+.25*(n-l),c[1]=.5*(u+h),a.getPhysicalCoordsFast(c,!0,m,0,12),c[0]=l+.75*(n-l),a.getPhysicalCoordsFast(c,!0,m,0,15),c[0]=.5*(l+n),c[1]=u+.25*(h-u),a.getPhysicalCoordsFast(c,!0,m,0,18),c[1]=u+.75*(h-u),a.getPhysicalCoordsFast(c,!0,m,0,21),T=Math.max(T,m[12],m[15],m[18],m[21]),P=Math.min(P,m[12],m[15],m[18],m[21]),F=Math.max(F,m[13],m[16],m[19],m[22]),L=Math.min(L,m[13],m[16],m[19],m[22]),E=Math.max(E,m[14],m[17],m[20],m[23]),k=Math.min(k,m[14],m[17],m[20],m[23]),M=-1),m[0]=P,m[1]=L,m[2]=k,m[3]=T,m[4]=L,m[5]=k,m[6]=T,m[7]=F,m[8]=k,m[9]=P,m[10]=F,m[11]=k,m[12]=P,m[13]=L,m[14]=E,m[15]=T,m[16]=L,m[17]=E,m[18]=T,m[19]=F,m[20]=E,m[21]=P,m[22]=F,m[23]=E}else{if(y=o.normalize3,A=o.dot2,y(m,0,m,12),b=A(g,m,12),y(m,3,m,15),x=A(g,m,15),y(m,6,m,18),w=A(g,m,18),y(m,9,m,21),S=A(g,m,21),M=Math.min(b,x,w,S),this.id[0]<=8){c=this.diskPos;var N=.024*(5-(this.id[0]-4));m[0]+=(m[0]-c[0])*N,m[1]+=(m[1]-c[1])*N,m[2]+=(m[2]-c[2])*N,m[3]+=(m[3]-c[0])*N,m[4]+=(m[4]-c[1])*N,m[5]+=(m[5]-c[2])*N,m[6]+=(m[6]-c[0])*N,m[7]+=(m[7]-c[1])*N,m[8]+=(m[8]-c[2])*N,m[9]+=(m[9]-c[0])*N,m[10]+=(m[10]-c[1])*N,m[11]+=(m[11]-c[2])*N}v+=i.planetRadius-i.planetRadius*M,m[12]=m[0]+m[12]*v,m[13]=m[1]+m[13]*v,m[14]=m[2]+m[14]*v,m[15]=m[3]+m[15]*v,m[16]=m[4]+m[16]*v,m[17]=m[5]+m[17]*v,m[18]=m[6]+m[18]*v,m[19]=m[7]+m[19]*v,m[20]=m[8]+m[20]*v,m[21]=m[9]+m[21]*v,m[22]=m[10]+m[22]*v,m[23]=m[11]+m[23]*v}else y=o.normalize2,y(m,0,c),b=A(g,c),y(m,3,c),x=A(g,c),y(m,6,c),w=A(g,c),y(m,9,c),S=A(g,c),M=Math.min(b,x,w,S);this.diskAngle=Math.cos(Math.max(0,.5*Math.PI-Math.acos(M))),this.diskAngle2=M,this.diskAngle2A=Math.acos(M)}},d.prototype.getWorldMatrix=function(e,t){var i=t;return null!=i?(i[0]=this.bbox.side(0),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=this.bbox.side(1),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=this.bbox.side(2),i[11]=0,i[12]=this.bbox.min[0]-e[0],i[13]=this.bbox.min[1]-e[1],i[14]=this.bbox.min[2]-e[2],i[15]=1):(i=h.create(),h.multiply(u.translationMatrix(this.bbox.min[0]-e[0],this.bbox.min[1]-e[1],this.bbox.min[2]-e[2]),u.scaleMatrix(this.bbox.side(0),this.bbox.side(1),this.bbox.side(2)),i)),i},d.prototype.drawBBox=function(e){if(this.metatile.useVersion>=4)return this.drawBBox2(e);var t=this.map.renderer;t.gpu.useProgram(t.progBBox,["aPosition"]);var i=h.create(),r=h.create();h.multiply(t.camera.getModelviewMatrix(),this.getWorldMatrix(e),r);var s=t.camera.getProjectionMatrix();h.multiply(s,r,i),t.progBBox.setMat4("uMVP",i),t.bboxMesh.draw(t.progBBox,"aPosition")},d.prototype.drawBBox2=function(){for(var e=this.bbox2,t=this.map.draw.bboxBuffer,i=this.map.camera.position,r=this.map.renderer,s=r.progBBox2,a=0;a<24;a+=3)t[a]=e[a]-i[0],t[a+1]=e[a+1]-i[1],t[a+2]=e[a+2]-i[2];r.gpu.useProgram(s,["aPosition"]),s.setFloatArray("uPoints",t);var n=r.camera.getMvpMatrix();s.setMat4("uMVP",n),r.bboxMesh2.draw(s,"aPosition")},d.prototype.drawPlane=function(e,t){var i=this.map.renderer,r=this.map.draw.planeBuffer,s=this.plane;if(s){i.gpu.useProgram(i.progPlane,["aPosition","aTexCoord"]);var a=h.create(),n=i.camera.getModelviewMatrix(),o=i.camera.getProjectionMatrix();h.multiply(o,n,a);for(var l=e[0],u=e[1],c=e[2],d=0;d<9;d++){var p=3*d;r[p]=s[p]-l,r[p+1]=s[p+1]-u,r[p+2]=s[p+2]-c}var f=i.progPlane;f.setMat4("uMV",n),f.setMat4("uProj",o),f.setFloatArray("uPoints",r);var g=Math.max(10,t.distance+20),m=Math.log(g)/Math.log(8),v=m-Math.floor(m);f.setVec4("uParams",[4,0,1/15,8]),f.setVec4("uParams2",[0,0,v,0]),i.gpu.bindTexture(i.heightmapTexture),i.planeMesh.draw(i.progPlane,"aPosition","aTexCoord")}},d.prototype.getGridHeight=function(e,t,i){var r=e[0]-this.llx,s=e[1]-this.lly,a=i-1,n=i-1;r=a*(r/(this.urx-this.llx)),s=n*(s/(this.ury-this.lly)),r<0&&(r=0),s<0&&(s=0),r>a&&(r=a),s>n&&(s=n);var o=Math.floor(r),h=Math.floor(s),l=r-o,u=s-h,c=h*i,d=h==n?c:c+i,p=o==a?o:o+1,f=t[c+o],g=t[c+p],m=t[d+o],v=t[d+p],y=f+(g-f)*l;return y+(m+(v-m)*l-y)*u},t.a=d},function(e,t,i){"use strict";var r=i(2),s=i(146),a=(r.a,s.a),n=function(e,t,i){this.metaresources=e,this.map=e.map,this.surface=t,this.id=e.id,this.tile=i,this.nodes=[],this.drawCounter=0,this.loadState=0,this.loadErrorTime=null,this.loadErrorCounter=0,this.size=0,this.cacheItem=null};n.prototype.kill=function(e){!0!==e&&null!=this.cacheItem&&this.map.metatileCache.remove(this.cacheItem),this.metaresources&&this.metaresources.removeMetatile(this),this.loadState=0,this.surface=0,this.cacheItem=null,this.nodes=[]},n.prototype.clone=function(e){var t=new n(this.metaresources,e);return t.nodes=this.nodes,t.loadState=this.loadState,t.nodes=this.nodes,t.size=this.size,t.lod=this.lod,t.metatileIdx=this.metatileIdx,t.metatileIdy=this.metatileIdy,t.offsetx=this.offsetx,t.offsety=this.offsety,t.sizex=this.sizex,t.sizey=this.sizey,t.version=this.version,t.credits=this.credits,this.version<2?t.nodeSize=this.nodeSize:(t.flags=this.flags,t.creditCount=this.creditCount,t.flagPlanes=this.flagPlanes),t.cacheItem=this.map.metatileCache.insert(t.kill.bind(t,!0),t.size),t},n.prototype.isReady=function(e){return 2==this.loadState||(0==this.loadState&&(3==this.loadState?this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&performance.now()>this.loadErrorTime+this.map.config.mapLoadErrorRetryTime&&this.scheduleLoad(e):this.scheduleLoad(e)),!1)},n.prototype.used=function(){null!=this.cacheItem&&this.map.metatileCache.updateItem(this.cacheItem)},n.prototype.getNode=function(e){var t=e[1]-this.id[1]-this.offsetx,i=e[2]-this.id[2]-this.offsety;if(t<0||i<0||t>=this.sizex||i>=this.sizey)return null;var r=this.nodes[this.sizex*i+t];if(!r){var s=this.sizex*i+t,n={data:this.data,index:this.metanodesIndex+s*this.metanodeSize};r=new a(this,[this.lod,this.metatileIdx+this.offsetx+t,this.metatileIdy+this.offsety+i],n,this.divisionNode),this.nodes[s]=r,this.applyMetanodeCredits(t,i),this.applyMetatanodeBitplanes(t,i)}return r},n.prototype.scheduleLoad=function(){null==this.mapLoaderUrl&&(this.mapLoaderUrl=this.surface.getMetaUrl(this.id)),this.map.loader.load(this.mapLoaderUrl,this.onLoad.bind(this),null,this.tile,"metatile")},n.prototype.onLoad=function(e,t,i){this.mapLoaderCallLoaded=t,this.mapLoaderCallError=i,this.map.loader.processLoadBinary(e,this.onLoaded.bind(this),this.onLoadError.bind(this),null,"metadata"),this.loadState=1},n.prototype.onLoadError=function(){this.map.killed||(this.loadState=3,this.loadErrorTime=performance.now(),this.loadErrorCounter++,this.loadErrorCounter<=this.map.config.mapLoadErrorMaxRetryCount&&setTimeout(function(){this.map.killed||this.map.markDirty()}.bind(this),this.map.config.mapLoadErrorRetryTime),this.mapLoaderCallError())},n.prototype.onLoaded=function(e,t){if(!this.map.killed){if(!t)return this.map.markDirty(),void this.map.addProcessingTask(this.onLoaded.bind(this,e,!0));e=new DataView(e),this.size+=4*e.byteLength,this.data=e;var i=performance.now();this.parseMetatatile({data:e,index:0}),this.map.stats.renderBuild+=performance.now()-i,this.cacheItem=this.map.metatileCache.insert(this.kill.bind(this,!0),this.size),this.map.markDirty(),this.loadState=2,this.loadErrorTime=null,this.loadErrorCounter=0,this.mapLoaderCallLoaded()}},n.prototype.parseMetatatile=function(e){var t=e.data,i="";i+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,i+=String.fromCharCode(t.getUint8(e.index,!0)),e.index+=1,"MT"==i&&(this.version=t.getUint16(e.index,!0),e.index+=2,this.version>5||(this.lod=t.getUint8(e.index,!0),e.index+=1,this.metatileIdx=t.getUint32(e.index,!0),e.index+=4,this.metatileIdy=t.getUint32(e.index,!0),e.index+=4,this.offsetx=t.getUint16(e.index,!0),e.index+=2,this.offsety=t.getUint16(e.index,!0),e.index+=2,this.sizex=t.getUint16(e.index,!0),e.index+=2,this.sizey=t.getUint16(e.index,!0),e.index+=2,this.flagPlanes=new Array(8),this.version<2?(this.nodeSize=t.getUint8(e.index,!0),e.index+=1):(this.flags=t.getUint8(e.index,!0),e.index+=1,this.creditCount=t.getUint8(e.index,!0),e.index+=1,this.parseFlagPlanes(e)),this.parseMetatatileCredits(e),this.parseMetatatileNodes(e),this.useVersion=this.map.config.mapForceMetatileV3&&this.version<5?3:this.version))},n.prototype.parseFlagPlanes=function(e){for(var t=e.data,i=this.sizex*this.sizey+7>>3,r=0;r<6;r++)if(0!=(this.flags&1<<r)){for(var s=new Uint8Array(i),a=0;a<i;a++)s[a]=t.getUint8(e.index,!0),e.index+=1;this.flagPlanes[r]=s}},n.prototype.parseMetatatileCredits=function(e){var t=e.data;if(this.version<2&&(this.creditCount=t.getUint8(e.index,!0),e.index+=1,this.creditSize=t.getUint16(e.index,!0),e.index+=2),0==this.creditCount)return void(this.credits=[]);var i=this.sizex*this.sizey+7>>3;this.credits=new Array(this.creditCount);for(var r=0,s=this.credits.length;r<s;r++){var a=t.getUint16(e.index,!0);e.index+=2;for(var n=new Uint8Array(i),o=0;o<i;o++)n[o]=t.getUint8(e.index,!0),e.index+=1;var h=this.map.getCreditByNumber(a),l=h?h.key:null;this.credits[r]={creditId:l,creditMask:n}}},n.prototype.applyMetatatileBitplanes=function(){for(var e=0;e<1;e++)if(this.flagPlanes[e])for(var t=this.flagPlanes[e],i=0;i<this.sizey;i++)for(var r=0;r<this.sizex;r++){var s=this.sizex*i+r,a=7&s,n=1<<a;if(s>>=3,t[s]&n)switch(e){case 0:this.nodes[i*this.sizex+r].alien=!0}}},n.prototype.applyMetatanodeBitplanes=function(e,t){for(var i=0;i<1;i++)if(this.flagPlanes[i]){var r=this.flagPlanes[i],s=this.sizex*t+e,a=7&s,n=1<<a;if(s>>=3,r[s]&n)switch(i){case 0:this.nodes[t*this.sizex+e].alien=!0}}},n.prototype.applyMetatatileCredits=function(){for(var e=0;e<this.sizey;e++)for(var t=0;t<this.sizex;t++){var i=this.sizex*e+t,r=7&i,s=1<<r;i>>=3;for(var a=0,n=this.credits.length;a<n;a++)if(this.credits[a].creditMask[i]&s){var o=this.credits[a].creditId;o&&this.nodes[e*this.sizex+t].credits.push(o)}}},n.prototype.applyMetanodeCredits=function(e,t){var i=this.sizex*t+e,r=7&i,s=1<<r;i>>=3;for(var a=0,n=this.credits.length;a<n;a++)if(this.credits[a].creditMask[i]&s){var o=this.credits[a].creditId;o&&this.nodes[t*this.sizex+e].credits.push(o)}},n.prototype.parseMetatatileNodes=function(e){this.metanodesIndex=e.index,this.metanodeSize=10,this.version>=5?this.metanodeSize+=12:(this.metanodeSize+=Math.floor((6*(this.id[0]+2)+7)/8),4==this.version&&(this.metanodeSize+=12)),this.version>=3&&(128&this.flags?this.metanodeSize+=2:64&this.flags&&(this.metanodeSize+=1)),this.lod>=this.map.measure.minDivisionNodeDepth?(this.divisionNode=this.map.measure.getSpatialDivisionNodeAndExtents([this.lod,this.metatileIdx+this.offsetx,this.metatileIdy+this.offsety]),this.divisionNode&&(this.divisionNode=this.divisionNode[0])):this.divisionNode=null,this.nodes=new Array(this.sizex*this.sizey)},t.a=n},function(e,t,i){"use strict";var r=i(133),s=r.a,a=function(e,t){this.map=e,this.proj4=e.proj4,this.valid=!1,this.id=t.id||null,this.description=t.description||"",this.nodesMap=[];var i=t.model;if(null!=i){if(this.model={physicalSrs:e.getMapsSrs(i.physicalSrs),navigationSrs:e.getMapsSrs(i.navigationSrs),publicSrs:e.getMapsSrs(i.publicSrs)},this.body=t.body?e.getBody(t.body):null,this.params={},null!=t.parameters){var r=t.parameters;this.params.metaBinaryOrder=r.metaBinaryOrder||1,this.params.navDelta=r.navDelta||8}var s=t.division;if(null!=s){this.division={rootLod:s.rootLod||0,arity:s.arity||null,heightRange:s.heightRange||[0,1]};var a=this.parseSpaceExtents(s.extents);this.division.extents=a,e.spaceExtentSize=[a.ur[0]-a.ll[0],a.ur[1]-a.ll[1],a.ur[2]-a.ll[2]],e.spaceExtentOffset=a.ll;var n=s.nodes;if(this.division.nodes=[],null!=n){this.hasPoles=4==n.length;for(var o=0,h=n.length;o<h;o++){var l=this.parseNode(n[o]);this.nodesMap[l.id[0]+"."+l.id[1]+"."+l.id[2]]=l,this.division.nodes.push(l)}this.valid=!0}}}};a.prototype.getInfo=function(){return{id:this.id,physicalSrs:this.model.physicalSrs.id,navigationSrs:this.model.navigationSrs.id,publicSrs:this.model.publicSrs.id}},a.prototype.getGlobalHeightRange=function(){return this.division.heightRange},a.prototype.parseNode=function(e){var t={srs:e.srs,partitioning:e.partitioning};t.extents=this.parseExtents(e.extents);var i=e.id;if(null!=i)return t.id={lod:i.lod||0,position:i.position||[0,0]},new s(this.map,[t.id.lod,t.id.position[0],t.id.position[1]],t.srs,t.extents,this.heightRange,t.partitioning)},a.prototype.parseExtents=function(e){return null==e?{ll:[0,0],ur:[1,1]}:{ll:e.ll||[0,0],ur:e.ur||[1,1]}},a.prototype.parseSpaceExtents=function(e){return null==e?{ll:[0,0,0],ur:[1,1,1]}:{ll:e.ll||[0,0,0],ur:e.ur||[1,1,1]}},a.prototype.getSpatialDivisionNodes=function(){return this.division.nodes},a.prototype.convertCoords=function(e,t,i){var r,s;switch(t){case"public":r=this.model.publicSrs;break;case"physical":r=this.model.physicalSrs;break;case"navigation":r=this.model.navigationSrs}switch(i){case"public":s=this.model.publicSrs;break;case"physical":s=this.model.physicalSrs;break;case"navigation":s=this.model.navigationSrs}return r.convertCoordsTo(e,s)},t.a=a},function(e,t,i){"use strict";var r=function(e){this.map=e,this.draw=e.draw,this.renderer=e.renderer,this.config=e.config,this.renderSlots=[]};r.prototype.createRenderSlot=function(e,t,i){return{id:e,callback:t,enabled:i}},r.prototype.addRenderSlot=function(e,t,i){this.renderSlots.push(this.createRenderSlot(e,t,i))},r.prototype.getRenderSlotIndex=function(e){return this.map.searchArrayIndexById(this.renderSlots,e)},r.prototype.checkRenderSlotId=function(e){return"after-map-render"==e?"map":e},r.prototype.moveRenderSlotBefore=function(e,t){var i=this.getRenderSlotIndex(this.checkRenderSlotId(e)),r=this.getRenderSlotIndex(t);-1!=i&&-1!=r&&r!=i-1&&this.renderSlots.splice(r,0,this.renderSlots.splice(i,1)[0])},r.prototype.moveRenderSlotAfter=function(e,t){var i=this.getRenderSlotIndex(this.checkRenderSlotId(e)),r=this.getRenderSlotIndex(t);-1!=i&&-1!=r&&r!=i+1&&(r++,this.renderSlots.splice(r,0,this.renderSlots.splice(i,1)[0]))},r.prototype.removeRenderSlot=function(e){var t=this.getRenderSlotIndex(e);-1!=t&&this.renderSlots.splice(t,1)},r.prototype.setRenderSlotEnabled=function(e,t){var i=this.getRenderSlotIndex(e);-1!=i&&(this.renderSlots[i].enabled=t)},r.prototype.getRenderSlotEnabled=function(e){var t=this.getRenderSlotIndex(e);return-1!=t&&this.renderSlots[t].enabled},r.prototype.processRenderSlots=function(){1!=this.draw.drawChannel&&this.renderer.gpu.setViewport();for(var e=0,t=this.renderSlots.length;e<t;e++){var i=this.renderSlots[e];i.enabled&&i.callback&&(this.renderer.gpu.setState(this.draw.drawTileState),i.callback(this.draw.drawChannelNames[this.draw.drawChannel]))}},t.a=r},function(e,t,i){"use strict";var r=i(52),s=r.a,a=function(e){this.map=e,this.tree=new s(e,null,[0,0,0])};a.prototype.kill=function(){this.tree.kill()},a.prototype.findNode=function(e,t){for(var i=this.tree,r=e[0];r>0;r--){var s=1<<r-1,a=0;if(0!=(e[1]&s)&&(a+=1),0!=(e[2]&s)&&(a+=2),!i.children[a]){if(!t)return null;i.addChild(a)}i=i.children[a]}return i},a.prototype.findAgregatedNode=function(e,t,i){for(var r=this.tree,s=e[1]>>t<<t,a=e[2]>>t<<t,n=e[0];n>0;n--){var o=1<<n-1,h=0;if(0!=(s&o)&&(h+=1),0!=(a&o)&&(h+=2),!r.children[h]){if(!i)return null;r.addChild(h)}r=r.children[h]}return r},t.a=a},function(e,t,i){"use strict";var r=function(e){this.map=e,this.core=e.core,this.inspector=e.core.inspector,this.drawnTiles=0,this.drawnGeodataTiles=0,this.drawnGeodataTilesFactor=0,this.drawnGeodataTilesPerLayer=0,this.drawnFaces=0,this.drawCalls=0,this.usedNodes=0,this.processedNodes=0,this.processedMetatiles=0,this.counter=0,this.statsCycle=0,this.fps=0,this.frameTime=0,this.renderTime=0,this.renderTimeTmp=0,this.renderTimeBegin=0,this.renderBuild=0,this.lastRenderTime=0,this.lastFrameTime=0,this.renderedLods=new Array(32),this.debugIds={},this.recordGraphs=!1,this.graphsTimeIndex=0,this.graphsLastTimeIndex=0,this.graphsTimeSamples=900,this.graphsRenderTimes=new Array(this.graphsTimeSamples),this.graphsCreateMeshTimes=new Array(this.graphsTimeSamples),this.graphsCreateGpuMeshTimes=new Array(this.graphsTimeSamples),this.graphsCreateTextureTimes=new Array(this.graphsTimeSamples),this.graphsFrameTimes=new Array(this.graphsTimeSamples),this.graphsCpuMemoryMetatiles=new Array(this.graphsTimeSamples),this.graphsCpuMemoryUsed=new Array(this.graphsTimeSamples),this.graphsGpuMemoryTextures=new Array(this.graphsTimeSamples),this.graphsGpuMemoryMeshes=new Array(this.graphsTimeSamples),this.graphsGpuMemoryGeodata=new Array(this.graphsTimeSamples),this.graphsGpuMemoryRender=new Array(this.graphsTimeSamples),this.graphsPolygons=new Array(this.graphsTimeSamples),this.graphsLODs=new Array(this.graphsTimeSamples),this.graphsBuild=new Array(this.graphsTimeSamples),this.graphsFluxTextures=new Array(this.graphsTimeSamples),this.graphsFluxMeshes=new Array(this.graphsTimeSamples),this.graphsFluxGeodatas=new Array(this.graphsTimeSamples),this.graphsFluxTexture=[[0,0],[0,0]],this.graphsFluxMesh=[[0,0],[0,0]],this.graphsFluxGeodata=[[0,0],[0,0]],this.graphsCreateTextureTime=0,this.graphsCreateGpuMeshTime=0,this.graphsCreateMeshTime=0,this.resetGraphs(),this.meshesFaces=0,this.meshesUVArea=0,this.gpuMeshes=0,this.gpuTextures=0,this.gpuGeodata=0,this.gpuUsed=0,this.resourcesUsed=0,this.metaUsed=0,this.gpuRenderUsed=0,this.loadedCount=0,this.loadErrorCount=0,this.loadFirst=0,this.loadLast=0,this.gpuNeeded=0,this.gpuNeeded2=0,this.heightClass=0,this.heightLod=0,this.heightNode=0,this.heightTerrain=0,this.heightDelta=0,this.debugStr=null};r.prototype.resetGraphs=function(){this.graphsTimeIndex=0;for(var e=0;e<this.graphsTimeSamples;e++)this.graphsRenderTimes[e]=0,this.graphsCreateMeshTimes[e]=0,this.graphsCreateGpuMeshTimes[e]=0,this.graphsCreateTextureTimes[e]=0,this.graphsFrameTimes[e]=0,this.graphsCpuMemoryUsed[e]=0,this.graphsCpuMemoryMetatiles[e]=0,this.graphsGpuMemoryTextures[e]=0,this.graphsGpuMemoryMeshes[e]=0,this.graphsGpuMemoryGeodata[e]=0,this.graphsGpuMemoryRender[e]=0,this.graphsPolygons[e]=0,this.graphsLODs[e]=[0,[]],this.graphsBuild[e]=0,this.graphsFluxTextures[e]=[[0,0],[0,0]],this.graphsFluxMeshes[e]=[[0,0],[0,0]],this.graphsFluxGeodatas[e]=[[0,0],[0,0]]},r.prototype.begin=function(e){if(e){this.drawnTiles=0,this.drawnGeodataTiles=0,this.drawnGeodataTilesFactor=0,this.drawnGeodataTilesPerLayer=0,this.drawCalls=0,this.drawnFaces=0,this.gpuRenderUsed=0,this.gpuNeeded=0,this.usedNodes=0,this.processedNodes=0,this.processedMetatiles=0,this.meshesFaces=0,this.meshesUVArea=0;for(var t=0,i=this.renderedLods.length;t<i;t++)this.renderedLods[t]=0}this.debugIds={},this.counter++,this.statsCycle++,this.renderTimeBegin=performance.now(),e&&(this.lastFrameTime&&(this.frameTime=this.renderTimeBegin-this.lastFrameTime),this.lastFrameTime=this.renderTimeBegin)},r.prototype.end=function(e){var t=performance.now(),i=t-this.renderTimeBegin;if(e?(this.renderTimeTmp+=i,this.lastRenderTime=i):this.renderTimeTmp+=this.lastRenderTime,this.recordGraphs){var r=this.graphsTimeIndex;this.graphsRenderTimes[r]=i,this.graphsCreateMeshTimes[r]=0,this.graphsCreateGpuMeshTimes[r]=0,this.graphsCreateTextureTimes[r]=0,this.graphsFrameTimes[r]=this.frameTime,this.graphsCpuMemoryUsed[r]=this.map.resourcesCache.totalCost,this.graphsCpuMemoryMetatiles[r]=this.map.metatileCache.totalCost,this.graphsGpuMemoryTextures[r]=this.gpuTextures,this.graphsGpuMemoryMeshes[r]=this.gpuMeshes,this.graphsGpuMemoryGeodata[r]=this.gpuGeodata,this.graphsGpuMemoryRender[r]=this.gpuRenderUsed,this.graphsPolygons[r]=this.drawnFaces,this.graphsFluxTextures[r]=[[this.graphsFluxTexture[0][0],this.graphsFluxTexture[0][1]],[this.graphsFluxTexture[1][0],this.graphsFluxTexture[1][1]]],this.graphsFluxMeshes[r]=[[this.graphsFluxMesh[0][0],this.graphsFluxMesh[0][1]],[this.graphsFluxMesh[1][0],this.graphsFluxMesh[1][1]]],this.graphsFluxGeodatas[r]=[[this.graphsFluxGeodata[0][0],this.graphsFluxGeodata[0][1]],[this.graphsFluxGeodata[1][0],this.graphsFluxGeodata[1][1]]],this.graphsLODs[r]=[this.drawnTiles,this.renderedLods.slice()],this.graphsBuild[r]=this.renderBuild,this.graphsTimeIndex=(this.graphsTimeIndex+1)%this.graphsTimeSamples,this.inspector&&this.inspector.graphs&&this.inspector.graphs.updateGraphs(this)}this.statsCycle%50==0&&(this.renderTime=this.renderTimeTmp/100,this.fps=1e3/this.renderTime,this.renderTimeTmp=0,this.inspector&&this.inspector.stats&&(this.gpuUsed=this.map.gpuCache.totalCost,this.resourcesUsed=this.map.resourcesCache.totalCost,this.metaUsed=this.map.metatileCache.totalCost,this.inspector.stats.updateStatsPanel(this))),this.graphsFluxTexture=[[0,0],[0,0]],this.graphsFluxMesh=[[0,0],[0,0]],this.graphsFluxGeodata=[[0,0],[0,0]],this.debugStr=this.map.renderer.debugStr},t.a=r},function(e,t,i){"use strict";var r=i(1),s=i(4),a=i(32),n=i(5),o=r.e,h=s.a,l=a.a,u=n.a,c=function(e,t){this.generateLines=!0,this.map=e.map,this.vertices=null,this.internalUVs=null,this.externalUVs=null,this.indices=null,this.mesh=e,this.statsCounter=0,this.valid=!0,this.killed=!1,this.use16bit=e.use16bit,this.bbox=new u,this.size=0,this.faces=0,this.uvArea=0,this.uvAreaComputed=!1,this.flagsInternalTexcoords=1,this.flagsExternalTexcoords=2,this.flagsPerVertexUndulation=4,this.flagsTextureMode=8,t&&this.parseSubmesh(t)};c.prototype.kill=function(){this.killed=!0,this.vertices=null,this.internalUVs=null,this.externalUVs=null,this.indices=null},c.prototype.parseSubmesh=function(e){this.parseHeader(e),this.mesh.version>=3?this.parseVerticesAndFaces2(e):this.parseVerticesAndFaces(e)},c.prototype.parseHeader=function(e){var t=e.data;this.flags=t.getUint8(e.index,!0),e.index+=1,this.mesh.version>1?(this.surfaceReference=t.getUint8(e.index,!0),e.index+=1):this.surfaceReference=0,this.textureLayer=t.getUint16(e.index,!0),e.index+=2,this.textureLayer2=this.textureLayer;var i=this.bbox.min,r=this.bbox.max;i[0]=t.getFloat64(e.index,!0),e.index+=8,i[1]=t.getFloat64(e.index,!0),e.index+=8,i[2]=t.getFloat64(e.index,!0),e.index+=8,r[0]=t.getFloat64(e.index,!0),e.index+=8,r[1]=t.getFloat64(e.index,!0),e.index+=8,r[2]=t.getFloat64(e.index,!0),e.index+=8,this.bbox.updateMaxSize()},c.prototype.parseVerticesAndFaces=function(e){var t=e.data,i=e.index,r=e.uint8Data,s=t.getUint16(i,!0);i+=2,s||(this.valid=!1);var a=null,n=null,o=this.map.config.mapOnlyOneUVs&&this.flags&this.flagsInternalTexcoords,h=this.use16bit?new Uint16Array(3*s):new Float32Array(3*s);this.flags&this.flagsExternalTexcoords&&(n=!!o||(this.use16bit?new Uint16Array(2*s):new Float32Array(2*s)));var l,u,c=this.use16bit?1:1/65535,d=0,p=0;for(l=0;l<s;l++)h[d]=(r[i]+(r[i+1]<<8))*c,h[d+1]=(r[i+2]+(r[i+3]<<8))*c,h[d+2]=(r[i+4]+(r[i+5]<<8))*c,d+=3,n?(o||(n[p]=(r[i+6]+(r[i+7]<<8))*c,n[p+1]=(65535-(r[i+8]+(r[i+9]<<8)))*c,p+=2),i+=10):i+=6;if(this.tmpVertices=h,this.tmpExternalUVs=n,this.flags&this.flagsInternalTexcoords){var f=t.getUint16(i,!0);for(i+=2,a=this.use16bit?new Uint16Array(2*f):new Float32Array(2*f),l=0,u=2*f;l<u;l+=2)a[l]=(r[i]+(r[i+1]<<8))*c,a[l+1]=(65535-(r[i+2]+(r[i+3]<<8)))*c,i+=4;this.tmpInternalUVs=a}var g=t.getUint16(i,!0);i+=2;var m=null;a=null,n=null;var v=this.map.config.mapIndexBuffers&&this.map.config.mapOnlyOneUVs&&!(this.flags&this.flagsInternalTexcoords),y=this.map.config.mapIndexBuffers&&this.map.config.mapOnlyOneUVs&&this.flags&this.flagsInternalTexcoords,b=v||y;b?m=new Uint16Array(3*g):(h=this.use16bit?new Uint16Array(3*g*3):new Float32Array(3*g*3),this.flags&this.flagsInternalTexcoords&&(a=this.use16bit?new Uint16Array(3*g*2):new Float32Array(3*g*2)),!o&&this.flags&this.flagsExternalTexcoords&&(n=this.use16bit?new Uint16Array(3*g*2):new Float32Array(3*g*2)));var x,w,S,M,A,C,T,P=this.tmpVertices,F=this.tmpExternalUVs,L=this.tmpInternalUVs;for(v&&(h=this.tmpVertices,n=this.tmpExternalUVs),y&&(h=this.use16bit?new Uint16Array(L.length/2*3):new Float32Array(L.length/2*3),a=this.tmpInternalUVs),l=0;l<g;l++)x=r[i]+(r[i+1]<<8),w=r[i+2]+(r[i+3]<<8),S=r[i+4]+(r[i+5]<<8),b?(d=3*l,null!=a?(M=r[i+6]+(r[i+7]<<8),A=r[i+8]+(r[i+9]<<8),C=r[i+10]+(r[i+11]<<8),h[3*M]=P[3*x],h[3*M+1]=P[3*x+1],h[3*M+2]=P[3*x+2],h[3*A]=P[3*w],h[3*A+1]=P[3*w+1],h[3*A+2]=P[3*w+2],h[3*C]=P[3*S],h[3*C+1]=P[3*S+1],h[3*C+2]=P[3*S+2],m[d]=M,m[d+1]=A,m[d+2]=C,i+=12):(m[d]=x,m[d+1]=w,m[d+2]=S,i+=6)):(d=9*l,T=3*x,h[d]=P[T],h[d+1]=P[T+1],h[d+2]=P[T+2],T=3*w,h[d+3]=P[T],h[d+4]=P[T+1],h[d+5]=P[T+2],T=3*S,h[d+6]=P[T],h[d+7]=P[T+1],h[d+8]=P[T+2],null!=n&&(d=6*l,n[d]=F[2*x],n[d+1]=F[2*x+1],n[d+2]=F[2*w],n[d+3]=F[2*w+1],n[d+4]=F[2*S],n[d+5]=F[2*S+1]),null!=a?(x=r[i+6]+(r[i+7]<<8),w=r[i+8]+(r[i+9]<<8),S=r[i+10]+(r[i+11]<<8),i+=12,d=6*l,a[d]=L[2*x],a[d+1]=L[2*x+1],a[d+2]=L[2*w],a[d+3]=L[2*w+1],a[d+4]=L[2*S],a[d+5]=L[2*S+1]):i+=6);this.vertices=h,this.internalUVs=a,this.externalUVs=n,this.indices=m,this.tmpVertices=null,this.tmpInternalUVs=null,this.tmpExternalUVs=null,e.index=i,this.size=this.vertices.byteLength,this.internalUVs&&(this.size+=this.internalUVs.byteLength),this.externalUVs&&(this.size+=this.externalUVs.byteLength),this.indices&&(this.size+=this.indices.byteLength),this.faces=g},c.prototype.parseWord=function(e,t){var i=e[t[1]];128&i?(t[0]=127&i|e[t[1]+1]<<7,t[1]+=2):(t[0]=i,t[1]++)},c.prototype.parseDelta=function(e,t){var i=e[t[1]];128&i?(i=127&i|e[t[1]+1]<<7,1&i?(t[0]=-(1+(i>>1)),t[1]+=2):(t[0]=i>>1,t[1]+=2)):1&i?(t[0]=-(1+(i>>1)),t[1]++):(t[0]=i>>1,t[1]++)},c.prototype.parseVerticesAndFaces2=function(e){var t=e.data,i=e.index,r=e.uint8Data,s=this.map.config.mapOnlyOneUVs&&this.flags&this.flagsInternalTexcoords,a=t.getUint16(i,!0);i+=2;var n=t.getUint16(i,!0);i+=2,a||(this.valid=!1);var o,h,l,u,c=this.bbox.center(),d=this.bbox.maxSize,p=1/n,f=null,g=this.use16bit?new Uint16Array(3*a):new Float32Array(3*a),m=0,v=0,y=0,b=c[0],x=c[1],w=c[2],S=this.bbox.min[0],M=this.bbox.min[1],A=this.bbox.min[2],C=1/(this.bbox.max[0]-this.bbox.min[0]),T=1/(this.bbox.max[1]-this.bbox.min[1]),P=1/(this.bbox.max[2]-this.bbox.min[2]),F=[0,i];if(this.use16bit)for(h=0;h<a;h++)this.parseDelta(r,F),m+=F[0],this.parseDelta(r,F),v+=F[0],this.parseDelta(r,F),y+=F[0],o=3*h,u=(m*p*d+b-S)*C,u<0&&(u=0),u>1&&(u=1),g[o]=65535*u,u=(v*p*d+x-M)*T,u<0&&(u=0),u>1&&(u=1),g[o+1]=65535*u,u=(y*p*d+w-A)*P,u<0&&(u=0),u>1&&(u=1),g[o+2]=65535*u;else for(h=0;h<a;h++)this.parseDelta(r,F),m+=F[0],this.parseDelta(r,F),v+=F[0],this.parseDelta(r,F),y+=F[0],o=3*h,g[o]=(m*p*d+b-S)*C,g[o+1]=(v*p*d+x-M)*T,g[o+2]=(y*p*d+w-A)*P;if(i=F[1],this.flags&this.flagsExternalTexcoords)if(n=t.getUint16(i,!0),i+=2,F[1]=i,s)for(h=0;h<a;h++)this.parseDelta(r,F),this.parseDelta(r,F);else if(p=this.use16bit?65535/n:1/n,f=this.use16bit?new Uint16Array(2*a):new Float32Array(2*a),m=0,v=0,this.use16bit)for(h=0;h<a;h++){this.parseDelta(r,F),m+=F[0],this.parseDelta(r,F),v+=F[0];var L=2*h;u=m*p,u<0&&(u=0),u>65535&&(u=65535),f[L]=u,u=v*p,u<0&&(u=0),u>65535&&(u=65535),f[L+1]=65535-u}else for(h=0;h<a;h++){this.parseDelta(r,F),m+=F[0],this.parseDelta(r,F),v+=F[0];var L=2*h;f[L]=m*p,f[L+1]=1-v*p}if(i=F[1],this.tmpVertices=g,this.tmpExternalUVs=f,this.flags&this.flagsInternalTexcoords){var E=t.getUint16(i,!0);i+=2;var k=t.getUint16(i,!0);i+=2;var N=t.getUint16(i,!0);i+=2;var B=this.use16bit?65536/k:1/k,I=this.use16bit?65536/N:1/N;m=0,v=0;var R=this.use16bit?new Uint16Array(2*E):new Float32Array(2*E);if(F[1]=i,this.use16bit)for(h=0,l=2*E;h<l;h+=2)this.parseDelta(r,F),m+=F[0],this.parseDelta(r,F),v+=F[0],u=m*B,u<0&&(u=0),u>65535&&(u=65535),R[h]=u,u=v*I,u<0&&(u=0),u>65535&&(u=65535),R[h+1]=65535-u;else for(h=0,l=2*E;h<l;h+=2)this.parseDelta(r,F),m+=F[0],this.parseDelta(r,F),v+=F[0],R[h]=m*B,R[h+1]=1-v*I;i=F[1],this.tmpInternalUVs=R}var U=t.getUint16(i,!0);i+=2;var D=null;R=null,f=null;var z=this.map.config.mapIndexBuffers&&this.map.config.mapOnlyOneUVs&&!(this.flags&this.flagsInternalTexcoords),_=this.map.config.mapIndexBuffers&&this.map.config.mapOnlyOneUVs&&this.flags&this.flagsInternalTexcoords,G=z||_;G?D=new Uint16Array(3*U):(g=this.use16bit?new Uint16Array(3*U*3):new Float32Array(3*U*3),this.flags&this.flagsInternalTexcoords&&(R=this.use16bit?new Uint16Array(3*U*2):new Float32Array(3*U*2)),!s&&this.flags&this.flagsExternalTexcoords&&(f=this.use16bit?new Uint16Array(3*U*2):new Float32Array(3*U*2)));var V,O,j,H,Y,q,J=this.tmpVertices,Z=this.tmpExternalUVs,X=this.tmpInternalUVs,W=0;for(F[1]=i,h=0;h<U;h++)if(this.parseWord(r,F),V=W-F[0],F[0]||W++,this.parseWord(r,F),O=W-F[0],F[0]||W++,this.parseWord(r,F),j=W-F[0],F[0]||W++,G)o=3*h,D[o]=V,D[o+1]=O,D[o+2]=j;else{o=9*h;var Q=3*V;g[o]=J[Q],g[o+1]=J[Q+1],g[o+2]=J[Q+2],Q=3*O,g[o+3]=J[Q],g[o+4]=J[Q+1],g[o+5]=J[Q+2],Q=3*j,g[o+6]=J[Q],g[o+7]=J[Q+1],g[o+8]=J[Q+2],null!=f&&(o=6*h,f[o]=Z[2*V],f[o+1]=Z[2*V+1],f[o+2]=Z[2*O],f[o+3]=Z[2*O+1],f[o+4]=Z[2*j],f[o+5]=Z[2*j+1])}if(z&&(g=this.tmpVertices,f=this.tmpExternalUVs),_&&(g=this.use16bit?new Uint16Array(X.length/2*3):new Float32Array(X.length/2*3),R=this.tmpInternalUVs),W=0,null!=R)for(h=0;h<U;h++)this.parseWord(r,F),V=W-F[0],F[0]||W++,this.parseWord(r,F),O=W-F[0],F[0]||W++,this.parseWord(r,F),j=W-F[0],F[0]||W++,_?(o=3*h,H=3*D[o],Y=3*D[o+1],q=3*D[o+2],g[3*V]=J[H],g[3*V+1]=J[H+1],g[3*V+2]=J[H+2],g[3*O]=J[Y],g[3*O+1]=J[Y+1],g[3*O+2]=J[Y+2],g[3*j]=J[q],g[3*j+1]=J[q+1],g[3*j+2]=J[q+2],D[o]=V,D[o+1]=O,D[o+2]=j):(o=6*h,R[o]=X[2*V],R[o+1]=X[2*V+1],R[o+2]=X[2*O],R[o+3]=X[2*O+1],R[o+4]=X[2*j],R[o+5]=X[2*j+1]);i=F[1],this.vertices=g,this.internalUVs=R,this.externalUVs=f,this.indices=D,this.tmpVertices=null,this.tmpInternalUVs=null,this.tmpExternalUVs=null,e.index=i,this.size=this.vertices.byteLength,this.internalUVs&&(this.size+=this.internalUVs.byteLength),this.externalUVs&&(this.size+=this.externalUVs.byteLength),this.indices&&(this.size+=this.indices.byteLength),this.faces=U},c.prototype.getSize=function(){return this.size},c.prototype.getFileSize=function(){return this.fileSize},c.prototype.buildGpuMesh=function(){return new l(this.map.renderer.gpu,{bbox:this.bbox,vertices:this.vertices,uvs:this.internalUVs,uvs2:this.externalUVs,indices:this.indices},1,this.map.core,!0,this.use16bit)},c.prototype.computeUVArea=function(e){var t=this.internalUVs||this.externalUVs,i=0,r=e.width/65535,s=e.height/65535,a=function(e,i,a){var n=(t[i]-t[e])*r,o=(t[i+1]-t[e+1])*s,h=Math.sqrt(n*n+o*o);n=(t[a]-t[i])*r,o=(t[a+1]-t[i+1])*s;var l=Math.sqrt(n*n+o*o);n=(t[e]-t[a])*s,o=(t[e+1]-t[a+1])*s;var u=Math.sqrt(n*n+o*o),c=.5*(h+l+u);return Math.sqrt(Math.max(0,c*(c-h)*(c-l)*(c-u)))};if(t){var n=this.indices;if(n)for(var o=0,h=0,l=this.faces;o<l;o++,h+=3)i+=a(2*n[3*o],2*n[3*o+1],2*n[3*o+2]);else for(var o=0,h=0,l=this.faces;o<l;o++,h+=3)i+=a(3*o*2,3*o*2+1,3*o*2+2)}this.uvAreaComputed=!0,this.uvArea=i},c.prototype.getWorldMatrix=function(e,t){var i=t;return i?(i[0]=this.bbox.side(0),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=this.bbox.side(1),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=this.bbox.side(2),i[11]=0,i[12]=this.bbox.min[0]-e[0],i[13]=this.bbox.min[1]-e[1],i[14]=this.bbox.min[2]-e[2],i[15]=1):(i=o.create(),o.multiply(h.translationMatrix(this.bbox.min[0]-e[0],this.bbox.min[1]-e[1],this.bbox.min[2]-e[2]),h.scaleMatrix(this.bbox.side(0),this.bbox.side(1),this.bbox.side(2)),i)),i},c.prototype.getWorldMatrixSE=function(e,t){var i=t;return i?(i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=this.bbox.min[0]-e[0],i[13]=this.bbox.min[1]-e[1],i[14]=this.bbox.min[2]-e[2],i[15]=1):i=h.translationMatrix(this.bbox.min[0]-e[0],this.bbox.min[1]-e[1],this.bbox.min[2]-e[2]),i},c.prototype.drawBBox=function(e){var t=this.map.renderer;t.gpu.useProgram(t.progBBox,["aPosition"]);var i=o.create(),r=o.create();o.multiply(t.camera.getModelviewMatrix(),this.getWorldMatrix(e),r);var s=t.camera.getProjectionMatrix();o.multiply(s,r,i),t.progBBox.setMat4("uMVP",i),t.bboxMesh.draw(t.progBBox,"aPosition")},t.a=c},function(e,t,i){"use strict";var r=function(e){this.map=e};r.prototype.generateSurfaceSequence=function(){var e=this.map.currentView,t=this.map.tree;if(t){t.surfaceSequence=[],t.surfaceSequenceIndices=[],t.surfaceOnlySequence=[];var i,r,s,a,n,o,h,l,u={},c=0,d=[],p=[];for(l in e.surfaces)(i=this.map.getSurface(l))&&(p.push(i.id),c++,u[l]=i.index+1,d.push([[i.index+1],i,!0,!1]));if(c>=1&&(p.sort(),p=p.join(";"),(i=this.map.virtualSurfaces[p])&&(d=[[[i.index+1],i,!0,!1]],c=1)),c>1){var f=[];for(l in this.map.glues)if((r=this.map.glues[l])&&r.id){var g=r.id;if(g.length<=c){var m=!1;for(o=0,h=g.length;o<h;o++)if(!u[g[o]]){m=!0;break}if(!m){for(s=[],o=0,h=g.length;o<h;o++)s.unshift(u[g[o]]);f.push([s,r,!1,!1])}}}for(a=0,n=f.length;a<n;a++){var v=f[a];r=v[1],r.flagProper=!0,r.flagAlien=!0,r.flagProper&&d.push(v),r.flagAlien&&(s=v[0].slice(1),d.push([s,v[1],!1,!0]))}do{var y=!0;for(a=0,n=d.length-1;a<n;a++){var b=d[a][0],x=d[a+1][0],w=!1;for(o=0,h=Math.min(b.length,x.length);o<h;o++)if(b[o]<x[o]||o==h-1&&b[o]==x[o]&&x.length>b.length){w=!0;break}if(w){var S=d[a];d[a]=d[a+1],d[a+1]=S,y=!1}}}while(!y);var M=c-1;for(a=0,n=d.length;a<n;a++)t.surfaceSequence.push([d[a][1],d[a][3]]),d[a][1].viewSurfaceIndex=M,d[a][2]&&(M--,t.surfaceOnlySequence.push(d[a][1]))}else 1==c&&(t.surfaceSequence.push([d[0][1],d[0][3]]),d[0][1].viewSurfaceIndex=c-1,t.surfaceOnlySequence=[d[0][1]]);this.map.freeLayersHaveGeodata=!1;for(l in e.freeLayers){var A=this.map.getFreeLayer(l);A&&(A.surfaceSequence=[A],A.surfaceOnlySequence=[A],A.geodata&&(this.map.freeLayersHaveGeodata=!0))}this.map.renderer.draw.clearJobBuffer()}},r.prototype.generateBoundLayerSequence=function(){var e,t,i,r,s,a,n,o=this.map.currentView,h=this.map.boundLayers;for(var e in h)h[e].shaderFilters=null;for(e in o.surfaces){var l=o.surfaces[e],u=this.map.getSurface(e);if(null!=u)for(u.boundLayerSequence=[],s=0,a=l.length;s<a;s++)t=l[s],"string"==typeof t?(i=this.map.getBoundLayerById(t))&&u.boundLayerSequence.push([i,1]):(i=this.map.getBoundLayerById(t.id))&&(r=1,void 0!==t.alpha&&(r=parseFloat(t.alpha)),u.boundLayerSequence.push([i,r]),n=t.options||t,n.shaderVarFlatShade&&(i.shaderFilters||(i.shaderFilters={}),i.shaderFilters[u.id]||(i.shaderFilters[u.id]={}),i.shaderFilters[u.id].varFlatShade=n.shaderVarFlatShade),n.shaderFilter&&(i.shaderFilters||(i.shaderFilters={}),i.shaderFilters[u.id]||(i.shaderFilters[u.id]={}),i.shaderFilters[u.id].filter=n.shaderFilter))}for(e in o.freeLayers){var c=o.freeLayers[e],d=this.map.getFreeLayer(e);if(null!=d&&d.ready){d.boundLayerSequence=[];var p=c.boundLayers;if(p&&Array.isArray(p))for(s=0,a=p.length;s<a;s++)t=p[s],"string"==typeof t?(i=this.map.getBoundLayerById(t))&&d.boundLayerSequence.push([i,1]):(i=this.map.getBoundLayerById(t.id))&&(r=1,void 0!==t.alpha&&(r=parseFloat(t.alpha)),d.boundLayerSequence.push([i,r]),t.shaderVarFlatShade&&(i.shaderFilters||(i.shaderFilters={}),i.shaderFilters[u.id]||(i.shaderFilters[u.id]={}),i.shaderFilters[u.id].varFlatShade=t.shaderVarFlatShade),t.shaderFilter&&(i.shaderFilters||(i.shaderFilters={}),i.shaderFilters[u.id]||(i.shaderFilters[u.id]={}),i.shaderFilters[u.id].filter=t.shaderFilter))}}},t.a=r},function(e,t,i){"use strict";var r=i(1),s=i(6),a=i(4),n=r.b,o=s.a,h=a.a,l=[[-1,-1,0,0],[0,-1,.5,1],[1,-1,1,0],[-1,0,0,.5],[0,0,.5,.5],[1,0,1,.5],[-1,1,0,1],[0,1,.5,0],[1,1,1,1]],u=[[0,1,3],[2,1,5],[6,3,7],[8,7,5]],c=function(e,t,i){this.map=e,this.id=i,this.parent=t,this.viewCounter=e.viewCounter,this.drawCounter=0,this.childrenReadyCount=0,this.renderReady=!1,this.geodataCounter=0,this.gridRenderCounter=0,this.texelSize=1,this.texelSize2=1,this.distance=1,this.tiltAngle=1,this.seCounter=0,this.metanode=null,this.lastMetanode=null,this.boundmetaresources=null,this.surface=null,this.surfaceMesh=null,this.surfaceGeodata=null,this.surfaceGeodataView=null,this.surfaceTextures=[],this.resourceSurface=null,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.resetDrawCommands=!1,this.drawCommands=[[],[],[]],this.bounds={},this.boundLayers={},this.boundTextures={},this.updateBounds=!0,this.hmap=null,this.heightMap=null,this.drawCommands=[[],[],[]],this.imageryCredits={},this.glueImageryCredits={},this.mapdataCredits={},this.resources=this.map.resourcesTree.findNode(i,!0),this.metaresources=this.map.resourcesTree.findAgregatedNode(i,5,!0),this.boundresources=this.map.resourcesTree.findAgregatedNode(i,8,!0),this.children=[null,null,null,null]};c.prototype.kill=function(){for(var e=0;e<4;e++)null!=this.children[e]&&this.children[e].kill();this.resources=null,this.metaresources=null,this.metanode=null,this.surface=null,this.surfaceMesh=null,this.surfaceTextures=[],this.surfaceGeodata=null,this.surfaceGeodataView=null,this.resourceSurface=null,this.bounds={},this.boundLayers={},this.boundTextures={},this.updateBounds=!0,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.renderReady=!1,this.lastSurface=null,this.lastState=null,this.lastRenderState=null,this.hmap=null,this.heightMap=null,this.drawCommands=[[],[],[]],this.imageryCredits={},this.glueImageryCredits={},this.mapdataCredits={},this.verifyChildren=!1,this.children=[null,null,null,null];var t=this.parent;this.parent=null,null!=t&&t.removeChild(this)},c.prototype.validate=function(){null==this.metaresources||this.metaresources.getMetatile(this.surface,null,this)},c.prototype.viewSwitched=function(){this.lastSurface=this.surface,this.lastState={surfaceMesh:this.surfaceMesh,surfaceTextures:this.surfaceTextures,boundTextures:this.boundTextures,surfaceGeodata:this.surfaceGeodata,surfaceGeodataView:this.surfaceGeodataView,resourceSurface:this.resourceSurface},this.drawCommands[0].length>0?this.lastRenderState={drawCommands:this.drawCommands,imageryCredits:this.imageryCredits,mapdataCredits:this.mapdataCredits}:this.lastRenderState=null,this.verifyChildren=!0,this.renderReady=!1,this.lastMetanode=this.metanode,this.metanode=null,this.map.config.mapSoftViewSwitch||(this.metanode&&(this.metanode.border=null,this.metanode.border2=null,this.metanode.border3=null,this.metanode.borderNodes=null,this.metanode.borderReady=null),this.lastState=null,this.lastRenderState=null,this.lastMetanode=null,this.metanode=null,this.gridPoints=null);for(var e in this.bounds)this.bounds[e]={sequence:[],alpha:[],transparent:!1,viewCoutner:0};this.boundLayers={},this.boundTextures={},this.updateBounds=!0,this.transparentBounds=!1,this.surface=null,this.surfaceMesh=null,this.surfaceTextures=[],this.surfaceGeodata=null,this.surfaceGeodataView=null,this.resourceSurface=null,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.virtualSurfacesUncomplete=!1,this.drawCommands=[[],[],[]],this.imageryCredits={},this.glueImageryCredits={},this.mapdataCredits={}},c.prototype.restoreLastState=function(){this.lastState&&(this.surfaceMesh=this.lastState.surfaceMesh,this.surfaceTextures=this.lastState.surfaceTextures,this.boundTextures=this.lastState.boundTextures,this.surfaceGeodata=this.lastState.surfaceGeodata,this.surfaceGeodataView=this.lastState.surfaceGeodataView,this.resourceSurface=this.lastState.resourceSurface,this.lastSurface=null,this.lastState=null,this.lastResourceSurface=null)},c.prototype.addChild=function(e){if(!this.children[e]){var t=this.id,i=[t[0]+1,t[1]<<1,t[2]<<1];switch(e){case 1:i[1]++;break;case 2:i[2]++;break;case 3:i[1]++,i[2]++}this.children[e]=new c(this.map,this,i)}},c.prototype.removeChildByIndex=function(e){null!=this.children[e]&&(this.children[e].kill(),this.children[e]=null)},c.prototype.removeChild=function(e){for(var t=0;t<4;t++)this.children[t]==e&&(this.children[t].kill(),this.children[t]=null)},c.prototype.isMetanodeReady=function(e,t,i){if(this.map.viewCounter!=this.viewCoutner&&(this.viewSwitched(),this.viewCoutner=this.map.viewCounter,this.map.markDirty()),!i&&((this.virtualSurfacesUncomplete||null==this.surface&&0==this.virtualSurfaces.length)&&this.checkSurface(e,t),(null==this.metanode||this.lastMetanode)&&!this.virtualSurfacesUncomplete)){if(!(this.checkMetanode(e,t)||null!=this.metanode&&this.lastMetanode))return!1}if(null==this.metanode)return!1;if(this.metanode.metatile.used(),this.lastSurface&&this.lastSurface==this.surface&&(this.lastSurface=null,this.restoreLastState()),this.surface&&(this.surface.virtual?(this.resourceSurface=this.surface.getSurface(this.metanode.sourceReference),this.resourceSurface||(this.resourceSurface=this.surface)):this.resourceSurface=this.surface),this.seCounter!=this.map.renderer.seCounter){var r=this.map.renderer;this.seCounter=r.seCounter;var s=this.metanode;r.useSuperElevation?(s.minZ=r.getSuperElevatedHeight(s.minZ2),s.maxZ=r.getSuperElevatedHeight(s.maxZ2)):(s.minZ=s.minZ2,s.maxZ=s.maxZ2),r.seCounter>0&&(this.gridPoints=null,s.border=null,s.border2=null,s.border3=null,s.borderReady=!1,s.generateCullingHelpers())}return!0},c.prototype.checkSurface=function(e,t){if(this.surface=null,this.virtual=!1,this.virtualReady=!1,this.virtualSurfaces=[],this.virtualSurfacesUncomplete=!1,e.freeLayerSurface)return void(this.surface=e.freeLayerSurface);for(var i=e.surfaceSequence,r=0,s=i.length;r<s;r++){var a=i[r][0],n=i[r][1];if(a.hasTile2(this.id)[0]){if(this.id[0]>0){var o=this.parent;if(o){if(o.virtualSurfacesUncomplete)return this.virtualSurfacesUncomplete=!0,void(this.virtualSurfaces=[]);var h=o.metaresources.getMetatile(a,null,this);if(!h)continue;if(!h.isReady(t)){this.virtualSurfacesUncomplete=!0;continue}var l=h.getNode(o.id);if(!l)continue;if(!l.hasChildById(this.id))continue}}this.virtualSurfaces.push([a,n])}}this.virtualSurfaces.length>1?this.virtual=!0:this.surface=this.virtualSurfaces[0]?this.virtualSurfaces[0][0]:null},c.prototype.checkMetanode=function(e,t){if(this.virtual){if(!this.isVirtualMetanodeReady(e,t))return!1;this.metanode=this.createVirtualMetanode(e,t),this.lastMetanode=null,this.map.markDirty()}var i=this.surface;if(null==i)return!1;var r=this.metaresources.getMetatile(i,!0,this);if(!r.isReady(t))return!1;if(this.virtual||(this.metanode=r.getNode(this.id),this.lastMetanode=null,this.map.markDirty()),null!=this.metanode){this.metanode.tile=this,this.lastMetanode=null,this.map.markDirty();for(var s=0;s<4;s++)this.metanode.hasChild(s)?this.addChild(s):this.removeChildByIndex(s)}return!0},c.prototype.isVirtualMetanodeReady=function(e,t){for(var i=this.virtualSurfaces,r=0,s=0,a=i.length;s<a;s++){var n=i[s][0];this.metaresources.getMetatile(n,!0,this).isReady(t)&&r++}return r==a},c.prototype.createVirtualMetanode=function(e,t){var i,r,s,a,n,o=this.virtualSurfaces,h=null;for(i=0,r=o.length;i<r;i++){s=o[i][0];var l=o[i][1];if(a=this.metaresources.getMetatile(s,null,this),a.isReady(t)&&null!=(n=a.getNode(this.id))){if(l!=n.alien)continue;if(!l&&s.glue&&!n.hasGeometry()&&n.internalTextureCount>0){var u=n.internalTextureCount-1;u=this.map.getSurface(s.id[u]).viewSurfaceIndex;for(var c=!1,d=i;d<r;d++)if(o[d].viewSurfaceIndex<=u){c=d>i,i=d-1;break}if(c)continue}if(n.hasGeometry()){h=n.clone(),this.surface=s;break}}}for(i=0,r=o.length;i<r;i++)s=o[i][0],a=this.metaresources.getMetatile(s,null,this),a.isReady(t)&&null!=(n=a.getNode(this.id))&&(h?(h.flags|=240&n.flags,a.useVersion<4&&(h.bbox.min[0]=Math.min(h.bbox.min[0],n.bbox.min[0]),h.bbox.min[1]=Math.min(h.bbox.min[1],n.bbox.min[1]),h.bbox.min[2]=Math.min(h.bbox.min[2],n.bbox.min[2]),h.bbox.max[0]=Math.max(h.bbox.max[0],n.bbox.max[0]),h.bbox.max[1]=Math.max(h.bbox.max[1],n.bbox.max[1]),h.bbox.max[2]=Math.max(h.bbox.max[2],n.bbox.max[2]))):(h=n.clone(),this.surface=s));return h&&h.generateCullingHelpers(!0),h},c.prototype.bboxVisible=function(e,t,i,r){var s=this.map,a=s.camera;if(e[0]<s.measure.minDivisionNodeDepth)return!0;if(!s.config.mapDisableCulling&&s.isGeocent&&r){var o=r.diskPos,h=a.position,l=[o[0]-h[0],o[1]-h[1],o[2]-h[2]],u=n.normalize4(l)*a.distanceFactor,c=n.dot(l,r.diskNormal);if(this.tiltAngle=c,u>15e4&&c>r.diskAngle)return!1}return r.metatile.useVersion>=4?a.camera.pointsVisible(r.bbox2,i):!s.isGeocent||!s.config.mapPreciseBBoxTest||e[0]<4?a.camera.bboxVisible(t,i):a.camera.pointsVisible(r.bbox2,i)},c.prototype.insideCone=function(e,t,i){if(this.map.isGeocent){return Math.acos(n.dot(e,i.diskNormal))<t+i.diskAngle2A}return!1},c.prototype.getPixelSize=function(e,t,i,r,s){var a=e.min,n=e.max,o=a[0]-i[0],h=a[1]-i[1],l=n[0]-i[0],u=a[1]-i[1],c=n[0]-i[0],d=n[1]-i[1],p=a[0]-i[0],f=n[1]-i[1],g=a[2]-i[2],m=n[2]-i[2];if(i[0]>a[0]&&i[0]<n[0]&&i[1]>a[1]&&i[1]<n[1]&&i[2]>a[2]&&i[2]<n[2])return s?[Number.POSITIVE_INFINITY,.1]:Number.POSITIVE_INFINITY;var v=0,y=this.map.camera.camera;return v=0<h?0<o?0>m?y.scaleFactor([o,h,m],s):0<g?y.scaleFactor([o,h,g],s):y.scaleFactor([o,h,.5*(g+m)],s):0>l?0>m?y.scaleFactor([l,u,m],s):0<g?y.scaleFactor([l,u,g],s):y.scaleFactor([l,u,.5*(g+m)],s):0>m?y.scaleFactor([.5*(o+l),u,m],s):0<g?y.scaleFactor([.5*(o+l),u,g],s):y.scaleFactor([.5*(o+l),u,.5*(g+m)],s):0>f?0<p?0>m?y.scaleFactor([p,f,m],s):0<g?y.scaleFactor([p,f,g],s):y.scaleFactor([p,f,.5*(g+m)],s):0>c?0>m?y.scaleFactor([c,d,m],s):0<g?y.scaleFactor([c,d,g],s):y.scaleFactor([c,d,.5*(g+m)],s):0>m?y.scaleFactor([.5*(p+c),d,m],s):0<g?y.scaleFactor([.5*(p+c),d,g],s):y.scaleFactor([.5*(p+c),d,.5*(g+m)],s):0<p?0>m?y.scaleFactor([o,.5*(u+d),m],s):0<g?y.scaleFactor([o,.5*(u+d),g],s):y.scaleFactor([o,.5*(u+d),.5*(g+m)],s):0>c?0>m?y.scaleFactor([l,.5*(u+d),m],s):0<g?y.scaleFactor([l,.5*(u+d),g],s):y.scaleFactor([l,.5*(u+d),.5*(g+m)],s):0>m?y.scaleFactor([.5*(o+l),.5*(u+d),m],s):0<g?y.scaleFactor([.5*(o+l),.5*(u+d),g],s):y.scaleFactor([.5*(o+l),.5*(u+d),.5*(g+m)],s),s?[v[0]*t,v[1]]:v*t},c.prototype.getPixelSize3Old=function(e,t,i){var r=this.map.camera,s=r.geocentDistance*i-e.diskDistance;s<0&&(s=-s);var a=n.dot(r.geocentNormal,e.diskNormal);if(a<e.diskAngle2){var o=Math.acos(a);o-=Math.acos(e.diskAngle2);var h=Math.tan(o)*e.diskDistance;s=Math.sqrt(h*h+s*s)}return i=r.camera.scaleFactor2(s),[i*t,s]},c.prototype.getPixelSize3=function(e,t){var i,r=this.map.camera,s=r.geocentDistance,a=n.dot(r.geocentNormal,e.diskNormal),o=s-(e.diskDistance+(e.maxZ-e.minZ));if(a<e.diskAngle2){var h=Math.acos(a);h-=e.diskAngle2A;var l=Math.tan(h)*e.diskDistance;o<0?(i=s-e.diskDistance,i<0?(o=-i,o=Math.sqrt(l*l+o*o)):o=l):o=Math.sqrt(l*l+o*o)}else if(o<0){if(!((i=s-e.diskDistance)<0))return[Number.POSITIVE_INFINITY,.1];o=-i}return[r.camera.scaleFactor2(o)*t,o]},c.prototype.updateTexelSize=function(){var e,t,i,r,s=this.map,a=s.draw,n=s.camera,o=a.texelSizeFit,h=this.metanode,l=s.camera.position,u=s.isGeocent&&(s.config.mapPreciseDistanceTest||h.metatile.useVersion>=4);if(h.hasGeometry()){var c=Number.POSITIVE_INFINITY;if(h.usedTexelSize()?c=a.ndcToScreenPixel*h.pixelSize:h.usedDisplaySize()&&(c=a.ndcToScreenPixel*(h.bbox.maxSize/h.displaySize)),n.camera.ortho){var d=n.camera.getViewHeight();e=[2*c/d,d]}else h.usedDisplaySize()?u?(c=a.isGeocent?a.ndcToScreenPixel*(h.diskAngle2A*a.planetRadius*1.41421356236/h.displaySize):a.ndcToScreenPixel*(h.bbox.maxSize/h.displaySize),e=this.getPixelSize3(h,c)):(c=a.ndcToScreenPixel*(h.bbox.maxSize/256),t=h.displaySize/256*n.distance,i=n.vector,r=[l[0]-i[0]*t,l[1]-i[1]*t,l[2]-i[2]*t],e=this.getPixelSize(h.bbox,c,r,r,!0)):!u&&o>1.1?(c=a.ndcToScreenPixel*h.pixelSize*(o/1.1),t=o/1.1*n.distance,i=n.vector,r=[l[0]-i[0]*t,l[1]-i[1]*t,l[2]-i[2]*t],e=this.getPixelSize(h.bbox,c,r,r,!0)):e=u?this.getPixelSize3(h,c):this.getPixelSize(h.bbox,c,l,l,!0)}else e=u?this.getPixelSize3(h,1,1):this.getPixelSize(h.bbox,1,l,l,!0),e[0]=Number.POSITIVE_INFINITY;if(this.texelSize=e[0],this.distance=e[1],s.config.mapDegradeHorizon&&!(a.degradeHorizonFactor<1)){var p=s.config.mapDegradeHorizonParams,f=p[1],g=p[2],m=a.degradeHorizonFactor*a.degradeHorizonTiltFactor,v=this.distance*n.distanceFactor;v<f?m=1:v>f&&v<g&&(m=1+(v-f)/(g-f)*(m-1)),m=Math.max(m,1);var y=n.perceivedDistance,b=p[3];y>b?m=1:y<b&&m>1&&(m=1+(m-1)*(1-y/b)),this.texelSize/=m}},c.prototype.drawGrid=function(e,t,i,r,s){if(!((this.texelSize==Number.POSITIVE_INFINITY||this.texelSize>4.4)&&this.metanode&&this.metanode.hasChildren())&&this.metanode){var a,n,o,c,d=this.map;if(!d.draw.gridSkipped){t?(a=t[0],n=t[1][0],o=t[1][1]):(c=d.measure.getSpatialDivisionNodeAndExtents(this.id),a=c[0],n=c[1][0],o=c[1][1]);var p=[.5*(o[0]+n[0]),.5*(o[1]+n[1])],f=d.referenceFrame.hasPoles;if(i=i||this.metanode.diskAngle2,f&&!a.isPole&&Math.acos(i)>.1*Math.PI)return i=Math.cos(.5*Math.acos(i)),this.drawGrid(e,[a,[[n[0],n[1]],[p[0],p[1]]]],i,!1,!0),this.drawGrid(e,[a,[[p[0],n[1]],[o[0],p[1]]]],i,!1,!0),this.drawGrid(e,[a,[[n[0],p[1]],[p[0],o[1]]]],i,!1,!0),void this.drawGrid(e,[a,[[p[0],p[1]],[o[0],o[1]]]],i,!1,!0);var g=a.extents.ur[1]-a.extents.ll[1],m=this.distance,v=Math.log(5*g/m)/d.log2;v=Math.max(0,v-8+a.id[0]);var y,b,x,w=d.draw,S=e[0],S=e[0],M=e[1],A=e[2],C=w.planeBuffer,T=w.gridFlat,P=w.gridGlues,F=this.gridPoints,L=d.config.mapGridSurrogatez;if(!F){y=L?this.metanode.surrogatez:this.metanode.minZ;var E=a.getPhysicalCoords([o[0],o[1],y],!0),k=a.getPhysicalCoords([o[0],n[1],y],!0),N=a.getPhysicalCoords([n[0],n[1],y],!0),B=a.getPhysicalCoords([n[0],o[1],y],!0),I=a.getPhysicalCoords([p[0],o[1],y],!0),R=a.getPhysicalCoords([p[0],n[1],y],!0),U=a.getPhysicalCoords([n[0],p[1],y],!0),D=a.getPhysicalCoords([o[0],p[1],y],!0);if(p[2]=y,p=a.getPhysicalCoords(p,!0),t)C[0]=B[0]-S,C[1]=B[1]-M,C[2]=B[2]-A,C[3]=I[0]-S,C[4]=I[1]-M,C[5]=I[2]-A,C[6]=E[0]-S,C[7]=E[1]-M,C[8]=E[2]-A,C[9]=U[0]-S,C[10]=U[1]-M,C[11]=U[2]-A,C[12]=p[0]-S,C[13]=p[1]-M,C[14]=p[2]-A,C[15]=D[0]-S,C[16]=D[1]-M,C[17]=D[2]-A,C[18]=N[0]-S,C[19]=N[1]-M,C[20]=N[2]-A,C[21]=R[0]-S,C[22]=R[1]-M,C[23]=R[2]-A,C[24]=k[0]-S,C[25]=k[1]-M,C[26]=k[2]-A;else{var F=[B[0],B[1],B[2],I[0],I[1],I[2],E[0],E[1],E[2],U[0],U[1],U[2],p[0],p[1],p[2],D[0],D[1],D[2],N[0],N[1],N[2],R[0],R[1],R[2],k[0],k[1],k[2]];this.gridPoints=F}}if(!T){var z,_,G,V=this.metanode,O=V.border,j=V.borderNodes,H=d.tree,Y=this.id;O||(V.border=new Array(9),V.borderNodes=new Array(9),O=V.border,j=V.borderNodes,O[4]=L?V.surrogatez:V.minZ);var q=l,J=!1;if(!V.borderReady)for(z=0;z<9;z++)4==z||j[z]||(G=H.getNodeById([Y[0],Y[1]+q[z][0],Y[2]+q[z][1]],!0),G?(j[z]=G,O[z]=L?G.surrogatez:G.minZ):(O[z]=O[4],J=!0));var Z=V.border2;if(y=L?V.surrogatez:V.minZ,Z&&V.borderReady||(Z=[.25*(O[0]+O[1]+O[3]+O[4])-y,.5*(O[1]+O[4])-y,.25*(O[2]+O[1]+O[5]+O[4])-y,.5*(O[3]+O[4])-y,O[4]-y,.5*(O[5]+O[4])-y,.25*(O[6]+O[7]+O[3]+O[4])-y,.5*(O[7]+O[4])-y,.25*(O[8]+O[7]+O[5]+O[4])-y],V.border2=Z),J||(V.borderReady=!0),r)return;if(P){var X=u,W=this.nodeTable;for(W||(W=new Array(9),this.nodeTable=W),z=0,_=q.length;z<_;z++)4!=z&&(W[z]=H.getRenderedNodeById([Y[0],Y[1]+q[z][0],Y[2]+q[z][1]],w.drawCounter));var Q=V.border3;for(Q||(Q=new Array(9),V.border3=Q),z=0,_=X.length;z<_;z++){for(var K=W[X[z][0]],$=1;$<3;$++)(G=W[X[z][$]])&&(K?G.id[0]<K.id[0]&&(K=G):K=G);W[X[z][0]]=K}for(z=0,_=q.length;z<_;z++)if(G=W[z],4!=z&&G&&G.id[0]<Y[0]){var ee;switch(z){case 0:ee=[V.llx,V.lly];break;case 1:ee=[.5*(V.urx+V.llx),V.lly];break;case 2:ee=[V.urx,V.lly];break;case 3:ee=[V.llx,.5*(V.ury+V.lly)];break;case 5:ee=[V.urx,.5*(V.ury+V.lly)];break;case 6:ee=[V.llx,V.ury];break;case 7:ee=[.5*(V.urx+V.llx),V.ury];break;case 8:ee=[V.urx,V.ury]}G.border2||G.tile.drawGrid(e,t,i,!0),G.border2?V.border3[z]=G.getGridHeight(ee,G.border2,3)+(L?G.surrogatez:G.minZ)-y:Z[z]}else V.border3[z]=Z[z]}}var te=d.renderer,ie=te.camera.getModelviewMatrix(),re=te.camera.getProjectionMatrix();if(F&&(C[0]=F[0]-S,C[1]=F[1]-M,C[2]=F[2]-A,C[3]=F[3]-S,C[4]=F[4]-M,C[5]=F[5]-A,C[6]=F[6]-S,C[7]=F[7]-M,C[8]=F[8]-A,C[9]=F[9]-S,C[10]=F[10]-M,C[11]=F[11]-A,C[12]=F[12]-S,C[13]=F[13]-M,C[14]=F[14]-A,C[15]=F[15]-S,C[16]=F[16]-M,C[17]=F[17]-A,C[18]=F[18]-S,C[19]=F[19]-M,C[20]=F[20]-A,C[21]=F[21]-S,C[22]=F[22]-M,C[23]=F[23]-A,C[24]=F[24]-S,C[25]=F[25]-M,C[26]=F[26]-A),f&&!d.poleRadius&&1==a.id[0]&&!a.isPole){var se=a.getPhysicalCoords([a.extents.ur[0],a.extents.ur[1],0]);d.poleRadius=Math.sqrt(se[0]*se[0]+se[1]*se[1]),d.poleRadiusFactor=8*Math.pow(2,552058/d.poleRadius)}b=1;var ae=""!=d.config.mapGridTextureLayer;if(ae){if(!this.gridTexture){var ne=d.boundLayers[d.config.mapGridTextureLayer],oe=this;if(!ne||oe<ne.lodRange[0])ae=!1;else{for(var he=h.clamp(oe.id[0]-d.config.mapGridTextureLevel,ne.lodRange[0],ne.lodRange[3]);oe.id[0]>he;)oe=oe.parent;this.gridTexture=this.resources.getTexture("gmap#"+d.config.mapGridTextureLayer,null,{sourceTile:oe,layer:ne,tile:this},null,null,null)}}ae&&!this.gridTexture.isReady(!1,0,!1)&&(ae=!1)}var le=te.onlyDepth;if(f&&a.isPole)b=d.poleRadiusFactor,x=le?te.progPlane2D:te.progPlane2,te.gpu.useProgram(x,["aPosition","aTexCoord"]),x.setVec4("uParams4",[-S,-M,d.poleRadius,0]);else if(T)x=te.progPlane,te.gpu.useProgram(x,["aPosition","aTexCoord"]);else{x=le?te.progPlane3D:te.progPlane3,te.gpu.useProgram(x,["aPosition","aTexCoord"]);var O;O=P?V.border3:V.border2,x.setFloatArray("uHeights",O),x.setVec3("uVector",V.diskNormal)}x.setMat4("uMV",ie),x.setMat4("uProj",re),x.setFloatArray("uPoints",C);var ue=a.gridStep1*b,ce=1/(o[0]-n[0]),de=1/(n[1]-o[1]),pe=ue/((a.extents.ur[0]-a.extents.ll[0])*ce),fe=ue/((a.extents.ur[1]-a.extents.ll[1])*de),ge=(n[0]-a.extents.ll[0])*ce*pe,me=(o[1]-a.extents.ll[1])*de*fe;if(ae){te.gpu.bindTexture(this.gridTexture.getGpuTexture()),x.setVec4("uParams",[ue*b,w.fogDensity,1/15,a.gridStep2*b]);var ve=this.gridTexture.getTransform();x.setVec4("uParams3",[ve[2],ve[3],ve[0],ve[1]]),x.setVec4("uParams2",[0,0,0,0])}else te.gpu.bindTexture(te.heightmapTexture),x.setVec4("uParams",[ue*b,w.fogDensity,1/15,a.gridStep2*b]),x.setVec4("uParams3",[me-Math.floor(me),ge-Math.floor(ge),fe,pe]),x.setVec4("uParams2",[0,0,a.gridBlend,0]);x.setVec4("uFogColor",w.atmoColor),te.planeMesh.draw(x,"aPosition","aTexCoord"),this.map.stats.drawnFaces+=te.planeMesh.polygons}}},c.prototype.drawHmapTile=function(e,t,i,r,s){if(this.metanode){var a,h,l,u,c=this.map,d=c.renderer;d.progHmapPlane||d.initProceduralShaders(),t?(a=t[0],h=t[1][0],l=t[1][1]):(u=c.measure.getSpatialDivisionNodeAndExtents(this.id),a=u[0],h=u[1][0],l=u[1][1]);var p=[.5*(l[0]+h[0]),.5*(l[1]+h[1])],f=c.referenceFrame.hasPoles;if(i=i||this.metanode.diskAngle2,f&&!a.isPole&&Math.acos(i)>.1*Math.PI)return i=Math.cos(.5*Math.acos(i)),this.drawHmapTile(e,[a,[[h[0],h[1]],[p[0],p[1]]]],i),this.drawHmapTile(e,[a,[[p[0],h[1]],[l[0],p[1]]]],i),this.drawHmapTile(e,[a,[[h[0],p[1]],[p[0],l[1]]]],i),void this.drawHmapTile(e,[a,[[p[0],p[1]],[l[0],l[1]]]],i);var g=a.extents.ur[1]-a.extents.ll[1],m=this.distance,v=Math.log(5*g/m)/c.log2;v=Math.max(0,v-8+a.id[0]);var y,b,x,w=c.draw,S=e[0],S=e[0],M=e[1],A=e[2],C=w.planeBuffer,T=this.gridPoints;c.config.mapGridSurrogatez;if(!T){y=0;var P=a.getPhysicalCoords([l[0],l[1],y],!0),F=a.getPhysicalCoords([l[0],h[1],y],!0),L=a.getPhysicalCoords([h[0],h[1],y],!0),E=a.getPhysicalCoords([h[0],l[1],y],!0),k=a.getPhysicalCoords([p[0],l[1],y],!0),N=a.getPhysicalCoords([p[0],h[1],y],!0),B=a.getPhysicalCoords([h[0],p[1],y],!0),I=a.getPhysicalCoords([l[0],p[1],y],!0);if(p[2]=y,p=a.getPhysicalCoords(p,!0),t)C[0]=E[0]-S,C[1]=E[1]-M,C[2]=E[2]-A,C[3]=k[0]-S,C[4]=k[1]-M,C[5]=k[2]-A,C[6]=P[0]-S,C[7]=P[1]-M,C[8]=P[2]-A,C[9]=B[0]-S,C[10]=B[1]-M,C[11]=B[2]-A,C[12]=p[0]-S,C[13]=p[1]-M,C[14]=p[2]-A,C[15]=I[0]-S,C[16]=I[1]-M,C[17]=I[2]-A,C[18]=L[0]-S,C[19]=L[1]-M,C[20]=L[2]-A,C[21]=N[0]-S,C[22]=N[1]-M,C[23]=N[2]-A,C[24]=F[0]-S,C[25]=F[1]-M,C[26]=F[2]-A;else{var T=[E[0],E[1],E[2],k[0],k[1],k[2],P[0],P[1],P[2],B[0],B[1],B[2],p[0],p[1],p[2],I[0],I[1],I[2],L[0],L[1],L[2],N[0],N[1],N[2],F[0],F[1],F[2]];this.gridPoints=T}}var R=d.camera.getModelviewMatrix(),U=d.camera.getProjectionMatrix();if(T&&(C[0]=T[0]-S,C[1]=T[1]-M,C[2]=T[2]-A,C[3]=T[3]-S,C[4]=T[4]-M,C[5]=T[5]-A,C[6]=T[6]-S,C[7]=T[7]-M,C[8]=T[8]-A,C[9]=T[9]-S,C[10]=T[10]-M,C[11]=T[11]-A,C[12]=T[12]-S,C[13]=T[13]-M,C[14]=T[14]-A,C[15]=T[15]-S,C[16]=T[16]-M,C[17]=T[17]-A,C[18]=T[18]-S,C[19]=T[19]-M,C[20]=T[20]-A,C[21]=T[21]-S,C[22]=T[22]-M,C[23]=T[23]-A,C[24]=T[24]-S,C[25]=T[25]-M,C[26]=T[26]-A),f&&!c.poleRadius&&1==a.id[0]&&!a.isPole){var D=a.getPhysicalCoords([a.extents.ur[0],a.extents.ur[1],0]);c.poleRadius=Math.sqrt(D[0]*D[0]+D[1]*D[1]),c.poleRadiusFactor=8*Math.pow(2,552058/c.poleRadius)}var z=this.metanode,_=w.debug.drawTestMode;if(b=1,f&&a.isPole)b=c.poleRadiusFactor,x=d.progPlane2,d.gpu.useProgram(x,["aPosition","aTexCoord"]),x.setVec4("uParams4",[-S,-M,c.poleRadius,0]);else{switch(_){default:case 0:x=d.progHmapPlane;break;case 1:x=d.progHmapPlane2;break;case 2:x=d.progHmapPlane5;break;case 3:x=d.progHmapPlane6;break;case 4:x=d.progHmapPlane7;break;case 8:x=d.progHmapPlane4;break;case 9:x=1==r?d.progHmapPlane3:d.progHmapPlane8}if(3!=_&&4!=_||d.ntextures||(d.ntextures=[new o(d.gpu,"./textures/test/test001.png",d.core,null),new o(d.gpu,"./textures/test/test002.png",d.core,null),new o(d.gpu,"./textures/test003.jpg",d.core,null),new o(d.gpu,"./textures/download.png",d.core,null),new o(d.gpu,"./textures/test009.jpg",d.core,null),new o(d.gpu,"./textures/test004.jpg",d.core,null),new o(d.gpu,"./textures/test005.jpg",d.core,null),new o(d.gpu,"./textures/nor_sand.jpg",d.core,null),new o(d.gpu,"./textures/test007.jpg",d.core,null),new o(d.gpu,"./textures/test008.jpg",d.core,null),new o(d.gpu,"./textures/download (1).png",d.core,null),new o(d.gpu,"./textures/test010.jpg",d.core,null),new o(d.gpu,"./textures/test011.jpg",d.core,null),new o(d.gpu,"./textures/test012.jpg",d.core,null),new o(d.gpu,"./textures/test013.jpg",d.core,null),new o(d.gpu,"./textures/test014.jpg",d.core,null),new o(d.gpu,"./textures/test015.jpg",d.core,null),new o(d.gpu,"./textures/test016.jpg",d.core,null),new o(d.gpu,"./textures/test017.jpg",d.core,null),new o(d.gpu,"./textures/test018.jpg",d.core,null)]),d.gpu.useProgram(x,["aPosition"]),x.setVec3("uVector",z.diskNormal),T){var G=[T[15]-T[12],T[16]-T[13],T[17]-T[14]],V=[T[21]-T[12],T[22]-T[13],T[23]-T[14]];n.normalize(G),n.normalize(V);var O=z.diskNormal.slice(),R=c.camera.camera.modelview,j=vts.mat3.create();vts.mat4.toInverseMat3(R,j),vts.mat3.transpose(j),vts.mat3.multiplyVec3(j,V),vts.mat3.multiplyVec3(j,O),vts.mat3.multiplyVec3(j,G);var H=[G[0],G[1],G[2],V[0],V[1],V[2],O[0],O[1],O[2]];x.setMat3("uSpace",H)}}x.setMat4("uMV",R),x.setMat4("uProj",U),x.setFloatArray("uPoints",C);var Y=a.gridStep1*b;if(x.setVec4("uParams",[Y*b,w.fogDensity,1/127,a.gridStep2*b]),_>=3&&_<=4)x.setVec4("uParams3",[1,1,0,0]);else if(s)x.setVec4("uParams3",s.getTransform());else{var q=1/(l[0]-h[0]),J=1/(h[1]-l[1]),Z=Y/((a.extents.ur[0]-a.extents.ll[0])*q),X=Y/((a.extents.ur[1]-a.extents.ll[1])*J),W=(h[0]-a.extents.ll[0])*q*Z,Q=(l[1]-a.extents.ll[1])*J*X;x.setVec4("uParams3",[X,Z,Q-Math.floor(Q),W-Math.floor(W)])}if(x.setVec4("uParams2",[0,0,a.gridBlend,0]),x.setVec4("uFogColor",w.atmoColor),this.hmap.extraBound?(z=this.hmap.extraBound.sourceTile.metanode,x.setVec3("uHeights",[z.minHeight,z.maxHeight,1/z.pixelSize]),x.setVec4("uTransform",this.hmap.getTransform())):(x.setVec3("uHeights",[z.minHeight,z.maxHeight,1/z.pixelSize]),x.setVec4("uTransform",[1,1,0,0])),_>=3&&_<=4){if(!d.ntextures[w.debug.drawTestData].loaded)return;d.gpu.bindTexture(d.ntextures[w.debug.drawTestData])}else s?d.gpu.bindTexture(s.getGpuTexture()):d.gpu.bindTexture(d.heightmapTexture);x.setSampler("uSampler",0),d.gpu.bindTexture(this.hmap.getGpuTexture(),1),x.setSampler("uSampler2",1),d.planeMesh2.draw(x,"aPosition"),this.map.stats.drawnFaces+=d.planeMesh2.polygons}},t.a=c},function(e,t,i){"use strict";var r=i(4),s=r.a,a=function(e,t,i,r){this.map=e,this.p1=t.clone(),this.p2=i.clone(),this.op2=i.clone();var s=this.p1.getHeightMode(),a=this.p2.getHeightMode();"fix"==s&&"float"==a?this.p1=this.map.convert.convertPositionHeightMode(this.p1,"float",!0):"float"==s&&"fix"==a&&(this.p1=this.map.convert.convertPositionHeightMode(this.p1,"fix",!0));var n=this.p1.getViewMode(),o=this.p2.getViewMode();if("subj"==n&&"obj"==o?this.p2=this.map.convert.convertPositionViewMode(this.p2,"subj"):"obj"==n&&"subj"==o&&(this.p1=this.map.convert.convertPositionViewMode(this.p1,"subj")),this.p1.pos[5]=this.p1.pos[5]<0?360+this.p1.pos[5]%360:this.p1.pos[5]%360,this.p2.pos[5]=this.p2.pos[5]<0?360+this.p2.pos[5]%360:this.p2.pos[5]%360,this.pp1=this.p1.clone(),this.mode=r.mode||"auto",this.submode=r.submode||"none",this.submode="none",this.maxHeight=r.maxHeight||1e9,this.minDuration=r.minDuration||0,this.maxDuration=r.maxDuration||1e4,this.samplePeriod=r.samplePeriod||10,this.fade=r.fade||"none",this.fadePower=r.fadePower||1,this.yawInterpolation=r.yawInterpolation||"shortest",this.pv=r.pv||.15,this.map.getNavigationSrs().isProjected()||(this.geodesic=this.map.measure.getGeodesic()),r.distanceAzimuth)this.distanceAzimuth=!0,this.pp2=this.p1.clone(),r.destHeight&&this.pp2.setHeight(r.destHeight),r.destOrientation&&this.pp2.setHeight(r.destOrientation),r.destFov&&this.pp2.setHeight(r.destFov),this.geoAzimuth=r.azimuth||0,this.geoDistance=r.distance||100,this.distance=this.geoDistance,this.azimuth=this.geoAzimuth%360,this.azimuth=this.azimuth<0?360+this.azimuth:this.azimuth;else{this.distanceAzimuth=!1,this.pp2=this.p2.clone();var h=this.map.measure.getDistance(this.pp1.getCoords(),this.pp2.getCoords());this.distance=h[0],this.azimuth=(h[1]+90)%360,this.azimuth=this.azimuth<0?360+this.azimuth:this.azimuth,this.map.getNavigationSrs().isProjected()||(h=this.geodesic.Inverse(this.pp1.pos[2],this.pp1.pos[1],this.pp2.pos[2],this.pp2.pos[1]),this.geoAzimuth=h.azi1,this.geoDistance=h.s12,this.azimuth=this.geoAzimuth%360,this.azimuth=this.azimuth<0?360+this.azimuth:this.azimuth)}this.detectMode(),this.detectDuration(),this.detectFlightHeight(r.height)};a.prototype.detectFlightHeight=function(e){"ballistic"==this.mode&&(this.flightHeight=Math.max(this.pp1.getHeight(),this.pp2.getHeight()),this.flightHeight+=e||.5*this.distance,this.flightHeight=Math.min(this.flightHeight,this.maxHeight),this.flightHeight-=Math.max(this.pp1.getHeight(),this.pp2.getHeight()))},a.prototype.detectMode=function(){"auto"==this.mode&&(this.mode=this.distance>2e3?"ballistic":"direct")},a.prototype.detectDuration=function(){if(this.duration=0,this.headingDuration=1e3,this.distance<500?this.duration=1e3:this.distance<2e3?this.duration=2e3:(this.duration=this.distance/100,this.duration<300?this.duration=3e3:this.headingDuration=1500,this.duration<6e3&&(this.duration=6e3),this.duration>1e4&&(this.duration=1e4),"direct"!=this.mode&&(this.duration*=1.8,this.headingDuration*=1.8)),"direct"!=this.mode){var e=3*this.headingDuration;this.duration=Math.max(this.duration,e),this.maxDuration<e&&(this.duration=this.maxDuration,this.headingDuration=this.maxDuration/3)}this.duration=Math.min(this.duration,this.maxDuration),this.duration=Math.max(this.duration,this.minDuration)},a.prototype.generate=function(){for(var e=new Array(Math.ceil(this.duration/this.samplePeriod)+(this.distanceAzimuth?0:1)),t=0,i=0;i<=this.duration;i+=this.samplePeriod){var r,a,n=i/this.duration,o=this.pp1.clone();if("direct"==this.mode){switch(r=n,this.fade){case"in":switch(this.fadePower){case 1:n=r*r;break;case 2:n=r*r*r;break;case 3:n=r*r*r*r;break;case 4:n=r*r*r*r*r;break;case 5:n=r*r*r*r*r*r;break;case 6:n=r*r*r*r*r*r*r}break;case"out":switch(r=1-r,this.fadePower){case 1:n=1-r*r;break;case 2:n=1-r*r*r;break;case 3:n=1-r*r*r*r;break;case 4:n=1-r*r*r*r*r;break;case 5:n=1-r*r*r*r*r*r;break;case 6:n=1-r*r*r*r*r*r*r}break;case"inout":switch(this.fadePower){case 1:n=r*r*(3-2*r);break;case 2:n=r*r*r*(r*(6*r-15)+10);break;case 3:n=r*r*(3-2*r),r=n,n=r*r*(3-2*r);break;case 4:n=r*r*r*(r*(6*r-15)+10),r=n,n=r*r*r*(r*(6*r-15)+10);break;case 5:n=r*r*(3-2*r),r=n,n=r*r*(3-2*r),r=n,n=r*r*(3-2*r);break;case 6:n=r*r*r*(r*(6*r-15)+10),r=n,n=r*r*r*(r*(6*r-15)+10),r=n,n=r*r*r*(r*(6*r-15)+10)}}o.setCoords(this.getInterpolatedCoords(n)),o.setHeight(this.getInterpolatedHeight(n));var h=this.pp1.getOrientation(),l=this.pp2.getOrientation();o.setOrientation(this.getInterpolatedOrinetation(h,l,n)),o.setFov(this.getInterpolatedFov(n)),o.setViewExtent(this.getInterpolatedViewExtent(n)),e[t]=o.pos,t++}else{r=n,n=r*r*(3-2*r),r=n,n=r*r*(3-2*r);var u=this.getSmoothFactor(i);if("piha"==this.submode){var c=this.distance/this.duration*(i-this.duration/(2*Math.PI)*Math.sin(2*Math.PI/this.duration*i))/this.distance,d=this.pv,p=this.pp1.getCoords()[2],f=this.pp2.getCoords()[2],g=this.distance/(.001*this.duration*d*Math.tan(.5*s.radians(this.pp1.getFov())))*(1-Math.cos(2*Math.PI*i/this.duration))+p+(f-p)*i/this.duration;a=this.getInterpolatedCoords(c),o.setCoords(a),o.setHeight(g)}else a=this.getInterpolatedCoords(u),o.setCoords(a),o.setHeight(this.getSineHeight(n));null!=a[3]&&(this.azimuth=-a[3]),o.setOrientation(this.getFlightOrienation(i)),o.setFov(this.getInterpolatedFov(n)),o.setViewExtent(this.getInterpolatedViewExtent(n)),e[t]=o.pos,e[t]=o.pos,t++}}return this.distanceAzimuth||(e[t]=this.op2.clone().pos),e},a.prototype.getInterpolatedCoords=function(e){var t=this.pp1.getCoords(),i=this.pp2.getCoords();if(this.map.getNavigationSrs().isProjected())return[t[0]+(i[0]-t[0])*e,t[1]+(i[1]-t[1])*e,t[2]+(i[2]-t[2])*e];var r=this.geodesic.Direct(t[1],t[0],this.geoAzimuth,this.geoDistance*e),s=r.azi1-r.azi2;return s=this.azimuth<0?360+s:s,[r.lon2,r.lat2,t[2]+(i[2]-t[2])*e,s]},a.prototype.getInterpolatedOrinetation=function(e,t,i){var r=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2];return"shortest"==this.yawInterpolation&&Math.abs(r)>180&&(r=r>0?-(360-r):360-Math.abs(r)),[e[0]+r*i,e[1]+s*i,e[2]+a*i]},a.prototype.getInterpolatedFov=function(e){var t=this.pp1.getFov();return t+(this.pp2.getFov()-t)*e},a.prototype.getInterpolatedViewExtent=function(e){var t=this.pp1.getViewExtent();return t+(this.pp2.getViewExtent()-t)*e},a.prototype.getInterpolatedHeight=function(e){var t=this.pp1.getHeight();return t+(this.pp2.getHeight()-t)*e},a.prototype.getSineHeight=function(e){var t=this.pp1.getCoords(),i=this.pp2.getCoords();return t[2]+(i[2]-t[2])*e+Math.sin(Math.PI*e)*this.flightHeight},a.prototype.getSmoothFactor=function(e){var t=0;return t=e<this.headingDuration?0:e>this.duration-this.headingDuration?1:Math.min(1,(e-this.headingDuration)/(this.duration-2*this.headingDuration)),(t=t*t*(3-2*t))*t*(3-2*t)},a.prototype.getFlightOrienation=function(e){var t=null,i=null,r=[0,-90,0],s=0;return r[0]=this.azimuth%360,r[0]<0&&(r[0]=360-Math.abs(r[0])),e<=this.headingDuration?(s=e/this.headingDuration,t=this.pp1.getOrientation(),i=r):e>=this.duration-this.headingDuration?(s=(e-(this.duration-this.headingDuration))/this.headingDuration,t=r,i=this.pp2.getOrientation()):(s=0,t=r,i=r),this.getInterpolatedOrinetation(t,i,s)},t.a=a},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__utils_utils__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_1__utils_url__=__webpack_require__(9),utilsUrl=__WEBPACK_IMPORTED_MODULE_1__utils_url__.a,utils=__WEBPACK_IMPORTED_MODULE_0__utils_utils__.a,MapUrl=function(e,t){this.map=e,t=t.trim(),this.baseUrl=utilsUrl.getBase(t),this.baseUrlSchema=utilsUrl.getSchema(t),this.baseUrlOrigin=utilsUrl.getOrigin(t),this.urlCounter=0};MapUrl.prototype.quad=function(e,t,i){for(var r="",s=e;s>0;s--){var a=0,n=1<<s-1;0!=(t&n)&&(a+=1),0!=(i&n)&&(a+=2),r+=a}return r},MapUrl.prototype.msDigit=function(e,t){return((3&e)<<1)+(1&t)},MapUrl.prototype.hex=function(e){for(var t=e.toString(16);t.length<8;)t="0"+t;return t},MapUrl.prototype.ppx=function(e,t){return this.hex(t<<28-e,7)},MapUrl.prototype.ppy=function(e,t){return this.hex((1<<28)-(t+1<<28-e),7)},MapUrl.prototype.processUrlFunction=function(id,counter,string){var string2,fc;if("string"!=typeof string)return string;if(-1!=string.indexOf("quad")){string2="(function(lod,x,y,loclod,locx,locy){"+string.replace("quad","return this.quad")+"})";try{return(fc=eval(string2).bind(this))(id.lod,id.ix,id.iy,id.loclod,id.locx,id.locy)}catch(e){return string}}else if(-1!=string.indexOf("msdigit")){string2="(function(x,y,loclod,locx,locy){"+string.replace("msdigit","return this.msDigit")+"})";try{return(fc=eval(string2).bind(this))(id.ix,id.iy,id.loclod,id.locx,id.locy)}catch(e){return string}}else{if(-1!=string.indexOf("alt")){var result=/\(([^)]*)\)/.exec(string);if(result&&result[1]){var strings=result[1].match(/([^,]+)/g);if(strings.length>0)return strings[counter%strings.length]}return string}if(-1!=string.indexOf("ppx")){string2="(function(lod,x,loclod,locx){"+string.replace("ppx","return this.ppx")+"})";try{return(fc=eval(string2).bind(this))(id.lod,id.ix,id.loclod,id.locx)}catch(e){return string}}else{if(-1==string.indexOf("ppy"))return string;string2="(function(lod,y,loclod,locy){"+string.replace("ppy","return this.ppy")+"})";try{return(fc=eval(string2).bind(this))(id.lod,id.iy,id.loclod,id.locy)}catch(e){return string}}}},MapUrl.prototype.findLocalRoot=function(e){for(var t=this.map.referenceFrame.getSpatialDivisionNodes(),i=[],r=0,s=t.length;r<s;r++){var a=t[r],n=e[0]-a.id[0],o=e[1]>>n,h=e[2]>>n;o==a.id[1]&&h==a.id[2]&&i.push(a)}var l=null;for(r=0,s=i.length;r<s;r++)i[r].id[0]>-1&&(l=i[r]);return l?l.id.slice():[0,0,0]},MapUrl.prototype.makeUrl=function(e,t,i,r){var s=0,a=0,n=0;if(t.lod){var o=this.findLocalRoot([t.lod,t.ix,t.iy]);n=t.lod-o[0];var h=(1<<n)-1;s=t.ix&h,a=t.iy&h}var l={lod:t.lod,ix:t.ix,iy:t.iy,loclod:n,locx:s,locy:a};e=e.replace(/ /g,"");var u=utils.simpleFmtObjOrCall(e,{lod:t.lod,x:t.ix,y:t.iy,sub:i,locx:s,locy:a,loclod:n,geonavtile:i,hereappid:"abcde",hereappcode:"12345"},this.processUrlFunction.bind(this,l,this.urlCounter));return this.urlCounter++,r=-1!=u.indexOf("//"),r?0==u.indexOf("//")?this.baseUrlSchema+u:u:this.baseUrl+u},MapUrl.prototype.processUrl=function(e,t){return e?(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},__webpack_exports__.a=MapUrl},function(e,t,i){"use strict";var r=i(2),s=i(5),a=s.a,n=r.a,o=function(e,t){this.map=e,this.id=null,this.metaUrl="",this.mappingUrl="",this.baseUrl=this.map.url.baseUrl,this.baseUrlSchema=this.map.url.baseUrlSchema,this.baseUrlOrigin=this.map.url.baseUrlOrigin,this.lodRange=[0,0],this.tileRange=[[0,0],[0,0]],this.surfaces=[],this.parseJson(t),this.virtual=!0,this.ready=!1};o.prototype.parseJson=function(e){if(this.id=e.id||null,this.metaUrl=this.processUrl(e.metaUrl,""),this.mappingUrl=this.processUrl(e.mapping,""),this.lodRange=e.lodRange||[0,0],this.tileRange=e.tileRange||[[0,0],[0,0]],this.strId=this.id?this.id.join(";"):null,this.id){var t=this.id.slice();t.sort(),this.strId=t.join(";")}if(e.extents){var i=e.extents.ll,r=e.extents.ur;this.extents=new a(i[0],i[1],i[2],r[0],r[1],r[2])}else this.extents=new a(0,0,0,1,1,1);this.specificity=Math.pow(2,this.lodRange[0])/((this.tileRange[1][0]-this.tileRange[1][0]+1)*(this.tileRange[1][1]-this.tileRange[1][1]+1)),n.loadBinary(this.mappingUrl,this.onMappingFileLoaded.bind(this),this.onMappingFileLoadError.bind(this),!!n.useCredentials&&-1!=this.jsonUrl.indexOf(this.map.url.baseUrl),this.map.core.xhrParams)},o.prototype.onMappingFileLoaded=function(e){this.parseMappingFile(new DataView(e)),this.ready=!0,this.map.refreshView()},o.prototype.onMappingFileLoadError=function(){},o.prototype.parseMappingFile=function(e){var t=0,i="";if(i+=String.fromCharCode(e.getUint8(t,!0)),t+=1,i+=String.fromCharCode(e.getUint8(t,!0)),t+=1,"TM"!=i)return!1;var r=e.getUint16(t,!0);t+=2;for(var s=0;s<r;s++){var a=e.getUint8(t,!0);t+=1;for(var n=[],o=0;o<a;o++){var h=e.getUint16(t,!0);t+=2,h=this.id[h],h&&n.push(h)}1==n.length?this.surfaces.push(this.map.getSurface(n[0])):this.surfaces.push(this.map.getGlue(n.join(";")))}return!0},o.prototype.getInfo=function(){return{metaUrl:this.metaUrl,mapping:this.mappingUrl,lodRange:this.lodRange,tileRange:this.tileRange}},o.prototype.processUrl=function(e,t){return e?(e=e.trim(),-1!=e.indexOf("://")?e:0==e.indexOf("//")?this.baseUrlSchema+e:0==e.indexOf("/")?this.baseUrlOrigin+e:this.baseUrl+e):t},o.prototype.hasTile=function(e){var t=e[0]-this.lodRange[0];if(t<0)return!1;var i=e[1]>>t,r=e[2]>>t;return!(e[0]<this.lodRange[0]||e[0]>this.lodRange[1]||i<this.tileRange[0][0]||i>this.tileRange[1][0]||r<this.tileRange[0][1]||r>this.tileRange[1][1])},o.prototype.hasTile2=function(e){var t=e[0]-this.lodRange[0],i=t<0;if(e[0]<this.lodRange[0]){t=-t;var r=this.tileRange[0][0]>>t,s=this.tileRange[0][1]>>t,a=this.tileRange[1][0]>>t,n=this.tileRange[1][1]>>t;if(e[0]>this.lodRange[1]||e[1]<r||e[1]>a||e[2]<s||e[2]>n)return[!1,!1]}else{var o=e[1]>>t,h=e[2]>>t;if(e[0]>this.lodRange[1]||o<this.tileRange[0][0]||o>this.tileRange[1][0]||h<this.tileRange[0][1]||h>this.tileRange[1][1])return[!1,!1]}return[!0,i]},o.prototype.hasMetatile=function(e){if(e[0]>this.lodRange[1])return!1;var t=e[0]-this.lodRange[0];if(t>=0){var i=e[1]>>t,r=e[2]>>t;if(i<this.tileRange[0][0]||i>this.tileRange[1][0]||r<this.tileRange[0][1]||r>this.tileRange[1][1])return!1}else if(t=-t,e[1]<this.tileRange[0][0]>>t||e[1]>this.tileRange[1][0]>>t||e[2]<this.tileRange[0][1]>>t||e[2]>this.tileRange[1][1]>>t)return!1;return!0},o.prototype.getSurface=function(e){return this.surfaces[e-1]},o.prototype.getMetaUrl=function(e,t){return this.map.url.makeUrl(this.metaUrl,{lod:e[0],ix:e[1],iy:e[2]},null,t)},t.a=o},function(e,t,i){"use strict";var r=i(1),s=i(4),a=r.b,n=r.c,o=r.e,h=s.a,l=function(e,t,i,r){this.parent=e,this.position=[0,0,0],this.orientation=[0,0,0],this.aspect=1,this.fov=t,this.fovTan=Math.tan(t*Math.PI/180),this.fovDist=1,this.near=i,this.far=r,this.rotationByMatrix=!1,this.modelview=o.create(),this.rotationview=o.create(),this.projection=o.create(),this.mvp=o.create(),this.mvp32=new Float32Array(16),this.modelview32=new Float32Array(16),this.rotationview32=new Float32Array(16),this.projection32=new Float32Array(16),this.frustumPlanes=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.bboxPoints=[[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1]],this.scaleFactorVec=[0,0,0,0],this.dirty=!0};l.prototype.setPosition=function(e){this.position=e,this.dirty=!0},l.prototype.setOrientation=function(e){this.rotationByMatrix=!1,this.orientation=e,this.dirty=!0},l.prototype.setRotationMatrix=function(e){this.rotationByMatrix=!0,this.rotationview=e.slice(),this.dirty=!0},l.prototype.setAspect=function(e){this.aspect=e,this.dirty=!0},l.prototype.setViewHeight=function(e){this.viewHeight=e,this.dirty=!0},l.prototype.setOrtho=function(e){this.ortho=e,this.dirty=!0},l.prototype.setParams=function(e,t,i){this.fov=e,this.near=t,this.far=i,this.dirty=!0},l.prototype.clone=function(e){var t=new l(this.parent,null!=e?e:this.getFov(),this.getNear(),this.getFar());return t.setPosition(this.getPosition()),t.setOrientation(this.getOrientation()),t.setAspect(this.getAspect()),t.update(),t},l.prototype.getPosition=function(){return[this.position[0],this.position[1],this.position[2]]},l.prototype.getOrientation=function(){return[this.orientation[0],this.orientation[1],this.orientation[2]]},l.prototype.getAspect=function(){return this.aspect},l.prototype.getFov=function(){return this.fov},l.prototype.getNear=function(){return this.near},l.prototype.getFar=function(){return this.far},l.prototype.getViewHeight=function(){return this.viewHeight},l.prototype.getOrtho=function(){return this.ortho},l.prototype.getRotationviewMatrix=function(){return this.dirty&&this.update(),this.rotationview},l.prototype.getRotationviewFMatrix=function(){return this.dirty&&this.update(),this.rotationview32},l.prototype.getModelviewMatrix=function(){return this.dirty&&this.update(),this.modelview},l.prototype.getModelviewFMatrix=function(){return this.dirty&&this.update(),this.modelview32},l.prototype.getProjectionMatrix=function(){return this.dirty&&this.update(),this.projection},l.prototype.getProjectionFMatrix=function(){return this.dirty&&this.update(),this.projection32},l.prototype.getMvpMatrix=function(){return this.dirty&&this.update(),this.mvp},l.prototype.getMvpFMatrix=function(){return this.dirty&&this.update(),this.mvp32},l.prototype.scaleFactor=function(e,t){this.dirty&&this.update(),o.multiplyVec3(this.modelview,e,this.scaleFactorVec);var i=a.length(this.scaleFactorVec);return t?i<this.near?[Number.POSITIVE_INFINITY,i]:[this.projection[0]/i,i]:i<this.near?Number.POSITIVE_INFINITY:this.projection[0]/i},l.prototype.scaleFactor2=function(e){return this.dirty&&this.update(),e<this.near?Number.POSITIVE_INFINITY:this.projection[0]/e},l.prototype.distance=function(e){var t=a.create();return a.subtract(this.position,e,t),a.length(t)},l.prototype.pointVisible=function(e,t){this.dirty&&this.update();var i;i=t?[e[0]-t[0],e[1]-t[1],e[2]-t[2],1]:[e[0],e[1],e[2],1];for(var r=0;r<6;r++)if(n.dot(this.frustumPlanes[r],i)<0)return!1;return!0},l.prototype.pointsVisible=function(e,t){this.dirty&&this.update();var i,r,s,a=this.frustumPlanes,o=e.length;t?(i=t[0],r=t[1],s=t[2]):(i=0,r=0,s=0);for(var h=n.dot3,l=0;l<6;l++){for(var u=!0,c=a[l],d=0;d<o;d+=3)if(h(c,e,d,i,r,s)>=0){u=!1;break}if(u)return!1}return!0},l.prototype.bboxVisible=function(e,t){this.dirty&&this.update();var i,r,s,a,o,h,l,u=e.min,c=e.max,d=this.bboxPoints;t?(r=u[0]-t[0],s=u[1]-t[1],a=u[2]-t[2],o=c[0]-t[0],h=c[1]-t[1],l=c[2]-t[2]):(r=u[0],s=u[1],a=u[2],o=c[0],h=c[1],l=c[2]),i=d[0],i[0]=r,i[1]=s,i[2]=a,i=d[1],i[0]=r,i[1]=s,i[2]=l,i=d[2],i[0]=r,i[1]=h,i[2]=a,i=d[3],i[0]=r,i[1]=h,i[2]=l,i=d[4],i[0]=o,i[1]=s,i[2]=a,i=d[5],i[0]=o,i[1]=s,i[2]=l,i=d[6],i[0]=o,i[1]=h,i[2]=a,i=d[7],i[0]=o,i[1]=h,i[2]=l;for(var p=n.dot2,f=this.frustumPlanes,g=0;g<6;g++){for(var m=!0,v=f[g],y=0;y<8;y++)if(p(v,d[y])>=0){m=!1;break}if(m)return!1}return!0},l.prototype.update=function(e){this.rotationByMatrix||(o.multiply(h.rotationMatrix(2,h.radians(-this.orientation[2])),h.rotationMatrix(0,h.radians(-this.orientation[1]-90)),this.rotationview),o.multiply(this.rotationview,h.rotationMatrix(2,h.radians(-this.orientation[0])),this.rotationview)),o.multiply(this.rotationview,h.translationMatrix(-this.position[0],-this.position[1],-this.position[2]),this.modelview),this.ortho?this.projection=h.orthographicMatrix(this.viewHeight,this.aspect,this.near,this.far):this.projection=h.perspectiveMatrix(this.fov,this.aspect,this.near,this.far),o.multiply(this.projection,this.modelview,this.mvp),this.frustumPlanes[0]=[0,0,1,1],this.frustumPlanes[1]=[0,0,-1,1],this.frustumPlanes[2]=[1,0,0,1],this.frustumPlanes[3]=[-1,0,0,1],this.frustumPlanes[4]=[0,1,0,1],this.frustumPlanes[5]=[0,-1,0,1];var t=o.create();o.transpose(this.mvp,t);for(var i=0;i<6;i++)this.frustumPlanes[i]=o.multiplyVec4(t,this.frustumPlanes[i]);this.mvp32.set(this.mvp),this.projection32.set(this.projection),this.modelview32.set(this.modelview),this.rotationview32.set(this.rotationview),this.fovDist=.5*this.parent.curSize[1]/this.fovTan,this.dirty=!1},t.a=l},function(e,t,i){"use strict";function r(e,t,i,r){var s,a,n,o,h,l=e[0],u=e[1],c=e[2],d=e[3],p=t[0],f=t[1],g=t[2],m=t[3];return a=l*p+u*f+c*g+d*m,a<0&&(a=-a,p=-p,f=-f,g=-g,m=-m),1-a>1e-6?(s=Math.acos(a),n=Math.sin(s),o=Math.sin((1-i)*s)/n,h=Math.sin(i*s)/n):(o=1-i,h=i),r[0]=o*l+h*p,r[1]=o*u+h*f,r[2]=o*c+h*g,r[3]=o*d+h*m,r}var s=i(1),a=i(4),n=i(161),o=s.b,h=s.d,l=s.e,u=a.a,c=n.a,d=n.b,p=n.c,f=n.d,g=n.e,m=n.f,v=function(e){this.renderer=e,this.core=e.core,this.gpu=e.gpu,this.gl=e.gpu.gl,this.rmap=e.rmap,this.mBuffer=new Float32Array(16),this.mBuffer2=new Float32Array(16),this.vBuffer=new Float32Array(4)};v.prototype.drawSkydome=function(e,t){if(e){var i=this.gpu,r=this.gl,s=this.renderer,a=l.create();l.multiply(u.scaleMatrix(2,2,2),u.translationMatrix(-.5,-.5,-.5),a);var n=l.create(),o=s.camera.getPosition();l.multiply(u.translationMatrix(o[0],o[1],o[2]-400),u.scaleMatrixf(Math.min(.9*s.camera.getFar(),6e5)),n);var h=l.create();l.multiply(s.camera.getMvpMatrix(),n,h),l.multiply(h,a,h),i.useProgram(t,["aPosition","aTexCoord"]),i.bindTexture(e),t.setSampler("uSampler",0),t.setMat4("uMVP",h),r.depthMask(!1),s.skydomeMesh.draw(t,"aPosition","aTexCoord"),r.depthMask(!0),r.enable(r.CULL_FACE),s.renderedPolygons+=s.skydomeMesh.getPolygons()}},v.prototype.drawTBall=function(e,t,i,r,s,a){var n=this.gpu,o=(this.gl,this.renderer),h=l.create();l.multiply(u.scaleMatrix(2,2,2),u.translationMatrix(-.5,-.5,-.5),h);var c=[e[0],e[1],e[2]];t=null!=t?t:1.5;var d=l.create();l.multiply(u.translationMatrix(c[0],c[1],c[2]),u.scaleMatrix(t,t,s||t),d);var p=l.create();l.multiply(o.camera.getMvpMatrix(),d,p),l.multiply(p,h,p),n.useProgram(i,["aPosition","aTexCoord"]),n.bindTexture(r||o.redTexture),i.setSampler("uSampler",0),i.setMat4("uMVP",p),o.skydomeMesh.draw(i,"aPosition","aTexCoord"),o.renderedPolygons+=o.skydomeMesh.getPolygons()},v.prototype.drawBall=function(e,t,i,r,s,a,n,o,c,d){var p=this.gpu,f=this.gl,g=this.renderer,m=l.create();l.multiply(u.scaleMatrix(2,2,2),u.translationMatrix(-.5,-.5,-.5),m);var v=[e[0],e[1],e[2]],y=l.create();t=t||1.5,i=i||1.5,l.multiply(u.translationMatrix(v[0],v[1],v[2]),u.scaleMatrix(t,t,i),y);var b=l.create();l.multiply(g.camera.getModelviewMatrix(),y,b),l.multiply(b,m,b);var x=g.camera.getProjectionMatrix(),w=[0,0,0,0,0,0,0,0,0];l.toInverseMat3(b,w),h.transpose(w),p.useProgram(r,["aPosition"]),r.setMat4("uProj",x),r.setMat4("uMV",b),d&&(r.setMat3("uNorm",w),f.cullFace(f.FRONT)),s&&r.setVec4("uParams",s),a&&r.setVec4("uParams2",a),a&&r.setVec4("uParams3",n),o&&r.setVec4("uFogColor",o),c&&r.setVec4("uFogColor2",c),g.atmoMesh.draw(r,"aPosition",null),g.renderedPolygons+=g.skydomeMesh.getPolygons(),d&&f.cullFace(f.BACK)},v.prototype.drawBall2=function(e,t,i,r,s,a){var n=this.gpu,o=this.renderer,c=l.create();l.multiply(u.scaleMatrix(2,2,2),u.translationMatrix(-.5,-.5,-.5),c);var d=[e[0],e[1],e[2]],p=l.create();l.multiply(u.translationMatrix(d[0],d[1],d[2]),u.scaleMatrixf(null!=t?t:1.5),p);var f=l.create();l.multiply(o.camera.getModelviewMatrix(),p,f),l.multiply(f,c,f);var g=o.camera.getProjectionMatrix(),m=[0,0,0,0,0,0,0,0,0];l.toInverseMat3(f,m),h.transpose(m),n.useProgram(i,["aPosition"]),n.bindTexture(o.redTexture),i.setSampler("uSampler",0),i.setMat4("uProj",g),i.setMat4("uMV",f),i.setMat3("uNorm",m),i.setFloat("uNFactor",r),i.setVec3("uCenter",e),i.setVec2("uRadius",[t,a]),o.atmoMesh.draw(i,"aPosition",null),o.renderedPolygons+=o.skydomeMesh.getPolygons()},v.prototype.drawLineString=function(e,t,i,r,s,a,n,o,h){var l,u,c=this.gpu,d=(this.gl,this.renderer),p=0,f=e.length;if(f>32)for(u=0;u<f;u+=31)l=e.slice(u,u+32),this.drawLineString(l,t,i,r,s,a,n,o,h);else{var g=d.plineBuffer;if(t)for(u=0;u<f;u++)l=e[u],g[p]=l[0],g[p+1]=l[1],g[p+2]=l[2]||0,p+=3;else{var m=(d.camera.getMvpMatrix(),d.curSize,d.cameraPosition);for(u=0;u<f;u++)l=e[u],g[p]=l[0]-m[0],g[p+1]=l[1]-m[1],g[p+2]=l[2]-m[2],p+=3}if(!0!==h){var v=c.currentState;c.setState({ztest:!(!0!==a),blend:!0===n,zwrite:!(!1===o),stencil:!1,culling:!1,zequal:!1})}var y=t?d.progLine4:d.progLine5;c.useProgram(y,["aPosition"]),t?y.setMat4("uMVP",d.imageProjectionMatrix,s?d.getZoffsetFactor(s):null):(y.setMat4("uMV",d.camera.getModelviewFMatrix(),null),y.setMat4("uProj",d.camera.getProjectionFMatrix(),null)),y.setVec3("uScale",[2/d.curSize[0],2/d.curSize[1],.5*i]),y.setVec4("uColor",null!=r?r:[1,1,1,1]),y.setVec3("uPoints",g),d.plines.draw(y,"aPosition",f),!0!==h&&c.setState(v)}},v.prototype.drawCircle=function(e,t,i,r,s,a,n,o,h){for(var l=[],u=0,c=2*Math.PI/16,d=0;d<16;d++)l[d]=[-Math.sin(u)*t+e[0],Math.cos(u)*t+e[1],e[2]],u+=c;l[16]=[e[0],t+e[1],e[2]],this.drawLineString(l,!0,i,r,s,a,n,o,h)},v.prototype.drawImage=function(e,t,i,r,s,a,n,o,h,l,u,c){var d=this.gpu,p=this.gl,f=this.renderer;if(null!=s&&null!=f.imageProjectionMatrix){if(!0!==c){var g=d.currentState;d.setState({ztest:!(!0!==h),blend:!0===l,zwrite:!(!1===u),stencil:!1,culling:!1,zequal:!1})}var m=f.progImage;d.useProgram(m,["aPosition"]),d.bindTexture(s);var v=f.rectVerticesBuffer;p.bindBuffer(p.ARRAY_BUFFER,v),p.vertexAttribPointer(m.getAttribute("aPosition"),v.itemSize,p.FLOAT,!1,0,0);var y=f.rectIndicesBuffer;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,y),m.setMat4("uProjectionMatrix",f.imageProjectionMatrix),m.setMat4("uData",[e,t,0,0,e+i,t,1,0,e+i,t+r,1,1,e,t+r,0,1]),o&&(n*=1+2*f.getZoffsetFactor(o)),m.setVec4("uColor",null!=a?a:[1,1,1,1]),m.setFloat("uDepth",n),p.drawElements(p.TRIANGLES,y.numItems,p.UNSIGNED_SHORT,0),!0!==c&&d.setState(g)}},v.prototype.drawBillboard=function(e,t,i,r,s,a,n,o){var h=this.gpu,l=this.gl,u=this.renderer;if(!0!==o){var c=h.currentState;h.setState({ztest:!(!0!==s),blend:!0===a,zwrite:!(!1===n),stencil:!1,culling:!1,zequal:!1})}var d=u.progImage;h.useProgram(d,["aPosition","aTexCoord"]),h.bindTexture(t),d.setSampler("uSampler",0);var p=u.rectVerticesBuffer;l.bindBuffer(l.ARRAY_BUFFER,p),l.vertexAttribPointer(d.getAttribute("aPosition"),p.itemSize,l.FLOAT,!1,0,0);var f=u.rectIndicesBuffer;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,f),d.setMat4("uProjectionMatrix",e,r?u.getZoffsetFactor(r):null);d.setMat4("uData",[0,0,0,0,1,0,1,0,1,1,1,1,0,1,0,1]),d.setVec4("uColor",null!=i?i:[1,1,1,1]),d.setFloat("uDepth",0),l.drawElements(l.TRIANGLES,f.numItems,l.UNSIGNED_SHORT,0),!0!==o&&h.setState(c)},v.prototype.drawFlatImage=function(e,t,i,r,s,a,n,o){var h=this.gpu,l=this.gl,u=this.renderer;if(null!=s&&null!=u.imageProjectionMatrix){var c=u.progImage;h.useProgram(c,["aPosition"]),h.bindTexture(s);var d=u.rectVerticesBuffer;l.bindBuffer(l.ARRAY_BUFFER,d),l.vertexAttribPointer(c.getAttribute("aPosition"),d.itemSize,l.FLOAT,!1,0,0);var p=u.rectIndicesBuffer;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,p),c.setMat4("uProjectionMatrix",u.imageProjectionMatrix),c.setMat4("uData",[e,t,0,0,e+i,t,1,0,e+i,t+r,1,1,e,t+r,0,1]),c.setVec4("uColor",null!=a?a:[1,1,1,1]),c.setFloat("uDepth",null!=n?n:0),l.drawElements(l.TRIANGLES,p.numItems,l.UNSIGNED_SHORT,0)}},v.prototype.drawText=function(e,t,i,r,s,a,n){var o=this.gpu,h=this.gl,l=this.renderer;if(null!=l.imageProjectionMatrix){if(!0!==n){var u=o.currentState;o.setState({ztest:!(null==a),blend:!1,zwrite:!(null==a),stencil:!1,culling:!1,zequal:!(null==a)})}var c=l.progImage;o.useProgram(c,["aPosition"]),o.bindTexture(l.textTexture2);var d=l.rectVerticesBuffer;h.bindBuffer(h.ARRAY_BUFFER,d),h.vertexAttribPointer(c.getAttribute("aPosition"),d.itemSize,h.FLOAT,!1,0,0);var p=l.rectIndicesBuffer;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,p),c.setMat4("uProjectionMatrix",l.imageProjectionMatrix),c.setVec4("uColor",s),c.setFloat("uDepth",null!=a?a:0);var f=i-1,g=i,m=Math.round(.5*i),v=this.getTextSize(i,r)+2,y=0,b=(15&y)<<4,x=y>>4<<4;c.setMat4("uData",[e-2,t-2,b*(1/256),x*(1/128),e-2+v,t-2,(b+15)*(1/256),x*(1/128),e-2+v,t+g+1,(b+15)*(1/256),(x+15)*(1/128),e-2,t+g+1,b*(1/256),(x+15)*(1/128)]),h.drawElements(h.TRIANGLES,p.numItems,h.UNSIGNED_SHORT,0);for(var w=0,S=r.length;w<S;w++){switch(y=r.charCodeAt(w)-32,b=(15&y)<<4,x=y>>4<<4,y){case 12:case 14:case 27:case 28:case 64:case 73:case 76:case 84:c.setMat4("uData",[e,t,b*(1/256),x*(1/128),e+m,t,(b+8)*(1/256),x*(1/128),e+m,t+g,(b+8)*(1/256),(x+16)*(1/128),e,t+g,b*(1/256),(x+16)*(1/128)]),e+=m;break;default:c.setMat4("uData",[e,t,b*(1/256),x*(1/128),e+f,t,(b+15)*(1/256),x*(1/128),e+f,t+g,(b+15)*(1/256),(x+16)*(1/128),e,t+g,b*(1/256),(x+16)*(1/128)]),e+=f}h.drawElements(h.TRIANGLES,p.numItems,h.UNSIGNED_SHORT,0)}!0!==n&&o.setState(u)}},v.prototype.getTextSize=function(e,t){for(var i=e-1,r=Math.round(.5*e),s=0,a=0,n=t.length;a<n;a++){switch(t.charCodeAt(a)-32){case 12:case 14:case 27:case 28:case 64:case 73:case 76:case 84:s+=r;break;default:s+=i}}return s},v.prototype.drawGpuJobs=function(){var e=this.gpu,t=this.gl,i=this.renderer,r=i.config.mapSortHysteresis,s=i.config.mapHysteresisWait;i.geoRenderCounter++,i.totalJobs=0,i.drawnJobs=0,i.jobsTimer4=0,i.jobsTimer3=0,i.jobsTimer2=0,i.jobsTimer1=performance.now(),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT),t.stencilFunc(t.EQUAL,0,255),t.stencilOp(t.KEEP,t.KEEP,t.INCR);var a,n,o=[1/i.curSize[0],1/i.curSize[1]],h=this.rmap,v=513,y=0,b=i.clearStencilPasses,x=i.jobZBuffer,w=i.jobZBufferSize,S=i.jobZBuffer2,M=i.jobZBuffer2Size,A=i.onlyHitLayers,C=i.onlyAdvancedHitLayers,T=i.geoRenderCounter,P=i.onlyHitLayers,F=i.jobHSortBuffer,L=0;b.length>0&&(v=b[0],y++),this.rmap.counter!=this.renderer.geoRenderCounter&&this.rmap.clear(),i.gmapIndex=0,i.gmapUseVersion=1;for(var E=!1,k=i.frameTime,N=0,B=x.length;N<B;N++){var I,R=w[N],U=M[N],D=x[N],z=S[N];if(i.jobHBuffer={},i.totalJobs+=R,R>0&&N>=v&&(t.clear(t.STENCIL_BUFFER_BIT),b.length>y?(v=b[y],y++):v=513),A)if(C)for(I=0;I<R;I++)D[I].advancedHit&&this.drawGpuJob(e,t,i,D[I],o,!0);else for(I=0;I<R;I++){var a=D[I];a.hitable&&(this.drawGpuJob(e,t,i,a,o),a.advancedHit&&(i.advancedPassNeeded=!0))}else for(I=0;I<R;I++)a=D[I],this.drawGpuJob(e,t,i,a,o);if(i.jobsTimer3=performance.now(),i.gmapIndex>0){switch(i.gmapUseVersion){case 1:c(e,t,i,o,this);break;case 2:d(e,t,i,o,this);break;case 3:p(e,t,i,o,this);break;case 4:f(e,t,i,o,this);break;case 5:g(e,t,i,o,this)}i.gmapIndex=0}(h.rectanglesCount>0||h.rectangles2Count>0)&&h.processRectangles(e,t,i,o),i.jobsTimer4+=performance.now()-i.jobsTimer3,U=!1;var _=i.jobHBuffer;for(n in _){U=!0;break}for(n in z){U=!0;break}if(U){if(!P)for(n in _)if(a=_[n],a.hysteresis&&a.id){var G=z[a.id];G?a==G?G.hysteresisCounter=i.geoRenderCounter:G.hysteresisBackup=a:(a.timerShow=0,a.timerHide=0,a.draw=!1,a.hysteresisCounter=i.geoRenderCounter,z[a.id]=a,M[N]++,E=!0),!0}for(n in z){a=z[n],G=_[n],i.drawnJobs++,P||(G?(isNaN(a.timerShow)&&(a.timerShow=0,a.timerHide=0,a.draw=!1),a.draw?a.timerHide&&(a.draw=!1,a.timerShow=s+a.hysteresis[0]*(1-a.timerHide/a.hysteresis[1])):(a.timerShow+=k,a.timerShow-s>a.hysteresis[0]?(a.draw=!0,a.timerShow=0):E=!0),a.timerHide=0):(a.draw?(a.timerHide+=k,a.timerHide>a.hysteresis[1]?(delete z[n],M[N]--,a.draw=!1,a.timerHide=0):E=!0):a.timerShow&&(a.draw=!0,a.timerHide=a.hysteresis[1]*(1-(a.timerShow-s)/a.hysteresis[0])),a.timerShow=0));var V=a.draw,O=null;if(P||!0!==a.hysteresis[3]||(V?0!=a.timerHide&&(O=a.timerHide/(a.hysteresis[1]+1),O=1-Math.min(1,O)):0!=a.timerShow&&a.timerShow-s>0&&(O=(a.timerShow-s)/(a.hysteresis[0]+1),O=Math.min(1,O),V=!0)),V){if(a.hysteresisCounter!=i.geoRenderCounter&&a.hysteresisBackup){var j=a.hysteresisBackup;z[n]=j,j.timerShow=a.timerShow,j.timerHide=a.timerHide,j.draw=a.draw,a=j}if(a.renderCounter[0][0]!==T&&null!==a.renderCounter[0][0]){a.updatePos=!0;var H=a.renderCounter[0],Y=l.create(),q=l.create(),J=H[3],Z=J.bbox,X=i.cameraPosition,W=u.translationMatrix(Z.min[0]-X[0],Z.min[1]-X[1],Z.min[2]-X[2]);l.multiply(i.camera.getModelviewMatrix(),W,q);var Q=i.camera.getProjectionMatrix();l.multiply(Q,q,Y),a.mv=q,a.mvp=Y}if(r)a.fade=O,F[L]=a,L++;else{switch(a.type){case 10:var K=(i.viewExtent,a.vswitch[a.vswitchIndex]);if(K){K=K[1];for(var $=0,ee=K.length;$<ee;$++){var te=K[$];te.updatePos=a.updatePos,te.mvp=a.mvp,te.mv=a.mv,this.drawGpuSubJob(e,t,i,o,te.lastSubJob,O)}}break;case 6:this.drawGpuSubJobLineLabel(e,t,i,o,a.lastSubJob,O);break;default:this.drawGpuSubJob(e,t,i,o,a.lastSubJob,O)}a.updatePos=!1}}a.hysteresisBackup=null}}}if(r&&L)for(m(i,F,L,i.gmap2),N=0;N<L;N++){switch(a=F[N],a.type){case 10:var K=(i.viewExtent,a.vswitch[a.vswitchIndex]);if(K){K=K[1];for(var $=0,ee=K.length;$<ee;$++){var te=K[$];te.updatePos=a.updatePos,te.mvp=a.mvp,te.mv=a.mv,this.drawGpuSubJob(e,t,i,o,te.lastSubJob,a.fade)}}break;case 6:this.drawGpuSubJobLineLabel(e,t,i,o,a.lastSubJob,a.fade);break;default:this.drawGpuSubJob(e,t,i,o,a.lastSubJob,a.fade)}a.updatePos=!1}E&&this.core.markDirty(),i.jobsTimer2=performance.now()},v.prototype.clearJobBuffer=function(){for(var e=this.renderer,t=e.jobZBuffer,i=e.jobZBufferSize,r=0,s=t.length;r<s;r++){for(var a=i[r],n=t[r],o=0;o<a;o++)n[o]=null;i[r]=0}},v.prototype.clearJobHBuffer=function(){for(var e=this.renderer,t=e.jobZBuffer2,i=e.jobZBuffer2Size,r=0,s=t.length;r<s;r++)t[r]={},i[r]=0},v.prototype.paintGL=function(){var e=this.renderer;this.gpu.clear(!0,!1),e.onlyLayers||e.onlyDepth||e.onlyHitLayers||this.drawSkydome()},v.prototype.processNoOverlap=function(e,t,i,r,s,a,n,h,l,u,c){var d={exit:!0},p=t.reduce&&t.reduce[0]>=7&&t.reduce[0]<=11;if(!e.drawAllLabels&&t.noOverlap){i||(i=e.project2(t.center2,e.camera.mvp,e.cameraPosition,!0)),d.pp=i;var f=t.noOverlap,g=i[2];if(g<0||g>1)return d;if(6==t.type){if(e.benevolentMargins){if(!e.rmap.checkRectangle(i[0]-200,i[1]-200,i[0]+200,i[1]+200,0))return d}else if(!e.rmap.checkRectangle(i[0],i[1],i[0],i[1],0))return d}else if(!e.rmap.checkRectangle(i[0]+f[0],i[1]+f[1],i[0]+f[2],i[1]+f[3],h))return d;if(null!==f[4]&&(0===f[4]?g=f[5]:(null===n&&(s=t.center2,r=e.cameraPosition,a=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],n=o.length(a)+1e-4),t.reduce&&(!t.reduce||t.reduce[0]>=8&&t.reduce[0]<=11)||(g=f[5]/n))),t.lastSubJob=[t,h,l,u,c,i,!0,g,f],p)return e.gmapUseVersion=t.reduce[0]>=8&&t.reduce[0]<=11?t.reduce[0]-6:1,e.gmap[e.gmapIndex]=t.lastSubJob,e.gmapIndex++,e.config.mapFeaturesReduceFactor>=1&&(null===n&&(s=t.center2,r=e.cameraPosition,a=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],n=o.length(a)+1e-4),n>e.fmaxDist&&(e.fmaxDist=n),n<e.fminDist&&(e.fminDist=n),t.reduce[1]=t.reduce[2],t.reduce[4]=n),d;if(6==t.type){if(!e.rmap.addLineLabel(t.lastSubJob))return d}else if(!e.rmap.addRectangle(i[0]+f[0],i[1]+f[1],i[0]+f[2],i[1]+f[3],g,t.lastSubJob))return e.rmap.storeRemovedRectangle(i[0]+f[0],i[1]+f[1],i[0]+f[2],i[1]+f[3],g,t.lastSubJob),d;return d}return p?(i||(i=e.project2(t.center2,e.camera.mvp,e.cameraPosition,!0)),t.lastSubJob=[t,h,l,u,c,i,!1],e.gmapUseVersion=t.reduce[0]>=8&&t.reduce[0]<=11?t.reduce[0]-6:1,e.gmap[e.gmapIndex]=t.lastSubJob,e.gmapIndex++,e.config.mapFeaturesReduceFactor>=1&&(null===n&&(s=t.center2,r=e.cameraPosition,a=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],n=o.length(a)+1e-4),n>e.fmaxDist&&(e.fmaxDist=n),n<e.fminDist&&(e.fminDist=n),t.reduce[1]=t.reduce[2],t.reduce[4]=n),d.pp=i,d):t.hysteresis&&t.id?(i||(i=e.project2(t.center2,e.camera.mvp,e.cameraPosition,!0)),t.lastSubJob=[t,h,l,u,c,i],e.jobHBuffer[t.id]=t,d.pp=i,d):(d.pp=i,d.exit=!1,d)},v.prototype.drawGpuJob=function(e,t,i,r,s,a,n){if(r.ready&&r.eventInfo){var h=255&r.state,l=r.eventInfo["#id"];if(null!=l){if(512&r.state){if(-1!=i.geodataSelection.indexOf(l)){if(768&r.state)if(i.hoverFeature&&i.hoverFeature[0]["#id"]==l){if(3!=h)return}else if(2!=h)return}else if(256&r.state){if(i.hoverFeature&&i.hoverFeature[0]["#id"]==l){if(1!=h)return}else if(0!=h)return}else if(0!=h)return}else if(256&r.state){if(i.hoverFeature&&i.hoverFeature[0]["#id"]==l){if(1!=h)return}else if(0!=h)return}else if(0!=h)return}else if(0!=h)return;var c,d,p,f,g,m,v,y,b,x=r.mvp,w=r.hitable&&i.onlyHitLayers,S=r.color,M=i.useSuperElevation;if(w){var A=i.hoverFeatureCounter;S=[(255&A)/255,(A>>8&255)/255,0,0],i.hoverFeatureList[A]=[r.eventInfo,r.center,r.clickEvent,r.hoverEvent,r.enterEvent,r.leaveEvent,a],i.hoverFeatureCounter++}switch(r.type){case 1:case 11:11==r.type?w?r.stencil?e.setState(r.culling?i.polygonB0S1C1tate:i.polygonB0S1C0tate):e.setState(r.culling?i.polygonB0S0C1tate:i.polygonB0S0C0tate):r.stencil?e.setState(r.culling?i.polygonB1S1C1tate:i.polygonB1S1C0tate):e.setState(r.culling?i.polygonB1S0C1tate:i.polygonB1S0C0tate):e.setState(w?i.stencilLineHitState:i.stencilLineState);var C=0===e;c=M?a?r.program2:i.progLineSE:a?r.program2:C?i.progLineWireframe:r.program;var T=!a&&11==r.type&&1==r.style;if(T&&(c=M?i.progCFlatShadeTileSE:i.progCFlatShadeTile),e.useProgram(c,a?["aPosition","aElement"]:C?["aPosition","aBarycentric"]:["aPosition"]),M){var P=this.mBuffer,F=i.superElevation;P[0]=r.bbox.min[0],P[1]=r.bbox.min[1],P[2]=r.bbox.min[2],P[3]=1,P[4]=1,P[5]=1,P[9]=F[0],P[10]=F[1],P[11]=F[2],P[12]=F[6],P[13]=F[5],P[14]=i.earthRadius,P[15]=i.earthERatio,c.setMat4("uParamsSE",P)}if(T?(c.setMat4("uMV",r.mv),c.setMat4("uProj",i.camera.getProjectionFMatrix(),i.getZoffsetFactor(r.zbufferOffset)),c.setVec4("uColor",S)):(c.setMat4("uMVP",x,i.getZoffsetFactor(r.zbufferOffset)),c.setVec4("uColor",S)),f=c.getAttribute("aPosition"),t.bindBuffer(t.ARRAY_BUFFER,r.vertexPositionBuffer),t.vertexAttribPointer(f,r.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),a&&(y=c.getAttribute("aElement"),t.bindBuffer(t.ARRAY_BUFFER,r.vertexElementBuffer),t.vertexAttribPointer(y,r.vertexElementBuffer.itemSize,t.FLOAT,!1,0,0)),C){var L=c.getAttribute("aBarycentric");t.bindBuffer(t.ARRAY_BUFFER,e.barycentricBuffer),t.vertexAttribPointer(L,e.barycentricBuffer.itemSize,t.FLOAT,!1,0,0)}t.drawArrays(t.TRIANGLES,0,r.vertexPositionBuffer.numItems);if(i.debug.drawPolyWires){var E=M?i.progWireFrameBasicSE:i.progWireFrameBasic;i.gpu.useProgram(E,["aPosition"]),M&&E.setMat4("uParamsSE",P),E.setMat4("uMV",r.mv),E.setVec4("uColor",[0,0,0,1]),E.setMat4("uProj",i.camera.getProjectionFMatrix(),i.getZoffsetFactor(r.zbufferOffset));for(var k=0,N=2*r.vertexPositionBuffer.numItems;k<N;k+=3)t.drawArrays(t.LINE_LOOP,k,3)}break;case 2:case 3:case 4:case 5:e.setState(w?i.stencilLineHitState:i.stencilLineState),c=a?r.program2:r.program,d=null;var B=[0,0,0,0];if(b=s,w&&5==r.type&&(r.widthByRatio&&(b=[s[0]*i.curSize[1],s[1]*i.curSize[1]]),c=a?this.renderer.progELine3:this.renderer.progLine3,!c.isReady()))return;if(4!=r.type)if(2==r.type)B=[0,0,0,r.widthByRatio?i.cameraViewExtent:1];else{if(w)d=i.whiteTexture,3!=r.type&&2!=r.type||(B=[0,0,0,r.widthByRatio?i.cameraViewExtent:1]);else{var I=r.texture;if(null==I||null==I[0])return;d=I[0],B=[0,I[1]/I[0].height,(I[1]+I[2])/I[0].height,r.widthByRatio?i.cameraViewExtent:1],3==r.type||2==r.type?r.widthByRatio?B[0]=1/(i.cameraViewExtent2*r.lineWidth)/(d.width/I[2]):B[0]=1/r.lineWidth/(d.width/I[2]):r.widthByRatio?(B[0]=1/(i.cameraViewExtent2/i.curSize[1])/(d.width/I[2]),B[0]/=i.curSize[1]*r.lineWidth*.5,B[3]=i.curSize[1]):(B[0]=1/(i.cameraViewExtent2/i.curSize[1])/(d.width/I[2]),B[0]/=.5*r.lineWidth,B[3]=1)}if(!d.loaded)return;e.bindTexture(d)}else r.widthByRatio&&(b=[s[0]*i.curSize[1],s[1]*i.curSize[1]]);if(M){c=a?r.program2:i.progLine3SE;var P=this.mBuffer,F=i.superElevation;P[0]=r.bbox.min[0],P[1]=r.bbox.min[1],P[2]=r.bbox.min[2],P[3]=1,P[4]=1,P[5]=1,P[9]=F[0],P[10]=F[1],P[11]=F[2],P[12]=F[6],P[13]=F[5],P[14]=i.earthRadius,P[15]=i.earthERatio,e.useProgram(c,a?["aPosition","aNormal","aElement"]:["aPosition","aNormal"]),c.setMat4("uParamsSE",P)}else e.useProgram(c,a?["aPosition","aNormal","aElement"]:["aPosition","aNormal"]);c.setVec4("uColor",S),c.setVec2("uScale",b),c.setMat4("uMVP",x,i.getZoffsetFactor(r.zbufferOffset)),4!=r.type&&(null!=r.background&&c.setVec4("uColor2",w?[0,0,0,0]:r.background),c.setVec4("uParams",B),c.setSampler("uSampler",0)),f=c.getAttribute("aPosition"),m=c.getAttribute("aNormal"),t.bindBuffer(t.ARRAY_BUFFER,r.vertexPositionBuffer),t.vertexAttribPointer(f,r.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,r.vertexNormalBuffer),t.vertexAttribPointer(m,r.vertexNormalBuffer.itemSize,t.FLOAT,!1,0,0),a&&(y=c.getAttribute("aElement"),t.bindBuffer(t.ARRAY_BUFFER,r.vertexElementBuffer),t.vertexAttribPointer(y,r.vertexElementBuffer.itemSize,t.FLOAT,!1,0,0)),t.drawArrays(t.TRIANGLES,0,r.vertexPositionBuffer.numItems);break;case 6:var R=r.files;if(R.length>0){for(var k=0,N=R.length;k<N;k++)if(R[k].length>0){var U=r.fonts[k];if(U&&!U.areTexturesReady(R[k]))return}}else{if(!w)return;d=i.whiteTexture}i.useSuperElevation?r.seCounter!=i.seCounter&&(r.seCounter=i.seCounter,r.labelPointsBuffer.id=-1,r.center2=i.transformPointBySE(r.center)):r.center2=r.center;var D=1.4142*r.outline[2]/20,z=1.4142*r.outline[3]/20;if(r.singleBuffer){var _,G,V,O,j,H=null;if(180!=r.culling){if(G=r.center2,_=i.cameraPosition,V=[G[0]-_[0],G[1]-_[1],G[2]-_[2]],r.visibility){switch(H=o.length(V),r.visibility.length){case 1:if(H>r.visibility[0])return;break;case 2:if((O=H*i.localViewExtentFactor)<r.visibility[0]||O>r.visibility[1])return;break;case 4:O=H*i.localViewExtentFactor;var Y=r.visibility[0]*r.visibility[1];if(Y<r.visibility[2]*O||Y>r.visibility[3]*O)return}H=1/H,V[0]*=H,V[1]*=H,V[2]*=H}else o.normalize(V);if(r.normal=[0,0,0],o.normalize(r.center2,r.normal),(j=-o.dot(V,r.normal))<Math.cos(u.radians(r.culling)))return}else if(r.visibility)switch(G=r.center2,_=i.cameraPosition,V=[G[0]-_[0],G[1]-_[1],G[2]-_[2]],H=o.length(V),r.visibility.length){case 1:if(H>r.visibility[0])return;break;case 2:if((H*=i.localViewExtentFactor)<r.visibility[0]||H>r.visibility[1])return;break;case 4:H*=i.localViewExtentFactor;var Y=r.visibility[0]*r.visibility[1];if(Y<r.visibility[2]*H||Y>r.visibility[3]*H)return}if(p=this.processNoOverlap(i,r,oe,_,G,V,H,de,d,R,S),p.exit)return;return void this.drawGpuSubJobLineLabel(e,t,i,s,[r,0,d,R,S,oe])}if(e.setState(w?i.lineLabelHitState:i.lineLabelState),c=i.useSuperElevation?i.progText2SE:r.program,e.useProgram(c,["aPosition","aTexCoord"]),M){var P=this.mBuffer,F=i.superElevation;P[0]=r.bbox.min[0],P[1]=r.bbox.min[1],P[2]=r.bbox.min[2],P[3]=1,P[4]=1,P[5]=1,P[9]=F[0],P[10]=F[1],P[11]=F[2],P[12]=F[6],P[13]=F[5],P[14]=i.earthRadius,P[15]=i.earthERatio,c.setMat4("uParamsSE",P)}c.setSampler("uSampler",0),c.setMat4("uMVP",x,i.getZoffsetFactor(r.zbufferOffset)),c.setVec4("uVec",i.labelVector),c.setVec4("uColor",w?S:r.color2),c.setVec2("uParams",[r.outline[0],z]),f=c.getAttribute("aPosition"),g=c.getAttribute("aTexCoord"),t.bindBuffer(t.ARRAY_BUFFER,r.vertexPositionBuffer),t.vertexAttribPointer(f,r.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,r.vertexTexcoordBuffer),t.vertexAttribPointer(g,r.vertexTexcoordBuffer.itemSize,t.FLOAT,!1,0,0);for(var q=0;q<(w?1:2);q++)if(1==q&&(c.setVec4("uColor",S),c.setVec2("uParams",[r.outline[1],D])),R.length>0)for(var k=0,N=R.length;k<N;k++)for(var J=R[k],Z=0,X=J.length;Z<X;Z++){var W=J[Z];c.setFloat("uFile",Math.round(W+1e3*k)),e.bindTexture(r.fonts[k].getTexture(W)),t.drawArrays(t.TRIANGLES,0,r.vertexPositionBuffer.numItems)}else e.bindTexture(d),t.drawArrays(t.TRIANGLES,0,r.vertexPositionBuffer.numItems);break;case 7:case 8:case 9:case 10:if(r.reduce&&!(r.reduce[0]>=7&&r.reduce[0]<=11)){var Q,K=r.reduce;if(K[0]>4)if(4==K[0]){if(Q=Math.max(K[1],Math.floor(K[2]/Math.max(1,i.drawnGeodataTiles))),r.index>=Q)return;K[5]=Q}else{if(Q=Math.pow(r.texelSize*r.tiltAngle,.5),Q=Math.max(K[1],Math.round(K[2]*(Q/Math.max(1e-5,this.renderer.drawnGeodataTilesFactor)))),r.index>=Q)return;K[5]=Q}else{Q=r.tiltAngle,1==K[0]?Q=1-Math.acos(Q)*(1/(.5*Math.PI)):3==K[0]&&(Q=.5*(Math.cos(2*Math.acos(Q))+1));var $=Math.round(K[1]+Q*K[2])-1;if(r.index>$)return;K[5]=$}}var R=r.files;if(10!=r.type)if(9==r.type){for(var ee=!1,q=0,te=r.subjobs.length;q<te;q++){var ie=r.subjobs[q];if(R=ie.files,R.length>0){for(var k=0,N=R.length;k<N;k++)if(R[k].length>0){var U=ie.fonts[k];U&&!U.areTexturesReady(R[k])&&(ee=!0)}}else d=w?i.whiteTexture:ie.texture,d.loaded||(ee=!0)}if(ee)return}else if(R=r.files,R.length>0){for(var k=0,N=R.length;k<N;k++)if(R[k].length>0){var U=r.fonts[k];if(U&&!U.areTexturesReady(R[k]))return}}else if(d=w?i.whiteTexture:r.texture,!d.loaded)return;var _,G,V,O,j,H=null;if(i.useSuperElevation?r.seCounter!=i.seCounter&&(r.seCounter=i.seCounter,r.center2=i.transformPointBySE(r.center)):r.center2=r.center,180!=r.culling){if(G=r.center2,_=i.cameraPosition,V=[G[0]-_[0],G[1]-_[1],G[2]-_[2]],r.visibility){switch(H=o.length(V),r.visibility.length){case 1:if(H>r.visibility[0])return;break;case 2:if((O=H*i.localViewExtentFactor)<r.visibility[0]||O>r.visibility[1])return;break;case 4:O=H*i.localViewExtentFactor;var Y=r.visibility[0]*r.visibility[1];if(Y<r.visibility[2]*O||Y>r.visibility[3]*O)return}H=1/H,V[0]*=H,V[1]*=H,V[2]*=H}else o.normalize(V);if(r.normal=[0,0,0],o.normalize(r.center2,r.normal),(j=-o.dot(V,r.normal))<Math.cos(u.radians(r.culling)))return}else if(r.visibility)switch(G=r.center2,_=i.cameraPosition,V=[G[0]-_[0],G[1]-_[1],G[2]-_[2]],H=o.length(V),r.visibility.length){case 1:if(H>r.visibility[0])return;break;case 2:if((H*=i.localViewExtentFactor)<r.visibility[0]||H>r.visibility[1])return;break;case 4:H*=i.localViewExtentFactor;var Y=r.visibility[0]*r.visibility[1];if(Y<r.visibility[2]*H||Y>r.visibility[3]*H)return}if(10==r.type){var re=i.viewExtent,se=r.vswitch;for(r.vswitchIndex=0,k=0,N=se.length;k<N;k++)if(re<=se[k][0]||k==N-1){r.vswitchIndex=k;var ae=r.vswitch[k];if(ae)for(ae=ae[1],q=0,te=ae.length;q<te;q++){var ne=ae[q];ne.mv=r.mv,ne.mvp=r.mvp,ne.updatePos=r.updatePos,ne.hysteresis=r.hysteresis,ne.vswitchIndex=k,ne.renderCounter=r.renderCounter,ne.localTilt=j,ne.id=r.id,this.drawGpuJob(e,t,i,ne,s,a,n)}return}return}var oe,he,le,ue,ce=r.stick,de=0;if(0!=ce[0]){if(le=i.config.mapFeatureStickMode,ue=ce[0],le[0]){if(j||(j=r.localTilt)||(G=r.center2,_=i.cameraPosition,V=[G[0]-_[0],G[1]-_[1],G[2]-_[2]],o.normalize(V),r.normal=[0,0,0],o.normalize(r.center2,r.normal),j=-o.dot(V,r.normal)),2==le[0]){var pe=i.gridHmax-i.gridHmin;pe<0&&(pe=0),pe<ue&&(ue=pe)}j<0&&(j=0),de=Math.pow(1-j,le[1])*ue*i.cameraTiltFator}else de=i.cameraTiltFator*ce[0];de<ce[1]&&(de=0),0!=ce[0]&&0!=ce[2]&&de>=4&&(de+=ce[7]),oe=i.project2(r.center2,i.camera.mvp,i.cameraPosition),oe[0]=Math.round(oe[0]),oe[1]-=de}if(p=this.processNoOverlap(i,r,oe,_,G,V,H,de,d,R,S),p.exit)return;if(oe=p.pp,_=p.p1,G=p.p2,V=p.camVec,H=p.l,9==r.type)return;if(i.drawLabelBoxes&&(he=r.noOverlap)&&(oe||(oe=i.project2(r.center2,i.camera.mvp,i.cameraPosition)),e.setState(w?i.lineLabelHitState:i.lineLabelState),this.drawLineString([[oe[0]+he[0],oe[1]+he[1],.5],[oe[0]+he[2],oe[1]+he[1],.5],[oe[0]+he[2],oe[1]+he[3],.5],[oe[0]+he[0],oe[1]+he[3],.5],[oe[0]+he[0],oe[1]+he[1],.5]],!0,1,[255,0,0,255],null,!0,null,null,null),r.reduce&&(r.reduce[0]>=10?this.drawText(oe[0]+he[0],oe[1]+he[3]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,r.reduce[6].toFixed(3)+" "+r.reduce[1].toFixed(2)+" "+r.reduce[3].toFixed(2)+" "+r.reduce[7].toFixed(0),[1,0,0,1],.5):this.drawText(oe[0]+he[0],oe[1]+he[3]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,r.reduce[1].toFixed(0)+" "+r.reduce[5].toFixed(0),[1,0,0,1],.5))),e.setState(w?i.lineLabelHitState:i.labelState),0!=ce[0]&&0!=ce[2]&&(oe||(oe=i.project2(r.center2,i.camera.mvp,i.cameraPosition)),this.drawLineString([[oe[0],oe[1]+de+ce[7],oe[2]],[oe[0],oe[1]+ce[7],oe[2]]],!0,ce[2],[ce[3],ce[4],ce[5],ce[6]],null,null,null,null,!0)),c=r.program,r.singleBuffer){if(oe||(oe=i.project2(r.center2,i.camera.mvp,i.cameraPosition)),c==i.progIcon){var fe=r.singleBuffer;if(c=i.progImage,!r.singleBuffer2){r.singleBuffer2=new Float32Array(fe);var ge=1/d.width,me=1/d.height;fe[2]*=ge,fe[3]*=me,fe[6]*=ge,fe[7]*=me,fe[10]*=ge,fe[11]*=me,fe[14]*=ge,fe[15]*=me}r.updatePos&&(oe=i.project2(r.center2,i.camera.mvp,i.cameraPosition),oe[1]-=de);var ve=r.singleBuffer2;fe[0]=oe[0]+ve[0],fe[1]=oe[1]+ve[1],fe[4]=oe[0]+ve[4],fe[5]=oe[1]+ve[5],fe[8]=oe[0]+ve[8],fe[9]=oe[1]+ve[9],fe[12]=oe[0]+ve[12],fe[13]=oe[1]+ve[13],e.useProgram(c,["aPosition"]),e.bindTexture(d);var ye=i.rectVerticesBuffer;t.bindBuffer(t.ARRAY_BUFFER,ye),t.vertexAttribPointer(c.getAttribute("aPosition"),ye.itemSize,t.FLOAT,!1,0,0);var be=i.rectIndicesBuffer;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,be),c.setMat4("uProjectionMatrix",i.imageProjectionMatrix),c.setMat4("uData",r.singleBuffer),c.setVec4("uColor",S),c.setFloat("uDepth",oe[2]*(1+2*i.getZoffsetFactor(r.zbufferOffset))),t.drawElements(t.TRIANGLES,be.numItems,t.UNSIGNED_SHORT,0)}else{var xe,fe=r.singleBuffer,we=fe.length,Se=fe.length/4*6,Me=r.color2,q=0;we>384?(xe=i.textQuads128,c=i.progLabel128):we>256?(xe=i.textQuads96,c=i.progLabel96):we>192?(xe=i.textQuads64,c=i.progLabel64):we>128?(xe=i.textQuads48,c=i.progLabel48):we>64?(xe=i.textQuads32,c=i.progLabel32):(xe=i.textQuads16,c=i.progLabel16),r.updatePos&&(oe=i.project2(r.center2,i.camera.mvp,i.cameraPosition),oe[1]-=de),e.useProgram(c,["aPosition"]),c.setSampler("uSampler",0),c.setMat4("uProjectionMatrix",i.imageProjectionMatrix),c.setVec4("uScale",[s[0],s[1],1,2*de]),c.setVec3("uOrigin",[oe[0],oe[1],oe[2]*(1+2*i.getZoffsetFactor(r.zbufferOffset))]),c.setVec4("uColor",w?S:Me),c.setVec2("uParams",[r.outline[0],r.gamma[1]]),te=w?1:2;var f=c.getAttribute("aPosition");for(c.setVec4("uData",fe),t.bindBuffer(t.ARRAY_BUFFER,xe),t.vertexAttribPointer(f,xe.itemSize,t.FLOAT,!1,0,0);q<te;q++){1==q&&(c.setVec4("uColor",S),c.setVec2("uParams",[r.outline[1],r.gamma[0]]));for(var k=0,N=R.length;k<N;k++)for(var J=R[k],Z=0,X=J.length;Z<X;Z++){var W=J[Z];c.setFloat("uFile",Math.round(W+1e3*k)),e.bindTexture(r.fonts[k].getTexture(W)),t.drawArrays(t.TRIANGLES,0,Se)}}}return}e.useProgram(c,["aPosition","aTexCoord","aOrigin"]),c.setSampler("uSampler",0),c.setMat4("uMVP",x,i.getZoffsetFactor(r.zbufferOffset)),c.setVec4("uScale",[s[0],s[1],8==r.type?1:1/d.width,2*de]);var q=0,te=1;for(c!=i.progIcon?(c.setVec4("uColor",w?S:r.color2),c.setVec2("uParams",[r.outline[0],r.gamma[1]]),te=w?1:2):c.setVec4("uColor",S),f=c.getAttribute("aPosition"),g=c.getAttribute("aTexCoord"),v=c.getAttribute("aOrigin"),t.bindBuffer(t.ARRAY_BUFFER,r.vertexPositionBuffer),t.vertexAttribPointer(f,r.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,r.vertexTexcoordBuffer),t.vertexAttribPointer(g,r.vertexTexcoordBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,r.vertexOriginBuffer),t.vertexAttribPointer(v,r.vertexOriginBuffer.itemSize,t.FLOAT,!1,0,0);q<te;q++)if(1==q&&(c.setVec4("uColor",S),c.setVec2("uParams",[r.outline[1],r.gamma[0]])),R.length>0)for(var k=0,N=R.length;k<N;k++)for(var J=R[k],Z=0,X=J.length;Z<X;Z++){var W=J[Z];c.setFloat("uFile",Math.round(W+1e3*k)),e.bindTexture(r.fonts[k].getTexture(W)),t.drawArrays(t.TRIANGLES,0,r.vertexPositionBuffer.numItems)}else e.bindTexture(d),t.drawArrays(t.TRIANGLES,0,r.vertexPositionBuffer.numItems)}}},v.prototype.drawGpuSubJob=function(e,t,i,r,s,a){if(s){var n,h,l,u,c=s[0],d=s[1],p=s[2],f=s[3],g=s[4],m=s[5],v=c.stick,y=c.noOverlap;if(i.useSuperElevation?c.seCounter!=i.seCounter&&(c.seCounter=i.seCounter,c.center2=i.transformPointBySE(c.center)):c.center2=c.center,c.hysteresis&&c.id&&0!=v[0]){var b=i.config.mapFeatureStickMode,x=v[0];if(b[0]){if(n||(n=c.localTilt)||(h=c.center2,l=i.cameraPosition,u=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],o.normalize(u),c.normal=[0,0,0],o.normalize(c.center2,c.normal),n=-o.dot(u,c.normal)),2==b[0]){var w=i.gridHmax-i.gridHmin;w<0&&(w=0),w<x&&(x=w)}n<0&&(n=0),d=Math.pow(1-n,b[1])*x*i.cameraTiltFator}else d=i.cameraTiltFator*v[0];d<v[1]&&(d=0),0!=v[0]&&0!=v[2]&&d>=4&&(d+=v[7]),m=i.project2(c.center2,i.camera.mvp,i.cameraPosition),m[0]=Math.round(m[0]),m[1]-=d}var S=c.hitable&&i.onlyHitLayers;if(9!=c.type){i.drawLabelBoxes&&y&&(e.setState(S?i.lineLabelHitState:i.lineLabelState),this.drawLineString([[m[0]+y[0],m[1]+y[1],.5],[m[0]+y[2],m[1]+y[1],.5],[m[0]+y[2],m[1]+y[3],.5],[m[0]+y[0],m[1]+y[3],.5],[m[0]+y[0],m[1]+y[1],.5]],!0,1,[255,0,0,255],null,!0,null,null,null),c.reduce&&(c.reduce[0]>=10?this.drawText(m[0]+y[0],m[1]+y[3]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,c.reduce[6].toFixed(3)+" "+c.reduce[1].toFixed(2)+" "+c.reduce[3].toFixed(2)+" "+c.reduce[7].toFixed(0),[1,0,0,1],.5):this.drawText(m[0]+y[0],m[1]+y[3]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,c.reduce[1].toFixed(0)+" "+c.reduce[5].toFixed(0),[1,0,0,1],.5))),e.setState(S?i.lineLabelHitState:i.labelState);var M=0,A=1,C=c.color2;null!==a&&(g=[g[0],g[1],g[2],g[3]*a],C&&(C=[C[0],C[1],C[2],C[3]*a])),0!=v[0]&&0!=v[2]&&d>=4&&this.drawLineString([[m[0],m[1]+d+v[7],m[2]],[m[0],m[1]+v[7],m[2]]],!0,v[2],[v[3],v[4],v[5],null!==a?v[6]*a:v[6]],null,null,null,null,!0);var T=c.program;if(c.singleBuffer)if(T==i.progIcon){var P=c.singleBuffer;if(T=i.progImage,!c.singleBuffer2){c.singleBuffer2=new Float32Array(P);var F=1/p.width,L=1/p.height;P[2]*=F,P[3]*=L,P[6]*=F,P[7]*=L,P[10]*=F,P[11]*=L,P[14]*=F,P[15]*=L}c.updatePos&&(m=i.project2(c.center2,i.camera.mvp,i.cameraPosition),m[1]-=d);var E=c.singleBuffer2;P[0]=m[0]+E[0],P[1]=m[1]+E[1],P[4]=m[0]+E[4],P[5]=m[1]+E[5],P[8]=m[0]+E[8],P[9]=m[1]+E[9],P[12]=m[0]+E[12],P[13]=m[1]+E[13],e.useProgram(T,["aPosition"]),e.bindTexture(p);var k=i.rectVerticesBuffer;t.bindBuffer(t.ARRAY_BUFFER,k),t.vertexAttribPointer(T.getAttribute("aPosition"),k.itemSize,t.FLOAT,!1,0,0);var N=i.rectIndicesBuffer;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,N),T.setMat4("uProjectionMatrix",i.imageProjectionMatrix),T.setMat4("uData",c.singleBuffer),T.setVec4("uColor",g),T.setFloat("uDepth",m[2]*(1+2*i.getZoffsetFactor(c.zbufferOffset))),t.drawElements(t.TRIANGLES,N.numItems,t.UNSIGNED_SHORT,0)}else{var B,P=c.singleBuffer,I=P.length,R=P.length/4*6;I>384?(B=i.textQuads128,T=i.progLabel128):I>256?(B=i.textQuads96,T=i.progLabel96):I>192?(B=i.textQuads64,T=i.progLabel64):I>128?(B=i.textQuads48,T=i.progLabel48):I>64?(B=i.textQuads32,T=i.progLabel32):(B=i.textQuads16,T=i.progLabel16),c.updatePos&&(m=i.project2(c.center2,i.camera.mvp,i.cameraPosition),m[1]-=d),e.useProgram(T,["aPosition"]),T.setSampler("uSampler",0),T.setMat4("uProjectionMatrix",i.imageProjectionMatrix),T.setVec4("uScale",[r[0],r[1],1,2*d]),T.setVec3("uOrigin",[m[0],m[1],m[2]*(1+2*i.getZoffsetFactor(c.zbufferOffset))]),T.setVec4("uColor",S?g:C),T.setVec2("uParams",[c.outline[0],c.gamma[1]]),A=S?1:2;var U=T.getAttribute("aPosition");for(T.setVec4("uData",P),t.bindBuffer(t.ARRAY_BUFFER,B),t.vertexAttribPointer(U,B.itemSize,t.FLOAT,!1,0,0);M<A;M++){1==M&&(T.setVec4("uColor",g),T.setVec2("uParams",[c.outline[1],c.gamma[0]]));for(var D=0,z=f.length;D<z;D++)for(var _=f[D],G=0,V=_.length;G<V;G++){var O=_[G];T.setFloat("uFile",Math.round(O+1e3*D)),e.bindTexture(c.fonts[D].getTexture(O)),t.drawArrays(t.TRIANGLES,0,R)}}}else{e.useProgram(T,["aPosition","aTexCoord","aOrigin"]),T.setSampler("uSampler",0),T.setMat4("uMVP",c.mvp,i.getZoffsetFactor(c.zbufferOffset)),T.setVec4("uScale",[r[0],r[1],8==c.type?1:1/p.width,2*d]),T!=i.progIcon?(T.setVec4("uColor",S?g:C),T.setVec2("uParams",[c.outline[0],c.gamma[1]]),A=S?1:2):T.setVec4("uColor",g);var U=T.getAttribute("aPosition"),j=T.getAttribute("aTexCoord"),H=T.getAttribute("aOrigin");for(t.bindBuffer(t.ARRAY_BUFFER,c.vertexPositionBuffer),t.vertexAttribPointer(U,c.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,c.vertexTexcoordBuffer),t.vertexAttribPointer(j,c.vertexTexcoordBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,c.vertexOriginBuffer),t.vertexAttribPointer(H,c.vertexOriginBuffer.itemSize,t.FLOAT,!1,0,0);M<A;M++)if(1==M&&(T.setVec4("uColor",g),T.setVec2("uParams",[c.outline[1],c.gamma[0]])),f.length>0)for(var D=0,z=f.length;D<z;D++)for(var _=f[D],G=0,V=_.length;G<V;G++){var O=_[G];T.setFloat("uFile",Math.round(O+1e3*D)),e.bindTexture(c.fonts[D].getTexture(O)),t.drawArrays(t.TRIANGLES,0,c.vertexPositionBuffer.numItems)}else e.bindTexture(p),t.drawArrays(t.TRIANGLES,0,c.vertexPositionBuffer.numItems)}}else{i.drawLabelBoxes&&y&&(e.setState(S?i.lineLabelHitState:i.lineLabelState),this.drawLineString([[m[0]+y[0],m[1]+y[1],.5],[m[0]+y[2],m[1]+y[1],.5],[m[0]+y[2],m[1]+y[3],.5],[m[0]+y[0],m[1]+y[3],.5],[m[0]+y[0],m[1]+y[1],.5]],!0,1,[255,0,0,255],null,!0,null,null,null),c.reduce&&(c.reduce[0]>=10?this.drawText(m[0]+y[0],m[1]+y[3]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,c.reduce[6].toFixed(3)+" "+c.reduce[1].toFixed(2)+" "+c.reduce[3].toFixed(2)+" "+c.reduce[7].toFixed(0),[1,0,0,1],.5):this.drawText(m[0]+y[0],m[1]+y[3]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,c.reduce[1].toFixed(0)+" "+c.reduce[5].toFixed(0),[1,0,0,1],.5))),e.setState(S?i.lineLabelHitState:i.labelState),0!=v[0]&&0!=v[2]&&d>=4&&this.drawLineString([[m[0],m[1]+d+v[7],m[2]],[m[0],m[1]+v[7],m[2]]],!0,v[2],[v[3],v[4],v[5],null!==a?v[6]*a:v[6]],null,null,null,null,!0);for(var D=0,z=c.subjobs.length;D<z;D++){var Y=c.subjobs[D];Y.mvp=c.mvp,Y.updatePos=c.updatePos;var q=s[7];y=null,f=Y.files,S?(g=s[4],p=i.whiteTexture):(g=Y.color,p=Y.texture),this.drawGpuSubJob(e,t,i,r,[Y,d,p,f,g,m,!0,q,y],a)}}}},v.prototype.drawGpuSubJobLineLabel=function(e,t,i,s,a,n){if(a){var h,l,u=a[0],c=(a[2],a[3]),d=a[4],p=a[5],f=u.noOverlap,g=i.useSuperElevation;g?u.seCounter!=i.seCounter&&(u.seCounter=i.seCounter,u.labelPointsBuffer.id=-1,u.center2=i.transformPointBySE(u.center)):u.center2=u.center;var m,v,y,h,b=u.hitable&&i.onlyHitLayers,x=1.4142*u.outline[2]/20,w=1.4142*u.outline[3]/20;if(u.singleBuffer){e.setState(b?i.lineLabelHitState:i.lineLabelState),(p=a[5])&&!u.updatePos||(p=i.project2(u.center2,i.camera.mvp,i.cameraPosition,!0));var S=.5*u.labelSize,M=.5*i.camera.scaleFactor2(p[3])*i.curSize[1]*(i.curSize[0]/i.curSize[1]),A=u.labelPoints,C=u.labelIndex,T=0;if((v=A.length)<=1||A[v-1][0]*M<S)return;for(v--,m=0;m<v;m++){var P=A[m+1][0]*M;if(P>S){var F=A[m][0]*M;C=m,T=(S-F)/(P-F);break}}var L,E,k=o.dot(A[C][1],i.labelVector)>=0?3:2,N=3==k?u.singleBuffer2:u.singleBuffer,B=N.length,I=N.length/4*6,R=A[C][k],U=0,D=A[C+1]?A[C+1][k]:R,z=[0,0,0,0];if(g)if(E=u.labelPointsBuffer,E.id!=1024*C+k){E.id=1024*C+k,E.points.length!=R.length&&(E.points=new Array(R.length),E.points2=new Array(R.length));var _=E.points,G=E.points2;for(m=0,v=R.length;m<v;m++)_[m]=i.transformPointBySE2(R[m]),G[m]=i.transformPointBySE2(D[m]);R=_,D=G}else R=E.points,D=E.points2;for(m=0,v=R.length;m<v;m++)y=R[m],h=D[m],g?(N[U]=y[4]+y[13]+(h[4]+h[13]-(y[4]+y[13]))*T,N[U+1]=y[5]+y[14]+(h[5]+h[14]-(y[5]+y[14]))*T,N[U+2]=y[6]+y[15]+(h[6]+h[15]-(y[6]+y[15]))*T):(N[U]=y[4]+(h[4]-y[4])*T,N[U+1]=y[5]+(h[5]-y[5])*T,N[U+2]=y[6]+(h[6]-y[6])*T),r([y[7],y[8],y[9],y[10]],[h[7],h[8],h[9],h[10]],T,z),N[U+3]=z[0],N[U+4]=z[1],N[U+5]=z[2],N[U+6]=z[3],N[U+7]=y[11]+(h[11]-y[11])*T,N[U+8]=y[12]+(h[12]-y[12])*T,U+=12;B>384?(L=i.textQuads128,l=i.progLineLabel128):B>256?(L=i.textQuads96,l=i.progLineLabel96):B>192?(L=i.textQuads64,l=i.progLineLabel64):B>128?(L=i.textQuads48,l=i.progLineLabel48):B>64?(L=i.textQuads32,l=i.progLineLabel32):(L=i.textQuads16,l=i.progLineLabel16);var V=u.color2;null!==n&&(d=[d[0],d[1],d[2],d[3]*n],V&&(V=[V[0],V[1],V[2],V[3]*n])),e.useProgram(l,["aPosition"]),l.setSampler("uSampler",0),l.setMat4("uMVP",u.mvp,i.getZoffsetFactor(u.zbufferOffset)),l.setVec4("uColor",b?d:V),l.setVec2("uParams",[u.outline[0],w]);var v=b?1:2,O=l.getAttribute("aPosition");for(l.setVec4("uData",N),t.bindBuffer(t.ARRAY_BUFFER,L),t.vertexAttribPointer(O,L.itemSize,t.FLOAT,!1,0,0),m=0,v=b?1:2;m<v;m++){1==m&&(l.setVec4("uColor",d),l.setVec2("uParams",[u.outline[1],x]));for(var j=0,H=c.length;j<H;j++)for(var Y=c[j],q=0,J=Y.length;q<J;q++){var Z=Y[q];l.setFloat("uFile",Math.round(Z+1e3*j)),e.bindTexture(u.fonts[j].getTexture(Z)),t.drawArrays(t.TRIANGLES,0,I/3)}}if(i.drawLabelBoxes){var X,W=f?f[0]:1,p=[0,0,0];for(m=0,v=R.length;m<v;m++)y=R[m],h=D[m],p[0]=y[0]+(h[0]-y[0])*T,p[1]=y[1]+(h[1]-y[1])*T,p[2]=y[2]+(h[2]-y[2])*T,X=y[3]+(h[3]-y[3])*T,p=i.project2(p,i.camera.mvp,i.cameraPosition,!0),this.drawCircle(p,X*M*W,1,[255,0,255,255],null,null,null,null,null);p=a[5],p||(p=i.project2(u.center2,i.camera.mvp,i.cameraPosition,!0)),this.drawCircle(p,8,1,[255,255,0,255],null,null,null,null,null),u.reduce&&(u.reduce[0]>=10?this.drawText(p[0],p[1]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,u.reduce[6].toFixed(3)+" "+u.reduce[1].toFixed(2)+" "+u.reduce[3].toFixed(2)+" "+u.reduce[7].toFixed(0),[1,0,0,1],.5):this.drawText(p[0],p[1]-4*i.debug.debugTextSize,4*i.debug.debugTextSize,u.reduce[1].toFixed(0)+" "+u.reduce[5].toFixed(0),[1,0,0,1],.5))}}else;}},t.a=v},function(e,t,i){"use strict";var r=i(5),s=r.a,a={};a.setFaceVertices=function(e,t,i,r,s){e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=i[0],e[s+4]=i[1],e[s+5]=i[2],e[s+6]=r[0],e[s+7]=r[1],e[s+8]=r[2]},a.setFaceUVs=function(e,t,i,r,s){e[s]=t[0],e[s+1]=t[1],e[s+2]=i[0],e[s+3]=i[1],e[s+4]=r[0],e[s+5]=r[1]},a.buildHeightmap=function(e,t){e--;for(var i=a,r=e*e*2,n=new Float32Array(3*r*3),o=new Float32Array(3*r*2),h=1*e,l=0,u=0,c=0;c<e;c++)for(var d=0;d<e;d++){var p=d*h,f=(d+1)*h,g=c*h,m=(c+1)*h;i.setFaceVertices(n,[p,g,0],[f,g,0],[f,m,0],l),i.setFaceUVs(o,[p,g],[f,g],[f,m],u),l+=9,u+=6,i.setFaceVertices(n,[f,m,0],[p,m,0],[p,g,0],l),i.setFaceUVs(o,[f,m],[p,m],[p,g],u),l+=9,u+=6}var v=new s(0,0,0,1,1,1);return t?{bbox:v,vertices:this.covnetTo16Bit(n),uvs:this.covnetTo16Bit(o)}:{bbox:v,vertices:n,uvs:o}},a.buildPlane=function(e,t){e--;for(var i,r,n,o,h,l,u,c,d=a,p=e*e*2,f=t?new Uint16Array(3*p*3):new Float32Array(3*p*3),g=new Float32Array(3*p*2),m=1/e,v=0,y=0,b=0;b<e;b++)for(var x=0;x<e;x++)i=x,n=x+1,r=b,o=b+1,h=x*m,l=(x+1)*m,u=b*m,c=(b+1)*m,d.setFaceVertices(f,[i,r,0],[i,o,0],[n,o,0],v),d.setFaceUVs(g,[h,u],[h,c],[l,c],y),v+=9,y+=6,d.setFaceVertices(f,[n,o,0],[n,r,0],[i,r,0],v),d.setFaceUVs(g,[l,c],[l,u],[h,u],y),v+=9,y+=6;var w=new s(0,0,0,1,1,1);return t?{bbox:w,vertices:f,uvs:this.covnetTo16Bit(g)}:{bbox:w,vertices:f,uvs:g}},a.spherePos=function(e,t){return t*=Math.PI,e*=2*Math.PI,[Math.cos(e)*Math.sin(t)*.5+.5,Math.sin(e)*Math.sin(t)*.5+.5,.5*Math.cos(t)+.5]},a.buildSkydome=function(e,t,i,r){var n,o,h,l,u,c,d,p=a,f=e*t*2,g=e*t*(r?1:3),m=new Float32Array(3*g),v=new Float32Array(2*g),y=r?new Uint16Array(3*f):null,b=0,x=0,p=a;if(r){for(n=0;n<e;n++)for(o=0;o<t;o++)c=o/t,d=n/e,u=p.spherePos(c,d),m[b]=u[0],m[b+1]=u[1],m[b+2]=u[2],v[x]=c,v[x+1]=d,b+=3,x+=2;for(b=0,n=0;n<e-1;n++)for(o=0;o<t;o++)l=n+1,h=o+1,h>=t&&(h=0),y[b]=l*t+o,y[b+1]=n*t+o,y[b+2]=n*t+h,y[b+3]=n*t+h,y[b+4]=l*t+h,y[b+5]=l*t+o,b+=6}else for(var n=0;n<e;n++)for(var o=0;o<t;o++){var w=o/t,h=(o+1)/t,S=n/e,l=(n+1)/e;p.makeQuad(w,S,h,l,m,b,v,x),b+=18,x+=12}var M=new s(0,0,0,1,1,1);return i?{bbox:M,vertices:this.covnetTo16Bit(m),uvs:this.covnetTo16Bit(v),indices:y}:{bbox:M,vertices:m,uvs:v,indices:y}},a.covnetTo16Bit=function(e){for(var t,i=new Uint16Array(e.length),r=0,s=e.length;r<s;r++)t=65535*e[r],t<0&&(t=0),t>65535&&(t=65535),i[r]=t;return i},a.makeQuad=function(e,t,i,r,s,n,o,h){var l=a,u=l.spherePos(e,t),c=[e,t],d=l.spherePos(e,r),p=[e,r],f=l.spherePos(i,t),g=[i,t],m=l.spherePos(i,r),v=[i,r];l.setFaceVertices(s,d,u,f,n),l.setFaceUVs(o,p,c,g,h),l.setFaceVertices(s,f,m,d,n+9),l.setFaceUVs(o,g,v,p,h+6)},t.a=a},function(e,t,i){"use strict";function r(e,t,i,r,a){if(i.config.mapFeaturesReduceParams){var n,o,h=i.config.mapFeaturesReduceParams[1],l=i.config.mapFeaturesReduceParams[0],u=96*(window.devicePixelRatio||1),c=i.curSize[0],d=i.curSize[1],p=Math.ceil(c/u*(d/u)*l),f=i.config.mapFeaturesSortByTop;h=h<=0?2*p:h;var g=i.gmap,m=i.gmapIndex,v=i.gmapTop,y=p;p>m&&(y=m);var b,x,w,S,M=Math.floor(Math.sqrt(c*d/h)),A=i.gmapHit,C=0,T=i.drawAllLabels,P=[[0,0,255,255],[128,0,255,255],[255,0,0,255],[255,128,0,255],[0,255,0,255],[0,255,128,255],[128,255,128,255]],F=0;do{var L,E,k,N,B,I,R,U,D,z,_,G,V,O,j,H;B=c/M,I=d/M,R=B*I,_=Math.floor(B),G=Math.floor(I),B-=_,I-=G,L=1/R,E=B/R,k=I/R,N=B*I/R,L=Math.floor(L*p),E=Math.floor(E*p),k=Math.floor(k*p),N=Math.floor(N*p);var A=i.gmapStore,Y=i.gmapHit;if(i.drawGridCells){e.setState(i.lineLabelState);var H,q,J=0,Z=0;for(H=0,q=G+1;H<q;H++)for(n=0,o=_+1;n<o;n++)J=M*n,Z=M*H,V=L,n>=_?V=H>=G?N:E:H>=G&&(V=E),a.drawLineString([[J,Z,.5],[J+M,Z,.5],[J+M,Z+M,.5],[J,Z+M,.5]],!0,1,P[F],null,!0,null,null,null),a.drawText(Math.round(J+5),Math.round(Z+5+15*F),10,""+V,P[F],.5)}for(n=0,o=(_+1)*(G+1);n<o;n++)A[n]=null;for(n=0,o=m;n<o;n++)(w=g[n])&&(U=w[5],U[0]<30||U[0]>=c-30||U[1]<30||U[1]>=d-30?g[n]=null:(D=U[0]/M,z=U[1]/M,(V=D>_?z>G?N:E:z>G?k:L)>0&&(O=Math.floor(D)+Math.floor(z)*(_+1),b=A[O],b?A[O].push(n):(A[O]=[n],Y[O]=V))));for(n=0,o=(_+1)*(G+1);n<o;n++)if((b=A[n])&&b.length)for(x=Y[n],x>b.length&&(x=b.length),s(b,f,x,i),H=0;H<x;H++)O=v[H],w=g[O],v[H]=null,g[O]=null,S=w[0],!T&&w[6]?(U=w[5],j=w[8],i.rmap.addRectangle(U[0]+j[0],U[1]+j[1],U[0]+j[2],U[1]+j[3],w[7],w[0].lastSubJob),6==S.type?i.rmap.addLineLabel(S.lastSubJob,depthParams):i.rmap.addRectangle(U[0]+j[0],U[1]+j[1],U[0]+j[2],U[1]+j[3],w[7],S.lastSubJob,!0,depthParams)&&i.rmap.storeRemovedRectangle(U[0]+j[0],U[1]+j[1],U[0]+j[2],U[1]+j[3],w[7],w[0].lastSubJob)):S.hysteresis?i.jobHBuffer[S.id]=S:(i.drawnJobs++,6==S.type?a.drawGpuSubJobLineLabel(e,t,i,r,S.lastSubJob,null):a.drawGpuSubJob(e,t,i,r,S.lastSubJob,null));L*=_*G,E*=_,k*=G,C+=L+E+k+N,p-=L+E+k+N,M*=2,F++}while(C<y)}}function s(e,t,i,r){var s,a,n,o=0,h=t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY,l=r.gmapTop,u=0,c=0,d=r.gmap;do{var p=t?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;c=u;for(var f=0,g=e.length;f<g;f++)n=e[f],a=d[n],s=a[0].reduce[1],(t&&s>=p&&s<h||s<=p&&s>h)&&(p!=s&&(u=c),l[u]=n,u++,p=s);h=p,o++}while(o<i)}function a(e,t,i,r,s,a,n,o,h){var l,u,c=i-1,d=r-1,p=i+1,f=r+1;for(c<0&&(c=0),d<0&&(d=0),p>s&&(p=s),f>a&&(f=a);d<=f;d++)for(l=c;l<=p;l++)u=2*(d*s+l),n[u],n[u]?(o[n[u+1]]=h,n[u+1]=h+1,o[h]=t,o[h+1]=0,h+=2):(n[u]=h,n[u+1]=h+1,o[h]=t,o[h+1]=0,h+=2);return h}function n(e,t,i,r,s){if(i.config.mapFeaturesReduceParams){var n,o,h,l,u,c,d,p,f,g,m=96*(window.devicePixelRatio||1),v=i.config.mapFeaturesReduceParams[0]*m,y=i.config.mapFeaturesReduceParams[1],b=i.curSize[0],x=i.curSize[1],w=(i.config.mapFeaturesSortByTop,i.drawAllLabels),S=i.gmap,M=i.gmapIndex,A=i.gmap2,C=1,T=i.gmap3,P=i.gmap3Size,T=i.gmap3,F=1e4,L=0,E=i.config.mapFeaturesReduceFactor>=1;if(E){if(i.fmaxDist==Number.NEGATIVE_INFINITY||i.fminDist==Number.POSITIVE_INFINITY)return;var k=1-Math.log(i.fminDist)/Math.log(101),N=-Math.log(i.fmaxDist)/Math.log(101)}for(n=0,o=M;n<o;n++)(h=S[n])&&(u=h[5],E?(g=h[0].reduce,f=Math.round(((Math.log(g[1]+1)-Math.log(g[4]))/Math.log(101)-N)/(k-N)*1e4-5e3)+5e3,g[5]=f):f=Math.round(h[0].reduce[1]),f<0&&(f=0),f>=1e4&&(f=9999),f<F&&(F=f),f>L&&(L=f),T[f][P[f]++]=h);var B,I,R,U,D=1/v,z=Math.floor(b*D),_=Math.floor(x*D),G=i.gmapStore;i.gmapHit;for(n=0,o=(z+1)*(_+1)*2;n<o;n+=2)G[n]=0;var V,O,j,H,Y,q=0;for(v*=v,n=L,o=F;n>=0;n--)if(P[n]>0){var U=T[n];for(V=0,O=P[n];V<O;V++){if(h=U[V],p=h[0],j=0,u=h[5],I=Math.floor(u[0]*D),R=Math.floor(u[1]*D),B=2*(R*z+I),G[B]){B=G[B];do{if(l=A[B],c=l[5],H=u[0]-c[0],Y=u[1]-c[1],H*H+Y*Y<v&&++j>y)break;B=A[B+1]}while(B)}j<=y&&(B=q,!w&&h[6]?(u=h[5],d=h[8],6==p.type?i.rmap.addLineLabel(p.lastSubJob,null)&&q++:i.rmap.addRectangle(u[0]+d[0],u[1]+d[1],u[0]+d[2],u[1]+d[3],h[7],p.lastSubJob,!0,null)&&q++):(p.hysteresis?i.jobHBuffer[p.id]=p:(i.drawnJobs++,6==p.type?s.drawGpuSubJobLineLabel(e,t,i,r,p.lastSubJob,null):s.drawGpuSubJob(e,t,i,r,p.lastSubJob,null)),q++),B!=q&&(C=a(B,h,I,R,z,_,G,A,C)))}P[n]=0}}}function o(e,t,i,r,s){if(i.config.mapFeaturesReduceParams){var a,n,o,h,l,u,c,d,p=(window.devicePixelRatio,i.curSize[0],i.curSize[1],i.config.mapFeaturesSortByTop,i.drawAllLabels),f=i.gmap,g=i.gmapIndex,m=(i.gmap2,i.gmap3),v=i.gmap3Size,m=i.gmap3,y=1e4,b=0,x=i.config.mapFeaturesReduceFactor>=1;if(x){if(i.fmaxDist==Number.NEGATIVE_INFINITY||i.fminDist==Number.POSITIVE_INFINITY)return;var w=1-Math.log(i.fminDist)/Math.log(101),S=-Math.log(i.fmaxDist)/Math.log(101)}for(a=0,n=g;a<n;a++)(o=f[a])&&(h=o[5],x?(d=o[0].reduce,c=Math.round(((Math.log(d[1]+1)-Math.log(d[4]))/Math.log(101)-S)/(w-S)*1e4-5e3)+5e3,d[5]=c):c=Math.round(o[0].reduce[1]),c<0&&(c=0),c>=1e4&&(c=9999),c<y&&(y=c),c>b&&(b=c),m[c][v[c]++]=o);var M,A;for(a=b,n=y;a>=0;a--)if(v[a]>0){var C=m[a];for(M=0,A=v[a];M<A;M++)o=C[M],u=o[0],h=o[5],!p&&o[6]?(h=o[5],l=o[8],6==u.type?i.rmap.addLineLabel(u.lastSubJob,null):i.rmap.addRectangle(h[0]+l[0],h[1]+l[1],h[0]+l[2],h[1]+l[3],o[7],u.lastSubJob,!0,null)):u.hysteresis?i.jobHBuffer[u.id]=u:(i.drawnJobs++,6==u.type?s.drawGpuSubJobLineLabel(e,t,i,r,u.lastSubJob,null):s.drawGpuSubJob(e,t,i,r,u.lastSubJob,null));v[a]=0}}}function h(e,t,i,r,s){var a,n,o,h,l=i<65536?e.radixCountBuffer16:e.radixCountBuffer32,u=e.buffUint32,c=e.buffFloat32,d=e.config.mapFeaturesReduceFactor;e.curSize[0],e.curSize[1];if(l.fill)l.fill(0);else for(o=0;o<1024;o++)l[o]=0;for(o=0;o<i;o++)a=t[o],h=a[0].reduce,n=h[3]-d*Math.log(h[4]),h[6]=n,n+=1e4,n<0&&(n=0),c[0]=n,n=u[0],h[5]=n,l[255&n]++,l[256+(n>>8&255)]++,l[512+(n>>16&255)]++,l[768+(n>>24&255)]++;for(var p=0;p<4;p++){var f=0,g=0,m=256*p;for(o=0;o<256;o++)f=l[o+m],l[o+m]=g,g+=f}for(o=0;o<i;o++)a=t[o],n=a[0].reduce[5],r[l[255&n]++]=a;for(o=0;o<i;o++)a=r[o],n=a[0].reduce[5],t[l[256+(n>>8&255)]++]=a;for(o=0;o<i;o++)a=t[o],n=a[0].reduce[5],r[l[512+(n>>16&255)]++]=a;for(o=0;o<i;o++)a=r[o],n=a[0].reduce[5],t[l[768+(n>>24&255)]++]=a;if(-123==o)for(o=0;o<i;o++)n=t[o][0].reduce[5],console.log(n+" "+t[o][0].id);return t}function l(e,t,i,r,s){if(i.config.mapFeaturesReduceParams){var a,n,o,l,u,c=i.config.mapFeaturesReduceParams[1],d=96*(window.devicePixelRatio||1),p=i.curSize[0],f=i.curSize[1],g=Math.ceil(p/d*(f/d)*c),m=(i.config.mapFeaturesSortByTop,0),v=i.drawAllLabels,y=0!=i.config.mapFeaturesReduceFactor2,b=-i.config.mapFeaturesReduceFactor3,x=null;i.debugStr="<br>featuresPerScr: "+g;var w=i.gmap,S=i.gmapIndex,M=i.gmap2;for(v&&(g=S),h(i,w,S,M),a=S-1;a>=0;a--)if(o=w[a],n=o[0],!v&&o[6]){if(l=o[5],u=o[8],x=y?[l[0],l[1]+o[1],n.reduce,b]:null,6==n.type?i.rmap.addLineLabel(n.lastSubJob,x)&&m++:i.rmap.addRectangle(l[0]+u[0],l[1]+u[1],l[0]+u[2],l[1]+u[3],o[7],n.lastSubJob,!0,x)&&m++,m>=g)return}else n.hysteresis?i.jobHBuffer[n.id]=n:(i.drawnJobs++,6==n.type?s.drawGpuSubJobLineLabel(e,t,i,r,n.lastSubJob,null):s.drawGpuSubJob(e,t,i,r,n.lastSubJob,null))}}function u(e,t,i,r){var s,a,n,o=i<65536?e.radixCountBuffer16:e.radixCountBuffer32,h=e.buffUint32,l=e.buffFloat32;e.config.mapFeaturesReduceFactor;if(o.fill)o.fill(0);else for(n=0;n<1024;n++)o[n]=0;for(n=0;n<i;n++)s=t[n],a=1-s.lastSubJob[5][2],l[0]=a,a=h[0],s.depth=a,o[255&a]++,o[256+(a>>8&255)]++,o[512+(a>>16&255)]++,o[768+(a>>24&255)]++;for(var u=0;u<4;u++){var c=0,d=0,p=256*u;for(n=0;n<256;n++)c=o[n+p],o[n+p]=d,d+=c}for(n=0;n<i;n++)s=t[n],a=s.depth,r[o[255&a]++]=s;for(n=0;n<i;n++)s=r[n],a=s.depth,t[o[256+(a>>8&255)]++]=s;for(n=0;n<i;n++)s=t[n],a=s.depth,r[o[512+(a>>16&255)]++]=s;for(n=0;n<i;n++)s=r[n],a=s.depth,t[o[768+(a>>24&255)]++]=s;return t}function c(e,t,i){for(var r,s,a,n,o,h,l=0,u=t-1,d=i-1,p=0,f=i;p<f;p++)for(var g=0,m=t;g<m;g++)if(null===e[p*t+g]){r=g-1,s=p-1,a=g,n=p,o=g+1,h=p+1,r<0&&(r=0),s<0&&(s=0),o>u&&(o=u),h>d&&(h=d);for(var v=[e[s*t+r],e[s*t+a],e[s*t+o],e[n*t+r],e[n*t+o],e[h*t+r],e[h*t+a],e[h*t+o]],y=0,b=0,x=0;x<8;x++)null!==v[x]&&(y++,b+=v[x]);0!=y?e[p*t+g]=b/y:l++}0!=l&&l!=t*i&&c(e,t,i)}function d(e,t,i,r,s){t-=.5,i-=.5;var a=r-1,n=s-1;t<0&&(t=0),i<0&&(i=0),t>a&&(t=a),i>n&&(i=n);var o=Math.floor(t),h=Math.floor(i),l=t-o,u=i-h,c=h*r,d=h==n?c:c+r,p=o==a?o:o+1,f=e[c+o],g=e[c+p],m=e[d+o],v=e[d+p],y=f+(g-f)*l;return y+(m+(v-m)*l-y)*u}function p(e,t,i,r){var s,a,n,o=i<65536?e.radixCountBuffer16:e.radixCountBuffer32,h=e.buffUint32,l=e.buffFloat32;if(o.fill)o.fill(0);else for(n=0;n<1024;n++)o[n]=0;for(n=0;n<i;n++)s=t[n],l[0]=s[0].delta,a=h[0],s[0].delta=a,o[255&a]++,o[256+(a>>8&255)]++,o[512+(a>>16&255)]++,o[768+(a>>24&255)]++;for(var u=0;u<4;u++){var c=0,d=0,p=256*u;for(n=0;n<256;n++)c=o[n+p],o[n+p]=d,d+=c}for(n=0;n<i;n++)s=t[n],a=s[0].delta,r[o[255&a]++]=s;for(n=0;n<i;n++)s=r[n],a=s[0].delta,t[o[256+(a>>8&255)]++]=s;for(n=0;n<i;n++)s=t[n],a=s[0].delta,r[o[512+(a>>16&255)]++]=s;for(n=0;n<i;n++)s=r[n],a=s[0].delta,t[o[768+(a>>24&255)]++]=s;return t}function f(e,t,i,r,s){if(i.config.mapFeaturesReduceParams){var a=i.config.mapFeaturesReduceParams[5],n=i.config.mapFeaturesReduceParams[1],o=96*(window.devicePixelRatio||1),l=i.curSize[0],u=i.curSize[1],f=Math.ceil(l/o*(u/o)*n),g=f/(a*a),m=Math.floor(g),v=g-m,y=l/a,b=u/a;i.debugStr="<br>featuresPerScr: "+f+"<br>featuresPerTile: "+g.toFixed(2);var x,w,S,M=(i.config.mapFeaturesSortByTop,0),A=0!=i.config.mapFeaturesReduceFactor2,C=-i.config.mapFeaturesReduceFactor3,T=null,P=i.gmap,F=i.gmapIndex,L=i.gmap2,E=0,k=i.gmap4,N=i.drawAllLabels;if(N&&(f=F),F>0)if(h(i,P,F,L),N)for(x=F-1;x>=0;x--)R=P[x],S=R[0],R[0].hysteresis?i.jobHBuffer[R[0].id]=S:(i.drawnJobs++,S=R[0],6==S.type?s.drawGpuSubJobLineLabel(e,t,i,r,S.lastSubJob,null):s.drawGpuSubJob(e,t,i,r,S.lastSubJob,null));else{var B,I,R,U,D,z,_,G,V,O,j,H,Y,q,J,Z=i.gmapHit;U=l/y,D=u/b,V=Math.round(U),O=Math.round(D);var Z=i.gmapStore;i.gmapHit;for(x=0,w=V*O;x<w;x++)Z[x]=null,k[x]=null;for(x=F-1;x>=0;x--)(R=P[x])&&(z=R[5],z[0]<30||z[0]>=l-30||z[1]<30||z[1]>=u-30?P[x]=null:(_=z[0]/y,G=z[1]/b,Y=Math.floor(_)+Math.floor(G)*V,B=Z[Y],B?Z[Y].push(x):Z[Y]=[x]));for(x=0,w=V*O;x<w;x++)(B=Z[x])&&B.length&&(I=B.length,0==I?k[x]=null:(I>m?(I=m,Y=B[I],R=P[Y],j=R[0].reduce[6],B.length>I+1&&(Y=B[I+1],R=P[Y],H=R[0].reduce[6],j+=(H-j)*v)):(Y=B[I-1],R=P[Y],j=R[0].reduce[6]),k[x]=j));for(c(k,V,O),x=F-1;x>=0;x--)if(R=P[x]){S=R[0],j=S.reduce[6],z=R[5];var X=d(k,z[0]/y,z[1]/b,V,O);j>=X?R[6]?(z=R[5],q=R[8],T=A?[z[0],z[1]+R[1],S.reduce,C]:null,6==S.type?i.rmap.addLineLabel(S.lastSubJob,T)&&M++:i.rmap.addRectangle(z[0]+q[0],z[1]+q[1],z[0]+q[2],z[1]+q[3],R[7],S.lastSubJob,!0,T)&&M++):S.hysteresis?i.jobHBuffer[S.id]=S:(i.drawnJobs++,6==S.type?s.drawGpuSubJobLineLabel(e,t,i,r,S.lastSubJob,null):s.drawGpuSubJob(e,t,i,r,S.lastSubJob,null)):(R[0].delta=Math.abs(X-j),L[E]=R,E++)}if(M<f&&E>0)for(p(i,L,E,P),x=E-1;x>=0&&(R=L[x],S=R[0],R[6]?(z=R[5],q=R[8],T=A?[z[0],z[1]+R[1],S.reduce,C]:null,6==S.type?i.rmap.addLineLabel(S.lastSubJob,T)&&M++:i.rmap.addRectangle(z[0]+q[0],z[1]+q[1],z[0]+q[2],z[1]+q[3],R[7],S.lastSubJob,!0,T)&&M++):S.hysteresis?i.jobHBuffer[S.id]=S:(i.drawnJobs++,6==S.type?s.drawGpuSubJobLineLabel(e,t,i,r,S.lastSubJob,null):s.drawGpuSubJob(e,t,i,r,S.lastSubJob,null)),!(M>=f));x--);}if(i.drawGridCells){e.setState(i.lineLabelState);var J,W,Q=0,K=0;for(J=0,W=O;J<W;J++)for(x=0,w=V;x<w;x++){Q=y*x,K=b*J;var j=k[J*V+x];s.drawLineString([[Q,K,.5],[Q+y,K,.5],[Q+y,K+b,.5],[Q,K+b,.5]],!0,1,[0,0,255,255],null,!0,null,null,null),j&&s.drawText(Math.round(Q+5),Math.round(K+5),11,""+j.toFixed(2),[255,255,255,255],.5)}}}}i.d(t,"a",function(){return r}),i.d(t,"b",function(){return n}),i.d(t,"c",function(){return o}),i.d(t,"d",function(){return l}),i.d(t,"e",function(){return f}),i.d(t,"f",function(){return u})},function(e,t,i){"use strict";var r=function(e,t){this.gl=e.gl;var i=this.gl;if(null!=i){this.free=t,this.vertexPositionBuffer=null,this.vertexPositionBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexPositionBuffer);var r;r=t?[0,0,0,0,0,1,0,0,1,0,0,2,0,0,2,0,0,3,0,0,3,0,0,0,0,0,4,0,0,5,0,0,5,0,0,6,0,0,6,0,0,7,0,0,7,0,0,4,0,0,0,0,0,4,0,0,1,0,0,5,0,0,2,0,0,6,0,0,3,0,0,7]:[0,0,0,1,0,0,1,0,0,1,1,0,1,1,0,0,1,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,1,0,0,0,0,0,1,1,0,0,1,0,1,1,1,0,1,1,1,0,1,0,0,1,1],i.bufferData(i.ARRAY_BUFFER,new Float32Array(r),i.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=r.length/3,this.size=36,this.lines=this.vertexPositionBuffer.numItems/3}};r.prototype.kill=function(){this.gl.deleteBuffer(this.vertexPositionBuffer)},r.prototype.draw=function(e,t){var i=this.gl;if(null!=i){var r=e.getAttribute(t);i.bindBuffer(i.ARRAY_BUFFER,this.vertexPositionBuffer),i.vertexAttribPointer(r,this.vertexPositionBuffer.itemSize,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,this.vertexPositionBuffer.numItems)}},t.a=r},function(e,t,i){"use strict";var r=function(e,t,i,r,s,a){this.renderer=e,this.div=t,this.canvas=null,this.curSize=i,this.currentProgram=null,this.maxAttributesCount=8,this.newAttributes=new Uint8Array(this.maxAttributesCount),this.enabledAttributes=new Uint8Array(this.maxAttributesCount),this.noTextures=!1,this.barycentricBuffer=null,this.defaultState=this.createState({blend:!1,stencil:!1,zequal:!1,ztest:!1,zwrite:!1,culling:!1}),this.currentState=this.defaultState,this.currentOffset=0,this.keepFrameBuffer=null!=r&&r,this.antialias=!!s,this.anisoLevel=a};r.prototype.init=function(){var e=document.createElement("canvas");if(null!=e&&(this.canvas=e,e.width=this.curSize[0],e.height=this.curSize[1],e.style.display="block",null!=e.getContext)){e.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),e.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);var t;try{t=e.getContext("webgl",{preserveDrawingBuffer:this.keepFrameBuffer,antialias:this.antialias,stencil:!0})||e.getContext("experimental-webgl",{preserveDrawingBuffer:this.keepFrameBuffer})}catch(e){}t&&(this.gl=t,t.getExtension("OES_standard_derivatives"),this.anisoExt=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.anisoExt?(this.maxAniso=t.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT),this.anisoLevel&&(-1==this.anisoLevel?this.anisoLevel=this.maxAniso:this.anisoLevel=Math.min(this.anisoLevel,this.maxAniso))):(this.maxAniso=0,this.anisoLevel=0),this.div.appendChild(e),t.viewportWidth=e.width,t.viewportHeight=e.height,t.clearColor(0,0,0,1),t.disable(t.BLEND),t.disable(t.STENCIL_TEST),t.depthMask(!1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.disable(t.CULL_FACE),t.viewport(0,0,t.viewportWidth,t.viewportHeight),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT))}},r.prototype.kill=function(){this.div.removeChild(this.canvas),delete this.canvas,this.canvas=null},r.prototype.contextLost=function(e){e.preventDefault(),this.renderer.core.contextLost=!0,this.renderer.core.callListener("gpu-context-lost",{})},r.prototype.contextRestored=function(){this.renderer.core.callListener("gpu-context-restored",{})},r.prototype.resize=function(e,t){this.curSize=e;var i=this.canvas,r=this.gl;null!=i&&!0!==t&&(i.width=this.curSize[0],i.height=this.curSize[1]),null!=r&&(r.viewportWidth=i.width,r.viewportHeight=i.height)},r.prototype.setAniso=function(e){this.anisoExt&&this.anisoLevel&&(this.anisoLevel=-1==e?this.maxAniso:Math.min(e,this.maxAniso))},r.prototype.getCanvas=function(){return this.canvas},r.prototype.setViewport=function(){this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight)},r.prototype.clear=function(e,t,i){null!=i&&this.gl.clearColor(i[0]/255,i[1]/255,i[2]/255,i[3]/255),this.gl.clear((t?this.gl.COLOR_BUFFER_BIT:0)|(e?this.gl.DEPTH_BUFFER_BIT:0))},r.prototype.useProgram=function(e,t,i){if(this.currentProgram!=e){this.gl.useProgram(e.program),this.currentProgram=e,e.setSampler("uSampler",0),i&&e.setSampler("uSampler2",1);for(var r=this.newAttributes,s=this.enabledAttributes,a=0,n=r.length;a<n;a++)r[a]=0;for(a=0,n=t.length;a<n;a++){var o=e.getAttribute(t[a]);-1!=o&&(r[o]=1)}for(a=0,n=r.length;a<n;a++)s[a]!=r[a]&&(r[a]?(this.gl.enableVertexAttribArray(a),s[a]=1):(this.gl.disableVertexAttribArray(a),s[a]=0))}},r.prototype.bindTexture=function(e,t){e.loaded&&(this.gl.activeTexture(t?this.gl.TEXTURE1:this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e.texture))},r.prototype.setFramebuffer=function(e){null!=e?this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.framebuffer):(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null))},r.prototype.createState=function(e){return null==e.blend&&(e.blend=!1),null==e.stencil&&(e.stencil=!1),null==e.zwrite&&(e.zwrite=!0),null==e.ztest&&(e.ztest=!0),null==e.zequal&&(e.zequal=!1),null==e.culling&&(e.culling=!0),e},r.prototype.setState=function(e){if(e){var t=this.gl,i=this.currentState;i.blend!=e.blend&&(e.blend?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND)):t.disable(t.BLEND)),i.stencil!=e.stencil&&(e.stencil?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST)),i.zwrite!=e.zwrite&&(e.zwrite?t.depthMask(!0):t.depthMask(!1)),i.ztest!=e.ztest&&(0!=e.ztest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),i.zequal!=e.zequal&&(0!=e.zequal?t.depthFunc(t.LEQUAL):t.depthFunc(t.LESS)),i.culling!=e.culling&&(e.culling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)),this.currentState=e}},t.a=r},function(e,t,i){"use strict";function r(e,t){if(null==e||"object"!=typeof e)return this;if(null==e.points)return this;var i=e.points,r=e.color||[255,255,255,255],s=null!=e.depthOffset?e.depthOffset:null,a=e.size||2,n=null==e.screenSpace||e.screenSpace,o=null!=e.depthTest&&e.depthTest,h=null!=e.blend&&e.blend,l=null!=e.writeDepth&&e.writeDepth,u=null!=e.useState&&e.useState;return r[0]*=1/255,r[1]*=1/255,r[2]*=1/255,r[3]*=1/255,t.draw.drawLineString(i,n,a,r,s,o,h,l,u),this}var s=i(1),a=i(5),n=i(4),o=i(2),h=i(52),l=s.b,u=s.e,c=a.a,d=n.a,p=o.a,f=h.a,g=function(e,t,i,r,s){this.id=e,this.bbox=null,this.origin=i||[0,0,0],this.gpu=r,this.gl=r.gl,this.renderer=s,this.jobs=[],this.reduced=0,this.geometries={},this.subjob=null,this.mv=new Float32Array(16),this.mvp=new Float32Array(16),this.loadMode=0,this.geFactor=1/38,this.geNormalized=!1,null!=t&&null!=t[0]&&null!=t[1]&&(this.bbox=new c(t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2])),this.size=0,this.polygons=0};g.prototype.kill=function(){for(var e=0,t=this.jobs.length;e<t;e++){var i=this.jobs[e];switch(i.type){case 1:case 11:i.vertexPositionBuffer&&this.gl.deleteBuffer(i.vertexPositionBuffer),i.vertexElementBuffer&&this.gl.deleteBuffer(i.vertexElementBuffer);break;case 3:case 2:case 4:case 5:i.vertexPositionBuffer&&this.gl.deleteBuffer(i.vertexPositionBuffer),i.vertexNormalBuffer&&this.gl.deleteBuffer(i.vertexNormalBuffer),i.vertexElementBuffer&&this.gl.deleteBuffer(i.vertexElementBuffer);break;case 6:i.vertexPositionBuffer&&this.gl.deleteBuffer(i.vertexPositionBuffer),i.vertexTexcoordBuffer&&this.gl.deleteBuffer(i.vertexTexcoordBuffer),i.vertexElementBuffer&&this.gl.deleteBuffer(i.vertexElementBuffer);break;case 7:case 8:i.vertexPositionBuffer&&this.gl.deleteBuffer(i.vertexPositionBuffer),i.vertexTexcoordBuffer&&this.gl.deleteBuffer(i.vertexTexcoordBuffer),i.vertexOriginBuffer&&this.gl.deleteBuffer(i.vertexOriginBuffer),i.vertexElementBuffer&&this.gl.deleteBuffer(i.vertexElementBuffer)}}for(var r in this.geometries){var s=this.geometries[r],a=this.renderer.geometries[r];for(this.geometries[r]=null,e=0,t=s.length;e<t;e++)s[e]==a&&(this.renderer.geometries[r]=null)}},g.prototype.getSize=function(){return this.size},g.prototype.getZbufferOffset=function(){return this.size},g.prototype.addGeometry=function(e){var t=e.id;this.geometries[t]?this.geometries[t].push(e):this.geometries[t]=[e],this.renderer.geometries[t]=e},g.prototype.convertColor=function(e){var t=1/255;return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]},g.prototype.addLineJob=function(e){var t=this.gl,i=e.vertexBuffer,r={};if(13==e.type?r.type=11:r.type=1,r.program=this.renderer.progLine,r.color=this.convertColor(e.color),r.zIndex=e["z-index"]+256,r.clickEvent=e["click-event"],r.hoverEvent=e["hover-event"],r.enterEvent=e["enter-event"],r.leaveEvent=e["leave-event"],r.advancedHit=e.advancedHit,r.hitable=e.hitable,r.eventInfo=e.eventInfo,r.style=e.style||0,r.stencil=!1!==e.stencil,r.culling=e.culling||0,r.state=e.state,r.center=e.center,r.lod=e.lod,r.lineWidth=e["line-width"],r.zbufferOffset=e["zbuffer-offset"],r.reduced=!1,r.ready=!0,r.bbox=this.bbox,r.program.isReady()&&(!r.advancedHit||(r.program2=this.renderer.progELine,r.program2.isReady()))){if(r.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),r.vertexPositionBuffer.itemSize=3,r.vertexPositionBuffer.numItems=i.length/3,r.advancedHit){r.program=this.renderer.progLine;var s=e.elementBuffer;r.vertexElementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r.vertexElementBuffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),r.vertexElementBuffer.itemSize=1,r.vertexElementBuffer.numItems=s.length}this.jobs.push(r),this.size+=4*i.length,this.polygons+=i.length/9}},g.prototype.addExtentedLineJob=function(e){var t=this.gl,i=e.vertexBuffer,r=e.normalBuffer,s={};switch(s.type=e.type,s.type){case 6:s.type=3;break;case 7:s.type=2;break;case 9:s.type=4;break;case 10:s.type=5}if(s.color=this.convertColor(e.color),s.zIndex=e["z-index"]+256,s.clickEvent=e["click-event"],s.hoverEvent=e["hover-event"],s.hitable=e.hitable,s.eventInfo=e.eventInfo,s.enterEvent=e["enter-event"],s.leaveEvent=e["leave-event"],s.advancedHit=e.advancedHit,s.widthByRatio="ratio"==e["width-units"],s.state=e.state,s.center=e.center,s.lod=e.lod,s.lineWidth=e["line-width"],s.zbufferOffset=e["zbuffer-offset"],s.reduced=!1,s.ready=!0,s.bbox=this.bbox,null!=e.texture){var a=e.texture,n=a[0];s.texture=[this.renderer.getBitmap(n.url,n.filter||"linear",n.tiled||!1),a[1],a[2],a[3],a[4]];var o=this.convertColor(e.background);0!=o[3]&&(s.background=o)}switch(s.type){case 3:s.program=0!=o[3]?this.renderer.progTBLine:this.renderer.progTLine;break;case 2:s.program=this.renderer.progRLine;break;case 4:s.program=this.renderer.progLine3;break;case 5:s.program=0!=o[3]?this.renderer.progTPBLine:this.renderer.progTPLine}if(s.program.isReady()){if(s.advancedHit){switch(s.type){case 3:s.program2=this.renderer.progETLine;break;case 2:s.program2=this.renderer.progERLine;break;case 4:s.program2=this.renderer.progELine3;break;case 5:s.program2=this.renderer.progETPLine}if(!s.program2.isReady())return}if(s.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),s.vertexPositionBuffer.itemSize=4,s.vertexPositionBuffer.numItems=i.length/4,s.vertexNormalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.vertexNormalBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),s.vertexNormalBuffer.itemSize=4,s.vertexNormalBuffer.numItems=r.length/4,s.advancedHit){var h=e.elementBuffer;s.vertexElementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.vertexElementBuffer),t.bufferData(t.ARRAY_BUFFER,h,t.STATIC_DRAW),s.vertexElementBuffer.itemSize=1,s.vertexElementBuffer.numItems=h.length}this.jobs.push(s),this.size+=4*i.length+4*r.length,this.polygons+=i.length/12}},g.prototype.processReduce=function(e){if(e.reduce){switch(e.reduce[0]){case"tilt":e.reduce[0]=1;break;case"tilt-cos":e.reduce[0]=2;break;case"tilt-cos2":e.reduce[0]=3;break;case"scr-count":e.reduce[0]=4;break;case"scr-count2":e.reduce[0]=5,this.renderer.drawnGeodataTilesUsed=!0;break;case"scr-count3":e.reduce[0]=6,this.renderer.drawnGeodataTilesUsed=!0;break;case"scr-count4":e.reduce[0]=7;break;case"scr-count5":e.reduce[0]=8;break;case"scr-count6":e.reduce[0]=9;break;case"scr-count7":e.reduce[0]=10;break;case"scr-count8":e.reduce[0]=11}e.reduce[5]=0,e.reduce[6]=0,e.reduce[7]=0,e.reduce[0]>=7&&e.reduce[0]<=11&&(10==e.reduce[0]||11==e.reduce[0]?(e.reduce[1]=Math.abs(e.reduce[1]),e.reduce[3]=e.reduce[1]*e.reduce[2],e.reduce[2]=e.reduce[1],e.reduce[4]=0):(e.reduce[2]=Math.abs(e.reduce[1]),this.renderer.config.mapFeaturesReduceFactor>=1?e.reduce[1]=e.reduce[2]:9==e.reduce[0]?e.reduce[1]=e.reduce[2]:e.reduce[1]=Math.floor(Math.log(500*e.reduce[2])/Math.log(1.0017)+5e3)))}},g.prototype.addLineLabelJob=function(e){var t=this.gl;if(e.singleBuffer)var i=e.singleBuffer,r=e.singleBuffer2;else var s=e.vertexBuffer,a=e.texcoordsBuffer;var n={};n.type=6,n.program=this.renderer.progText,n.color=this.convertColor(e.color),n.color2=this.convertColor(e.color2),n.outline=e.outline,n.zIndex=e["z-index"]+256,n.visibility=e.visibility,n.culling=e.culling,n.clickEvent=e["click-event"],n.hoverEvent=e["hover-event"],n.enterEvent=e["enter-event"],n.leaveEvent=e["leave-event"],n.hitable=e.hitable,n.eventInfo=e.eventInfo,n.state=e.state,n.center=e.center,n.lod=e.lod,n.labelPoints=e.labelPoints,n.labelIndex=e.labelIndex,n.labelSize=e.labelSize,n.zbufferOffset=e["zbuffer-offset"],n.hysteresis=e.hysteresis,n.noOverlap=e.noOverlap,n.labelPointsBuffer={id:-1,points:[],points2:[]},n.id=n.hysteresis?n.hysteresis[2]:null,n.reduced=!1,n.ready=!0,n.bbox=this.bbox,n.reduce=e.reduce,this.processReduce(n),n.files=e.files||[];var o=e.fonts||["#default"];n.fonts=o;for(var h=0,l=o.length;h<l;h++)o[h]=this.renderer.fonts[o[h]];n.program=this.renderer.progText2,n.program.isReady()&&(i?(n.singleBuffer=i,n.singleBuffer2=r,n.textVector=e.textVector,this.polygons+=i.length/12*2):(n.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),n.vertexPositionBuffer.itemSize=4,n.vertexPositionBuffer.numItems=s.length/4,n.vertexTexcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.vertexTexcoordBuffer),t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW),n.vertexTexcoordBuffer.itemSize=4,n.vertexTexcoordBuffer.numItems=a.length/4,this.size+=4*s.length+4*a.length,this.polygons+=s.length/12),this.jobs.push(n))},g.prototype.addIconJob=function(e,t,i){var r=this.gl,s=e.vertexBuffer,a=e.texcoordsBuffer,n=e.originBuffer,o=e.singleBuffer,h=e.stick,l=1/255,u={tile:i};if(u.type=t?8:7,u.program=this.renderer.progIcon,u.color=this.convertColor(e.color),u.zIndex=e["z-index"]+256,u.visibility=e.visibility,u.culling=e.culling,u.clickEvent=e["click-event"],u.hoverEvent=e["hover-event"],u.enterEvent=e["enter-event"],u.leaveEvent=e["leave-event"],u.hitable=e.hitable,u.eventInfo=e.eventInfo,u.state=e.state,u.center=e.center,u.stick=[h[0],h[1],h[2],h[3]*l,h[4]*l,h[5]*l,h[6]*l,h[7]],u.lod=e.lod,u.zbufferOffset=e["zbuffer-offset"],u.hysteresis=e.hysteresis,u.noOverlap=e.noOverlap,u.id=u.hysteresis?u.hysteresis[2]:null,u.reduced=!1,u.ready=!0,u.reduce=e.reduce,this.processReduce(u),u.program.isReady()){if(!0!==t){var c=e.icon;u.texture=this.renderer.getBitmap(null,c.filter||"linear",c.tiled||!1,c.hash,!0),u.files=[]}else{u.color2=this.convertColor(e.color2),u.outline=e.outline,u.size=e.size,u.origin=e.origin,u.files=e.files||[],u.index=e.index||0;var d=e.fonts||["#default"];u.fonts=d,u.gamma=[1.4142*u.outline[2]/u.size,1.4142*u.outline[3]/u.size],u.origin&&(u.origin=new Float32Array(u.origin));for(var p=0,f=d.length;p<f;p++)d[p]=this.renderer.fonts[d[p]];u.program=this.renderer.progIcon2}null==u.visibility||Array.isArray(u.visibility)||(u.visibility=[u.visibility]),o?(u.singleBuffer=o,this.polygons+=2):(u.vertexPositionBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,u.vertexPositionBuffer),r.bufferData(r.ARRAY_BUFFER,s,r.STATIC_DRAW),u.vertexPositionBuffer.itemSize=4,u.vertexPositionBuffer.numItems=s.length/4,u.vertexTexcoordBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,u.vertexTexcoordBuffer),r.bufferData(r.ARRAY_BUFFER,a,r.STATIC_DRAW),u.vertexTexcoordBuffer.itemSize=4,u.vertexTexcoordBuffer.numItems=a.length/4,u.vertexOriginBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,u.vertexOriginBuffer),r.bufferData(r.ARRAY_BUFFER,n,r.STATIC_DRAW),u.vertexOriginBuffer.itemSize=3,u.vertexOriginBuffer.numItems=n.length/3,this.size+=4*u.vertexPositionBuffer.numItems+4*u.vertexOriginBuffer.numItems+4*u.vertexTexcoordBuffer.numItems,this.polygons+=u.vertexPositionBuffer.numItems/12),this.subjobs?this.subjobs.push(u):this.vsjobs?this.vsjobs.push(u):this.jobs.push(u)}},g.prototype.addPack=function(e){if(!this.subjobs.length)return void(this.subjobs=null);for(var t={type:9,subjobs:this.subjobs,culling:180,zIndex:0,ready:!0},i=0,r=t.subjobs.length;i<r;i++){var s=t.subjobs[i];if(s.noOverlap){if(t.noOverlap){var a=t.noOverlap,n=s.noOverlap;n[0]<a[0]&&(a[0]=n[0]),n[1]<a[1]&&(a[1]=n[1]),n[2]>a[2]&&(a[2]=n[2]),n[3]>a[3]&&(a[3]=n[3])}else t.noOverlap=s.noOverlap;s.noOverlap=null}s.culling<=t.culling&&(t.culling=s.culling,s.culling=180),s.visibility&&(t.visibility=s.visibility,s.visibility=null),s.stick&&(t.stick=s.stick,s.stick=[0,0,0,255,255,255,255,0]),s.zIndex>t.zIndex&&(t.zIndex=s.zIndex),s.center&&(t.center=s.center),t.eventInfo=s.eventInfo,t.reduce=s.reduce,t.hysteresis=s.hysteresis,t.id=s.id}this.vsjobs?this.vsjobs.push(t):this.jobs.push(t),this.subjobs=null},g.prototype.addVSPoint=function(e,t){var i={tile:t};i.type=10,i.zIndex=e["z-index"]+256,i.visibility=e.visibility,i.culling=e.culling,i.hitable=!1,i.eventInfo=e.eventInfo,i.state=e.state,i.center=e.center,i.lod=e.lod,i.hysteresis=e.hysteresis,i.id=i.hysteresis?i.hysteresis[2]:null,i.reduced=!1,i.ready=!0,i.reduce=e.reduce,i.vswitch=[],this.vsjob=i},g.prototype.storeVSJobs=function(e){this.vsjob.vswitch.push([e.viewExtent,this.vsjobs]),this.vsjobs=[]},g.prototype.addVSwitch=function(){this.vsjob&&this.jobs.push(this.vsjob),this.vsjobs=null},g.prototype.addMeshJob=function(e,t){var i={};if(i.type=12,i.path=e.path,i.textures=[],i.resources=new f(this.renderer.core.map,null,null),i.path){var r=i.path.split(".");r.length>1&&(r.pop(),i.texturePath=r.join(".")),i.mesh=i.resources.getMesh(i.path,null)}this.jobs.push(i)},g.prototype.copyBuffer=function(e,t,i){return new Uint8Array(e.buffer).set(new Uint8Array(t.buffer,i,e.byteLength)),e},g.prototype.addRenderJob2=function(e,t,i){var r,s,a,n=new DataView(e.buffer),o=e[t];switch(t+=1,15!=o&&16!=o&&17!=o&&19!=o&&18!=o&&(a=n.getUint32(t),t+=4,s=p.unint8ArrayToString(new Uint8Array(e.buffer,t,a)),t+=a,r=JSON.parse(s)),o){case 13:case 6:r.type=o,a=n.getUint32(t),t+=4,r.vertexBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.vertexBuffer.byteLength,r.advancedHit&&(a=n.getUint32(t),t+=4,r.elementBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.elementBuffer.byteLength),this.addLineJob(r);break;case 8:case 7:case 9:case 10:r.type=o,a=n.getUint32(t),t+=4,r.vertexBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.vertexBuffer.byteLength,a=n.getUint32(t),t+=4,r.normalBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.normalBuffer.byteLength,r.advancedHit&&(a=n.getUint32(t),t+=4,r.elementBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.elementBuffer.byteLength),this.addExtentedLineJob(r);break;case 11:a=n.getUint32(t),t+=4,r.vertexBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.vertexBuffer.byteLength,a=n.getUint32(t),t+=4,r.texcoordsBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.texcoordsBuffer.byteLength,this.addLineLabelJob(r);break;case 12:a=n.getUint32(t),t+=4,r.singleBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.singleBuffer.byteLength,a=n.getUint32(t),t+=4,r.singleBuffer2=this.copyBuffer(new Float32Array(a),e,t),t+=r.singleBuffer2.byteLength,this.addLineLabelJob(r);break;case 3:case 1:a=n.getUint32(t),t+=4,r.singleBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.singleBuffer.byteLength,this.addIconJob(r,1==o,i);break;case 4:case 2:a=n.getUint32(t),t+=4,r.vertexBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.vertexBuffer.byteLength,a=n.getUint32(t),t+=4,r.originBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.originBuffer.byteLength,a=n.getUint32(t),t+=4,r.texcoordsBuffer=this.copyBuffer(new Float32Array(a),e,t),t+=r.texcoordsBuffer.byteLength,this.addIconJob(r,2==o,i);break;case 5:case 14:a=n.getUint32(t),t+=4,r.geometryBuffer=this.copyBuffer(new Float64Array(a),e,t),t+=r.originBuffer.byteLength,a=n.getUint32(t),t+=4,r.indicesBuffer=this.copyBuffer(new Uint32Array(a),e,t),t+=r.indicesBuffer.byteLength,a=n.getUint32(t),t+=4,this.addGeometry(r);break;case 15:this.subjobs=[],t+=4;break;case 16:this.addPack(),t+=4;break;case 20:this.addVSPoint(r,i);break;case 17:this.vsjobs=[],this.vsjob=null,t+=4;break;case 19:this.addVSwitch(),t+=4;break;case 18:r={viewExtent:n.getUint32(t)},t+=4,this.storeVSJobs(r);break;case 21:var h=r;if(h.nodes=[],h.jobs=[],h.parent=this.currentNode,h.volume){var l=h.volume.points,u=[l[0][0],l[0][1],l[0][2],l[1][0],l[1][1],l[1][2],l[2][0],l[2][1],l[2][2],l[3][0],l[3][1],l[3][2],l[4][0],l[4][1],l[4][2],l[5][0],l[5][1],l[5][2],l[6][0],l[6][1],l[6][2],l[7][0],l[7][1],l[7][2]];h.volume.points2=u}this.rootNode?(this.currentNode.nodes.push(h),this.currentNode=h):(this.rootNode=h,this.currentNode=h,this.oldJobs=this.jobs),this.jobs=h.jobs;break;case 22:this.currentNode.parent?(this.currentNode=this.currentNode.parent,this.jobs=this.currentNode.jobs):(this.currentNode=this.currentNode.parent,this.jobs=this.oldJobs);break;case 23:this.addMeshJob(r,i)}return t},g.prototype.addRenderJob=function(e,t){switch(e.type){case"polygon":case"flat-line":this.addLineJob(e);break;case"flat-tline":case"flat-rline":case"pixel-line":case"pixel-tline":this.addExtentedLineJob(e);break;case"line-label":this.addLineLabelJob(e);break;case"icon":this.addIconJob(e);break;case"label":this.addIconJob(e,!0,t);break;case"point-geometry":case"line-geometry":this.addGeometry(e);break;case"pack-begin":this.subjobs=[];break;case"pack-end":this.addPack();break;case"vspoint":this.addVSPoint(e,t);break;case"vswitch-begin":this.vsjobs=[],this.vsjob=null;break;case"vswitch-store":this.storeVSJobs(e);break;case"vswitch-end":this.addVSwitch();break;case"node-begin":this.nodeBegin();break;case"node-end":this.nodeEnd();break;case"mesh":this.addMesh()}},g.prototype.getNodeLOD=function(e){for(var t=0;e.parent;)t++,e=e.parent;return t},g.prototype.getNodeTexelSize=function(e,t){var i=e.volume.center,r=this.renderer.cameraPosition,s=l.length([i[0]-r[0],i[1]-r[1],i[2]-r[2]]);return s-=e.volume.radius,s<=0?[Number.POSITIVE_INFINITY,.1]:[this.renderer.camera.scaleFactor2(s)*t,s]},g.prototype.normalizeGE=function(e,t){e.precision=t;for(var i=0,r=e.nodes.length;i<r;i++)this.normalizeGE(e.nodes[i],.5*t)},g.prototype.traverseNode=function(e,t,i){var r=this.renderer,s=e.volume.points2,a=this.renderer.cameraPosition;if(t||r.camera.pointsVisible(s,a)){var n=this.getNodeTexelSize(e,e.precision*r.curSize[0]*this.geFactor);if(0==this.loadMode)if(!e.nodes.length||n[0]<=1.1)(e.parent||this.isNodeReady(e))&&this.drawNode(e);else{for(var o=!0,h=e.nodes,t=[],l=0,u=h.length;l<u;l++)this.isNodeReady(h[l])||(o=!1);if(o)for(var l=0,u=h.length;l<u;l++)this.traverseNode(h[l]);else this.drawNode(e)}else if(1==this.loadMode)if(!e.nodes.length||n[0]<=1.1)if(i||this.isNodeReady(e))this.drawNode(e);else for(var h=e.nodes,l=0,u=h.length;l<u;l++)r.camera.pointsVisible(h[l].volume.points2,a)&&this.isNodeReady(h[l],!0)&&this.drawNode(e);else if(n[0]<=2.2){for(var o=!0,h=e.nodes,t=[],l=0,u=h.length;l<u;l++)t[l]=r.camera.pointsVisible(h[l].volume.points2,a),t[l]&&(this.isNodeReady(h[l])||(o=!1));if(o)for(var l=0,u=h.length;l<u;l++)t[l]&&this.traverseNode(h[l],!0,!0);else this.drawNode(e)}else for(var l=0,u=e.nodes.length;l<u;l++)this.traverseNode(e.nodes[l]);else if(2==this.loadMode)if(!e.nodes.length||n[0]<=1.1)this.isNodeReady(e)&&this.drawNode(e);else for(var l=0,u=e.nodes.length;l<u;l++)this.traverseNode(e.nodes[l])}},g.prototype.isNodeReady=function(e,t){for(var i=e.jobs,r=!0,s=0,a=i.length;s<a;s++){var n=i[s];12==n.type&&(this.isMeshReady(n,t)||(r=!1))}return r},g.prototype.drawNode=function(e){var t=this.renderer,i=t.core.map.draw.debug,s=e.jobs;if(t.drawnNodes++,i.drawNBBoxes){var a=e.volume.points;r({points:[a[0],a[1],a[2],a[3],a[0],a[4],a[5],a[6],a[7],a[4]],size:1,color:[255,0,255,255],depthTest:!1,screenSpace:!1,blend:!1},t),r({points:[a[1],a[5]],size:1,color:[255,0,255,255],depthTest:!1,screenSpace:!1,blend:!1},t),r({points:[a[2],a[6]],size:1,color:[255,0,255,255],depthTest:!1,screenSpace:!1,blend:!1},t),r({points:[a[3],a[7]],size:1,color:[255,0,255,255],depthTest:!1,screenSpace:!1,blend:!1},t);var n=this.renderer.cameraPosition,o=e.volume.center,h=[n[0]-o[0],n[1]-o[1],n[2]-o[2]];l.normalize(h),l.scale(h,e.volume.radius),o=[o[0]+h[0]-n[0],o[1]+h[1]-n[1],o[2]+h[2]-n[2]],o=this.renderer.core.getRendererInterface().getCanvasCoords(o,this.renderer.camera.getMvpMatrix());var u;if(i.drawLods&&(u=""+this.getNodeLOD(e),t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]-8),8,u,[1,0,0,1],o[2])),i.drawDistance){var c=this.getNodeTexelSize(e,e.precision*t.curSize[0]*this.geFactor);u=c[1].toFixed(2)+" "+c[0].toFixed(2)+" "+e.precision.toFixed(2),t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]+34),8,u,[.5,.5,1,1],o[2])}if(i.drawFaceCount){var d=s[0]&&12==s[0].type?s[0].mesh:null;d&&(u=d.faces+" - "+d.submeshes.length,t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]+20),8,u,[0,1,0,1],o[2]))}if(i.drawResources&&s[0]&&(u=(this.getGpuSize(s[0])/1048576).toFixed(2)+"MB",t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]+6),8,u,[0,1,0,1],o[2])),i.drawSurfaces&&s[0]){var u="";if(s[0].texturePath){var p=s[0].texturePath.split("/");u=p.length>1?p[p.length-2]+"/"+p[p.length-1]:p[0]}t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]+20),8,u,[0,1,0,1],o[2])}if(i.drawTextureSize){var d=s[0]&&12==s[0].type?s[0].mesh:null;if(d){var f=d.submeshes;for(v=0,y=f.length;v<y;v++)if(f[v].internalUVs){var g=s[0].textures[v];if(g){var m=g.getGpuTexture();m&&(u="["+v+"]: "+m.width+" x "+m.height,t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]+2*(17+4*v*2)),8,u,[1,1,1,1],o[2]))}}else u="["+v+"]: 256 x 256",t.draw.drawText(Math.round(o[0]-.5*t.draw.getTextSize(8,u)),Math.round(o[1]+2*(17+4*v*2)),8,u,[1,1,1,1],o[2])}}}for(var v=0,y=s.length;v<y;v++){var b=s[v];12==b.type&&this.drawMesh(b)}},g.prototype.isMeshReady=function(e,t){var i=e.mesh,r=i.submeshes,s=!0,a=this.renderer.core.map.stats;if(i.isReady(t)){a.gpuNeeded+=i.gpuSize;for(var n=0,o=r.length;n<o;n++){if(r[n].internalUVs&&e.texturePath){if(null==e.textures[n]){var h=e.texturePath+"-"+n+".jpg";e.textures[n]=e.resources.getTexture(h,0,null,null,null,!0)}e.textures[n].isReady(t)||(s=!1),a.gpuNeeded+=e.textures[n].getGpuSize()}}}else s=!1;return s},g.prototype.getGpuSize=function(e){var t=e.mesh;if(!t)return 0;var i=t.submeshes,r=0;if(t.isReady(!0)){r+=t.gpuSize;for(var s=0,a=i.length;s<a;s++){i[s].internalUVs&&e.texturePath&&e.textures[s]&&(r+=e.textures[s].getGpuSize())}}return r},g.prototype.drawMesh=function(e){for(var t=e.mesh,i=t.submeshes,r=this.renderer.cameraPosition,s=0,a=i.length;s<a;s++){i[s];e.textures[s]&&t.drawSubmesh(r,s,e.textures[s],4,null,null,null,null)}},g.prototype.testNodes=function(e){for(var t=(e.volume.points,0),i=e.nodes.length;t<i;t++);},g.prototype.draw=function(e,t,i,r,s){if(null==this.id||!1!==this.renderer.layerGroupVisible[this.id]){var a=this.renderer,n=[[a.geoRenderCounter,e,t,this]];if(this.rootNode){a.drawnNodes=0;switch(a.core.map.config.mapLoadMode){case"topdown":this.loadMode=0;break;case"fit":this.loadMode=1;break;case"fitonly":this.loadMode=2}return this.geNormalized||(this.normalizeGE(this.rootNode,this.rootNode.precision),this.geNormalized=!0),this.testNodes(this.rootNode),void this.traverseNode(this.rootNode,map)}if(i){var o=u.create(),h=u.create(),c=this.renderer.position,p=this.origin;p=[p[0]-c[0],p[1]-c[1],p[2]],u.multiply(e,d.translationMatrix(p[0],p[1],p[2]),h),u.multiply(t,h,o),e=h,t=o}for(var f=a.cameraPosition,g=a.jobZBuffer,m=a.jobZBufferSize,v=(a.jobZBuffer2,a.jobZBuffer2Size,a.onlyHitLayers),y=0,b=this.jobs.length;y<b;y++){var x=this.jobs[y];if((7==x.type||8==x.type)&&x.visibility>0){var w=x.center;if(l.length([w[0]-f[0],w[1]-f[1],w[2]-f[2]])>x.visibility)continue}if(!v||x.hitable){x.mv=e,x.mvp=t,x.renderCounter=n,x.tiltAngle=r,x.texelSize=s;var S=x.zIndex;g[S][m[S]]=x,m[S]++}}}},t.a=g},function(e,t,i){"use strict";var r=function(e,t,i,r,s,a){this.bbox=null,this.gpu=e,this.gl=e.gl,this.core=t,null!=this.gl&&(this.vertices=[],this.normals=[],this.vertexBuffer=null,this.lines=i,this.joins=s,this.joinSides=a,this.maxLines=r,this.init())};r.prototype.kill=function(){this.gl.deleteBuffer(this.vertexBuffer)},r.prototype.init=function(){var e;if(this.lines)for(this.joins&&this.addCircle(0,this.joinSides),e=0;e<this.maxLines;e++)this.addLine(e,e+1),this.joins&&this.addCircle(e+1,this.joinSides);else if(this.joins)for(e=0;e<=this.maxLines;e++)this.addCircle(e,this.joinSides);this.compile()},r.prototype.addLine=function(e,t){var i=this.vertices.length;this.vertices[i]=e,this.vertices[i+1]=t,this.vertices[i+2]=1,this.vertices[i+3]=e,this.vertices[i+4]=t,this.vertices[i+5]=-1,this.vertices[i+6]=t,this.vertices[i+7]=e,this.vertices[i+8]=1,this.vertices[i+9]=e,this.vertices[i+10]=t,this.vertices[i+11]=1,this.vertices[i+12]=t,this.vertices[i+13]=e,this.vertices[i+14]=1,this.vertices[i+15]=t,this.vertices[i+16]=e,this.vertices[i+17]=-1,this.polygons+=2},r.prototype.addCircle=function(e,t){for(var i=this.vertices.length,r=2*Math.PI/t,s=0;s<t;s++)this.vertices[i]=e,this.vertices[i+1]=-1,this.vertices[i+2]=0,this.vertices[i+3]=e,this.vertices[i+4]=-2,this.vertices[i+5]=r*s,this.vertices[i+6]=e,this.vertices[i+7]=-2,this.vertices[i+8]=r*(s+1),i+=9;this.polygons+=t},r.prototype.compile=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertices),e.STATIC_DRAW),this.vertexBuffer.itemSize=3,this.vertexBuffer.numItems=this.vertices.length/3,this.size=3*this.vertexBuffer.numItems*4*2,this.polygons=this.vertexBuffer.numItems/3},r.prototype.draw=function(e,t,i){var r=this.gl;if(!(null==r||null==this.vertexBuffer||i>this.maxLines)){var s=e.getAttribute(t);r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(s,this.vertexBuffer.itemSize,r.FLOAT,!1,0,0);var a=0;this.lines&&(a+=3*(i-1)*2),this.joins&&(a+=i*(3*this.joinSides)),r.drawArrays(r.TRIANGLES,0,a)}},r.prototype.getSize=function(){return this.size},r.prototype.getBbox=function(){return this.bbox},r.prototype.getPolygons=function(){return this.polygons},t.a=r},function(e,t,i){"use strict";var r=i(160),s=i(162),a=i(60),n=i(32),o=i(165),h=i(33),l=i(61),u=i(6),c=r.a,d=s.a,p=(a.a,n.a),f=o.a,g=h.a,m=l.a,v=u.a,y=function(e){this.renderer=e,this.core=e.core,this.gpu=e.gpu,this.initShaders(),this.initHeightmap(),this.initSkydome(),this.initHitmap(),this.initTextMap(),this.initImage(),this.initTestMap(),this.initBBox(),this.initLines(),this.initBaricentricBuffer()};y.prototype.initShaders=function(){var e=m,t=this.renderer,i=this.gpu;t.progTile=[new g(i,"#define variants\n"+e.tileVertexShader,"#define variants\n"+e.tileFragmentShader)],t.progTile2=[new g(i,"#define variants\n#define externalTex\n"+e.tileVertexShader,"#define variants\n#define externalTex\n"+e.tileFragmentShader.replace("__FILTER__",""))],t.progTile3=[new g(i,"#define variants\n#define externalTex\n"+e.tileVertexShader,"#define variants\n#define externalTex\n#define mask\n"+e.tileFragmentShader.replace("__FILTER__",""))],t.progFogTile=[new g(i,"#define variants\n#define onlyFog\n"+e.tileVertexShader,"#define variants\n#define onlyFog\n"+e.tileFragmentShader)];var r="#extension GL_OES_standard_derivatives : enable\n";t.progFlatShadeTile=[new g(i,"#define variants\n#define flatShadeVar\n"+e.tileVertexShader,r+"#define variants\n#define flatShadeVar\n#define flatShade\n"+e.tileFragmentShader)],t.progFlatShadeTileSE=[new g(i,"#define variants\n#define applySE\n#define flatShadeVar\n"+e.tileVertexShader,r+"#define variants\n#define flatShadeVar\n#define flatShade\n"+e.tileFragmentShader)],t.progCFlatShadeTile=new g(i,"#define flatShadeVar\n"+e.tileVertexShader,(r+"#define flatShadeVar\n#define flatShade\n#define fogAndColor\n"+e.tileFragmentShader).replace("mediump","highp")),t.progCFlatShadeTileSE=new g(i,"#define applySE\n#define flatShadeVar\n"+e.tileVertexShader,(r+"#define flatShadeVar\n#define flatShade\n#define fogAndColor\n"+e.tileFragmentShader).replace("mediump","highp")),t.progDepthTile=[new g(i,"#define variants\n#define depth\n"+e.tileVertexShader,("#define variants\n#define depth\n"+e.tileFragmentShader).replace("mediump","highp"))],t.progDepthHeightmap=new g(i,e.heightmapDepthVertexShader,e.heightmapDepthFragmentShader.replace("mediump","highp")),t.progWireFrameBasic=[new g(i,"#define variants\n"+e.tileVertexShader,"#define variants\n"+e.tileWireFrameBasicShader)],t.progShadedTile=new g(i,e.shadedMeshVertexShader,e.shadedMeshFragmentShader),t.progTShadedTile=new g(i,e.shadedMeshVertexShader,"#define textured\n"+e.shadedMeshFragmentShader),t.progHeightmap=new g(i,e.heightmapVertexShader,e.heightmapFragmentShader),t.progPlane=new g(i,"#define flat\n"+e.planeVertexShader,e.planeFragmentShader),t.progPlane2=new g(i,"#define poles\n"+e.planeVertexShader,"#define poles\n"+e.planeFragmentShader),t.progPlane3=new g(i,e.planeVertexShader,e.planeFragmentShader),t.progPlaneD=new g(i,"#define depth\n#define flat\n"+e.planeVertexShader,"#define depth\n"+e.planeFragmentShader),t.progPlane2D=new g(i,"#define depth\n#define poles\n"+e.planeVertexShader,"#define depth\n#define poles\n"+e.planeFragmentShader),t.progPlane3D=new g(i,"#define depth\n"+e.planeVertexShader,"#define depth\n"+e.planeFragmentShader),t.progSkydome=new g(i,e.skydomeVertexShader,e.skydomeFragmentShader),t.progStardome=new g(i,e.skydomeVertexShader,e.stardomeFragmentShader),t.progAtmo2=new g(i,e.atmoVertexShader,e.atmoFragmentShader),t.progAtmo=new g(i,e.atmoVertexShader3,e.atmoFragmentShader3),t.progBBox=new g(i,e.bboxVertexShader,e.bboxFragmentShader),t.progBBox2=new g(i,e.bbox2VertexShader,e.bboxFragmentShader),t.progLine=new g(i,e.lineVertexShader,e.lineFragmentShader),t.progLineSE=new g(i,"#define applySE\n"+e.lineVertexShader,e.lineFragmentShader),t.progELine=new g(i,"#define withElements\n"+e.lineVertexShader,"#define withElements\n"+e.lineFragmentShader),t.progELineSE=new g(i,"#define applySE\n#define withElements\n"+e.lineVertexShader,"#define withElements\n"+e.lineFragmentShader),t.progLine3=new g(i,"#define pixelLine\n"+e.lineVertexShader,e.lineFragmentShader),t.progELine3=new g(i,"#define pixelLine\n#define withElements\n"+e.lineVertexShader,"#define withElements\n"+e.lineFragmentShader),t.progLine3SE=new g(i,"#define applySE\n#define pixelLine\n"+e.lineVertexShader,e.lineFragmentShader),t.progELine3SE=new g(i,"#define applySE\n#define pixelLine\n#define withElements\n"+e.lineVertexShader,"#define withElements\n"+e.lineFragmentShader),t.progLine4=new g(i,"#define pixelLine\n#define dataPoints\n"+e.lineVertexShader,e.lineFragmentShader),t.progLine5=new g(i,"#define pixelLine\n#define dataPoints\n#define dataPoints2\n"+e.lineVertexShader,e.lineFragmentShader),t.progRLine=new g(i,"#define dynamicWidth\n"+e.lineVertexShader,e.lineFragmentShader),t.progRLineSE=new g(i,"#define applySE\n#define dynamicWidth\n"+e.lineVertexShader,e.lineFragmentShader),t.progERLine=new g(i,"#define dynamicWidth\n#define withElements\n"+e.lineVertexShader,"#define withElements\n"+e.lineFragmentShader),t.progERLineSE=new g(i,"#define applySE\n#define dynamicWidth\n#define withElements\n"+e.lineVertexShader,"#define withElements\n"+e.lineFragmentShader),t.progTLine=new g(i,e.tlineVertexShader,e.tlineFragmentShader),t.progTPLine=new g(i,e.tplineVertexShader,e.tlineFragmentShader),t.progTBLine=new g(i,e.tlineVertexShader,e.tblineFragmentShader),t.progTPBLine=new g(i,e.tplineVertexShader,e.tblineFragmentShader),t.progETLine=new g(i,e.etlineVertexShader,e.elineFragmentShader),t.progETPLine=new g(i,e.etplineVertexShader,e.elineFragmentShader),t.progText2=new g(i,"#define lineLabel\n"+e.lineVertexShader,e.text2FragmentShader),t.progText2SE=new g(i,"#define applySE\n#define lineLabel\n"+e.lineVertexShader,e.text2FragmentShader),t.progLineLabel16=new g(i,"#define DSIZE 16\n#define lineLabel2\n"+e.lineVertexShader,e.text2FragmentShader),t.progLineLabel32=new g(i,"#define DSIZE 32\n#define lineLabel2\n"+e.lineVertexShader,e.text2FragmentShader),t.progLineLabel48=new g(i,"#define DSIZE 48\n#define lineLabel2\n"+e.lineVertexShader,e.text2FragmentShader),t.progLineLabel64=new g(i,"#define DSIZE 64\n#define lineLabel2\n"+e.lineVertexShader,e.text2FragmentShader),t.progLineLabel96=new g(i,"#define DSIZE 96\n#define lineLabel2\n"+e.lineVertexShader,e.text2FragmentShader),t.progLineLabel128=new g(i,"#define DSIZE 128\n#define lineLabel2\n"+e.lineVertexShader,e.text2FragmentShader),t.progPolygon=new g(i,e.polygonVertexShader,e.polygonFragmentShader),t.progImage=new g(i,e.imageVertexShader,e.imageFragmentShader),t.progIcon=new g(i,e.iconVertexShader,e.textFragmentShader),t.progIcon2=new g(i,e.icon2VertexShader,e.text2FragmentShader),t.progLabel16=new g(i,"#define DSIZE 16\n"+e.icon3VertexShader,e.text2FragmentShader),t.progLabel32=new g(i,"#define DSIZE 32\n"+e.icon3VertexShader,e.text2FragmentShader),t.progLabel48=new g(i,"#define DSIZE 48\n"+e.icon3VertexShader,e.text2FragmentShader),t.progLabel64=new g(i,"#define DSIZE 64\n"+e.icon3VertexShader,e.text2FragmentShader),t.progLabel96=new g(i,"#define DSIZE 96\n"+e.icon3VertexShader,e.text2FragmentShader),t.progLabel128=new g(i,"#define DSIZE 128\n"+e.icon3VertexShader,e.text2FragmentShader)},y.prototype.initProceduralShaders=function(){var e=m,t=this.renderer,i=this.gpu;t.progHmapPlane=new g(i,e.planeVertex4Shader,e.planeFragmentShader2),t.progHmapPlane2=new g(i,e.planeVertex4Shader,"#define grid\n"+e.planeFragmentShader2),t.progHmapPlane3=new g(i,e.planeVertex4Shader,"#define exmap\n"+e.planeFragmentShader2),t.progHmapPlane4=new g(i,e.planeVertex4Shader,"#define flat\n"+e.planeFragmentShader2),t.progHmapPlane5=new g(i,e.planeVertex4Shader,"#define normals\n"+e.planeFragmentShader2),t.progHmapPlane6=new g(i,e.planeVertex4Shader,"#define nmix\n#define normals\n"+e.planeFragmentShader2),t.progHmapPlane7=new g(i,e.planeVertex4Shader,"#define nmix\n"+e.planeFragmentShader2),t.progHmapPlane8=new g(i,e.planeVertex4Shader,"#define exmap\n#define classmap\n"+e.planeFragmentShader2)},y.prototype.initHeightmap=function(){var e=this.renderer,t=e.core.config.map16bitMeshes,i=this.gpu,r=c.buildHeightmap(5,!0);r=c.buildPlane(16,!0),e.planeMesh=new p(i,r,null,this.core,!0,t,!0),r=c.buildPlane(128,!0),e.planeMesh2=new p(i,r,null,this.core,!0,t,!0);for(var s=new Uint8Array(16384),a=0;a<64;a++)for(var n=0;n<64;n++){var o=4*(64*a+n);a<1||a>=63||n<1||n>=63?(s[o]=255,s[o+1]=255,s[o+2]=255):(s[o]=32,s[o+1]=32,s[o+2]=32),s[o+3]=255}e.heightmapTexture=new v(i),e.heightmapTexture.createFromData(64,64,s,"trilinear",!0)},y.prototype.initHitmap=function(){var e=this.renderer,t=e.hitmapSize,i=new Uint8Array(t*t*4);e.hitmapMode>2&&(e.hitmapData=i),e.hitmapTexture=new v(this.gpu),e.hitmapTexture.createFromData(t,t,i),e.hitmapTexture.createFramebuffer(t,t),e.geoHitmapTexture=new v(this.gpu),e.geoHitmapTexture.createFromData(t,t,i),e.geoHitmapTexture.createFramebuffer(t,t),e.geoHitmapTexture2=new v(this.gpu),e.geoHitmapTexture2.createFromData(t,t,i),e.geoHitmapTexture2.createFramebuffer(t,t)},y.prototype.initTestMap=function(){var e,t,i,r=this.renderer,s=this.gpu,a=new Uint8Array(1024);for(e=0;e<16;e++)for(t=0;t<16;t++)i=4*(16*e+t),a[i]=255,a[i+1]=0,a[i+2]=0,a[i+3]=255;for(r.redTexture=new v(s),r.redTexture.createFromData(16,16,a),a=new Uint8Array(1024),e=0;e<16;e++)for(t=0;t<16;t++)i=4*(16*e+t),a[i]=255,a[i+1]=255,a[i+2]=255,a[i+3]=255;for(r.whiteTexture=new v(s),r.whiteTexture.createFromData(16,16,a),a=new Uint8Array(1024),e=0;e<16;e++)for(t=0;t<16;t++)i=4*(16*e+t),a[i]=0,a[i+1]=0,a[i+2]=0,a[i+3]=255;r.blackTexture=new v(s),r.blackTexture.createFromData(16,16,a)},y.prototype.initTextMap=function(){this.renderer.textTexture2=new v(this.gpu,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAACACAMAAADTa0c4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFAAAA////pdmf3QAABIFJREFUeNrsnNuyqzAIhsP7v/Se6Yxra0L4OUVNCzetVqP5DAQItrVOiLg95739NnfOaR99RDj6esBw+CKZXiMK4PiuBkAcANoHAP3J5fzzAV2jePQIt6f4Ndb/MIChlVcCEFpAACZPfN4KUAF0/ufboDW3AuBMFgBwHTCfg2ftYgDUKBuA1ABuHKvA2P+5XdONIEt7BO2o2MdlAJoTQOsV6GEAswt0Zq/bsBhdeQQkqEDMwmIAnJHzA8i3ASkWRFKBbADyLGB3mlYD6DyhA4DfBlgsBDtirUPcBgC5woStYMgVtgKATWcB6DskKUEkGFLYrGw3+l3ydR16wKbbPDlWp4Xfo9vZwR1jtOMA6GkABrdvNmt1Vluy6pyvxu4Xt62fquyTggCTsIkCoIuv8gAA08w+ATBXAdSRY56xPDFPx/VPWFZp5v65kFMPgFjP70YASMfRsDn01xLPcwkRq1HLMoK647hR8v+nId74MQBjvIbUQePra42ZVXVcBCR3mIY89mYAlNGLflqA0V1seosCQNMg80B0bsLGAIDNwvFyiqu66ngVGGMGVBwyWwIwpty2DqEr/qf0Bq+DbjYkkcr4VUoOxiRjrYn3YY5SC4BQB/cF0Lq4kD1RCJ+tN4g6Jps5zfWu+QmSz9sUABkA0BIAXocmBwCJ99MDIASATkmtLQAIft4IgE/ZDStZ59yQbOQQAGZWYMbZ3FFCAGRHnwHQznegGAE+zwxNi8kALCOgS9tzAC4jYG1Qo0myRm0Ae/z8eleqewBoZLwfUswCsbT1KgBZD6QAzAEoXUe3K+xxVf2uLf5U3nBeMPRyACW/LtrwVX989id3PRQOG5Io6vh9XwC6stHIdGdJozun03lxNlwvH4u6UgDM8/LmJyx7ak12feEebaXmUwCOYJWk1JcYKsl74HL74wAaH93NqkE1FSKXc4cv0AjaPEEPgE4ru/ieWdvzVq/4psG3AYDFHlEAioQCuEgMgPjK1VDrqlkbTABAiQBGK38B0BlBSf9xtiAJQDM4NtDqMlaeyduTtkDjHgAtEQBj5ZGK2QE0aCcMAIxLSw0WVYlGDgOQXWE+afouAM0S398O4Nej3wIQf4cIHSfz9pbWugyep4MFIAFARvspbm8BcE2DOdvWnCJQAWFhJ/hKzh4AaB2A7NxedKmLPc+6PN4cL2S8GYC1QMIEQJvmFsJfxdvkEQAoLV4AogBS8/kNvdXlWe5GKhABvQUAZASDALJffY1XfsrToFXFbvYD1gBo6wC8LR7/uvj9CwHcfWuoUJItsVl5nwWAnhxxqsXatUq0OYCcaS/fkbK61u5H8jwAuUIEZXHNL1Jmub5oSKZWiDR9FttM4HEAigqRpn8TeB2AuWNiByAXSHCGbB7/3qYCfgCgPgADEEskbjCCaJDB/+kR6wP4P1Obl8jsBwDUB4yAxqKkthaATjX0KmCtDyCxm+yIMLjCbwBgrg94FYC3h8vLPPmfAVBSUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlJSUlLy9fJPgAEAvWMULbGsSjwAAAAASUVORK5CYII=",this.core,null,!0)},y.prototype.initImage=function(){var e=this.renderer,t=this.gpu.gl;e.rectVerticesBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e.rectVerticesBuffer);var i=[0,0,0,1,1,0,0,1,2,0,0,1,3,0,0,1];t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),e.rectVerticesBuffer.itemSize=4,e.rectVerticesBuffer.numItems=4,e.rectIndicesBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.rectIndicesBuffer);var r=[0,2,1,0,3,2];t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW),e.rectIndicesBuffer.itemSize=1,e.rectIndicesBuffer.numItems=6,e.textBuff16=new Float32Array(64),e.textBuff32=new Float32Array(128),e.textBuff48=new Float32Array(192),e.textBuff64=new Float32Array(256),e.textQuads16=this.generateTextQuads(16),e.textQuads32=this.generateTextQuads(32),e.textQuads48=this.generateTextQuads(48),e.textQuads64=this.generateTextQuads(64),e.textQuads96=this.generateTextQuads(96),e.textQuads128=this.generateTextQuads(128)},y.prototype.generateTextQuads=function(e){for(var t,i,r=(this.renderer,this.gpu.gl),s=new Float32Array(2*e*6),a=0;a<e;a++)t=6*a*2,i=0,s[t]=a,s[t+1]=i,i=1,s[t+2]=a,s[t+3]=i,i=2,s[t+4]=a,s[t+5]=i,i=2,s[t+6]=a,s[t+7]=i,i=3,s[t+8]=a,s[t+9]=i,i=0,s[t+10]=a,s[t+11]=i;var n=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,s,r.STATIC_DRAW),n.itemSize=2,n.numItems=6*e,n},y.prototype.initSkydome=function(){var e=this.renderer,t=e.core.config.map16bitMeshes,i=c.buildSkydome(32,64,t);e.skydomeMesh=new p(this.gpu,i,null,this.core,!0,t),i=c.buildSkydome(128,256,t,!0),e.atmoMesh=new p(this.gpu,i,null,this.core,!0,t)},y.prototype.initBBox=function(){var e=this.renderer,t=this.gpu;e.bboxMesh=new d(t),e.bboxMesh2=new d(t,!0)},y.prototype.initLines=function(){var e=this.gpu,t=this.renderer;t.plineBuffer=new Float32Array(96),t.plines=new f(e,this.core,!0,64,!0,8),t.plineJoints=new f(e,this.core,!1,64,!0,8),t.stencilLineState=e.createState({blend:!0,stencil:!0,culling:!1}),t.lineLabelState=e.createState({blend:!0,culling:!1,zequal:!0,zwrite:!1}),t.labelState=e.createState({blend:!0,culling:!1,zequal:!0}),t.stencilLineHitState=e.createState({blend:!1,stencil:!0,culling:!1}),t.lineLabelHitState=e.createState({blend:!1,culling:!1}),t.polygonB1S1C1tate=e.createState({blend:!0,stencil:!0,culling:!0,zequal:!0}),t.polygonB1S0C1tate=e.createState({blend:!0,stencil:!1,culling:!0,zequal:!0}),t.polygonB1S1C0tate=e.createState({blend:!0,stencil:!0,culling:!1,zequal:!0}),t.polygonB1S0C0tate=e.createState({blend:!0,stencil:!1,culling:!1,zequal:!0}),t.polygonB0S1C1tate=e.createState({blend:!1,stencil:!0,culling:!0,zequal:!0}),t.polygonB0S0C1tate=e.createState({blend:!1,stencil:!1,culling:!0,zequal:!0}),t.polygonB0S1C0tate=e.createState({blend:!1,stencil:!0,culling:!1,zequal:!0}),t.polygonB0S0C0tate=e.createState({blend:!1,stencil:!1,culling:!1,zequal:!0})},y.prototype.initBaricentricBuffer=function(){for(var e=this.gpu,t=new Array(196605),i=0;i<196605;i+=9)t[i]=1,t[i+1]=0,t[i+2]=0,t[i+3]=0,t[i+4]=1,t[i+5]=0,t[i+6]=0,t[i+7]=0,t[i+8]=1;var r=e.gl;e.barycentricBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,e.barycentricBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(t),r.STATIC_DRAW),e.barycentricBuffer.itemSize=3,e.barycentricBuffer.numItems=t.length/3},t.a=y},function(e,t,i){"use strict";var r=i(6),s=i(32),a=i(33),n=i(168),o=r.a,h=s.a,l=a.a,u=n.a,c=n.b,d=function(e){this.renderer=e,this.gpu=e.gpu};d.prototype.clear=function(e){return null!=e&&this.gpu.clear(e.clearDepth||!0,e.clearColor||!1,e.color||[255,255,255,255],null!=e.depth?e.depth:1),this},d.prototype.createState=function(e){if(null==e||"object"!=typeof e)return this;var t={blend:null!=e.blend&&e.blend,stencil:null!=e.stencil&&e.stencil,zoffset:null!=e.zoffset?e.zoffset:0,zwrite:null==e.zwrite||e.zwrite,ztest:null==e.ztest||e.ztest,zequal:null==e.zequal||e.zequal,culling:null==e.culling||e.culling};return this.gpu.createState(t)},d.prototype.setState=function(e){return null!=e&&this.gpu.setState(e),this},d.prototype.createTexture=function(e){if(null==e||"object"!=typeof e)return null;var t=e.source;if(null==t)return null;var i,r=e.filter||"linear",s=e.repeat||!1;if(t instanceof Uint8Array){var a=e.width,n=e.height;if(a&&n)return i=new o(this.gpu),i.createFromData(a,n,t,r,s),i}return t instanceof Image?(i=new o(this.gpu),i.createFromImage(t,r,s),i):null},d.prototype.removeTexture=function(e){return e&&e.kill(),this},d.prototype.createMesh=function(e){if(null==e||"object"!=typeof e)return null;var t={vertices:e.vertices,uvs:e.uvs,uvs2:e.normals,vertexSize:e.vertexSize,uvSize:e.uvSize,uv2Size:e.normalSize||3,vertexAttr:e.vertexAttr,uvAttr:e.uvAttr,uv2Attr:e.normalAttr,bbox:e.bbox};return new h(this.gpu,t,0,this.renderer.core)},d.prototype.removeMesh=function(e){return e&&e.kill(),this},d.prototype.createShader=function(e){if(null==e||"object"!=typeof e)return null;var t=e.vertexShader,i=e.fragmentShader;return null!=t&&i?new l(this.gpu,t,i):void 0},d.prototype.removeResource=function(e){return null!=e&&null!=e.kill&&e.kill(),this},d.prototype.addJob=function(){return this},d.prototype.clearJobs=function(){return this},d.prototype.drawMesh=function(e){if(null==e||"object"!=typeof e)return this;if(null==!e.mesh||!e.shaderVariables)return this;var t=e.vertex||"aPosition",i=e.uv||"aTexCoord",r=e.normal||"aNormal",s=null!=e.depthOffset?e.depthOffset:null,a=e.shaderVariables,n=e.shader||"textured",o=this.renderer,h=e.mesh,l=e.texture,u=o.camera.getModelviewMatrix(),c=o.camera.getProjectionMatrix(),d=o.fogDensity;if("string"==typeof n)switch(n){case"hit":a.uMV||(a.uMV=["mat4",u]),a.uProj||(a.uProj=["mat4",c]),i=null,r=null,l=null,n=o.progDepthTile;break;case"shaded":i=null;case"textured":case"textured-and-shaded":a.uMV||(a.uMV=["mat4",u]),a.uProj||(a.uProj=["mat4",c]),a.uFogDensity||(a.uFogDensity=["float",d]),r="textured"==n?null:"aNormal",n="textured"==n?o.progTile:"shaded"==n?o.progShadedTile:o.progTShadedTile}if(n&&n.isReady()){var p=[t];i&&p.push(i),r&&p.push(r),o.gpu.useProgram(n,p);for(var f in a){var g=a[f];if(2==g.length)switch(g[0]){case"floatArray":n.setFloatArray(f,g[1]);break;case"float":n.setFloat(f,g[1]);break;case"mat3":n.setMat3(f,g[1]);break;case"mat4":s&&"uProj"==f?n.setMat4(f,g[1],o.getZoffsetFactor(s)):n.setMat4(f,g[1]);break;case"vec2":n.setVec2(f,g[1]);break;case"vec3":n.setVec3(f,g[1]);break;case"vec4":n.setVec4(f,g[1]);break;case"sampler":n.setSampler(f,g[1])}}return l&&o.gpu.bindTexture(l),h.draw(n,t,i,r,null),this}},d.prototype.drawImage=function(e){if(null==e||"object"!=typeof e)return this;if(null==e.texture||null==e.rect)return this;var t=e.rect,i=e.color||[255,255,255,255],r=null!=e.depth?e.depth:0,s=null!=e.depthOffset?e.depthOffset:null,a=null!=e.depthTest&&e.depthTest,n=null!=e.blend&&e.blend,o=null!=e.writeDepth&&e.writeDepth,h=null!=e.useState&&e.useState;return i[0]*=1/255,i[1]*=1/255,i[2]*=1/255,i[3]*=1/255,this.renderer.draw.drawImage(t[0],t[1],t[2],t[3],e.texture,i,r,s,a,n,o,h),this},d.prototype.drawBillboard=function(e){if(null==e||"object"!=typeof e)return this;if(null==e.texture||null==e.mvp)return this;var t=e.mvp,i=e.color||[255,255,255,255],r=null!=e.depthOffset?e.depthOffset:null,s=null!=e.depthTest&&e.depthTest,a=null!=e.blend&&e.blend,n=null!=e.writeDepth&&e.writeDepth,o=null!=e.useState&&e.useState;return i[0]*=1/255,i[1]*=1/255,i[2]*=1/255,i[3]*=1/255,this.renderer.draw.drawBillboard(t,e.texture,i,r,s,a,n,o),this},d.prototype.drawLineString=function(e){if(null==e||"object"!=typeof e)return this;if(null==e.points)return this;var t=e.points,i=e.color||[255,255,255,255],r=null!=e.depthOffset?e.depthOffset:null,s=e.size||2,a=null==e.screenSpace||e.screenSpace,n=null!=e.depthTest&&e.depthTest,o=null!=e.blend&&e.blend,h=null!=e.writeDepth&&e.writeDepth,l=null!=e.useState&&e.useState;return i[0]*=1/255,i[1]*=1/255,i[2]*=1/255,i[3]*=1/255,this.renderer.draw.drawLineString(t,a,s,i,r,n,o,h,l),this},d.prototype.drawJobs=function(){return this},d.prototype.drawBBox=function(){return this},d.prototype.drawDebugText=function(e){if(null==e||"object"!=typeof e)return this;var t=e.text,i=e.coords;if(!t||!i)return this;var r=e.color||[255,255,255,255],s=e.size||16,a=e.depth,n=e.useState||!1;r[0]*=1/255,r[1]*=1/255,r[2]*=1/255,r[3]*=1/255;var o=this.renderer.draw.getTextSize(s,t);return this.renderer.draw.drawText(i[0]-.5*o,i[1],s,t,r,a,n),this},d.prototype.buildOctreeFromGeometry=function(e){var t=new u;return t.buildFromGeometry(e),t},d.prototype.raycastOctreeGeometry=function(e,t,i){var r=new c,s=[];return r.intersectOctree(t,i,e,s),r.intersectOctants(t,i,s)},d.prototype.saveScreenshot=function(e,t,i){return this.renderer.saveScreenshot(e,t,i)},d.prototype.getCanvasCoords=function(e,t){return this.renderer.project2(e,t)},d.prototype.getCanvasSize=function(){return this.renderer.curSize.slice()},d.prototype.setConfigParams=function(e){return this.renderer.setConfigParams(e),this},d.prototype.setConfigParam=function(e,t){return this.renderer.setConfigParam(e,t),this},d.prototype.getConfigParam=function(e){return this.renderer.getConfigParam(e)},d.prototype.getGLInterface=function(){return{canvas:this.gpu.canvas,gl:this.gpu.gl}},d.prototype.setSuperElevation=function(e,t,i,r){return this.renderer.setSuperElevation(e,t,i,r)},d.prototype.setMarginFlags=function(e){return this.renderer.marginFlags=e},d.prototype.getMarginFlags=function(){return this.renderer.marginFlags},t.a=d},function(e,t,i){"use strict";var r=i(1);i.d(t,"a",function(){return a}),i.d(t,"b",function(){return o});var s=r.b,a=function(){this.root=null,this.maxItemsPerNode=20,this.maxDepth=20,this.depthCount=[];for(var e=0;e<1e3;e++)this.depthCount[e]=0;this.pattern=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])]};a.prototype.clear=function(){},a.prototype.buildFromGeometry=function(e){if(e){var t,i,r,s,a,o,h,l,u,c,d,p,f,g,m,v,y,b,x;for(p=f=g=Number.POSITIVE_INFINITY,m=v=y=Number.NEGATIVE_INFINITY,t=0,i=e.length;t<i;t++)if(b=e[t],"mesh"==b.type)for(l=b.submeshes,r=0,s=l.length;r<s;r++)u=l[r],c=u.bbox,c[0][0]<p&&(p=c[0][0]),c[0][1]<f&&(f=c[0][1]),c[0][2]<g&&(g=c[0][2]),c[1][0]>m&&(m=c[1][0]),c[1][1]>v&&(v=c[1][1]),c[1][2]>y&&(y=c[1][2]);for(this.root=new n([p,f,g],[m,v,y]),t=0,i=e.length;t<i;t++)if(b=e[t],"mesh"==b.type)for(l=b.submeshes,r=0,s=l.length;r<s;r++)for(u=l[r],x=u.vertices,a=0,o=x.length;a<o;a+=9){for(p=f=g=Number.POSITIVE_INFINITY,m=v=y=Number.NEGATIVE_INFINITY,h=0;h<3;h++)d=a+3*h,x[d]<p&&(p=x[d]),x[d+1]<f&&(f=x[d+1]),x[d+2]<g&&(g=x[d+2]),x[d]>m&&(m=x[d]),x[d+1]>v&&(v=x[d+1]),x[d+2]>y&&(y=x[d+2]);this.root.add([p,f,g,m,v,y,x,a],this)}}};var n=function(e,t){this.min=e,this.max=t,this.children=null,this.items=null};n.prototype.add=function(e,t,i){if(this.children){i||(i=0);for(var r=0;r<8;r++){var s=this.children[r],a=s.min,n=s.max;e[0]<n[0]&&e[3]>a[0]&&e[1]<n[1]&&e[4]>a[1]&&e[2]<n[2]&&e[5]>a[2]&&s.add(e,t,i+1)}}else this.items||(this.items=[]),this.items.push(e),i<t.maxDepth&&this.items.length>=t.maxItemsPerNode&&this.split(t,i+1)},n.prototype.split=function(e,t){var i,r,s,a=this.min,o=this.max,h=[.5*(o[0]+a[0]),.5*(o[1]+a[1]),.5*(o[2]+a[2])];for(this.children=[null,null,null,null,null,null,null,null],this.depthCount[t]++,i=0;i<8;i++){var l=e.pattern[i];this.children[i]=new n([0===l[0]?a[0]:h[0],0===l[1]?a[1]:h[1],0===l[2]?a[2]:h[2]],[0===l[0]?h[0]:o[0],0===l[1]?h[1]:o[1],0===l[2]?h[2]:o[2]])}var u=this.items;if(u)for(i=0,r=u.length;i<r;i++){var c=u[i];for(s=0;s<8;s++){var d=this.children[s];a=d.min,o=d.max,c[0]<o[0]&&c[3]>a[0]&&c[1]<o[1]&&c[4]>a[1]&&c[2]<o[2]&&c[5]>a[2]&&d.add(c,e)}}this.items=null};var o=function(){this.octantTable=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],this.flags=0};o.prototype.findEntryOctant=function(e,t,i,r,s,a){var n=0;return e>t&&e>i?(s<e&&(n|=2),a<e&&(n|=1)):t>i?(r<t&&(n|=4),a<t&&(n|=1)):(r<i&&(n|=4),s<i&&(n|=2)),n},o.prototype.findNextOctant=function(e,t,i,r){var s,a=0;return t<i?(s=t,a=0):(s=i,a=1),r<s&&(a=2),this.octantTable[e][a]},o.prototype.raycastOctant=function(e,t,i,r,s,a,n,o){var h,l,u,c,d=e.children;if(s>=0&&a>=0&&n>=0)if(d){l=.5*(t+s),u=.5*(i+a),c=.5*(r+n),h=this.findEntryOctant(t,i,r,l,u,c);do{switch(h){case 0:this.raycastOctant(d[this.flags],t,i,r,l,u,c,o),h=this.findNextOctant(h,l,u,c);break;case 1:this.raycastOctant(d[1^this.flags],t,i,c,l,u,n,o),h=this.findNextOctant(h,l,u,n);break;case 2:this.raycastOctant(d[2^this.flags],t,u,r,l,a,c,o),h=this.findNextOctant(h,l,a,c);break;case 3:this.raycastOctant(d[3^this.flags],t,u,c,l,a,n,o),h=this.findNextOctant(h,l,a,n);break;case 4:this.raycastOctant(d[4^this.flags],l,i,r,s,u,c,o),h=this.findNextOctant(h,s,u,c);break;case 5:this.raycastOctant(d[5^this.flags],l,i,c,s,u,n,o),h=this.findNextOctant(h,s,u,n);break;case 6:this.raycastOctant(d[6^this.flags],l,u,r,s,a,c,o),h=this.findNextOctant(h,s,a,c);break;case 7:this.raycastOctant(d[7^this.flags],l,u,c,s,a,n,o),h=8}}while(h<8)}else e.items&&o.push(e)},o.prototype.hitFace=function(e,t,i,r){var a,n,o,h,l,u=[r[i],r[i+1],r[i+2]],c=[r[i+3],r[i+4],r[i+5]],d=[r[i+6],r[i+7],r[i+8]],p=[0,0,0],f=[0,0,0],g=[c[0]-u[0],c[1]-u[1],c[2]-u[2]],m=[d[0]-u[0],d[1]-u[1],d[2]-u[2]];return s.cross(t,m,p),(n=s.dot(g,p))>-1e-7&&n<1e-7?[!1]:(o=1/n,a=[e[0]-u[0],e[1]-u[1],e[2]-u[2]],(h=o*s.dot(a,p))<0||h>1?[!1]:(f=s.cross(a,g),(l=o*s.dot(t,f))<0||h+l>1?[!1]:[!0,o*s.dot(m,f)]))},o.prototype.intersectOctree=function(e,t,i,r){var s,a,n,o,h,l,u,c,d,p=[0,0,0],f=[i.root.max[0]-i.root.min[0],i.root.max[1]-i.root.min[1],i.root.max[2]-i.root.min[2]],g=[f[0],f[1],f[2]],m=[.5*g[0],.5*g[1],.5*g[2]],v=[e[0],e[1],e[2]],y=[t[0],t[1],t[2]],b=[.5*(i.root.max[0]+i.root.min[0]),.5*(i.root.max[1]+i.root.min[1]),.5*(i.root.max[2]+i.root.min[2])];v[0]=v[0]-b[0]+m[0],v[1]=v[1]-b[1]+m[1],v[2]=v[2]-b[2]+m[2],this.flags=0,y[0]<0&&(v[0]=g[0]-v[0],y[0]=-y[0],this.flags|=4),y[1]<0&&(v[1]=g[1]-v[1],y[1]=-y[1],this.flags|=2),y[2]<0&&(v[2]=g[2]-v[2],y[2]=-y[2],this.flags|=1),s=1/y[0],a=1/y[1],n=1/y[2],o=(p[0]-v[0])*s,h=(f[0]-v[0])*s,l=(p[1]-v[1])*a,u=(f[1]-v[1])*a,c=(p[2]-v[2])*n,d=(f[2]-v[2])*n,Math.max(Math.max(o,l),c)<Math.min(Math.min(h,u),d)&&this.raycastOctant(i.root,o,l,c,h,u,d,r)},o.prototype.intersectOctants=function(e,t,i){for(var r=[],s=Number.POSITIVE_INFINITY,a=0,n=i.length;a<n;a++)for(var o=i[a].items,h=0,l=o.length;h<l;h++){var u=o[h],c=this.hitFace(e,t,u[7],u[6]);c[0]&&c[1]<s&&(s=c[1])}return s!==Number.POSITIVE_INFINITY&&(r=[s]),r}},function(e,t,i){"use strict";var r=i(1),s=i(163),a=i(6),n=i(60),o=i(158),h=i(166),l=i(159),u=i(170),c=r.b,d=r.e,p=s.a,f=a.a,g=n.a,m=o.a,v=h.a,y=l.a,b=u.a,x=function(e,t,i,r,s){this.config=s||{},this.core=e,this.marginFlags=0,this.progTile=null,this.progHeightmap=null,this.progSkydome=null,this.progWireframeTile=null,this.progWireframeTile2=null,this.progText=null,this.div=t,this.onUpdate=i,this.killed=!1,this.onlyDepth=!1,this.onlyLayers=!1,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1,this.hitmapCounter=0,this.geoRenderCounter=0,this.geoHitmapCounter=0,this.frameTime=0,this.geometries={},this.clearStencilPasses=[],this.onResizeCall=r,this.stencilLineState=null,this.drawLabelBoxes=!1,this.drawGridCells=!1,this.drawAllLabels=!1,this.debug={},this.mapHack=null,this.geodataSelection=[],this.hoverFeatureCounter=0,this.hoverFeatureList=[],this.touchSurfaceEvent=[];var a=this.div.getBoundingClientRect();this.winSize=[a.width,a.height],this.curSize=[a.width,a.height],this.oldSize=[a.width,a.height],this.dirty=!0,this.cameraVector=[0,1,0],this.viewExtent=1,this.gpu=new p(this,t,this.curSize,this.config.rendererAllowScreenshots,this.config.rendererAntialiasing,this.config.rendererAnisotropic),this.camera=new m(this,45,2,12e5),this.drawTileMatrix=d.create(),this.drawTileMatrix2=d.create(),this.drawTileVec=[0,0,0],this.drawTileWorldMatrix=d.create(),this.pixelTileSizeMatrix=d.create(),this.heightmapMesh=null,this.heightmapTexture=null,this.skydomeMesh=null,this.skydomeTexture=null,this.hitmapTexture=null,this.geoHitmapTexture=null,this.hitmapSize=this.config.mapDMapSize,this.hitmapMode=this.config.mapDMapMode,this.updateHitmap=!0,this.updateGeoHitmap=!0,this.redTexture=null,this.rectVerticesBuffer=null,this.rectIndicesBuffer=null,this.imageProjectionMatrix=null,this.font=null,this.fonts={},this.fogDensity=0,this.gmap=new Array(2048),this.gmap2=new Array(2048),this.gmap3=new Array(1e4),this.gmap3Size=new Array(1e4),this.gmap4=new Array(1e4),this.gmapIndex=0,this.gmapTop=new Array(512),this.gmapHit=new Array(512),this.gmapStore=new Array(512),this.fmaxDist=0,this.fminDist=0,this.jobZBuffer=new Array(512),this.jobZBufferSize=new Array(512),this.jobZBuffer2=new Array(512),this.jobZBuffer2Size=new Array(512),this.jobHBuffer={},this.jobHBufferSize=0,this.jobHSortBuffer=new Array(2048);for(var n=0,o=this.jobZBuffer.length;n<o;n++)this.jobZBuffer[n]=[],this.jobZBufferSize[n]=0,this.jobZBuffer2[n]={},this.jobZBuffer2Size[n]=0;for(n=0,o=this.gmap3.length;n<o;n++)this.gmap3[n]=[],this.gmap3Size[n]=0;this.radixCountBuffer16=new Uint16Array(1024),this.radixCountBuffer32=new Uint32Array(1024),this.buffFloat32=new Float32Array(1),this.buffUint32=new Uint32Array(this.buffFloat32.buffer),this.layerGroupVisible=[],this.bitmaps={},this.cameraPosition=[0,0,0],this.cameraOrientation=[0,0,0],this.cameraTiltFator=1,this.cameraViewExtent=1,this.distanceFactor=1,this.tiltFactor=1,this.localViewExtentFactor=1,this.cameraVector=[0,0,0],this.labelVector=[0,0,0],this.drawnGeodataTiles=0,this.drawnGeodataTilesFactor=0,this.drawnGeodataTilesUsed=!1,this.progMap={},this.gridHmax=0,this.gridHmin=0,this.seCounter=0,this.updateCameraMatrix=d.create(),this.seTmpVec=[0,0,0],this.seTmpVec2=[0,0,0],this.seTmpVec3=[0,0,0],this.lastHitPosition=[0,0,100],this.logTilePos=null,this.setSuperElevation(0,2,4e3,1.5),window.addEventListener("resize",this.onResize.bind(this),!1),this.gpu.init(),this.init=new v(this),this.rmap=new b(this,50),this.draw=new y(this);this.resizeGL(Math.floor(1*this.curSize[0]),Math.floor(1*this.curSize[1]))};x.prototype.initProceduralShaders=function(){this.init.initProceduralShaders()},x.prototype.onResize=function(){if(!this.killed){var e=this.div.getBoundingClientRect();this.resizeGL(Math.floor(e.width),Math.floor(e.height)),this.onResizeCall&&this.onResizeCall()}},x.prototype.kill=function(){this.killed||(this.killed=!0,this.heightmapMesh&&this.heightmapMesh.kill(),this.heightmapTexture&&this.heightmapTexture.kill(),this.skydomeMesh&&this.skydomeMesh.kill(),this.skydomeTexture&&this.skydomeTexture.kill(),this.hitmapTexture&&this.hitmapTexture.kill(),this.geoHitmapTexture&&this.geoHitmapTexture.kill(),this.redTexture&&this.redTexture.kill(),this.whiteTexture&&this.whiteTexture.kill(),this.blackTexture&&this.blackTexture.kill(),this.lineTexture&&this.lineTexture.kill(),this.textTexture2&&this.textTexture2.kill(),this.atmoMesh&&this.atmoMesh.kill(),this.bboxMesh&&this.bboxMesh.kill(),this.font&&this.font.kill(),this.plines&&this.plines.kill(),this.plineJoints&&this.plineJoints.kill(),this.gpu.kill())},x.prototype.resizeGL=function(e,t,i,r){this.camera.setAspect(e/t),this.curSize=[e,t],this.oldSize=[e,t],this.gpu.resize(this.curSize,i);var s=new Float32Array(16);s[0]=2/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2/t,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=.5*-e*s[0],s[13]=.5*-t*s[5],s[14]=0,s[15]=1,this.imageProjectionMatrix=s},x.prototype.project2=function(e,t,i,r){var s=[0,0,0,1];if(s=i?d.multiplyVec4(t,[e[0]-i[0],e[1]-i[1],e[2]-i[2],1]):d.multiplyVec4(t,[e[0],e[1],e[2],1]),0!=s[3]){var a=[0,0,0];return a[0]=.5*(s[0]/s[3]+1)*this.curSize[0],a[1]=.5*(-s[1]/s[3]+1)*this.curSize[1],a[2]=s[2]/s[3],r&&(a[3]=s[2]),a}return[0,0,0]},x.prototype.setSuperElevationState=function(e){this.useSuperElevation!=e&&(this.useSuperElevation=e,this.seCounter++)},x.prototype.getSuperElevationState=function(){return this.useSuperElevation},x.prototype.setSuperElevation=function(e,t,i,r){if(1==t&&1==r)return 0!=this.useSuperElevation&&(this.useSuperElevation=!1,this.seCounter++),e==i&&(i=e+1),void(this.superElevation=[e,t,i,r,i-e,r-t,1/(i-e)]);e==i&&(i=e+1),this.superElevation=[e,t,i,r,i-e,r-t,1/(i-e)],this.seCounter++},x.prototype.getSuperElevation=function(){return this.superElevation.slice()},x.prototype.getSuperElevatedHeight=function(e){var t=this.superElevation,i=e;return i<t[0]&&(i=t[0]),i>t[2]&&(i=t[2]),e*(t[1]+(i-t[0])*t[6]*t[5])},x.prototype.getUnsuperElevatedHeight=function(e){var t=this.superElevation,i=e;if(t[1]==t[3])return i/t[1];if(i<=t[0]*t[1])return i/t[1];if(i>=t[2]*t[3])return i/t[3];var r=t[0],s=t[1],a=t[2],n=t[3];return-(Math.sqrt(-2*n*(s*r*a+2*r*i-2*a*i)+s*(s*a*a+4*r*i-4*a*i)+n*n*r*r)-s*a+n*r)/(2*(s-n))},x.prototype.getEllipsoidHeight=function(e,t){var i,r;return this.seTmpVec3=[0,0,0],t?(i=this.seTmpVec,r=[e[0]+t[0],e[1]+t[1],(e[2]+t[2])*this.earthERatio]):(i=e,r=[i[0],i[1],i[2]*this.earthERatio]),Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])-this.earthRadius},x.prototype.transformPointBySE=function(e,t){var i,r=e;this.seTmpVec3=[0,0,0],i=t?[e[0]+t[0],e[1]+t[1],(e[2]+t[2])*this.earthERatio]:[r[0],r[1],r[2]*this.earthERatio];var s=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),a=this.seTmpVec2,n=1/(s+1e-4);a[0]=i[0]*n,a[1]=i[1]*n,a[2]=i[2]*n;var o=s-this.earthRadius;return n=this.getSuperElevatedHeight(o)-o,i[0]=r[0]+a[0]*n,i[1]=r[1]+a[1]*n,i[2]=r[2]+a[2]*n,i},x.prototype.transformPointBySE2=function(e,t){var i,r=e;this.seTmpVec3=[0,0,0],i=t?[e[0]+t[0],e[1]+t[1],(e[2]+t[2])*this.earthERatio]:[r[0],r[1],r[2]*this.earthERatio];var s=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),a=this.seTmpVec2,n=1/(s+1e-4);a[0]=i[0]*n,a[1]=i[1]*n,a[2]=i[2]*n;var o=s-this.earthRadius;return n=this.getSuperElevatedHeight(o)-o,e=e.slice(),e[0]=r[0]+a[0]*n,e[1]=r[1]+a[1]*n,e[2]=r[2]+a[2]*n,e[13]=a[0]*n,e[14]=a[1]*n,e[15]=a[2]*n,e},x.prototype.project=function(e){var t=this.camera.getMvpMatrix(),i=this.camera.getPosition(),r=this.cameraPosition(),s=[e[0]-r[0]+i[0],e[1]-r[1]+i[1],e[2]-r[2]+i[2],1],a=[0,0,0,1];if(a=d.multiplyVec4(t,s),0!=a[3]){var n=[0,0,0];return n[0]=.5*(a[0]/a[3]+1)*this.curSize[0],n[1]=.5*(-a[1]/a[3]+1)*this.curSize[1],n[2]=a[2]/a[3],n}return[0,0,0]},x.prototype.getScreenRay=function(e,t){if(null==this.camera)return[0,0,1];this.camera.dirty=!0;var i=2*e/this.curSize[0]-1,r=1-2*t/this.curSize[1],s=[i,r,1],a=[s[0],s[1],-1,1],n=d.create();n=d.inverse(this.camera.getProjectionMatrix());var o=[0,0,0,0];d.multiplyVec4(n,a,o),o[2]=-1,o[3]=0;var h=d.create();h=d.inverse(this.camera.getModelviewMatrix());var l=[0,0,0,0];return d.multiplyVec4(h,o,l),l=c.normalize([l[0],l[1],l[2]])},x.prototype.hitTestGeoLayers=function(e,t,i){var r,s=(this.gpu.gl,!1);if(e>=0&&e<this.curSize[0]&&t>=0&&t<this.curSize[1]){var a=0,n=0;a=Math.floor(e*(this.hitmapSize/this.curSize[0])),n=Math.floor(t*(this.hitmapSize/this.curSize[1])),r=i?this.geoHitmapTexture2.readFramebufferPixels(a,this.hitmapSize-n-1,1,1):this.geoHitmapTexture.readFramebufferPixels(a,this.hitmapSize-n-1,1,1),s=!(255==r[0]&&255==r[1]&&255==r[2]&&255==r[3])}return s?[!0,r[0],r[1],r[2],r[3]]:[!1,0,0,0,0]},x.prototype.switchToFramebuffer=function(e,t){var i,r,s,a=this.gpu.gl;switch(e){case"base":r=this.oldSize[0],s=this.oldSize[1],a.clearColor(0,0,0,1),a.viewport(0,0,r,s),this.gpu.setFramebuffer(null),this.camera.setAspect(r/s),this.curSize=[r,s],this.gpu.resize(this.curSize,!0),this.camera.update(),this.onlyDepth=!1,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1;break;case"depth":this.gpu.setFramebuffer(this.hitmapTexture),this.oldSize=[this.curSize[0],this.curSize[1]],a.clearColor(1,1,1,1),a.enable(a.DEPTH_TEST),i=this.hitmapSize,a.viewport(0,0,i,i),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.curSize=[i,i],this.camera.update(),this.onlyDepth=!0,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1;break;case"geo":case"geo2":this.hoverFeatureCounter=0,i=this.hitmapSize,this.gpu.setFramebuffer("geo"==e?this.geoHitmapTexture:this.geoHitmapTexture2),r=i,s=i,a.clearColor(1,1,1,1),a.enable(a.DEPTH_TEST),a.viewport(0,0,i,i),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.curSize=[r,s],this.onlyHitLayers=!0,this.advancedPassNeeded=!1,this.onlyAdvancedHitLayers="geo2"==e,this.camera.update();break;case"texture":this.gpu.setFramebuffer(t),this.oldSize=[this.curSize[0],this.curSize[1]],a.clearColor(0,0,0,1),a.enable(a.DEPTH_TEST),a.viewport(0,0,this.gpu.canvas.width,this.gpu.canvas.height),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.curSize=[this.gpu.canvas.width,this.gpu.canvas.height],this.camera.update(),this.onlyDepth=!1,this.onlyHitLayers=!1,this.onlyAdvancedHitLayers=!1,this.advancedPassNeeded=!1}},x.prototype.hitTest=function(e,t){var i=(this.gpu.gl,this.getScreenRay(e,t)),r=this.camera.getPosition(),s=0,a=0;s=Math.floor(e*(this.hitmapSize/this.curSize[0])),a=Math.floor(t*(this.hitmapSize/this.curSize[1]));var n=this.hitmapTexture.readFramebufferPixels(s,this.hitmapSize-a-1,1,1),o=n[0]*(1/255)+n[1]+255*n[2]+65025*n[3],h=!(255==n[0]&&255==n[1]&&255==n[2]&&255==n[3]);return this.lastHitPosition=[r[0]+i[0]*o,r[1]+i[1]*o,r[2]+i[2]*o],[this.lastHitPosition[0],this.lastHitPosition[1],this.lastHitPosition[2],h,i,o,r]},x.prototype.copyHitmap=function(){this.hitmapTexture.readFramebufferPixels(0,0,this.hitmapSize,this.hitmapSize,!1,this.hitmapData)},x.prototype.getDepth=function(e,t){var i=Math.floor(e*(this.hitmapSize/this.curSize[0])),r=Math.floor(t*(this.hitmapSize/this.curSize[1]));if(this.hitmapMode<=2)var s=this.hitmapTexture.readFramebufferPixels(i,this.hitmapSize-r-1,1,1,2==this.hitmapMode),a=s[0]*(1/255)+s[1]+255*s[2]+65025*s[3],n=!(255==s[0]&&255==s[1]&&255==s[2]&&255==s[3]);else var o=this.hitmapData,h=4*(i+(this.hitmapSize-r-1)*this.hitmapSize),l=o[h],u=o[h+1],c=o[h+2],d=o[h+3],a=l*(1/255)+u+255*c+65025*d,n=!(255==l&&255==u&&255==c&&255==d);return[n,a]},x.prototype.getZoffsetFactor=function(e){return 1e-4*(e[0]+e[1]*this.distanceFactor+e[2]*this.tiltFactor)},x.prototype.saveScreenshot=function(e,t,i){var r=this.gpu.gl,s=this.curSize[0],a=this.curSize[1],n=new Uint8Array(s*a*4);r.readPixels(0,0,s,a,r.RGBA,r.UNSIGNED_BYTE,n);for(var o=new Uint8Array(s*a*4),h=0,l=0;l<a;l++)for(var u=(a-1-l)*s*4,c=0;c<s;c++)o[h]=n[u],o[h+1]=n[u+1],o[h+2]=n[u+2],o[h+3]=n[u+3],h+=4,u+=4;var d=document.createElement("canvas");d.width=s,d.height=a;var p=d.getContext("2d"),f=p.createImageData(s,a);if(f.data.set(o),p.putImageData(f,0,0),i=i||"jpg","file"==e){for(var g=document.createElement("a"),m=d.toDataURL("image/"+i),v=atob(m.split(",")[1]),y=new ArrayBuffer(v.length),b=new Uint8Array(y),x=0;x<v.length;x++)b[x]=v.charCodeAt(x);var w=new Blob([y],{type:i}),S=URL.createObjectURL(w);g.href=S,g.download=t,document.body.appendChild(g),g.click(),setTimeout(function(){document.body.removeChild(g),window.URL.revokeObjectURL(S)},0)}return"tab"==e&&window.open(d.toDataURL("image/"+i)),f},x.prototype.getBitmap=function(e,t,i,r,s){var a=(s?r:e)+"*"+t+"*"+i,n=this.bitmaps[a];return!n&&e&&(n=new f(this.gpu,e,this.core,null,null,i,t),this.bitmaps[a]=n),n},x.prototype.getFont=function(e){var t=this.fonts[e];return t||(t=new g(this.gpu,this.core,null,null,e),this.fonts[e]=t),t},t.a=x},function(e,t,i){"use strict";var r=i(1),s=r.b,a=function(e,t,i){this.renderer=e,this.drawAllLabels=!1,this.maxBlockRectangles=i||500,this.blockSize=t,this.blockSizeFactor=1/t,this.blocks=[],this.blocks2=[],this.blocksRCount=[],this.blocks2RCount=[],this.allocatedBlocks=0,this.lx=1,this.ly=1,this.counter=0,this.rectangles=null,this.rectanglesCount=0,this.rectangles2=null,this.rectangles2Count=0,this.rectanglesR=null,this.rectanglesRCount=0,this.benevolentMargins=!1,this.positionsBuffer=new Float64Array(1024)};a.prototype.clear=function(){var e=this.renderer;this.sx2=e.curSize[0],this.sy2=e.curSize[1],this.sy2=Math.max(1,this.sy2-55),this.sy1=1,this.sx1=1,this.cx2=135,this.cy1=e.curSize[1]-145,this.bx2=245,this.by2=45,this.lx=Math.floor(e.curSize[0]*this.blockSizeFactor)+1,this.ly=Math.floor(e.curSize[1]*this.blockSizeFactor)+1,4096&e.marginFlags&&(this.sx1=Math.min(34,this.sx2),this.sx2=Math.max(1,e.curSize[0]-34),this.sy1=Math.min(50,this.sy2),this.sy2=Math.max(1,e.curSize[1]-68));var t=this.ly*this.lx;if(this.rectangles||(this.rectangles=new Array(t*this.maxBlockRectangles*6)),this.rectangles2||(this.rectangles2=new Array(t*this.maxBlockRectangles*6)),this.rectanglesR||(this.rectanglesR=new Array(t*this.maxBlockRectangles*6)),this.rectanglesCount>0||this.allocatedBlocks!=t)for(var i=0;i<t;i++)this.blocks[i]||(this.blocks[i]=[]),this.blocksRCount[i]=0;if(this.rectangles2Count>0||this.allocatedBlocks!=t)for(var i=0;i<t;i++)this.blocks2[i]||(this.blocks2[i]=[]),this.blocks2RCount[i]=0;this.allocatedBlocks=t,this.drawAllLabels=e.debug.drawAllLabels,this.benevolentMargins=e.benevolentMargins,this.rectanglesCount=0,this.rectangles2Count=0,this.rectanglesRCount=0,this.counter=e.geoRenderCounter},a.prototype.storeRemovedRectangle=function(e,t,i,r,s,a){var n=this.rectanglesR,o=this.rectanglesRCount;n[o]=e,n[o+1]=t,n[o+2]=i,n[o+3]=r,n[o+4]=s,n[o+5]=a,this.rectanglesRCount+=6},a.prototype.circleAABBoxCollide=function(e,t,i,r,s,a,n){var o=.5*(i-e),h=.5*(r-t),l=Math.abs(s-e-o),u=Math.abs(a-r-h);if(l>o+n||u>h+n)return!1;if(l<=o||u<=h)return!0;var c=l-o,d=u-h;return c*c+d*d<=n*n},a.prototype.lineAABBoxCollide=function(e,t,i,r,s,a,n,o){var h=1/(n!=s?n-s:1e-5),l=(e-s)*h,u=(i-s)*h,c=Math.min(l,u),d=Math.max(l,u),p=1/(o!=a?o-a:1e-5),f=(t-a)*p,g=(r-a)*p;return c=Math.max(c,Math.min(f,g)),(d=Math.min(d,Math.max(f,g)))>=c},a.prototype.checkRectangle=function(e,t,i,r,s){var a;return e>i&&(a=e,e=i,i=a),t>r&&(a=t,t=r,r=a),s+=r,this.benevolentMargins?!(i<this.sx1||e>this.sx2||s<this.sy1||t>this.sy2):!(e<this.sx1||i>this.sx2||t<this.sy1||s>this.sy2)&&(!(1&this.renderer.marginFlags&&e<this.cx2&&i>0&&t<=this.sx2&&s>this.cy1)&&!(2&this.renderer.marginFlags&&e<this.bx2&&i>0&&t<=this.by2&&s>0))},a.prototype.addRectangle=function(e,t,i,r,s,a,n,o){var h,l,u,c,d,p,f,g,m=this.renderer;if(this.drawAllLabels)return!0;e>i&&(g=e,e=i,i=g),t>r&&(g=t,t=r,r=g);var v=r+a[1];if(this.benevolentMargins){if(i<this.sx1||e>this.sx2||v<this.sy1||t>this.sy2)return!1}else{if(e<this.sx1||i>this.sx2||t<this.sy1||v>this.sy2)return!1;if(1&m.marginFlags&&e<this.cx2&&i>0&&t<=this.sx2&&v>this.cy1)return!1;if(2&m.marginFlags&&e<this.bx2&&i>0&&t<=this.by2&&v>0)return!1}var y=Math.floor(e*this.blockSizeFactor),b=Math.floor(t*this.blockSizeFactor),x=Math.floor(i*this.blockSizeFactor),w=Math.floor(r*this.blockSizeFactor);if(x<0||w<0||y>=this.lx||b>=this.ly)return!1;y<0&&(y=0),x>=this.lx&&(x=this.lx-1),b<0&&(b=0),w>=this.ly&&(w=this.ly-1);var S=x-y+1,M=w-b+1,A={},C=m.config.mapFeaturesSortByTop,T=this.rectangles,P=this.rectangles2;for(l=0;l<M;l++)for(h=0;h<S;h++){for(c=(b+l)*this.lx+(y+h),d=this.blocks[c],p=this.blocksRCount[c],u=0;u<p;u++)if(f=d[u],e<T[f+2]&&i>T[f+0]&&t<T[f+3]&&r>T[f+1]){if(n)return!1;if(C){if(s<T[f+4])return!1}else if(s>T[f+4])return!1;A[f]=!0}if(p+1>=this.maxBlockRectangles)return!1;for(d=this.blocks2[c],p=this.blocks2RCount[c],u=0;u<p;u++)if(f=d[u],this.circleAABBoxCollide(e,t,i,r,P[f+0],P[f+1],T[f+3]))return!1}for(var F in A)this.removeRectangle(parseInt(F));if(o){var L=o[2],E=m.mapHack.getScreenDepth(o[0],o[1],L[4]>1e7);if(E[0]){var k=E[1]-L[4];if(L[7]=k,!m.drawHiddenLabels&&k<o[3])return!1}}for(f=this.rectanglesCount,T[f]=e,T[f+1]=t,T[f+2]=i,T[f+3]=r,T[f+4]=s,T[f+5]=a,this.rectanglesCount+=6,l=0;l<M;l++)for(h=0;h<S;h++)c=(b+l)*this.lx+(y+h),this.blocks[c][this.blocksRCount[c]]=f,this.blocksRCount[c]++;return!0},a.prototype.addLineLabel=function(e,t){var i,r,a,n,o,h,l,u,c,d,p=e[0],f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,y=0,b=this.renderer,x=[0,0,0,0],w=this.positionsBuffer,S=0,M=0,A=p.noOverlap?p.noOverlap[0]:1,C=.5*p.labelSize,T=.5*b.camera.scaleFactor2(e[5][3])*b.curSize[1]*(b.curSize[0]/b.curSize[1]),P=e[9],F=p.labelPoints,L=p.labelIndex,E=0;if(!((d=F.length)<=1||F[d-1][0]*T<C)){for(d--,c=0;c<d;c++){var k=F[c+1][0]*T;if(k>C){var N=F[c][0]*T;L=c,E=(C-N)/(k-N);break}}var B,I,R,P=s.dot(F[L][1],b.labelVector)>=0?3:2,U=F[L][P],D=F[L+1]?F[L+1][P]:U,z=this.benevolentMargins;if(b.useSuperElevation)if(R=p.labelPointsBuffer,R.id!=1024*L+P){R.id=1024*L+P,R.points.length!=U.length&&(R.points=new Array(U.length),R.points2=new Array(U.length));var _=R.points,G=R.points2;for(c=0,d=U.length;c<d;c++)_[c]=b.transformPointBySE2(U[c]),G[c]=b.transformPointBySE2(D[c]);U=_,D=G}else U=R.points,D=R.points2;for(c=0,d=U.length;c<d;c++)B=U[c],I=D[c],x[0]=B[0]+(I[0]-B[0])*E,x[1]=B[1]+(I[1]-B[1])*E,x[2]=B[2]+(I[2]-B[2])*E,h=(B[3]+(I[3]-B[3])*E)*T*A,x=b.project2(x,b.camera.mvp,b.cameraPosition,!0),x[0]>g&&(g=x[0]),x[1]>v&&(v=x[1]),x[0]<f&&(f=x[0]),x[1]<m&&(m=x[1]),w[M]=x[0],w[M+1]=x[1],w[M+2]=x[2],w[M+3]=h,h>y&&(y=h),M+=4;if(f-=y,g+=y,m-=y,v+=y,z){if(g<this.sx1||f>this.sx2||v<this.sy1||m>this.sy2)return!1}else{if(f<this.sx1||g>this.sx2||m<this.sy1||v>this.sy2)return!1;if(1&b.marginFlags&&f<this.cx2&&g>0&&m<=this.sx2&&v>this.cy1)return!1;if(2&b.marginFlags&&f<this.bx2&&g>0&&m<=this.by2&&v>0)return!1}var V,O,j,H,Y,q,J,Z=this.blockSizeFactor,X=this.lx,W=this.ly,Q=(b.config.mapFeaturesSortByTop,this.rectangles),K=this.rectangles2;for(M=0,c=0,d=U.length;c<d;c++){if(l=w[M],u=w[M+1],h=w[M+3],V=Math.floor((l-h)*Z),O=Math.floor((u-h)*Z),j=Math.floor((l+h)*Z),H=Math.floor((u+h)*Z),z){if(j<0||V>=X||H<0||O>=W){M+=4;continue}V<0&&(V=0),O<0&&(O=0),j>=X&&(j=X-1),H>=W&&(H=W-1)}var $=j-V+1,ee=H-O+1;for(o=0;o<ee;o++)for(n=0;n<$;n++){for(S=(O+o)*X+(V+n),i=this.blocks[S],r=this.blocksRCount[S],J=0;J<r;J++)if(a=i[J],this.circleAABBoxCollide(f,m,g,v,Q[a+0],Q[a+1],Q[a+2]))return!1;for(i=this.blocks2[S],r=this.blocks2RCount[S],J=0;J<r;J++)if(a=i[J],Y=l-K[a+0],q=u-K[a+1],y=K[a+2]+h,Y*Y+q*q<y*y)return!1}M+=4}for(M=0,c=0,d=U.length;c<d;c++){if(l=w[M],u=w[M+1],h=w[M+3],V=Math.floor((l-h)*Z),O=Math.floor((u-h)*Z),j=Math.floor((l+h)*Z),H=Math.floor((u+h)*Z),z){if(j<0||V>=X||H<0||O>=W){M+=4;continue}V<0&&(V=0),O<0&&(O=0),j>=X&&(j=X-1),H>=W&&(H=W-1)}var $=j-V+1,ee=H-O+1;for(a=this.rectangles2Count,K[a]=l,K[a+1]=u,K[a+2]=h,K[a+3]=e,this.rectangles2Count+=4,o=0;o<ee;o++)for(n=0;n<$;n++)S=(O+o)*this.lx+(V+n),this.blocks2[S][this.blocks2RCount[S]]=a,this.blocks2RCount[S]++;M+=4}return!0}},a.prototype.removeRectangle=function(e){var t,i,r,s,a,n,o,h,l,u,c=this.rectangles;t=c[e],i=c[e+1],r=c[e+2],s=c[e+3];var d=this.rectanglesR,p=this.rectanglesRCount;d[p]=t,d[p+1]=i,d[p+2]=r,d[p+3]=s,d[p+4]=c[e+4],d[p+5]=c[e+5],this.rectanglesRCount+=6,c[e+5]=null;var f=Math.floor(t*this.blockSizeFactor),g=Math.floor(i*this.blockSizeFactor),m=Math.floor(r*this.blockSizeFactor),v=Math.floor(s*this.blockSizeFactor);f<0&&(f=0),m>=this.lx&&(m=this.lx-1),g<0&&(g=0),v>=this.ly&&(v=this.ly-1);var y=m-f+1,b=v-g+1;for(n=0;n<b;n++)for(a=0;a<y;a++)for(h=(g+n)*this.lx+(f+a),l=this.blocks[h],u=this.blocksRCount[h],o=0;o<u;o++)if(l[o]==e){l[o]=l[u-1],this.blocksRCount[h]--;break}},a.prototype.processRectangles=function(e,t,i,r){for(var s=this.rectangles,a=this.rectangles2,n=this.rectanglesR,o=i.draw,h=0,l=this.rectanglesRCount;h<l;h+=6){var u=n[h],c=n[h+1],d=n[h+2],p=n[h+3],f=n[h+4],g=n[h+5];this.addRectangle(u,c,d,p,f,g)}for(this.rectanglesRCount=0,h=0,l=this.rectanglesCount;h<l;h+=6){var g=s[h+5];g&&(g[0].hysteresis?i.jobHBuffer[g[0].id]=g[0]:(i.drawnJobs++,o.drawGpuSubJob(e,t,i,r,g,null)))}for(h=0,l=this.rectangles2Count;h<l;h+=4){var g=a[h+3];if(g){var m=g[0];m.hysteresis?i.jobHBuffer[m.id]=m:(i.drawnJobs++,o.drawGpuSubJobLineLabel(e,t,i,r,g,null));var v=m.labelPoints[0][2].length;v>0&&(h+=4*(v-1))}}this.clear()},t.a=a},function(e,t,i){"use strict";function r(e,t){if(!e.config.constrainCamera)return t;var i,r=e.config.minViewExtent,s=e.config.maxViewExtent,a=e.getMap(),n=o.clamp(t.getViewExtent(),r,s);t.setViewExtent(n);var h=.5*n/Math.tan(o.radians(.5*t.getFov()));if("obj"==t.getViewMode()){var l=a.getReferenceFrame(),u=a.getSrsInfo(l.navigationSrs);if(u.a){var c,d=Math.asin(u.a/(h+u.a)),p=Math.tan(o.radians(.5*t.getFov()))/Math.tan(d),f=e.config.tiltConstrainThreshold,g=f[0],m=f[1];g>m||g==m?c=20:(p=o.clamp(p,g,m),p=(p-g)/(m-g),c=20+-110*p),i=t.getOrientation(),i[1]=o.clamp(i[1],-90,c),t.setOrientation(i)}var v=a.getPositionCameraCoords(t,"float"),y=.5*r/Math.tan(o.radians(.5*t.getFov()));y*=.5;var b=Math.max(y,h*Math.tan(o.radians(3)));if(v[2]<b){i=t.getOrientation();var x=function(e,r,s){var n=.5*(e+r);return s>20?n:(i[1]=n,t.setOrientation(i),a.getPositionCameraCoords(t,"float")[2]<b?x(e,n,s+1):x(n,r,s+1))};i[1]=x(-90,Math.min(20,i[1]),0),t.setOrientation(i)}}return t}var s=i(10),a=i(4);i.d(t,"a",function(){return h}),i.d(t,"b",function(){return r});var n=s.a,o=a.a,h=function(e){this.browser=e,this.config=e.config,this.coordsDeltas=[],this.orientationDeltas=[],this.viewExtentDeltas=[],this.northResetAnimation=!1,this.drag=this.drag,this.wheel=this.wheel,this.tick=this.tick,this.reset=this.reset,this.keyup=this.keyup,this.keydown=this.keydown,this.keypress=this.keypress,this.doubleclick=this.doubleclick,this.retinaFactor=1/Math.max(1,(window.devicePixelRatio||1)-1)};h.prototype.drag=function(e){var t=this.browser.getMap();if(t){var i,r=t.getPosition(),s=r.getCoords(),a=e.getDragDelta(),n=e.getDragTouches(),h=this.getAzimuthAndDistance(a[0],a[1]),l=this.config,u=this.browser.controlMode.altKey||this.browser.controlMode.shiftKey||this.browser.controlMode.ctrlKey;if(2==n){if("obj"!=r.getViewMode())return;if("pan"==e.getTouchParameter("touchMode")&&l.rotationAllowed)i=l.sensitivity[1]*this.retinaFactor,this.orientationDeltas.push([a[0]*i,-a[1]*i,0]),this.browser.callListener("map-position-rotated",{});else if("zoom"==e.getTouchParameter("touchMode")&&l.zoomAllowed){var a=e.getTouchParameter("touchDistanceDelta");if(Math.abs(a)>=1){var c=1+.01*(a>0?-1:1);this.viewExtentDeltas.push(c),this.reduceFloatingHeight(.8),l.legacyInertia&&this.updateDeltas(!1,!1,!0),this.browser.callListener("map-position-zoomed",{})}}}else if(e.getDragButton("left")&&!u&&l.panAllowed)if("fix"==r.getHeightMode()){var d=t.convertPositionHeightMode(r,"float",!0);null!=d&&(r=d,this.setPosition(r))}else{i=l.sensitivity[0]*this.retinaFactor;var p=r.getFov(),f=p>.01&&p<179?1/Math.tan(o.radians(.5*p)):1,g=o.radians(h[0]),m=[Math.sin(g),Math.cos(g),h[1]*f*i,h[0],s[0],s[1]];this.coordsDeltas.push(m),this.reduceFloatingHeight(.9),l.legacyInertia&&this.updateDeltas(!0),this.browser.callListener("map-position-panned",{})}else(n<=1&&e.getDragButton("right")||e.getDragButton("middle")||u)&&l.rotationAllowed&&(i=l.sensitivity[1]*this.retinaFactor*("obj"!=r.getViewMode()?.5:1),this.orientationDeltas.push([a[0]*i,-a[1]*i,0]),l.legacyInertia&&this.updateDeltas(!1,!0),this.browser.callListener("map-position-rotated",{}))}},h.prototype.wheel=function(e){n.preventDefault(e);var t=this.browser.getMap();if(t&&this.config.zoomAllowed){t.getStats(!0).maxZoom&&(this.browser.config.minViewExtent=.5);var i=t.getPosition(),r=e.getWheelDelta(),s=this.config.sensitivity[2];this.browser.controlMode.shiftKey&&(s*=.1);var a=1+(r>0?-1:1)*s;if(this.browser.controlMode.altKey&&this.browser.controlMode.shiftKey&&this.browser.controlMode.ctrltKey){var h=o.clamp(i.getFov()*a,1,179);i.setFov(h),t.setPosition(i)}else{if("obj"!=i.getViewMode()){var l=i.getCoords(),u=t.getCameraInfo(),c=u.vector,d=u.height,p=Math.max(100,d)*(this.browser.controlMode.shiftKey?25e-5:.0025)*(r>0?1:-1);return l=t.convertCoordsFromNavToPhys(l,"float"),l[0]+=c[0]*p,l[1]+=c[1]*p,l[2]+=c[2]*p,l=t.convertCoordsFromPhysToNav(l,"float"),i.setCoords(l),void t.setPosition(i)}this.viewExtentDeltas.push(a),this.reduceFloatingHeight(.8),this.browser.callListener("map-position-zoomed",{})}}},h.prototype.doubleclick=function(e){n.preventDefault(e);var t=this.browser.getMap();if(t&&this.config.jumpAllowed){if(this.browser.controlMode.altKey&&this.browser.controlMode.shiftKey&&this.browser.controlMode.ctrlKey)return void(this.browser.config.minViewExtent=.5);var i=e.getMouseCoords(),r=this.browser.getRenderer().getCanvasSize();if(!(i[0]<0||i[1]<0||i[0]>=r[0]||i[1]>=r[1])){var s=t.getHitCoords(i[0],i[1],"fix");if(s){var a=t.getPosition();a.setCoords(s),a=t.convertPositionHeightMode(a,"fix"),a.setHeight(s[2]),this.browser.autopilot.flyTo(a,{mode:"direct",maxDuration:2e3})}}}},h.prototype.keyup=function(){},h.prototype.keydown=function(){},h.prototype.keypress=function(){},h.prototype.setPosition=function(e){this.config.walkMode||(e=r(this.browser,e)),this.config.fixedHeight&&e.setHeight(this.config.fixedHeight),this.browser.getMap().setPosition(e)},h.prototype.reduceFloatingHeight=function(e){var t=this.browser.getMap(),i=t.getPosition(),r=i.getCoords();"float"==i.getHeightMode()&&"obj"==i.getViewMode()&&0!=r[2]&&(r[2]*=e,Math.abs(r[2])<.1&&(r[2]=0),i.setCoords(r),this.setPosition(i))},h.prototype.isNavigationSRSProjected=function(){var e=this.browser.getMap(),t=e.getReferenceFrame(),i=e.getSrsInfo(t.navigationSrs);return!!i&&"projected"==i.type},h.prototype.getAzimuthAndDistance=function(e,t){var i=this.browser.getMap(),r=i.getPosition(),s=r.getViewExtent(),a=.5*r.getFov();this.config.walkMode&&(s+=5);var n=.5*s*Math.tan(o.radians(a))/800;e*=n,t*=n;var h=Math.sqrt(e*e+t*t);return[-o.degrees(Math.atan2(e,t))+r.getOrientation()[0],h]},h.prototype.updateDeltas=function(e,t,i){var r=this.browser.getMap();if(r){var s,a,n,h,l,u=r.getPosition(),c=!1,d=this.config.inertia,p=(r.getStats(),1),f=1;if(this.config.timeNormalizedInertia){var g=1e3/(r.getStats().frameTime+1e-6);g<1&&(g=60),p=g/60,f=1/p}if(!t&&!i&&this.coordsDeltas.length>0){a=this.coordsDeltas;var m=[0,0],v=u.getCoords();for(l=e?a.length-1:0;l<a.length;l++)s=a[l],n=s[3],n=o.radians(n),m[0]+=Math.sin(n)*(s[2]*f),m[1]+=Math.cos(n)*(s[2]*f),s[2]*=d[0]*p,s[2]<.01&&(a.splice(l,1),l--);var y=Math.sqrt(m[0]*m[0]+m[1]*m[1]);for(n=o.degrees(Math.atan2(m[0],m[1])),this.isNavigationSRSProjected()||!this.northResetAnimation&&"azimuthal"==this.config.navigationMode&&(Math.abs(v[1])>75||Math.abs(u.getOrientation()[0])>1)&&(this.config.navigationMode="azimuthal2"),h=u.getOrientation()[0],u=r.movePositionCoordsTo(u,(this.isNavigationSRSProjected()?-1:1)*n,y,"free"!=this.config.navigationMode&&"azimuthal2"!=this.config.navigationMode?0:1),h=u.getOrientation()[0]-h,l=0;l<a.length;l++)s=a[l],s[3]+=h;c=!0}if(!e&&!i&&this.orientationDeltas.length>0){a=this.orientationDeltas;var b=u.getOrientation();for(l=t?a.length-1:0;l<a.length;l++)s=a[l],b[0]+=s[0]*f,b[1]+=s[1]*f,b[2]+=s[2]*f,s[0]*=d[1]*p,s[1]*=d[1]*p,s[2]*=d[1]*p,s[0]*s[0]+s[1]*s[1]+s[2]*s[2]<.1&&(a.splice(l,1),l--);u.setOrientation(b),c=!0}if(!t&&!e&&this.viewExtentDeltas.length>0){a=this.viewExtentDeltas;var x=u.getViewExtent();for(l=i?a.length-1:0;l<a.length;l++)x*=Math.pow(a[l],f),a[l]+=(1-a[l])*(1-d[2]*p),Math.abs(1-a[l])<.001&&(a.splice(l,1),l--);x=Math.max(1,x),u.setViewExtent(x),c=!0}c&&this.setPosition(u)}},h.prototype.tick=function(){this.updateDeltas()},h.prototype.reset=function(){this.coordsDeltas=[],this.orientationDeltas=[],this.viewExtentDeltas=[]}},function(e,t,i){"use strict";var r=i(10),s=i(2),a=i(1);i.d(t,"a",function(){return c}),i.d(t,"b",function(){return l}),i.d(t,"c",function(){return u});var n=r.a,o=s.a,h=a.b,l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpkNjI1MjFjMi1mYzE5LTcyNDUtOTI5My1kNTU3MmE5N2E1MjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODJGRUI2NzE2NzkwMTFFN0EzRUZFNzQ1NEFCMkVFQUQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODJGRUI2NzA2NzkwMTFFN0EzRUZFNzQ1NEFCMkVFQUQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjRBMjkwN0JENjc4QzExRTc5QTQwRjk4NjQzOEI4RDczIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjRBMjkwN0JFNjc4QzExRTc5QTQwRjk4NjQzOEI4RDczIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+k3ySjQAAAdJJREFUeNrclk0oBGEYgHemjZOLm8tSyt9BqT2I1O7JSdSSkpsDxZGLi5MTjn5K4SDh4OfiaPfkIDebOPiPUqKUiLKet96pzzT7MztxMPX0le+b95n3Z2ZZmUwm9NuXHfqLK1smsVhsED5hKkhswc4mYJmHVxgNIvIslyE4hnLYDSqycwiaoCGVSnUFFdk5BH2wKHtBRbYKqlVwbQhGoNU5GETkZHKpggjMqaBFhaGgIltv/mKphRuQss1oZkPuG4oRWTLHlmU5fSlhOYNKSEK7xIUugj+6hmSHpROm2RvL9Q7arqf80IykdDEdgll4IWi/Bm+ECT8Z2R7l+DBKV6N/PoRnEbBuwIKf0nm+8S7RGuzDLaxLMuw/5OuR+bn60ROPt9/pUUQnUEa6A56SyeSWeTYejzs9GkC8ZIpySjxEy1APbdCM6MAlGmeZdIahYIlLVAU9kIA7KZFxrJrA5+bU8RBjBf+eGD26gk0oI4AItiU4dMOqHh+GTylbQT3JU7oj2IMLmNBJrIATKIUoD5L2LfEQJbRPvXAP0iPZj5J92vNl9Fk6mSCZsBV4dwuyflb8XJrRqX6C3iDsFhSdiXOzZlSnwxD2yuBHJv/iX6JvAQYAPSICqA82OnoAAAAASUVORK5CYII=",u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NDkxMSwgMjAxMy8xMC8yOS0xMTo0NzoxNiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2Nzg3NzczMzY3OEMxMUU3QjU2QUUxNTNCNzc4MzVBQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2Nzg3NzczNDY3OEMxMUU3QjU2QUUxNTNCNzc4MzVBQiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjY3ODc3NzMxNjc4QzExRTdCNTZBRTE1M0I3NzgzNUFCIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjY3ODc3NzMyNjc4QzExRTdCNTZBRTE1M0I3NzgzNUFCIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+owD8TQAAAepJREFUeNrcls8rBGEYx993lIMfxR4kF/+AKMqBg7K1ajelLEWK025tKOTnjVykuAklNgcHuzmQg4MiTtz4Aza3TeGActDr+45nZt41s7tmBwdbn2l35933M9/3eead5UII9tsvjf3FK2uSiGgBKdDtZW6JllXA2DG4A3teRM7LZQl2QRuY9irScghGQRXb5KteRVoOQSMY0895FGkk8JHgSBH0gllzpAeRkeSRBAEwQIIZUJMxukARly3GOZdpivA5DnpAM2iQ5zFx3KE55DIugT6cT+a7PTTlKt9xHAT74AzU6vWJiEVQ4iWR9uXHhkgu3QhYB/JK3zBZE6WoBkE3Ivt9YolOQBd9uwJedQFjC+A8XyJ1J3G+4zNFV+CCmmMejINnY8sQG0wVzZnFlnW2Fd55ezGaIUAtPgzqwAsmv8mYMCLW8DaqdyY1g73w+RMFQRh0glse1RtDHRvDcdJp6XInsScKU3u3gnukSfCoOcoH0YPa3jif/P7zxEqUoPqUkWBZ398YqwdTNHqLdu+YuyTONToEl+AaTIAhUE61qwTtuJC0e4klkssQAn7QTy3+BA5AhRQgfdoovHvJp6iYli5EdTqlBKZA7a7CJFaiHdABUqBUFfyMxBJt06PBrwpskn/xl+hDgAEAH0j0b9rsgVUAAAAASUVORK5CYII=",c=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("measure",'<div id="vts-measure" class="vts-measure"><img id="vts-measure-button" class="vts-measure-button" src="'+l+'"><img id="vts-measure-button2" class="vts-measure-button" src="'+u+'"><div id="vts-measure-text-holder" class="vts-measure-text-holder"><div class="vts-measure-text-holder2"><div class="vts-measure-text"><textarea id="vts-measure-text-input" rows="10" cols="67" wrap="hard"></textarea></div><div class="vts-measure-tools"><div id="vts-measure-position" class="vts-measure-tools-button">Position</div><div id="vts-measure-length" class="vts-measure-tools-button">Length</div><div id="vts-measure-track" class="vts-measure-tools-button">Track Length</div><div id="vts-measure-area" class="vts-measure-tools-button">Area</div><div id="vts-measure-volume" class="vts-measure-tools-button">Volume</div><div id="vts-measure-clear" class="vts-measure-tools-button">Clear Log</div><div id="vts-measure-metric" class="vts-measure-tools-button">Units: Meters</div></div></div></div><div id="vts-measure-info" class="vts-measure-info"></div><div id="vts-measure-buttons" class="vts-measure-compute"><div id="vts-measure-undo" class="vts-measure-tools-button">Undo</div><div id="vts-measure-compute" class="vts-measure-tools-button">Compute</div></div> </div>',t,i),this.div=this.control.getElement("vts-measure"),this.buttonOff=this.control.getElement("vts-measure-button"),this.buttonOff.on("click",this.onSwitch.bind(this)),this.buttonOff.on("dblclick",this.onDoNothing.bind(this)),this.buttonOn=this.control.getElement("vts-measure-button2"),this.buttonOn.on("click",this.onSwitch.bind(this)),this.buttonOn.on("dblclick",this.onDoNothing.bind(this)),this.info=this.control.getElement("vts-measure-info"),this.compute=this.control.getElement("vts-measure-buttons");var r=this.control.getElement("vts-measure-undo");r.on("click",this.onCompute.bind(this,0)),r.on("dblclick",this.onDoNothing.bind(this)),r=this.control.getElement("vts-measure-compute"),r.on("click",this.onCompute.bind(this,1)),r.on("dblclick",this.onDoNothing.bind(this));var s=this.control.getElement("vts-measure-clear");s.on("click",this.onClear.bind(this)),s.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons=[];var a=this.control.getElement("vts-measure-position");a.on("click",this.onTool.bind(this,0)),a.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons.push(a),a=this.control.getElement("vts-measure-length"),a.on("click",this.onTool.bind(this,1)),a.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons.push(a),a=this.control.getElement("vts-measure-track"),a.on("click",this.onTool.bind(this,2)),a.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons.push(a),a=this.control.getElement("vts-measure-area"),a.on("click",this.onTool.bind(this,3)),a.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons.push(a),a=this.control.getElement("vts-measure-volume"),a.on("click",this.onTool.bind(this,4)),a.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons.push(a),a=this.control.getElement("vts-measure-metric"),a.on("click",this.onTool.bind(this,5)),a.on("dblclick",this.onDoNothing.bind(this)),this.toolButtons.push(a),this.metricButton=a,this.measuring=!1,this.counter=1,this.renderCounter=1,this.lastCoords=null,this.navCoords=null,this.tool=0,this.metric=!0,this.mapUpdateDestructor=null,this.listPanel=this.control.getElement("vts-measure-text-holder"),this.list=this.control.getElement("vts-measure-text-input"),this.measuring?(this.buttonOn.setStyle("display","block"),this.buttonOff.setStyle("display","none")):(this.buttonOn.setStyle("display","none"),this.buttonOff.setStyle("display","block")),this.onMouseMoveCall=this.onMouseMove.bind(this),this.onMouseLeaveCall=this.onMouseLeave.bind(this),this.onMouseClickCall=this.onMouseClick.bind(this),this.onMapUpdateCall=this.onMapUpdate.bind(this),this.update()};c.prototype.onDoNothing=function(e){n.stopPropagation(e)},c.prototype.onMouseLeave=function(e){this.info.setStyle("display","none")},c.prototype.onMouseClick=function(e){var t=this.browser.getMap();if(t){var i=this.ui.getMapElement(),r=i.getDraggingState(),s=r.absMoved;if(!(s[0]+s[1]>0)){var a=e.getMouseCoords(),n=t.getHitCoords(a[0],a[1],"fix");if(t.redraw(),n){var o,h,l,u,c="  ";for(o=0,h=(""+this.counter).length;o<h;o++)c+=" ";if(0==this.tool?(this.navCoords=n,n=t.convertCoordsFromNavToPublic(n,"fix"),u="------------------------------------------------------\n",u+="#"+this.counter+" Position: ",u+="\n"+c+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2]),this.counter++):1==this.tool?this.navCoords&&2!=this.navCoords.length?(this.navCoords.push(n),n=t.convertCoordsFromNavToPublic(n,"fix"),u=c+"p2: "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2]),u+="\n"+c+"------------------------",l=t.getDistance(this.lastCoords,n,!1,!0),u+="\n"+c+"great-circle distance: "+this.getTextNumber(l[0]),u+="\n"+c+"euclidean distance: "+this.getTextNumber(l[2]),u+="\n"+c+"elevation difference: "+this.getTextNumber(n[2]-this.lastCoords[2]),u+="\n"+c+"azimuth: "+l[1].toFixed(2)+" deg",this.counter++):(this.navCoords=[n],n=t.convertCoordsFromNavToPublic(n,"fix"),u="------------------------------------------------------\n",u+="#"+this.counter+" Length: ",u+="\n"+c+"p1: "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2])):2==this.tool?(this.renderCounter!=this.counter&&(this.renderCounter=this.counter,this.onTool(2)),this.navCoords?(this.navCoords.push(n),n=t.convertCoordsFromNavToPublic(n,"fix"),u=c+"p"+this.navCoords.length+": "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2])):(this.navCoords=[n],n=t.convertCoordsFromNavToPublic(n,"fix"),u="------------------------------------------------------\n",u+="#"+this.counter+" Track Length: ",u+="\n"+c+"p1: "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2]))):3!=this.tool&&4!=this.tool||(this.renderCounter!=this.counter&&(this.renderCounter=this.counter,this.onTool(this.tool)),this.navCoords?(this.navCoords.push(n),n=t.convertCoordsFromNavToPublic(n,"fix"),u=c+"p"+this.navCoords.length+": "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2])):(this.navCoords=[n],n=t.convertCoordsFromNavToPublic(n,"fix"),u="------------------------------------------------------\n",u+="#"+this.counter+(3==this.tool?" Area: ":" Volume: "),u+="\n"+c+"p1: "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+this.getTextNumber(n[2]))),this.lastCoords=n,u){var d=this.list.getElement();d.value+=u+"\n",d.scrollTop=d.scrollHeight}}}}},c.prototype.onMouseMove=function(e){var t=this.browser.getMap();if(t){var i=e.getMouseCoords(),r=t.getHitCoords(i[0],i[1],"fix");if(!r)return void this.info.setStyle("display","none");r=t.convertCoordsFromNavToPublic(r,"fix");var s=r[0].toFixed(7)+", "+r[1].toFixed(7)+", "+this.getTextNumber(r[2]);i[0]-=this.divRect.left,i[1]-=this.divRect.top,this.info.setStyle("display","block"),this.info.setStyle("left",i[0]+20+"px"),this.info.setStyle("top",i[1]+10+"px"),this.info.setHtml(s)}},c.prototype.onSwitch=function(){this.measuring=!this.measuring;var e=this.ui.getMapElement();this.measuring?(this.buttonOn.setStyle("display","block"),this.buttonOff.setStyle("display","none"),this.divRect=this.div.getRect(),e.on("mousemove",this.onMouseMoveCall),e.on("mouseleave",this.onMouseLeaveCall),e.on("click",this.onMouseClickCall),this.mapUpdateDestructor=this.browser.on("map-update",this.onMapUpdateCall)):(this.buttonOn.setStyle("display","none"),this.buttonOff.setStyle("display","block"),e.off("mousemove",this.onMouseMoveCall),e.off("mouseleave",this.onMouseLeaveCall),e.off("click",this.onMouseClickCall),this.mapUpdateDestructor&&this.mapUpdateDestructor()),this.onTool(this.tool),this.compute.setStyle("display","none");var t=this.browser.getMap();t&&t.redraw(),this.update()},c.prototype.onTool=function(e){if(5==e)return this.metric=!this.metric,void this.metricButton.setHtml(this.metric?"Units: Meters":"Units: Feets");this.tool=e,this.navCoords=null,this.compute.setStyle("display","none");for(var t=0;t<5;t++)this.toolButtons[t].setClass("vts-measure-tools-button");this.toolButtons[e].setClass("vts-measure-tools-button-selected");var i=this.browser.getMap();i&&i.redraw()},c.prototype.onCompute=function(e){if(this.navCoords){var t=this.browser.getMap();if(t){var i,r,s,a,n=this.list.getElement();if(0==e)this.navCoords.pop();else{if(2==this.tool){var o,l,u,c=0,d=0,p=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY;for(a="  ",r=0,s=(""+this.counter).length;r<s;r++)a+=" ";for(i=a+"------------------------",r=0,s=this.navCoords.length;r<s;r++)o=t.convertCoordsFromNavToPublic(this.navCoords[r],"fix"),o[2]>f&&(f=o[2]),o[2]<p&&(p=o[2]);for(r=0,s=this.navCoords.length-1;r<s;r++)o=t.convertCoordsFromNavToPublic(this.navCoords[r],"fix"),l=t.convertCoordsFromNavToPublic(this.navCoords[r+1],"fix"),u=t.getDistance(o,l,!1,!0),c+=u[0],d+=u[2];i+="\n"+a+"great-circle distance: "+this.getTextNumber(c),i+="\n"+a+"euclidean distance: "+this.getTextNumber(d),i+="\n"+a+"max elevation: "+this.getTextNumber(f),i+="\n"+a+"min elevation: "+this.getTextNumber(p),i+="\n"+a+"elevation difference: "+this.getTextNumber(f-p),this.counter++}if(3==this.tool){console.log(JSON.stringify(this.navCoords));var g=t.createGeodata();g.addPolygon3(this.navCoords,[],null,"fix",{},"tmp-polygon"),g.processHeights("node-by-lod",62,function(){for(a="  ",r=0,s=(""+this.counter).length;r<s;r++)a+=" ";i=a+"------------------------";var e=g.extractGeometry("tmp-polygon"),t=e.getSurfaceArea();this.metric?(i+="\n"+a+"area: "+t.toFixed(2)+" m",t>100&&(i+="\n"+a+"      "+(t/100).toFixed(2)+" ares"),t>1e4&&(i+="\n"+a+"      "+(t/1e4).toFixed(2)+" hectares"),t>1e6&&(i+="\n"+a+"      "+(t/1e6).toFixed(2)+" km")):(i+="\n"+a+"area: "+(t/.83612736).toFixed(2)+" yd",t/4046.8564224>=1&&(i+="\n"+a+"      "+(t/4046.8564224).toFixed(2)+" acres"),t/2589988.110346>=1&&(i+="\n"+a+"      "+(t/2589988.110346).toFixed(2)+" mi")),this.counter++}.bind(this))}if(4==this.tool){var m=[0,0,0];for(r=0,s=this.navCoords.length;r<s;r++)o=t.convertCoordsFromNavToPhys(this.navCoords[r],"fix"),m[0]+=o[0],m[1]+=o[1],m[2]+=o[2];m[0]/=s,m[1]/=s,m[2]/=s;var v,y,b,c,x=0;for(r=0,s=this.navCoords.length;r<s;r++)o=t.convertCoordsFromNavToPhys(this.navCoords[r],"fix"),v=m[0]-o[0],y=m[1]-o[1],b=m[2]-o[2],(c=Math.sqrt(v*v+y*y+b*b))>x&&(x=c);var g=t.createGeodata();x>3e4?g.addPolygon3(this.navCoords,[],null,"fix",{},"tmp-polygon"):g.addPolygon(this.navCoords,[],null,"fix",{},"tmp-polygon"),g.processHeights("node-by-lod",62,function(){if(this.navCoords.length){for(a="  ",r=0,s=(""+this.counter).length;r<s;r++)a+=" ";i=a+"------------------------";var e=g.extractGeometry("tmp-polygon"),l=new Array(e.getElements());for(r=0,s=l.length;r<s;r++)l[r]=e.getElement(r);var c,d,p,f=this.browser.getRenderer();o=t.convertCoordsFromPhysToNav(m,"fix");var v=.003*x,y=this.browser.getCore(),b=function(e){if(i=n.value,i=i.substr(0,i.lastIndexOf("loading data ...")),i+="computation progress: 0%",!e)return void(i+="\n some error ocurred. Try it again.");var r=f.buildOctreeFromGeometry(e),s=t.getNED(o,!1);d=s.direction,p=s.east;var g,v,b,w,S=[0,0,0],M=.04*x,A=0,C=0;M*=M;var T=-25,P=function(){for(c=-25;c<=25;c++)g=.04*c*x,v=.04*T*x,o[0]=1.0001*m[0]+d[0]*v+p[0]*g,o[1]=1.0001*m[1]+d[1]*v+p[1]*g,o[2]=1.0001*m[2]+d[2]*v+p[2]*g,h.normalize(o,S),S[0]=-S[0],S[1]=-S[1],S[2]=-S[2],u=this.hitFaces(o,S,l),u[0]&&(b=f.raycastOctreeGeometry(r,o,S),b.length>0&&(w=(u[1]-b[0])*M,w>=0?A+=w:C+=-w));if(T<25)i=i.substr(0,i.lastIndexOf("computation progress:")),i+="computation progress: "+((T+25)/50*100).toFixed(1)+" %";else if(i=i.substr(0,i.lastIndexOf("computation progress:")),this.metric)i+="volume above: "+A.toFixed(2)+" m",i+="\n"+a+"volume below: "+C.toFixed(2)+" m",i+="\n"+a+"volume combined: "+(A+C).toFixed(2)+" m\n";else{var e=.764554857984;i+="volume above: "+(A/e).toFixed(2)+" yd",i+="\n"+a+"volume below: "+(C/e).toFixed(2)+" yd",i+="\n"+a+"volume combined: "+((A+C)/e).toFixed(2)+" yd\n"}i&&(n.value=i,n.scrollTop=n.scrollHeight),T<25&&y.once("tick",P,1),T++}.bind(this);y.once("tick",P,1)}.bind(this);i+="\n"+a+"loading data ...",n.value+=i,n.scrollTop=n.scrollHeight,i=null;t.getSurfaceAreaGeometry(o,x,"texelSize",v,b,!1)}}.bind(this)),this.counter++}}i&&(n.value+=i+"\n",n.scrollTop=n.scrollHeight),t.redraw()}}},c.prototype.hitFace=function(e,t,i){var r,s,a,n,o,l=i[0],u=i[1],c=i[2],d=[0,0,0],p=[0,0,0],f=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],g=[c[0]-l[0],c[1]-l[1],c[2]-l[2]];return h.cross(t,g,d),(s=h.dot(f,d))>-1e-7&&s<1e-7?[!1]:(a=1/s,r=[e[0]-l[0],e[1]-l[1],e[2]-l[2]],(n=a*h.dot(r,d))<0||n>1?[!1]:(p=h.cross(r,f),(o=a*h.dot(t,p))<0||n+o>1?[!1]:[!0,a*h.dot(g,p)]))},c.prototype.hitFaces=function(e,t,i){for(var r=!1,s=Number.POSITIVE_INFINITY,a=0,n=i.length;a<n;a++){var o=this.hitFace(e,t,i[a]);o[0]&&(r=!0,o[1]<s&&(s=o[1]))}return[r,s]},c.prototype.onClear=function(){this.counter=1,this.lastCoords=null,this.navCoords=null;var e=this.list.getElement();e.value="",e.scrollTop=0,this.compute.setStyle("display","none");var t=this.browser.getMap();t&&t.redraw()},c.prototype.update=function(){var e=10+(this.ui.config.controlZoom?70:0)+(this.ui.config.controlSpace?35:0);this.div.setStyle("left",e+"px"),this.listPanel.setStyle("display",this.measuring?"block":"none")},c.prototype.onMapUpdate=function(){var e=this.browser.getMap();if(e){var t=this.browser.getRenderer();if(this.circleImage||(this.circleImage=o.loadImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QAAAAAAAD5Q7t/AAAACW9GRnMAAAAgAAAA4ACD+EAUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVRYw+2VPwqDMBTG3dz1Am56EnH2XLroETxGuwc3Z7cOdhY8QJpfSUBspUvStJAPPggvD973/uQligICAgL+DKViqygUV02hbaXLwJlio7gpyhNu2idzEXwwgfI8H+u6vnZdN/V9P3EuimLcCRlsiyArGcfxjWDLsmzyAGzc4aNFNDZ7/iw7AeQH4LNrh5WZYLgkJTaZCyHuVVVdkiSZ0zSdOWMzlaBFWkRrQ4A4Zk/A4wBie1MFYUMAz0wybCYAmR8FUAlzj6+2r18TgM2VAO8tOB1Cyk7mrofQ+zP0voheVjHtIBjDxjrmvCu7k1Xs/TP6ie84ICDAGR5uCYdPo0MWiAAAAABJRU5ErkJggg==",function(){this.circleTexture=t.createTexture({source:this.circleImage})}.bind(this))),this.circleTexture){var i,r,s,a;switch(this.tool){case 0:this.navCoords&&(s=e.convertCoordsFromNavToCanvas(this.navCoords,"fix"),s[2]<=1&&t.drawImage({rect:[s[0]-12,s[1]-12,24,24],texture:this.circleTexture,color:[255,0,0,255],depth:s[2],depthTest:!1,blend:!0}));break;case 1:case 2:case 3:case 4:if(this.navCoords){for(a=[],i=0,r=this.navCoords.length;i<r;i++)a.push(e.convertCoordsFromNavToCanvas(this.navCoords[i],"fix"));if(r>1){var n,h=[],l=[];for(i=0,r=this.navCoords.length-1;i<r;i++)n=e.getGeodesicLinePoints(this.navCoords[i],this.navCoords[i+1]),h=h.concat(n);for(3!=this.tool&&4!=this.tool||(n=e.getGeodesicLinePoints(this.navCoords[r],this.navCoords[0]),h=h.concat(n)),i=0,r=h.length;i<r;i++)l.push(e.convertCoordsFromNavToPhys(h[i],"fix",null,!0));t.drawLineString({points:l,size:5,color:[0,0,0,255],depthTest:!1,screenSpace:!1,blend:!1}),t.drawLineString({points:l,size:2,color:[255,0,0,255],depthTest:!1,screenSpace:!1,blend:!1})}for(i=0,r=a.length;i<r;i++)s=a[i],s[2]<=1&&t.drawImage({rect:[s[0]-12,s[1]-12,24,24],texture:this.circleTexture,color:[255,0,0,255],depth:s[2],depthTest:!1,blend:!0})}}if((2==this.tool||3==this.tool||4==this.tool)&&a){if(a.length<2||this.renderCounter!=this.counter)return void this.compute.setStyle("display","none");s=a[a.length-1],s[0]-=this.divRect.left,s[1]-=this.divRect.top,this.compute.setStyle("display","block"),this.compute.setStyle("left",s[0]+20+"px"),this.compute.setStyle("top",s[1]+10+"px")}}}},c.prototype.getTextNumber=function(e){return e>=1e5?this.metric?(.001*e).toFixed(2)+"km":(.001*e*.621371).toFixed(2)+"mi":this.metric?e.toFixed(2)+"m":(3.28084*e).toFixed(2)+"ft"}},function(e,t,i){"use strict";var r=function(e,t,i){this.type=e,this.event=i,this.element=t};r.prototype.getMouseButton=function(){switch(this.type){case"touchstart":case"touchend":case"touchmove":var e=this.event.touches;if(e)switch(e.length){case 1:return"left";case 2:return"right";case 3:return"middle"}return"";default:if(this.event.which)switch(this.event.which){case 1:return"left";case 2:return"middle";case 3:return"right"}else if(this.event.button)switch(this.event.button){case 1:return"left";case 2:return"right";case 3:return"middle"}}return""},r.prototype.getMouseCoords=function(e){var t=[0,0];switch(this.type){case"touchstart":case"touchend":case"touchmove":var i=this.event.touches;if(!i||0==i.length)break;for(var r=0,s=i.length;r<s;r++){var a=this.getEventCoords(this.event.touches[r],e);t[0]+=a[0],t[1]+=a[1]}t[0]/=s,t[1]/=s;break;case"mousedown":case"mouseup":case"mousemove":case"mouseenter":case"mouseover":case"mouseleave":case"click":case"dblclick":case"dragstart":case"dragend":case"drag":t=this.getEventCoords(this.event,e)}return t},r.prototype.getEventCoords=function(e,t){if(null==this.element.getPageRect||t)return[e.clientX,e.clientY];var i=this.element.getPageRect();return[e.pageX-i.left,e.pageY-i.top]},r.prototype.getDragDelta=function(){switch(this.type){case"drag":return[this.event.deltaX,this.event.deltaY]}return[0,0]},r.prototype.getDragZoom=function(){switch(this.type){case"drag":return this.event.zoom}return 1},r.prototype.getDragTouches=function(){switch(this.type){case"drag":return this.event.touches}return 0},r.prototype.getModifierKey=function(e){switch(this.type){case"mouseup":case"mousedown":case"dblclick":case"keyup":case"keydown":case"keypress":switch(e){case"alt":return this.event.altKey;case"ctrl":return this.event.ctrlKey;case"shift":return this.event.shiftKey}}return!1},r.prototype.getKeyCode=function(){switch(this.type){case"keyup":case"keydown":case"keypress":return this.event.keyCode?this.event.keyCode:this.event.which?this.event.which:this.event.charCode}return null},r.prototype.getDragButton=function(e){switch(e){case"left":case"right":case"middle":switch(this.getTouchesCount()){case-1:return this.event[e];case 0:return!1;case 1:return"left"==e;case 2:return"right"==e;case 3:return"middle"==e}}return!1},r.prototype.getWheelDelta=function(){switch(this.type){case"mousewheel":var e=0;return this.event.wheelDelta&&(e=this.event.wheelDelta/120),this.event.detail&&(e=-this.event.detail/3),e}return 0},r.prototype.getTouchesCount=function(){switch(this.type){case"touchstart":case"touchend":case"touchmove":if(!this.event.touches)break;return this.event.touches.length}return-1},r.prototype.getTouchParameter=function(e){switch(this.type){case"drag":return this.event[e]}return null},r.prototype.getTouchCoords=function(e,t){switch(this.type){case"touchstart":case"touchend":case"touchmove":if(!this.event.touches)break;var i=this.event.touches[e];if(!i)break;if(null==this.element.getPageRect||t)return[i.clientX,i.clientY];var r=this.element.getPageRect();return[i.pageX-r.left,i.pageY-r.top]}return[0,0]},r.prototype.getType=function(){return this.type},t.a=r},function(e,t,i){"use strict";var r=i(175),s=(i.n(r),i(176)),a=(i.n(s),i(177)),n=(i.n(a),i(178)),o=(i.n(n),i(180)),h=o.a,l=function(e,t){this.browser=new h(e,t),this.core=this.browser.getCore(),this.killed=!1,Object.defineProperty(this,"map",{get:function(){if(!this.killed)return this.core.map}}),Object.defineProperty(this,"renderer",{get:function(){if(!this.killed)return this.core.renderer}}),Object.defineProperty(this,"autopilot",{get:function(){if(!this.killed)return this.browser.autopilot}}),Object.defineProperty(this,"presenter",{get:function(){if(!this.killed)return this.browser.presenter}}),Object.defineProperty(this,"ui",{get:function(){if(!this.killed)return this.browser.ui}})};l.prototype.destroy=function(){if(!this.killed)return this.core.destroy(),this.browser.kill(),this.killed=!0,null},l.prototype.setControlMode=function(e){if(!this.killed)return this.browser.setControlMode(e),this},l.prototype.getControlMode=function(){if(!this.killed)return this.browser.getControlMode()},l.prototype.loadMap=function(e){if(!this.killed)return this.core.loadMap(e),this},l.prototype.destroyMap=function(){if(!this.killed)return this.core.destroyMap(),this.map=null,this},l.prototype.on=function(e,t){if(!this.killed)return this.core.on(e,t)},l.prototype.setParams=function(e){if(!this.killed)return this.setConfigParams(e,!0),this},l.prototype.setParam=function(e,t){if(!this.killed)return this.browser.setConfigParam(e,t,!0),this},l.prototype.getParam=function(e){if(!this.killed)return this.browser.getConfigParam(e)},t.a=l},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){"use strict";var r=function(e){this.browser=e,this.trajectory=[],this.flightDuration=1,this.flightTime=0,this.trajectoryIndex=0,this.finished=!0,this.autoMovement=!1,this.autoRotate=0,this.autoPan=0,this.autoPanAzimuth=0,this.center=[0,0,0],this.orientation=[0,0,0],this.viewHeight=0,this.fov=90,this.lastTime=0};r.prototype.setAutorotate=function(e){this.autoRotate!=e&&this.browser.callListener("autorotate-changed",{autorotate:e}),this.autoRotate=e},r.prototype.getAutorotate=function(){return this.autoRotate},r.prototype.setAutopan=function(e,t){this.autoPan=e,this.autoPanAzimuth=t},r.prototype.getAutopan=function(){return[this.autoPan,this.autoPanAzimuth]},r.prototype.flyToDAH=function(e,t,i,r){var s=this.browser.core.map;if(s){r=r||{};var a=s.generatePIHTrajectory(s.getPosition(),e,t,i,r);this.setTrajectory(a,r.samplePeriod||10,r)}},r.prototype.flyTo=function(e,t){var i=this.browser.core.map;if(i){t=t||{};var r=i.generateTrajectory(i.getPosition(),e,t);this.setTrajectory(r,t.samplePeriod||10,t)}},r.prototype.flyTrajectory=function(e,t){this.setTrajectory(e,t||10,{})},r.prototype.cancelFlight=function(){this.browser.getControlMode().setCurrentControlMode(this.lastControlMode),this.finished=!0},r.prototype.setTrajectory=function(e,t,i){null!=e&&0!=e.length&&(this.setAutorotate(0),this.setAutopan(0,0),this.speed=i.speed||1,this.finished&&(this.lastControlMode=this.browser.getControlMode().getCurrentControlMode()),this.browser.getControlMode().setCurrentControlMode("disabled"),this.trajectory=e,this.sampleDuration=t,this.browser.callListener("fly-start",{startPosition:this.trajectory[0],endPosition:this.trajectory[this.trajectory.length-1],options:i}),this.timeStart=performance.now(),this.finished=!1)},r.prototype.tick=function(){var e=this.browser.getMap();if(e){var t,i=performance.now(),r=(i-this.lastTime)/1e3;if(this.lastTime=i,!(this.browser.ui&&this.browser.ui.loading&&this.browser.ui.loading.control.getVisible())){if(0!=this.autoRotate){t=e.getPosition();var s=t.getOrientation();s[0]=(s[0]+this.autoRotate*r)%360,t.setOrientation(s),e.setPosition(t)}if(0!=this.autoPan&&(t=e.getPosition(),t=e.movePositionCoordsTo(t,this.autoPanAzimuth,t.getViewExtent()*(.01*this.autoPan)*r,0),e.setPosition(t)),!this.finished&&this.trajectory){i-=this.timeStart;var a=Math.floor(i/this.sampleDuration*this.speed),n=this.trajectory.length-1;a<n?(e.setPosition(this.trajectory[a]),this.browser.callListener("fly-progress",{position:this.trajectory[a],progress:a/n*100})):e.setPosition(this.trajectory[n]),a>=this.trajectory.length&&(this.browser.callListener("fly-end",{position:this.trajectory[n]}),this.browser.getControlMode().setCurrentControlMode(this.lastControlMode),this.finished=!0)}}}},r.prototype.generateTrajectory=function(e,t,i){var r=this.browser.core.map;if(r)return i=i||{},r.generateTrajectory(e,t,i)},r.prototype.generatePIHTrajectory=function(e,t,i,r){var s=this.browser.core.map;if(s)return r=r||{},s.generatePIHTrajectory(e,t,i,r)},t.a=r},function(e,t,i){"use strict";var r=i(13),s=i(62),a=i(2),n=i(204),o=i(179),h=i(181),l=i(185),u=i(186),c=s.a,d=a.a,p=n.a,f=o.a,g=h.a,m=l.a,v=u.a,y=r.b,b=function(e,t){return this.killed=!1,this.configStorage={},this.initConfig(),this.setConfigParams(t,!0),this.originalConfig=JSON.parse(JSON.stringify(t)),this.element="string"==typeof e?document.getElementById(e):e,this.ui=new p(this,this.element),e="string"!=typeof e?e:document.getElementById(e),y()?(this.core=new c(this.ui.getMapControl().getMapElement().getElement(),t),null==this.core?void this.ui.setControlVisible("fallback",!0):(this.updatePosInUrl=!1,this.lastUrlUpdateTime=!1,this.mapLoaded=!1,this.mapInteracted=!1,this.autopilot=new f(this),this.rois=new v(this),this.controlMode=new g(this,this.ui),this.presenter=new m(this,t),this.on("map-loaded",this.onMapLoaded.bind(this)),this.on("map-unloaded",this.onMapUnloaded.bind(this)),this.on("map-update",this.onMapUpdate.bind(this)),this.on("map-position-changed",this.onMapPositionChanged.bind(this)),this.on("map-position-fixed-height-changed",this.onMapPositionFixedHeightChanged.bind(this)),this.on("map-position-panned",this.onMapPositionPanned.bind(this)),this.on("map-position-rotated",this.onMapPositionRotated.bind(this)),this.on("map-position-zoomed",this.onMapPositionZoomed.bind(this)),void this.on("tick",this.onTick.bind(this)))):void this.ui.setControlVisible("fallback",!0)};b.prototype.kill=function(){this.ui.kill(),this.killed=!0},b.prototype.getCore=function(){return this.core},b.prototype.getMap=function(){return this.core?this.core.map:null},b.prototype.getRenderer=function(){return this.core?this.core.renderer:null},b.prototype.getProj4=function(){return this.core?this.core.proj4:null},b.prototype.getUI=function(){return this.ui},b.prototype.setControlMode=function(e){this.controlMode=e},b.prototype.getControlMode=function(){return this.controlMode},b.prototype.on=function(e,t){return this.core.on(e,t)},b.prototype.callListener=function(e,t){this.core.callListener(e,t)},b.prototype.onMapLoaded=function(e){this.mapLoaded=!0;var t=e.browserOptions||{},i=this.originalConfig;for(var r in i)void 0!==t[r]&&(t[r]=i[r]);if(this.setConfigParams(t),this.config.geojson||this.config.geodata){var s=this.config.geojson||this.config.geodata;if("string"==typeof s)if(s=s.trim(),"{"==s.charAt(0))try{s=JSON.parse(s),this.onGeoJsonLoaded(s)}catch(e){}else d.loadJSON(s,this.onGeoJsonLoaded.bind(this))}this.autopilot&&(this.autopilot.setAutorotate(this.config.autoRotate),this.autopilot.setAutopan(this.config.autoPan[0],this.config.autoPan[1]))},b.prototype.getLinkWithCurrentPos=function(){var e=this.getMap();if(!e)return"";var t=d.getParamsFromUrl(window.location.href),i=e.getPosition();i=e.convertPositionHeightMode(i,"fix",!0);var r="";r+=i.getViewMode()+",";var s=i.getCoords();r+=s[0].toFixed(6)+","+s[1].toFixed(6)+","+i.getHeightMode()+","+s[2].toFixed(2)+",";var a=i.getOrientation();if(r+=a[0].toFixed(2)+","+a[1].toFixed(2)+","+a[2].toFixed(2)+",",r+=i.getViewExtent().toFixed(2)+","+i.getFov().toFixed(2),t.pos=r,this.mapInteracted){(t.rotate||this.getConfigParam("rotate"))&&(t.rotate="0");var n=this.getConfigParam("pan");(t.pan||n&&(n[0]||n[1]))&&(t.pan="0,0")}r="";for(var o in t)r+=(r.length>0?"&":"")+o+"="+t[o];var h=window.location.href.split("?");if(h.length>1){var l=h[1].split("#");return h[0]+"?"+r+(l[1]||"")}return h[0]+"?"+r},b.prototype.onMapPositionChanged=function(){this.config.positionInUrl&&(this.updatePosInUrl=!0)},b.prototype.onMapPositionPanned=function(){this.mapInteracted=!0},b.prototype.onMapPositionRotated=function(){this.mapInteracted=!0},b.prototype.onMapPositionZoomed=function(){this.mapInteracted=!0},b.prototype.onMapPositionFixedHeightChanged=function(){this.config.positionInUrl&&(this.updatePosInUrl=!0)},b.prototype.onMapUnloaded=function(){},b.prototype.onMapUpdate=function(){this.dirty=!0},b.prototype.onGeoJsonLoaded=function(e){var t=this.getMap(),i=t.createGeodata(),r=function(){var e=i.makeFreeLayer(this.config.geojsonStyle);t.addFreeLayer("geojson",e);var r=t.getView();r.freeLayers.geojson={},t.setView(r)}.bind(this);this.config.geodata?(i.importVTSGeodata(e),r()):(i.importGeoJson(e),i.processHeights("node-by-precision",62,r))},b.prototype.onTick=function(){if(!this.killed&&(this.autopilot.tick(),this.ui.tick(this.dirty),this.dirty=!1,this.updatePosInUrl)){var e=performance.now();e-this.lastUrlUpdateTime>1e3&&(window.history.replaceState&&window.history.replaceState({},null,this.getLinkWithCurrentPos()),this.updatePosInUrl=!1,this.lastUrlUpdateTime=e)}},b.prototype.initConfig=function(){this.config={panAllowed:!0,rotationAllowed:!0,zoomAllowed:!0,jumpAllowed:!1,sensitivity:[1,.06,.05],inertia:[.81,.9,.7],timeNormalizedInertia:!1,legacyInertia:!1,positionInUrl:!1,positionUrlHistory:!1,constrainCamera:!0,navigationMode:"azimuthal",controlCompass:!0,controlZoom:!0,controlSpace:!0,controlSearch:!0,controlSearchSrs:null,controlSearchUrl:null,controlSearchFilter:!1,controlMeasure:!1,controlMeasureLite:!1,controlLink:!1,controlGithub:!1,controlScale:!0,controlLayers:!1,controlCredits:!0,controlFullscreen:!1,controlLoading:!0,searchElement:null,searchValue:null,walkMode:!1,fixedHeight:0,geojson:null,tiltConstrainThreshold:[.5,1],bigScreenMargins:!1,minViewExtent:20,maxViewExtent:Number.MAXINTEGER,autoRotate:0,autoPan:[0,0]}},b.prototype.setConfigParams=function(e,t){if("object"==typeof e&&null!==e)for(var i in e)this.setConfigParam(i,e[i],t)},b.prototype.updateUI=function(e){null!=this.ui&&this.ui.setParam(e)},b.prototype.setConfigParam=function(e,t,i){var r=this.getMap();switch(e){case"pos":case"position":this.config.position=t,r&&r.setPosition(this.config.position);break;case"view":this.config.view=t,r&&r.setView(this.config.view);break;case"panAllowed":this.config.panAllowed=d.validateBool(t,!0);break;case"rotationAllowed":this.config.rotationAllowed=d.validateBool(t,!0);break;case"zoomAllowed":this.config.zoomAllowed=d.validateBool(t,!0);break;case"jumpAllowed":this.config.jumpAllowed=d.validateBool(t,!1);break;case"constrainCamera":this.config.constrainCamera=d.validateBool(t,!0);break;case"navigationMode":this.config.navigationMode=t;break;case"positionInUrl":this.config.positionInUrl=d.validateBool(t,!1);break;case"positionUrlHistory":this.config.positionUrlHistory=d.validateBool(t,!1);break;case"controlCompass":this.config.controlCompass=d.validateBool(t,!0),this.updateUI(e);break;case"controlZoom":this.config.controlZoom=d.validateBool(t,!0),this.updateUI(e);break;case"controlMeasure":this.config.controlMeasure=d.validateBool(t,!1),this.updateUI(e);break;case"controlScale":this.config.controlScale=d.validateBool(t,!0),this.updateUI(e);break;case"controlLayers":this.config.controlLayers=d.validateBool(t,!1),this.updateUI(e);break;case"controlSpace":this.config.controlSpace=d.validateBool(t,!1),this.updateUI(e);break;case"controlSearch":this.config.controlSearch=d.validateBool(t,!1),this.updateUI(e);break;case"controlSearchUrl":this.config.controlSearchUrl=t;break;case"controlSearchSrs":this.config.controlSearchSrs=t;break;case"controlSearchFilter":this.config.controlSearchFilter=d.validateBool(t,!0);break;case"controlSearchElement":this.config.controlSearchElement=t,this.updateUI(e);break;case"controlSearchValue":this.config.controlSearchValue=t,this.updateUI(e);break;case"controlLink":this.config.controlLink=d.validateBool(t,!1),this.updateUI(e);break;case"controlGithub":this.config.controlGithub=d.validateBool(t,!1),this.updateUI(e);break;case"controlMeasure":this.config.controlMeasure=d.validateBool(t,!1),this.updateUI(e);break;case"controlMeasureLite":this.config.controlMeasureLite=d.validateBool(t,!1),this.updateUI(e);break;case"controlLogo":this.config.controlLogo=d.validateBool(t,!1),this.updateUI(e);break;case"controlFullscreen":this.config.controlFullscreen=d.validateBool(t,!0),this.updateUI(e);break;case"controlCredits":this.config.controlCredits=d.validateBool(t,!0),this.updateUI(e);break;case"controlLoading":this.config.controlLoading=d.validateBool(t,!0),this.updateUI(e);break;case"minViewExtent":this.config.minViewExtent=d.validateNumber(t,.01,Number.MAXINTEGER,100);break;case"maxViewExtent":this.config.maxViewExtent=d.validateNumber(t,.01,Number.MAXINTEGER,Number.MAXINTEGER);break;case"sensitivity":this.config.sensitivity=d.validateNumberArray(t,3,[0,0,0],[10,10,10],[1,.12,.05]);break;case"inertia":this.config.inertia=d.validateNumberArray(t,3,[0,0,0],[.99,.99,.99],[.85,.9,.7]);break;case"legacyInertia":this.config.legacyInertia=d.validateBool(t,!1);break;case"timeNormalizedInertia":this.config.timeNormalizedInertia=d.validateBool(t,!1);break;case"bigScreenMargins":this.config.bigScreenMargins=d.validateBool(t,!1);break;case"tiltConstrainThreshold":this.config.tiltConstrainThreshold=d.validateNumberArray(t,2,[.5,1],[-Number.MAXINTEGER,-Number.MAXINTEGER],[Number.MAXINTEGER,Number.MAXINTEGER]);break;case"walkMode":this.config.walkMode=d.validateBool(t,!1);break;case"fixedHeight":this.config.fixedHeight=d.validateNumber(t,-Number.MAXINTEGER,Number.MAXINTEGER,0);break;case"geodata":this.config.geodata=t;break;case"geojson":this.config.geojson=t;break;case"geojsonStyle":this.config.geojsonStyle=JSON.parse(t);break;case"rotate":this.config.autoRotate=d.validateNumber(t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,0),r&&this.autopilot&&this.autopilot.setAutorotate(this.config.autoRotate);break;case"pan":Array.isArray(t)&&2==t.length&&(this.config.autoPan=[d.validateNumber(t[0],Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,0),d.validateNumber(t[1],-360,360,0)]),r&&this.autopilot&&this.autopilot.setAutorotate(this.config.autoRotate)}i&&(0!=e.indexOf("map")&&0!=e.indexOf("mario")&&0!=e.indexOf("authorization")||!r||r.setConfigParam(e,t),0==e.indexOf("renderer")&&this.getRenderer()&&this.getRenderer().setConfigParam(e,t),0==e.indexOf("debug")&&this.core&&this.core.setConfigParam(e,t))},b.prototype.getConfigParam=function(e){var t=this.getMap();switch(e){case"pos":case"position":if(!t)return this.config.position;t.getPosition();break;case"view":return t?t.getView():this.config.view;case"panAllowed":return this.config.panAllowed;case"rotationAllowed":return this.config.rotationAllowed;case"zoomAllowed":return this.config.zoomAllowed;case"jumpAllowed":return this.config.jumpAllowed;case"sensitivity":return this.config.sensitivity;case"inertia":return this.config.inertia;case"legacyInertia":return this.config.legacyInertia;case"timeNormalizedInertia":return this.config.timeNormalizedInertia;case"bigScreenMargins":return this.config.bigScreenMargins;case"navigationMode":return this.config.navigationMode;case"constrainCamera":return this.config.constrainCamera;case"positionInUrl":return this.config.positionInUrl;case"positionUrlHistory":return this.config.positionUrlHistory;case"controlCompass":return this.config.controlCompass;case"controlZoom":return this.config.controlZoom;case"controlMeasure":return this.config.controlMeasure;case"controlScale":return this.config.controlScale;case"controlLayers":return this.config.controlLayers;case"controlSpace":return this.config.controlSpace;case"controlSearch":return this.config.controlSearch;case"controlLink":return this.config.controlLink;case"controlGithub":return this.config.controlGithub;case"controlMeasure":return this.config.controlMeasure;case"controlMeasureLite":return this.config.controlMeasureLite;case"controlLogo":return this.config.controlLogo;case"controlFullscreen":return this.config.controlFullscreen;case"controlCredits":return this.config.controlCredits;case"controlLoading":return this.config.controlLoading;case"controlSearchElement":return this.config.controlSearchElement;case"controlSearchValue":return this.config.controlSearchValue;case"controlSearchUrl":return this.config.controlSearchUrl;case"controlSearchSrs":return this.config.controlSearchSrs;case"controlSearchFilter":return this.config.controlSearchFilter;case"minViewExtent":return this.config.minViewExtent;case"maxViewExtent":return this.config.maxViewExtent;case"rotate":return this.config.autoRotate;case"pan":return this.config.autoPan}return 0==e.indexOf("map")&&t?t.getConfigParam(e):0==e.indexOf("renderer")?t.getConfigParam(e):void 0},t.a=b},function(e,t,i){"use strict";var r=i(182),s=i(171),a=i(183),n=r.a,o=s.a,h=a.a,l=function(e){this.browser=e,this.ui=e.ui,this.mapControl=this.ui.getMapControl(),this.mapElement=this.mapControl.getMapElement(),this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.mapElement.on("drag",this.onDrag.bind(this)),this.mapElement.on("mousedown",this.onDown.bind(this)),this.mapElement.on("mouseup",this.onUp.bind(this)),this.mapElement.on("mousewheel",this.onWheel.bind(this)),this.mapElement.on("keyup",this.onKeyUp.bind(this),window),this.mapElement.on("keydown",this.onKeyDown.bind(this),window),this.mapElement.on("keypress",this.onKeyPress.bind(this),window),this.mapElement.on("dblclick",this.onDoubleClick.bind(this),window),this.browser.on("tick",this.onTick.bind(this)),this.controlModes={},this.currentCotnrolModeId="map-observer",this.currentControlMode=this.controlModes["map-observer"],this.addControlMode("map-observer",new o(e)),this.addControlMode("disabled",new n),this.addControlMode("pano",new h(e)),this.setDefaultControlMode()};l.prototype.addControlMode=function(e,t){this.controlModes[e]=t},l.prototype.removeControlMode=function(e){e!==this.currentCotnrolModeId&&delete this.controlModes[e]},l.prototype.setCurrentControlMode=function(e,t){var i=this.controlModes[e];i&&(this.currentControlModeId=e,this.currentControlMode=i,i.reset&&i.reset(t))},l.prototype.setDefaultControlMode=function(){this.setCurrentControlMode("map-observer")},l.prototype.getCurrentControlMode=function(){return this.currentControlModeId},l.prototype.getCurrentController=function(){return this.currentControlMode},l.prototype.onDrag=function(e){this.checkAutopilot(),this.currentControlMode.drag&&this.currentControlMode.drag(e)},l.prototype.onDown=function(e){this.checkAutopilot(),this.updateModifierKeys(e),this.currentControlMode.down&&this.currentControlMode.down(e)},l.prototype.onUp=function(e){this.updateModifierKeys(e),this.currentControlMode.up&&this.currentControlMode.up(e)},l.prototype.onWheel=function(e){this.checkAutopilot(),this.currentControlMode.wheel&&this.currentControlMode.wheel(e)},l.prototype.onKeyUp=function(e){this.updateModifierKeys(e),this.currentControlMode.keyup&&this.currentControlMode.keyup(e)},l.prototype.onKeyDown=function(e){this.updateModifierKeys(e),this.currentControlMode.keydown&&this.currentControlMode.keydown(e)},l.prototype.onKeyPress=function(e){this.updateModifierKeys(e),this.currentControlMode.keypress&&this.currentControlMode.keypress(e)},l.prototype.onDoubleClick=function(e){this.updateModifierKeys(e),this.currentControlMode.doubleclick&&this.currentControlMode.doubleclick(e)},l.prototype.onTick=function(e){this.currentControlMode.tick&&(e.draggingState=this.mapElement.getDraggingState(),this.currentControlMode.tick(e))},l.prototype.updateModifierKeys=function(e){this.altKey=e.getModifierKey("alt"),this.shiftKey=e.getModifierKey("shift"),this.ctrlKey=e.getModifierKey("ctrl")},l.prototype.checkAutopilot=function(){this.browser.autopilot&&(this.browser.autopilot.setAutorotate(0),this.browser.autopilot.setAutopan(0,0))},t.a=l},function(e,t,i){"use strict";var r=function(){};t.a=r},function(e,t,i){"use strict";var r=i(4),s=r.a,a=function(e){this.browser=e,this.config=null,this.center=[0,0],this.dragging=!1,this.velocity=[0,0],this.impulse=[0,0],this.drag=this.drag,this.down=this.drag,this.up=this.drag,this.wheel=this.wheel,this.tick=this.tick,this.reset=this.reset,this.keyup=this.keyup,this.keydown=this.keydown,this.keypress=this.keypress};a.prototype.drag=function(e){if(this.dragging){var t=e.getMouseCoords(),i=[t[0]-this.center[0],t[1]-this.center[1]];this.velocity[0]=.008*i[0],this.velocity[1]=.008*i[1],this.impulse[0]=.008*i[0],this.impulse[1]=.008*i[1]}},a.prototype.down=function(e){"left"===e.getMouseButton()&&(this.center=e.getMouseCoords(),this.dragging=!0)},a.prototype.up=function(e){"left"===e.getMouseButton()&&(this.dragging=!1)},a.prototype.wheel=function(e){var t=this.browser.getMap();if(t){var i=t.getPosition(),r=e.getWheelDelta(),a=1*(r>0?-1:1);i.setViewExtent(s.clamp(i.getViewExtent()+a,1,179)),t.setPosition(i)}},a.prototype.keyup=function(){},a.prototype.keydown=function(){},a.prototype.keypress=function(){},a.prototype.tick=function(){if(0!=this.velocity[0]||0!=this.velocity[1]){var e=this.browser.getMap();if(e){var t=e.getPosition(),i=t.getCoords();if(i[0]-=this.velocity[0],i[1]-=this.velocity[1],t.setCoords(i),e.setPosition(t),!this.dragging){Math.abs(this.velocity[0])<5e-4?this.velocity[0]=0:this.velocity[0]*=.9,Math.abs(this.velocity[1])<5e-4?this.velocity[1]=0:this.velocity[1]*=.9}}}},a.prototype.reset=function(e){this.config=e},t.a=a},function(e,t,i){"use strict";function r(e,t){var i=new C(e,t);return i.core?i:null}function s(){return""+g()}Object.defineProperty(t,"__esModule",{value:!0});var a=i(21),n=i(34),o=i.n(n),h=i(13),l=i(1),u=i(2),c=i(4),d=i(22),p=i(174),f=i(10);i.d(t,"earcut",function(){return o.a}),i.d(t,"vec2",function(){return v}),i.d(t,"vec3",function(){return y}),i.d(t,"vec4",function(){return b}),i.d(t,"mat3",function(){return x}),i.d(t,"mat4",function(){return w}),i.d(t,"math",function(){return A}),i.d(t,"utils",function(){return S}),i.d(t,"getCoreVersion",function(){return g}),i.d(t,"checkSupport",function(){return m}),i.d(t,"browser",function(){return r}),i.d(t,"getBrowserVersion",function(){return s}),i.d(t,"proj4",function(){return T}),i.d(t,"platform",function(){return P}),i.d(t,"dom",function(){return M});var g=h.a,m=h.b,v=l.a,y=l.b,b=l.c,x=l.d,w=l.e,S=u.a,M=f.a,A=c.a,C=p.a,T=a.a,P=d.a},function(e,t,i){"use strict";var r=function(e,t){this.container=null,this.aTags=null,this.sectionTags=null,this.defaultHeight=0,this.maxHeight=0,this.subtitlesHeights=[],this.firstTitleMargin=20,this.swipeOffset=60,this.actualNode=0,this.maxNodes=1,this.animTime=600,this.currentToolbox="right",this.browser=e,this.id=[],this.current=null,this.presenter=void 0!==t.presenter?JSON.parse(JSON.stringify(t.presenter)):{},this.presenterAutoplay=t.presenterAutoplay,void 0!==this.presenter&&this.playPresentation()};r.prototype.addPresentation=function(e,t){0!==Object.keys(this.presenter).length?this.presenter[e]=t:void 0!==e&&(this.presenter={},this.presenter[e]=t)},r.prototype.removePresentation=function(e){return void 0!==e?(this.getCurrentPresentation()==e&&(this.stopPresentation(),this.current=null),delete this.presenter[e],"Removed presentation id: "+e):(null!==this.getCurrentPresentation()&&this.stopPresentation(),this.presenter={},this.presenterAutoplay="",this.current=null,"All presentations removed.")},r.prototype.getCurrentPresentation=function(){return this.current},r.prototype.getCurrentPresentationType=function(){return this.currentToolbox},r.prototype.playPresentation=function(e){if(this.stopPresentation(),void 0!==this.presenterAutoplay&&void 0===e)e=this.presenterAutoplay;else if(void 0===e&&void 0!==this.presenter&&Object.keys(this.presenter).length>0)for(var t in this.presenter){e=t;break}return void 0!==e&&-1!=Object.keys(this.presenter).indexOf(e)&&(this.current=e,this.readTextInput(e),!0)},r.prototype.stopPresentation=function(){var e=this.getCurrentPresentation();return this.currentToolbox="right",null!==e&&(this.current=null,this.browser.ui.removeControl(e),this.container.getElementsByTagName("article")[0].parentNode.parentNode.parentNode.remove(),!0)},r.prototype.listPresentations=function(e){if(0===Object.keys(this.presenter).length)return[];if(void 0!==e)return"undefined"!==this.presenter[e]?this.presenter[e]:null;var t=[];for(var i in this.presenter)t.push(i);return t},r.prototype.initPresentation=function(e,t){var i=this,r='<div class="vts-presenter panelContainer"><div class="vts-presenter swipeControl top"></div><div class="vts-presenter toolboxContainer">'+t+'</div><div class="vts-presenter swipeControl"></div></div>',s='<div class="vts-presenter subtitlesContainer"><button type="button"></button><button type="button"></button><div class="vts-presenter swipeSubtitles"><div><div></div></div></div><div class="vts-presenter swipeSubtitles"><div><div></div></div></div><div class="vts-presenter innerContainer">'+t+"</div></div>",a=r+s,n=this.browser.ui.addControl(e,a);this.id.push(e),this.setContainer(n),this.aTags=this.container.getElementsByTagName("a");for(var o=0;o<this.aTags.length;o++)this.aTags[o].onclick=function(){i.linksDecode(this)};setTimeout(function(){this.renderControl()}.bind(this),200)},r.prototype.readTextInput=function(e){var t={htmlDataStorage:this.presenter[e],id:e,checkID:function(){var e=/^(ftp|http|https):\/\/[^ "]+$/,t=/.*\/+.*/,i=/(\.\.\/|\.\/)/g,r=/^#.*$/;if(/(<article)/g.test(this.htmlDataStorage))return"string";if(e.test(this.htmlDataStorage))return"url";if(t.test(this.htmlDataStorage)){for(var s,a=0,n="",o=window.location.href.split("/"),h="";null!==(s=i.exec(this.htmlDataStorage))&&(n+=s[0],"./"!==s[0]);)a++;a++;for(var l=0;l<o.length-a;l++)h=h+o[l]+"/";return h+=this.htmlDataStorage.split(n)[1],this.htmlDataStorage=h,"url"}return r.test(this.htmlDataStorage)?"hash":"string"}},i=t.checkID();if("url"==i){var r=new XMLHttpRequest;r.open("GET",t.htmlDataStorage,!1),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0==r.status){var e=r.responseText;this.html=e,this.initPresentation(t.id,this.html)}else this.file="undefined"}.bind(this),r.send(null)}else if("hash"==i){var s=document.getElementById(t.htmlDataStorage).innerHTML;this.initPresentation(t.id,s)}else"string"==i&&this.initPresentation(t.id,t.htmlDataStorage)},r.prototype.linksDecode=function(e){var t=null,i=null,r=null,s=null;return null!==e.getAttribute("data-mln-navigate")&&null!==(s=e.getAttribute("data-mln-navigate"))?("prev"==s?this.nextArticle("-1"):"next"==s?this.nextArticle("+1"):"first"==s?this.nextArticle(0):"last"==s?this.nextArticle(this.maxNodes-1):this.nextArticle(s),"navigation:true"):null===e.getAttribute("data-mln-position")?"position:false":(t=this.getNumbers(e.getAttribute("data-mln-position").split(",")),null!==e.getAttribute("data-mln-autorotate")&&(i=this.getNumbers(e.getAttribute("data-mln-autorotate"))),null!==e.getAttribute("data-mln-transition")&&(r=e.getAttribute("data-mln-transition")),null===r?this.browser.autopilot.flyTo(t):"teleport"==r?this.browser.core.getMap().setPosition(t):this.browser.autopilot.flyTo(t),null!==i&&this.browser.autopilot.setAutorotate(i),"Moving to position: "+t)},r.prototype.getNumbers=function(e){for(var t=0;t<e.length;t++){if("string"==typeof e&&parseFloat(e)){e=parseFloat(e);break}parseFloat(e[t])&&(e[t]=parseFloat(e[t]))}return e},r.prototype.nextArticle=function(e,t,i){return"+1"===e?e=1:"-1"===e?e=-1:(this.actualNode=e,e=0),this.actualNode=this.actualNode+e,this.actualNode>=0&&this.actualNode<this.maxNodes?(t||("right"==this.currentToolbox?this.handleArticle(this.actualNode):"wide"==this.currentToolbox&&this.handleSubtitlesPosition(this.actualNode)),void 0!==i&&(this.maxNodes=i),this.linksDecode(this.container.getElementsByTagName("section")[this.actualNode]),!0):(this.actualNode=this.actualNode-e,!1)},r.prototype.useToolbox=function(){var e=this.container.getElementsByTagName("article")[0].getAttribute("data-mln-style");null===e&&(e="right");var t,i=this.container.getElementsByClassName("vts-presenter panelContainer")[0],r=this.container.getElementsByClassName("vts-presenter subtitlesContainer")[0],s=this.container.getElementsByClassName("vts-presenter swipeControl");if(this.currentToolbox=e,r.setAttribute("style","opacity: 0;"),r.setAttribute("class","vts-presenter subtitlesContainer"),"right"==e){for(i.style.display="block",setTimeout(function(){i.style.opacity=1},20),s[0].style.display="block",s[1].style.display="block",t=0;t<this.sectionTags.length;t++)this.sectionTags[t].style.height=this.maxHeight+"px";this.nextArticle(0)}else if("wide"==e){for(r.style.display="block",setTimeout(function(){r.style.opacity=1},20),i.style.display="none",i.style.opacity=0,s[0].style.display="none",s[1].style.display="none",t=0;t<this.sectionTags.length;t++)this.sectionTags[t].style.height="auto";this.handleSubtitlesPosition(0,!0)}},r.prototype.setContainer=function(e){this.container=e.element},r.prototype.renderControl=function(){this.sectionTags=this.container.getElementsByClassName("vts-presenter toolboxContainer")[0].querySelectorAll("section");var e=this.container.getElementsByClassName("vts-presenter swipeControl")[0],t=this.container.getElementsByClassName("vts-presenter swipeControl")[1],i=document.createElement("button");i.innerHTML="<div><div></div></div>",i.setAttribute("type","button"),i.setAttribute("class","vts-presenter-btnDw"),i.onclick=function(){this.nextArticle("+1")}.bind(this);var r=document.createElement("button");r.innerHTML="<div><div></div></div>",r.setAttribute("type","button"),r.setAttribute("class","vts-presenter-btnUp"),r.onclick=function(){this.nextArticle("-1")}.bind(this),e.appendChild(r),t.appendChild(i),this.getElementsTrueHeight(this.sectionTags);var s=this.maxHeight+this.swipeOffset;this.container.getElementsByClassName("vts-presenter panelContainer")[0].style.height=s+this.swipeOffset+"px",t.style.top=s+"px",e.style.opacity="1",t.style.opacity="1",setTimeout(function(){this.useToolbox()}.bind(this),this.animTime),this.nextArticle(0,!1,this.sectionTags.length)},r.prototype.getElementsTrueHeight=function(e){for(var t=0;t<e.length;t++)e[t].offsetHeight>this.maxHeight&&(this.maxHeight=e[t].offsetHeight);for(t=0;t<e.length;t++)e[t].style.height=this.maxHeight+"px"},r.prototype.handleArticle=function(e){var t=this.container.getElementsByClassName("vts-presenter toolboxContainer")[0],i=this.container.getElementsByClassName("vts-presenter-btnUp")[0],r=this.container.getElementsByClassName("vts-presenter-btnDw")[0],s=function(e){this.container.getElementsByClassName("vts-presenter toolboxContainer")[0].querySelectorAll("article")[0].setAttribute("class",e)}.bind(this),a=this.maxHeight*this.actualNode*-1;return i.setAttribute("class","vts-presenter-btnUp"),r.setAttribute("class","vts-presenter-btnDw"),0===e?i.setAttribute("class","vts-presenter-btnUp vts-presenter hidden"):e===this.maxNodes-1&&r.setAttribute("class","vts-presenter-btnDw vts-presenter hidden"),this.container.getElementsByTagName("article")[0].setAttribute("style","top: "+a+"px"),0===this.actualNode?(t.style.height=this.maxHeight+this.swipeOffset+"px",t.style.top=0,s("vts-presenter"),this.container.getElementsByClassName("vts-presenter swipeControl")[0].style.height=0,this.container.getElementsByTagName("article")[0].style.top=0,this.container.getElementsByTagName("section")[0].style.height=this.maxHeight+(this.swipeOffset-this.firstTitleMargin)+"px"):(t.style.height=this.maxHeight+"px",t.style.top=this.swipeOffset+"px",s("vts-presenter nonFirst"),this.container.getElementsByClassName("vts-presenter swipeControl")[0].style.height=this.swipeOffset+"px",this.container.getElementsByTagName("section")[0].style.height=this.maxHeight+this.swipeOffset+"px"),!0},r.prototype.handleSubtitlesPosition=function(e,t){void 0===e&&(e=0);var i=this.container.getElementsByClassName("vts-presenter subtitlesContainer")[0],r=i.childNodes[0],s=i.childNodes[1],a=i.childNodes[4].querySelectorAll("article")[0].querySelectorAll("section"),n=this.container.getElementsByClassName("vts-presenter swipeSubtitles");this.linksDecode(a[e]),a[e].removeAttribute("style"),i.setAttribute("class","vts-presenter subtitlesContainer"),i.removeAttribute("onclick"),n[0].removeAttribute("onclick"),n[1].removeAttribute("onclick"),n[0].removeAttribute("style"),n[1].removeAttribute("style"),r.removeAttribute("onclick"),s.removeAttribute("onclick"),r.setAttribute("class","vts-presenter hidden"),s.setAttribute("class","vts-presenter hidden");for(var o=0;o<a.length;o++)a[o].style.opacity=0,void 0===this.subtitlesHeights[o]&&(a[o].style.display="block",this.subtitlesHeights[o]=a[o].offsetHeight,a[o].style.display="none"),o!==e&&this.hideSections(a[o]);this.showSections(a[e]);var h=a[e].getAttribute("data-mln-style");void 0==h&&(h="full"),"full"==h?(n[0].style.opacity=0,n[1].style.opacity=0,n[0].style.cursor="default",n[1].style.cursor="default",0===e?(r.setAttribute("class","vts-presenter hidden"),s.setAttribute("class","vts-presenter"),s.onclick=function(){this.nextArticle(1)}.bind(this),s.innerHTML="Continue"):e===a.length-2&&(r.setAttribute("class","vts-presenter"),r.onclick=function(){this.nextArticle("-1")}.bind(this),r.innerHTML="Back",s.setAttribute("class","vts-presenter"),s.onclick=function(){this.nextArticle("+1")}.bind(this),s.innerHTML="Explore"),void 0===t&&i.setAttribute("style","display: block;"),i.setAttribute("class","vts-presenter subtitlesContainer full")):"title"==h?(n[0].style.opacity=1,n[1].style.opacity=1,n[0].onclick=function(){this.nextArticle("-1")}.bind(this),n[1].onclick=function(){this.nextArticle("+1")}.bind(this),r.setAttribute("class","vts-presenter hidden"),s.setAttribute("class","vts-presenter hidden"),i.style.height=this.subtitlesHeights[e]+"px",i.setAttribute("class","vts-presenter subtitlesContainer title")):"mini"==h&&(i.setAttribute("style","display: block;"),i.setAttribute("class","vts-presenter subtitlesContainer mini"),r.setAttribute("class","vts-presenter hidden"),s.setAttribute("class","vts-presenter hidden"))},r.prototype.hideSections=function(e){setTimeout(function(){e.style.display="none"},this.animTime)},r.prototype.showSections=function(e){setTimeout(function(){e.style.display="block",setTimeout(function(){e.style.opacity=1},50)},this.animTime)},t.a=r},function(e,t,i){"use strict";var r=function(e){this.roiServers=e};r.prototype.roisAtPosition=function(){},t.a=r},function(e,t,i){"use strict";var r=i(10),s=r.a,a=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("compass",'<div id="vts-compass"><div id="vts-compass-frame"><img id="vts-compass-compass" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAABjCAYAAACPO76VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODRDNjZFNDJCQjNCMTFFM0IyN0ZCQTZFQTAwNzEzNDUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODRDNjZFNDNCQjNCMTFFM0IyN0ZCQTZFQTAwNzEzNDUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4NEM2NkU0MEJCM0IxMUUzQjI3RkJBNkVBMDA3MTM0NSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4NEM2NkU0MUJCM0IxMUUzQjI3RkJBNkVBMDA3MTM0NSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pgg3VBcAAAzUSURBVHja7F1bbBTXGf7tNdiAbTAXYxscMJe04GDLwVwKNDgNhaogRB+4qKgtzUMrISEhIXjiLsT9gQd4oQ8lPFRtEdACoWCCuASRBCelJBASEnM1xsbgGwYbg03PN/4PHI93vTO7s7tnxv6kX7Pe9Y7H/zf/5fxnzn/iXr16Rd3QA3HdZHST0Q2XktFTSLKQNCGpQlKEJLL4WFqFvGRp5uMTIfVCaoQ08PvdZNgEFJ8uZIiQQQ6fu0rIfSEPmaBuMvygv5CRQrJN78cLyeLPQc4AIX2ZsB5Cegn5qZBqIff47oc8F1In5DErH5+XswWpwHdK+fMuTQYUOUrIaJPy3xLyEyYnV0iGQ3+vQsg1Vv73Qu6ayPlByI9CGrsSGf34bs5SCMgRksfKL4jSdVxmcr4WckshBhb0nZBaL5ORysrO5J+ThExmmRBjD3FJyBdCPhfSxO89YLLqvUQGsp18IcP5Z2RD04X8jC1EJ8AiPhNyjrMx4LaQK0Ja3E7GGBaZon4gZCbHBZ2BeHJKyCdKSnydxXVk+Nj1ZHFMeEfIbCGFLhuHfSnkYyFXOaYgnpREykoiQQbSz2lMCFLS+WwNbkaxkAOcAoOIC5w2a03GOCVVRXa0UMO4EE48+QdnXzIV/kZXMibwoA0WMU/Ib8mb+JuQf7GF3GO3pQ0Z8ZwZDeZMaYmQIvI2zgrZxxlXJWdgrbEmA0T8nOMEyPijBmOGaAEW8VcmA/Hj03AJCYeMOA7UKOYNFfJ7IeOpa+ErIfuFlFFbERKB/VU4d3aomMhEoID3oVUijhw5QqWlpV4hYzz/77LCPDFcNxMK3uULQJ3pdzzCtoSmpiaqqanxknXksw7SWCfvRpOMd7i0gTL2n63EiKqqKrp+vW3w2qtXL3r27JnX3BV08CfWyXDWUcTJgCW8zenrEqtmWVlZSSUlbRlg7969qbGxkTyIiawTH+soLZJk4Hen8OtfC3nfikuSBMjXHrUMifdZN8Tpvq2bPcEm8yh7j7E6oNu8eTNt3LjRIEMS0LdvXzp27BhdvnyZfD6f8RkIeu+99ygvL88LhEA3mKS6zjr73GkyQICc/kStqaedq+vTp89ry8jNzTVIAl68eEFPnz41iEpOTvaKdfRkHe1WdHfdKTJ8fMJ4/iP5wVJX3OX9+vVrRwaC+KFDhwwrgMAiBg4cSCNGjGj3ux7KsKCrv7DubpCFSm+8xRMDKAIGrb6WlZXRkydt8zJwQy9fvqT4+HhasmQJZWVlUWJiIjU0NNCdO3fo1q1brtEuLLi52dbTPjMV3eU7YRmpnKolKoGpUyQlJb2OD7AAKD09Pd1wTyDFjbh48SJduHCBVq1aZfervxLyLesQcaQ+HDJy+TiDLE4Mwf3gLgLGjh1LR48epefPnxvpbGtrK8XFxdH69euNoxusYefOnXTu3Dk6cOBAKKcoZN19zLr8LFQy4Mjx8EAKn9AS1NR1zpw5rnX6sIZNmzbRw4cPacOGDTRgwIBQTwXdnVd0WhsKGXJSqIhszFmDjOPHj9OlS5deB2vI9OnTKSMjwzXWAIsGpk2bRrNnzw7nlG+xDo+yTgOmuoGqtkkcI3DcSG0PlFkGLEOmrPL1yJEjKS0tzTXWYATM1FTDPYVhFRKojK6ltseA/kMBHpQLZBly6nSyXSJk3IC4KVNSrUFixYoVThBBrEPo8iy1PUX5jZ3UdjR/Nok8DgTn+fPndyDCAfdkxiTW6Wg7MaM/H3MozPq8zsBYaNu2bXTixImO+bxwT2vWrHH6T05knZayjqutWIZ0S3letwZ/RADLly93yj2ZkWfScVDLyGaScruSNUhMnjyZ5s6dG6lLgE7/zTouCUaGrNZhxFjgNWvYsmULPXr0KODvoFi5du3aSF5GAev2Juu6oTMy0k3ZVJewBtU9oXQTYbzNZKQHI2NIZz7Ni9aguqd58+ZF47JGKLq+2RkZeMLB5/Z4YccaouSezHHDR37WK6pkyAkj1KMyuoI1RNk9SWSwjstY583+yEg2jTNchbq6OsMaiouLbX0viu7JPJYrY51X+xtnpJnihmtw+vRpY9xgl4gouycVQ00672AZqXwc4CZr2Lp1K506dSqk70fZPfmrcqQGIiOFj33dYg1wS9XVoS3hjpF7IpOOUwKRkWSKHdoCAfrgwYMhfz+G7skcn5PUN+P9ZFM9dLcISUSoU7cxdE8SiSaddyDDx8deumdMAOZLMAeBCqsdTJo0KZbuyWwZvmBkaLsGD8Faxohly5YZU7l79uyxTAgIXL16tQ7/yshgZMhVN9U6EgH3JLOmCRMmGKksMGbMGMuEgMDMzExtXbBKxks+3tPdPZmDrxVCVAI1gFwt1BKMDO2aZG3fvr2de/J3d3dGiD8CY4yGYGRIEl7odNWoNZ08edLS3R2IEA3d03N/N75KhiRBm5UsqL5iTGHn7gYhixYt0tU9mS2jKdCgD8+BDtIpgCNOyOqrlbvbXB7R0D1JyFYXdYHIkKseH+ninuR8hJW721weARF4wkPT7OmRSecdyJD9lcrd5J78FQtBHr6jcRpbbtJ5BzKkH6t1i3vyZw34fQ1jhBm1Jp13IEMGcLRfQHPFjFi7p8LCQr+Kdak1SFSwjjtkruY58CoO4tdiQYbqnvDkur/ShYutQeIajy+qzB+YybjPZGCE+EEs3dPSpUtp6NChnVoD5iQQpAcPHkwuwk1F152S8ZCPP8TSPRUUFLQbK5itAfMRKINrUH0NBTdMug5Ihgwot6mt72tBLNzTunXrjLkKKB8kgAzVGhAbYjwfESous247BG9/ZAAoFGazbyuIlXtCCWTHjh1UW1vrBWuQwGLLVgpQjPVHRimT8XU0ru78+fPt3NOsWbNo5cqVdObMGa9Yg4orio4tkSHLIVikjU7IEVujgRVDCMrSPU2dOpUWLFjgNWuQuMQ6pUAlp0DLyBDA8fDzF5EkA9Omcv0csHv3bi9ag0QJu6iAyVEgMn5kMrAyEwstHX8QGosZ1aVbsu2RbtaARmXoHIeWG3KtonxtA3BLFxXd2iKjkesnaN7yqdNkwD1hVakZOloDGgqADNwsUpBsFBUV0cyZlnsnQ4dNrNNGu2QA3zEZZ4X8ghzsX252T5gMgjVEcMVQyMDa9YULF7Z7D60rHj+23PD5LusQ+L6zX0wIUsx6wK/RoP3DSLgnrCrFKDpCa+hCAtbGo6UGjuh3guQCDWhGjRpldH2Ai0LDGouA7p6wLmtCJUPWUTL5hFgcWOiUe4I1YJ21w8t7HQEGnGhRAaDfCa4bloyH50AGYobFbnJfsu6kLikcMup5xDhcyIlwyZDuSUdrkGUXjPplPywZrMeNG2e8J5MMtc1fEEBnmO++QxY2RbHSc+iKciwOxz2h/oQ7bteuXdoRAeTk5NCwYcOMjA6Bu7y8nPbt22dYR0JCArW0tD3MkZKS0q6IGQDFiu7+Z+XvW+nEhitAWzd0FEOfH5RI8+26JwQ9h/pwOIr6+nqjGRnu9uzsbKMznIobN24Y1w8CJNA5LkiycYV11cq6a3GKDOITysfYDzAxlvsU9ujRI5TGWVHB7du3jZIMXBDiAO5+dI9bvHix0bAMzczMZARBM73Za6OcbOxGY6cXOlwaOovhMXbcFn8gj+Lw4cPGHMmUKVNo7969NGPGDMNiECdAThB8JOQIjytOkI1m9Xb61OGkspMYOoud8SoZaiNktc2fBSLOsG6IQtjGwW7TQOTJshPlPnJwIw+doHaTw9y6xZnEEtZJC+vIdsP3hBCu9SrHi+FskiB0vNcso6KiwniNJxQt4CvWRQMPBa6G8ncTQrze/9KbRTX7+Tz5XiEDHeMsuCQ1c9rPI+xK1k1og80wNjOBRWAzk4HUvZkJaiOYqrxAYewu4+Q2P5mcYXWlbX4+YouI+TY/KiFdbQOsc0xEHWm0AZYKuTUc4sdvhCzyKBF/x1CE2hYXabc1nIruTRM1IoOo43aiC4T80uVE4DHGf5LLthOVMG+0C4vBXLobN9o9zhbgyo12VahbUKMrwAwWN2xB/QmLXH/n2i2ozVZi3py9iFNi3drvlXKKepY8uDm7CixBzeXxCIAhLjbUmqjB2ASuBw+Z4XEaOYWH8QOmSuujdRHRJON1tYEzrExlnJLD1jOWotfCFQ8hf8t3/S1lnPCAM6eo7+wYCzIkUNsaRe3btsZzPAFZI9iSnFq0U8F3+k1W9l3TQA2pKh4wi9nS61iSoaI/x49sP6N7uQvaEE6bMeOYzAlBmpIM3OW7GQG3gUfHSD/v05tZN/Mo+R6T81gHJehChopkLq2AhEEOn7uKSakkP+sjuskIjp5MUBonASkc/HtypibbBLWwNHMQfsLBt4YV36z7P+oGMroMusnQCP8XYACgtQtbAKLiKwAAAABJRU5ErkJggg=="></div><div id="vts-compass-frame2"><img id="vts-compass-compass2" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAABjCAYAAACPO76VAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABG9JREFUeNrtnM9LFGEcxkeEPCQVmbkh7EXoEgW6noIQzQwKoQ5Lkgh7SA8iddlCQfAQFApdghAxooJCsEMe9JAEek8i81YQCIEYQvgHZM9L37Fpmpl9Z3d+rs8DDw7unuaz3+ddX+d9DIOiKIqiKIqiKIqiKIqiKIqiKIqiKMpTQ0NDyqNwTq7/MRUNAKsfwL2EER+MLHxBru/BA4QR3zR0wY/lWmmEMKKHcVh+tsEv5PoGPE4Y0cP4LD9b4AW57oC/whvwB3gZfgN3886FG1EmjAZ41WEa6uAm+DTcyLsXPAz11fWkDUYtvAVPwHfgAnwdbmVMhQtjDj4jN3gNPiTXF+E8fAsuwvfhQScIuVwuMusK762H69IGYwY+LwDew+3wcZkOQ2fhThoMvK8TnkrjZEzCV+RGF2XhXoE/wuvwJ7jGK5aSAkOm4Qm8DTemEcYYfNNtCnTWiCTAkGn4Bu/B+bSuGcPwF3gJfg1Pww/l661uLMQGwzINe+L5tH+1PSpbIOdkG0TtRWWSDsM2Dco/UhlPQSpqGA7TsJfqeEorDLjHNg3pj6cUwjgCzzpAYDxFDENNw6YLCOU+Uggfhtc0mH5LAuHDKDUNyjtwhgTCg6EzDab7effDg6EzDYynkGH4mQbGU4gw/EwD4ykkGMfgZz4hMJ5CgHEV/l4GCMZTgDDUNDwvAwLjKeD1odxp2I8nP/92JQx3P6oAwn48EUYw64N5U3+VG09+H0ggDOc1woymn/Bl2WH1A2KhnKdDCON/WxfrgvzurA8gCmAzYVQOwxpPi7bXdIEUyn1uijDc46nZ4T2lgCxW8hAbYfz1U69PtwYQN4AE4BNGT6lPtwaQQqWPdxLGn93XzVKfbgff1QVI6cOY1Ywnt+2RkgApPRh+48m+PaJA9Ab1FPpBhuEnnpw2Cxd1I40qDUM3npymoRDG+YyDCsMaT0thTANh6MGwxtMunA1jGghDD4Y1ngY1pkH9T+JUFMfIDhoMazy9g2s8pmHHug1OGMHCcIunBvilwzRkoj5geZBgOMXTNXgrjGkgDHcYl2zxdAJ+FeY0EIYziHrLQRUVT7ejmAbCcIZhPbq1G9U06MIo97RuGkF0ejy50Z9LwDlwuekZOSB6QQ6MZuUAaVXGU+TT4BNGixydnpaj1EtytHq4GuPJPEPXF/HBSkcYOmUCUjowVo3xNK8OM8YBwgNGjdRqrEvNxorUbhTldVXHMVlN8aSmIR8XBDsMjymolSKadimmMaSoZqZa4mnePNqbMBiDUr1UlCqmvFQzGVLVtCbXqsJpLu3xtG1vHYgThMMUtEopWUFKyiaktKzWVmamys1G0xxPU04H3RMAo1Fq+Zqkps8OaFVq/aww0vt3hleDWQJgdEth5bIUWG5IoWWHvL5gNgJZYVABy2PRHpfKV0MqYNts1bC8eRHCGJEyZEPKkbvYwRsfjAGpCTdkGyRLAPHB6JUCfU5DAmDkpJ+XN4miKIqiKIqiKIqiKIqiKIqiKIpKpn4DKrVAiBFUfdUAAAAASUVORK5CYII="></div><div id="vts-compass-frame3"><img id="vts-compass-compass3" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGMAAABjCAYAAACPO76VAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABG9JREFUeNrtnM9LFGEcxkeEPCQVmbkh7EXoEgW6noIQzQwKoQ5Lkgh7SA8iddlCQfAQFApdghAxooJCsEMe9JAEek8i81YQCIEYQvgHZM9L37Fpmpl9Z3d+rs8DDw7unuaz3+ddX+d9DIOiKIqiKIqiKIqiKIqiKIqiKIqiKMpTQ0NDyqNwTq7/MRUNAKsfwL2EER+MLHxBru/BA4QR3zR0wY/lWmmEMKKHcVh+tsEv5PoGPE4Y0cP4LD9b4AW57oC/whvwB3gZfgN3886FG1EmjAZ41WEa6uAm+DTcyLsXPAz11fWkDUYtvAVPwHfgAnwdbmVMhQtjDj4jN3gNPiTXF+E8fAsuwvfhQScIuVwuMusK762H69IGYwY+LwDew+3wcZkOQ2fhThoMvK8TnkrjZEzCV+RGF2XhXoE/wuvwJ7jGK5aSAkOm4Qm8DTemEcYYfNNtCnTWiCTAkGn4Bu/B+bSuGcPwF3gJfg1Pww/l661uLMQGwzINe+L5tH+1PSpbIOdkG0TtRWWSDsM2Dco/UhlPQSpqGA7TsJfqeEorDLjHNg3pj6cUwjgCzzpAYDxFDENNw6YLCOU+Uggfhtc0mH5LAuHDKDUNyjtwhgTCg6EzDab7effDg6EzDYynkGH4mQbGU4gw/EwD4ykkGMfgZz4hMJ5CgHEV/l4GCMZTgDDUNDwvAwLjKeD1odxp2I8nP/92JQx3P6oAwn48EUYw64N5U3+VG09+H0ggDOc1woymn/Bl2WH1A2KhnKdDCON/WxfrgvzurA8gCmAzYVQOwxpPi7bXdIEUyn1uijDc46nZ4T2lgCxW8hAbYfz1U69PtwYQN4AE4BNGT6lPtwaQQqWPdxLGn93XzVKfbgff1QVI6cOY1Ywnt+2RkgApPRh+48m+PaJA9Ab1FPpBhuEnnpw2Cxd1I40qDUM3npymoRDG+YyDCsMaT0thTANh6MGwxtMunA1jGghDD4Y1ngY1pkH9T+JUFMfIDhoMazy9g2s8pmHHug1OGMHCcIunBvilwzRkoj5geZBgOMXTNXgrjGkgDHcYl2zxdAJ+FeY0EIYziHrLQRUVT7ejmAbCcIZhPbq1G9U06MIo97RuGkF0ejy50Z9LwDlwuekZOSB6QQ6MZuUAaVXGU+TT4BNGixydnpaj1EtytHq4GuPJPEPXF/HBSkcYOmUCUjowVo3xNK8OM8YBwgNGjdRqrEvNxorUbhTldVXHMVlN8aSmIR8XBDsMjymolSKadimmMaSoZqZa4mnePNqbMBiDUr1UlCqmvFQzGVLVtCbXqsJpLu3xtG1vHYgThMMUtEopWUFKyiaktKzWVmamys1G0xxPU04H3RMAo1Fq+Zqkps8OaFVq/aww0vt3hleDWQJgdEth5bIUWG5IoWWHvL5gNgJZYVABy2PRHpfKV0MqYNts1bC8eRHCGJEyZEPKkbvYwRsfjAGpCTdkGyRLAPHB6JUCfU5DAmDkpJ+XN4miKIqiKIqiKIqiKIqiKIqiKIpKpn4DKrVAiBFUfdUAAAAASUVORK5CYII="></div> </div>',t,i);var r=this.control.getElement("vts-compass");r.setDraggableState(!0),r.on("drag",this.onDrag.bind(this)),r.on("dblclick",this.onDoubleClick.bind(this)),this.image=this.control.getElement("vts-compass-compass"),this.image2=this.control.getElement("vts-compass-compass2"),this.image3=this.control.getElement("vts-compass-compass3"),this.lastStyle=""};a.prototype.update=function(){var e=this.browser.getMap();if(e){var t=e.getPosition(),i=t.getOrientation(),r="rotateX("+.7*Math.round(i[1]+90)+"deg) rotateZ("+Math.round(-i[0]-45)+"deg)";r!=this.lastStyle&&(this.lastStyle=r,this.image.setStyle(s.TRANSFORM,r),this.image2.setStyle(s.TRANSFORM,r),this.image3.setStyle(s.TRANSFORM,r))}},a.prototype.onDrag=function(e){if(this.browser.getMap()){this.browser.autopilot&&(this.browser.autopilot.setAutorotate(0),this.browser.autopilot.setAutopan(0,0));var t=e.getDragDelta(),i=this.browser.controlMode.getCurrentController();i.orientationDeltas&&i.orientationDeltas.push([.4*t[0],.4*-t[1],0])}},a.prototype.onDoubleClick=function(e){var t=this.browser.getMap();if(t){this.browser.autopilot&&(this.browser.autopilot.setAutorotate(0),this.browser.autopilot.setAutopan(0,0));var i=t.getPosition(),r=i.getOrientation();r[0]=0,r[1]=-90,i.setOrientation(r),t.setPosition(i),"azimuthal2"==this.browser.config.navigationMode&&(this.browser.config.navigationMode="azimuthal"),s.stopPropagation(e)}},t.a=a},function(e,t,i){"use strict";var r=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("credits",'<div id="vts-credits" class="vts-credits"> </div>',t,i),this.lastHTML="",this.lastHTML2="",this.lastHTML3="",this.credits=this.control.getElement("vts-credits")};r.prototype.getCreditsString=function(e,t,i){for(var r,s=this.browser.getMap(),a="",n=e.length,o="",h=!1,l=0;l<n;l++)r=s.getCreditInfo(e[l]),r.plain&&(o+=r.plain);if(o&&o.length>30&&n>1&&!i){for(l=0;l<n;l++)if(r=s.getCreditInfo(e[l]),""!=r.html.trim()){n=l+1;break}n<e.length?h=!0:n=e.length}for(l=0;l<n;l++)r=s.getCreditInfo(e[l]),r.html&&""!=r.html.trim()&&(a+=r.html,l+1<n&&(a+=t));return[a,h]},r.prototype.update=function(){var e=this.browser.getMap();if(e){var t,i="",r="",s="",a=e.getCurrentCredits();if(a.imagery.length>0&&(t=this.getCreditsString(a.imagery,", "),""!=t[0]&&(i+='<div class="vts-credits-supercell">',i+='<div class="vts-credits-cell">Imagery: '+t[0]+"</div>",i+=t[1]?'<div class="vts-credits-cell-button" id="vts-credits-imagery-more">and others</div>':"",i+='<div class="vts-credits-separator"></div>',i+="</div>",r='<div class="vts-credits-list">',r+=this.getCreditsString(a.imagery,"<br/>",!0)[0]+"</div>")),a.mapdata.length>0&&(t=this.getCreditsString(a.mapdata,", "),""!=t[0]&&(i+='<div class="vts-credits-supercell">',i+='<div class="vts-credits-cell">Map Data: '+t[0]+"</div>",i+=t[1]?'<div class="vts-credits-cell-button" id="vts-credits-mapdata-more">and others</div>':"",i+='<div class="vts-credits-separator"></div>',i+="</div>",s='<div class="vts-credits-list">',s+=this.getCreditsString(a.mapdata,"<br/>",!0)[0]+"</div>")),i+='<div class="vts-credits-supercell">',i+='<div class="vts-credits-cell">Powered by <a class="vts-logo" href="https://www.melown.com/products/vts/" target="blank">VTS 3D Geospatial Software Stack</a></div>',i+='<div class="vts-credits-separator"></div>',i+="</div>",this.lastHTML!=i){this.lastHTML=i,this.credits.setHtml(i);var n=this.control.getElement("vts-credits-imagery-more");n&&n.on("click",this.onMoreButton.bind(this,n,"2")),n=this.control.getElement("vts-credits-mapdata-more"),n&&n.on("click",this.onMoreButton.bind(this,n,"3"))}this.lastHTML2=r,this.lastHTML3=s}},r.prototype.onMoreButton=function(e,t){var i=e.getRect();t="2"==t?this.lastHTML2:this.lastHTML3,this.ui.popup.show({right:Math.max(0,i.fromRight-i.width)+"px",bottom:i.fromBottom+7+"px"},t)},t.a=r},function(e,t,i){"use strict";var r=function(e,t,i){this.ui=e,this.control=this.ui.addControl("fallback",'<div class="vts-fallback"><div class="vts-fallback-text"><p>VTS Browser needs <a href="http://get.webgl.org/">WebGL</a> capable web browser.</p></div> </div>',t,i)};t.a=r},function(e,t,i){"use strict";var r=i(10),s=r.a,a=function(e,t,i){this.ui=e,this.control=this.ui.addControl("fullscreen",'<img id="vts-fullscreen" class="vts-fullscreen" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAwUlEQVRo3u2YwRWDIBBEIc+SLMKmckpTFkFPePKQQ57DsitR/z/D6KgMDikBAMCTycKYxai9Bul8MYkic+NFS7BOs4FUa/1IrzTn9xk6O6+rrwEMjGayTlS/UXWeujbcDKgpEZRObgYOc1oYt7CIMXCFFLKmTrS+aqAEP8iSAGBYI1s776FLv7eReaWHWd/cyLz3Bas+vxIYGNXIhBTxOhcKNdCaHvPfGPjVYb3OhVjEGLhrI/Pewc9uZDQvAABwZQMKFi+DmFdLbgAAAABJRU5ErkJggg==">',t,i);var r=this.control.getElement("vts-fullscreen");r.on("click",this.onClick.bind(this)),r.on("dblclick",this.onDoNothing.bind(this)),this.enabled=!1};a.prototype.onDoNothing=function(e){s.preventDefault(e),s.stopPropagation(e)},a.prototype.requestFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},a.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},a.prototype.fullscreenEnabled=function(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled},a.prototype.onClick=function(){var e=this.ui.element;this.enabled?(this.enabled=!1,this.exitFullscreen()):(this.enabled=!0,this.requestFullscreen(e))},t.a=a},function(e,t,i){"use strict";var r=function(e,t,i){this.ui=e,this.control=this.ui.addControl("github",'<a target="_blank" href="https://github.com/Melown/vts-browser-js"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a>',t,i)};t.a=r},function(e,t,i){"use strict";var r=i(203),s=r.a,a=function(e,t,i,r,s){this.ui=e,this.html=t,this.elementsById=[],this.visible=null==i||i,this.element=document.createElement("div"),this.setVisible(this.visible),this.visibleLock=!!r,this.setVisibleLock(this.visibleLock),this.setHtml(t),s?s.appendChild(this.element):this.ui.element.appendChild(this.element)};a.prototype.setHtml=function(e){this.element.innerHTML=e;for(var t=this.element.getElementsByTagName("*"),i=0,r=t.length;i<r;i++){var a=t[i].getAttribute("id");null!==a&&(this.elementsById[a]=new s(this,t[i]))}},a.prototype.getElement=function(e){return this.elementsById[e]},a.prototype.setVisible=function(e){this.visibleLock||(this.element.style.display=e?"block":"none",this.visible=e)},a.prototype.getVisible=function(){return this.visible},a.prototype.setVisibleLock=function(e){this.visibleLock=e},a.prototype.getVisibleLock=function(){return this.visibleLock},t.a=a},function(e,t,i){"use strict";var r=function(e,t,i){this.ui=e,this.control=this.ui.addControl("layers",'<div class="vts-layers"</div>',t,i)};t.a=r},function(e,t,i){"use strict";var r=i(10),s=r.a,a=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("link",'<div id="vts-link" class="vts-link"><div id="vts-link-button" class="vts-link-button"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAABrUlEQVRIx+2VMWtUQRSFz5nZjVrpD9gNVhpLQbZZ5vWaIoUECayNRSpbo9UiJI1pBRs7DVjYGBC1ntm3yHaiwgYsZP+EmMe7x8K3YJEH+xYLwT3NcGe483HvnJkBVvovxWWSsiy7BeAxgGuSpmY2zPP8/V+DhBAekDysQgPgAMDMbo5Gow9n5bgmgF6vd47kAYBC0t0Y45qkPQAguV+X1wgymUx+ShqUZZmllI4AlEVRPJckkht1ea1FNu/3+1ve+31JV0h+dc49mq+12+0dkpQ0XfpMQgh7JJ9U4SmANf3WZUnXvfevAbQBbMYY3zVu1x+Awsx2YoznzewOgKcke3OApId1AADwCwIGJG90u12f5/nx+vr6Jefc0RyQUjpsfE9CCJsk3wIoyrLcljRttVrznv8AcAEAFgHUtovksNrkXp7nx+Px+ETSbQBfKrN8NrOtRQC17pK0QbJMKb2az5nZd+fc/ZRSBKAm1q+r5ASADyHsVuPAe/+R5JtlnqEzIWY2rGDPsiw7JfmysulB0ypq3TWbzb51Op0JyaskLwL4BGA3xvhi9aes9G/pF4AdwlhUZ8RfAAAAAElFTkSuQmCC"></div><div id="vts-link-text-holder" class="vts-link-text-holder"><div class="vts-link-text"><textarea id="vts-link-text-input" rows="4" cols="50" wrap="hard"></textarea></div></div> </div>',t,i),this.div=this.control.getElement("vts-link");var r=this.control.getElement("vts-link-button");r.on("click",this.onSwitch.bind(this)),r.on("dblclick",this.onDoNothing.bind(this)),this.linkPanel=this.control.getElement("vts-link-text-holder"),this.link=this.control.getElement("vts-link-text-input"),this.linkVisible=!1,this.update()};a.prototype.onDoNothing=function(e){s.stopPropagation(e)},a.prototype.onSwitch=function(){this.linkVisible=!this.linkVisible,this.updateLink(),this.update()},a.prototype.update=function(){var e=10+(this.ui.config.controlZoom?70:0)+(this.ui.config.controlSpace?35:0);this.div.setStyle("left",e+"px"),this.linkPanel.setStyle("display",this.linkVisible?"block":"none")},a.prototype.updateLink=function(){var e=this.browser.getLinkWithCurrentPos();this.link.getElement().value!=e&&(this.link.getElement().value=e)},t.a=a},function(e,t,i){"use strict";var r=function(e,t){this.ui=e,this.control=this.ui.addControl("loading",'<div id="vts-loading" class="vts-loading"><div class="vts-loading-progress"><div id="vts-loading-dot1" class="vts-loading-dot"></div><div id="vts-loading-dot2" class="vts-loading-dot"></div><div id="vts-loading-dot3" class="vts-loading-dot"></div><div id="vts-loading-dot4" class="vts-loading-dot"></div><div id="vts-loading-dot5" class="vts-loading-dot"></div></div> </div>',t),this.loading=this.control.getElement("vts-loading"),this.dots=[this.control.getElement("vts-loading-dot1"),this.control.getElement("vts-loading-dot2"),this.control.getElement("vts-loading-dot3"),this.control.getElement("vts-loading-dot4"),this.control.getElement("vts-loading-dot5")],this.time=Date.now(),this.hiding=null};r.prototype.show=function(){this.hiding=null,this.ui.setControlVisible("compass",!1),this.ui.setControlVisible("zoom",!1),this.ui.setControlVisible("space",!1),this.ui.setControlVisible("search",!1),this.ui.setControlVisible("link",!1),this.ui.setControlVisible("github",!1),this.ui.setControlVisible("measure",!1),this.ui.setControlVisible("measure2",!1),this.ui.setControlVisible("fullscreen",!1),this.ui.setControlVisible("credits",!1),this.ui.setControlVisible("loading",!0),this.time=Date.now()},r.prototype.hide=function(){this.hiding=Date.now();var e=this.ui.config.controlSearch;if(e&&!this.ui.browser.config.controlSearchUrl){var t=this.ui.browser.getMap();if(t){var i=t.getSrsInfo(t.getReferenceFrame().physicalSrs).a;e=i<6428137&&i>6328137}}this.ui.setControlVisible("compass",this.ui.config.controlCompass,!1),this.ui.setControlVisible("zoom",this.ui.config.controlZoom,!1),this.ui.setControlVisible("space",this.ui.config.controlSpace,!1),this.ui.setControlVisible("search",e,!1),this.ui.setControlVisible("link",this.ui.config.controlLink,!1),this.ui.setControlVisible("github",this.ui.config.controlGithub,!1),this.ui.setControlVisible("measure",this.ui.config.controlMeasure,!1),this.ui.setControlVisible("measure2",this.ui.config.controlMeasureLite,!1),this.ui.setControlVisible("fullscreen",this.ui.config.controlFullscreen,!1),this.ui.setControlVisible("credits",this.ui.config.controlCredits,!1),this.ui.setControlVisible("loading",!1)},r.prototype.update=function(){var e,t=Date.now();this.hiding&&(e=.001*(t-this.hiding),this.loading.setStyle("opacity",1-Math.min(1,2*e)+""),e>.5&&this.control.setVisible(!1)),e=.001*(t-this.time);for(var i=0;i<5;i++)this.dots[i].setStyle("opacity",.6*Math.sin(1.5*Math.PI/5*i-e*Math.PI*2)+.2);var r=this.ui.browser.getMap();if(r){var s=r.getStats();(0==s.surfaces&&0==s.freeLayers||t-this.time>7e3||0==s.downloading&&s.lastDownload>0&&t-s.lastDownload>1e3||0!=s.bestMeshTexelSize&&s.bestMeshTexelSize<=3*s.texelSizeFit||("fit"==s.loadMode||"fitonly"==s.loadMode)&&s.drawnTiles-s.drawnGeodataTiles>1)&&(this.hide(),this.ui.browser.callListener("loading-screen-hidden",{}))}},t.a=r},function(e,t,i){"use strict";var r=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("map",'<div id="vts-map" class="vts-map"> </div>',t,i),this.getMapElement().setDraggableState(!0)};r.prototype.getMapElement=function(){return this.control.getElement("vts-map")},t.a=r},function(e,t,i){"use strict";var r=i(10),s=i(172),a=r.a,n=s.b,o=s.c,h=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("measure2",'<div id="vts-measure" class="vts-measure"><img id="vts-measure-button" class="vts-measure-button" src="'+n+'"><img id="vts-measure-button2" class="vts-measure-button" src="'+o+'"><div id="vts-measure-text-holder" class="vts-measure-text-holder"><div class="vts-measure-text-holder2"><div class="vts-measure-text"><textarea id="vts-measure-text-input" rows="6" cols="50" wrap="hard"></textarea></div><div class="vts-measure-tools"><div id="vts-measure-clear" class="vts-measure-tools-button">Clear</div></div></div></div><div id="vts-measure-info" class="vts-measure-info"></div> </div>',t,i),this.div=this.control.getElement("vts-measure"),this.buttonOff=this.control.getElement("vts-measure-button"),this.buttonOff.on("click",this.onSwitch.bind(this)),this.buttonOff.on("dblclick",this.onDoNothing.bind(this)),this.buttonOn=this.control.getElement("vts-measure-button2"),this.buttonOn.on("click",this.onSwitch.bind(this)),this.buttonOn.on("dblclick",this.onDoNothing.bind(this)),this.info=this.control.getElement("vts-measure-info");var r=this.control.getElement("vts-measure-clear");r.on("click",this.onClear.bind(this)),r.on("dblclick",this.onDoNothing.bind(this)),this.measuring=!1,this.counter=1,this.lastCoords=null,this.listPanel=this.control.getElement("vts-measure-text-holder"),this.list=this.control.getElement("vts-measure-text-input"),this.measuring?(this.buttonOn.setStyle("display","block"),this.buttonOff.setStyle("display","none")):(this.buttonOn.setStyle("display","none"),this.buttonOff.setStyle("display","block")),this.onMouseMoveCall=this.onMouseMove.bind(this),this.onMouseLeaveCall=this.onMouseLeave.bind(this),this.onMouseClickCall=this.onMouseClick.bind(this),this.update()};h.prototype.onDoNothing=function(e){a.stopPropagation(e)},h.prototype.onMouseLeave=function(e){this.info.setStyle("display","none")},h.prototype.onMouseClick=function(e){var t=this.browser.getMap();if(t){var i=this.ui.getMapElement(),r=i.getDraggingState(),s=r.absMoved;if(!(s[0]+s[1]>0)){var a=e.getMouseCoords(),n=t.getHitCoords(a[0],a[1],"fix");if(n){n=t.convertCoordsFromNavToPublic(n,"fix");var o="#"+this.counter+"  "+n[0].toFixed(7)+", "+n[1].toFixed(7)+", "+n[2].toFixed(2)+"m";if(this.lastCoords){for(var h=t.getDistance(this.lastCoords,n,!1,!0),l="\n   ",u=0,c=(""+this.counter).length;u<c;u++)l+=" ";o+=l+"great-circle distance: ",h[0]>1e5?o+=(.001*h[0]).toFixed(2)+"km":o+=h[0].toFixed(2)+"m",o+=l+"elevation difference: "+(n[2]-this.lastCoords[2]).toFixed(2)+"m",o+=l+"euclidean distance: ",h[2]>1e5?o+=(.001*h[2]).toFixed(2)+"km":o+=h[2].toFixed(2)+"m"}this.counter++,this.lastCoords=n;var d=this.list.getElement();d.value+=o+"\n",d.scrollTop=d.scrollHeight}}}},h.prototype.onMouseMove=function(e){var t=this.browser.getMap();if(t){var i=e.getMouseCoords(),r=t.getHitCoords(i[0],i[1],"fix");if(!r)return void this.info.setStyle("display","none");r=t.convertCoordsFromNavToPublic(r,"fix");var s=r[0].toFixed(7)+", "+r[1].toFixed(7)+", "+r[2].toFixed(2)+"m";i[0]-=this.divRect.left,i[1]-=this.divRect.top,this.info.setStyle("display","block"),this.info.setStyle("left",i[0]+20+"px"),this.info.setStyle("top",i[1]+10+"px"),this.info.setHtml(s)}},h.prototype.onSwitch=function(){this.measuring=!this.measuring;var e=this.ui.getMapElement();this.measuring?(this.buttonOn.setStyle("display","block"),this.buttonOff.setStyle("display","none"),this.divRect=this.div.getRect(),e.on("mousemove",this.onMouseMoveCall),e.on("mouseleave",this.onMouseLeaveCall),e.on("click",this.onMouseClickCall)):(this.buttonOn.setStyle("display","none"),this.buttonOff.setStyle("display","block"),e.off("mousemove",this.onMouseMoveCall),e.off("mouseleave",this.onMouseLeaveCall),e.off("click",this.onMouseClickCall)),this.updateLink(),this.update()},h.prototype.onClear=function(){this.counter=1,this.lastCoords=null;var e=this.list.getElement();e.value="",e.scrollTop=0},h.prototype.update=function(){var e=10+(this.ui.config.controlZoom?70:0)+(this.ui.config.controlSpace?35:0);this.div.setStyle("left",e+"px"),this.listPanel.setStyle("display",this.measuring?"block":"none")},h.prototype.updateLink=function(){},t.a=h},function(e,t,i){"use strict";var r=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("popup",'<div class="vts-popup-background" id="vts-popup-background"><div id="vts-popup"</div></div>',t,i),this.lastHTML="",this.popup=this.control.getElement("vts-popup"),this.background=this.control.getElement("vts-popup-background"),this.background.on("click",this.hide.bind(this))};r.prototype.show=function(e,t){this.control.setVisible(!0);for(var i in e)this.popup.setStyle(i,e[i]);this.popup.setHtml(t)},r.prototype.hide=function(){this.control.setVisible(!1)},t.a=r},function(e,t,i){"use strict";function r(e){for(var t,i=[],r=[],s=function(e){for(var t=0;t<e.length;t++)switch(e[t].type){case"hamlet":case"village":case"town":case"city":return e[t]}return e[0]},a=0;a<e.length-1;a++)t=e[a],t.display_name===e[a+1].display_name?r.push(t):r.length>0?(r.push(t),i.push(s(r)),r.length=0):i.push(t);return r.length&&i.push(s(r)),i}function s(e,t,i,r){var s=u.radians(t),a=u.radians(r),n=u.radians(r-t),o=u.radians(i-e),h=Math.sin(n/2)*Math.sin(n/2)+Math.cos(s)*Math.cos(a)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371e3}function a(e,t){return+t.lat>+e.lat-.1&&+t.lat<+e.lat+.1&&+t.lon>+e.lon-.1&&+t.lon<+e.lon+.1}function n(e){var t,i;do{i=!0;for(var r=0;r<e.length-1;r++){var s=e[r],a=e[r+1];s.rank<.4&&a.rank<.4&&Math.abs(s.rank-a.rank)<.06&&s.distance>a.distance&&(s.note="reshaked-down",a.note="reshaked-up",t=s,e[r]=a,e[r+1]=t,i=!1)}}while(!i)}function o(e,t,i){for(var r,a,n=[],o=e,h=i&&t,l=0;l<o.length;l++)a=o[l],r={lat:+a.lat,lon:+a.lon,title:a.title,rank:1,country:a.country,region:a.region,state:a.state,cc:"",type:"",bounds:null,polygon:[],bbox:null},h&&(r.distance=s(t,i,r.lon,r.lat)),n.push(r);return n}function h(e,t,i){var o,h,l,u,c,d,p,f=[],g=i&&t,m=e;m.length>1&&(m=r(m));for(var v=0;v<m.length;v++)h=m[v],p=h.boundingbox,l=h.address,d=h.display_name.replace(/,.*/,""),u=l.state&&l.state||l.state_district&&l.state_district||l.county&&l.county||"",c=l.county&&l.county||l.state_district&&l.state_district||u,c===d&&(c=l.state_district&&l.state_district||u),o&&a(o,h)||h.importance<.01&&v>5||(new RegExp(/ - /).test(u)&&(u=u.replace(/ -.*/,"")),"archipelago"===h.type||"administrative"===h.type&&(d===l.country||d===u)?"-180"===p[2]&&(p[2]=p[3]=h.lon):p=null,d===l.house_number&&l.road&&(d=l.road),o={lat:+h.lat,lon:+h.lon,title:d,rank:h.importance,country:"us"===l.country_code?u:l.country&&l.country.replace(/,.*/,""),display:h.display_name,region:c||"",state:u||"",cc:l.country_code,type:h.type,bounds:p,polygon:h.polygonpoints||[],bbox:h.boundingbox},g&&(o.distance=s(t,i,o.lon,o.lat)),f.push(o));return g&&n(f),f}var l=i(4);i.d(t,"a",function(){return h}),i.d(t,"b",function(){return o});var u=l.a},function(e,t,i){"use strict";var r=i(10),s=i(2),a=i(199),n=i(1),o=i(4),h=r.a,l=n.b,u=o.a,c=s.a,d=a.a,p=a.b,f=function(e,t,i){this.ui=e,this.browser=e.browser;var r=this.browser.config.controlSearchElement;r&&"string"==typeof r&&(r=document.getElementById(r)),this.control=this.ui.addControl("search",'<div class="vts-search"><div class="vts-search-input"><input type="text" id="vts-search-input" autocomplete="off" spellcheck="false" placeholder="Search location..."></div><div id="vts-search-list" class="vts-search-list"></div></div>',t,i,r),this.input=this.control.getElement("vts-search-input"),this.input.on("input",this.onChange.bind(this)),this.input.on("keydown",this.onKeyUp.bind(this)),this.input.on("focus",this.onFocus.bind(this)),this.input.on("mousedown",this.onDrag2.bind(this)),this.input.on("mousewheel",this.onDrag.bind(this)),this.input.on("dblclick",this.onDoNothing.bind(this)),this.list=this.control.getElement("vts-search-list"),this.list.on("mousedown",this.onDrag2.bind(this)),this.list.on("mousewheel",this.onDrag.bind(this)),this.mapControl=this.ui.getMapControl(),this.mapElement=this.mapControl.getMapElement(),this.mapElement.on("mousedown",this.onDrag.bind(this),window),this.mapElement.on("mousewheel",this.onDrag.bind(this),window),this.ignoreDrag=!1,this.urlTemplate="//cdn.melown.com/vtsapi/geocode/v3.0/{lat}/{long}/{value}",this.urlTemplate2=this.urlTemplate,this.data=[],this.lastSearch="",this.itemIndex=-1,this.searchCounter=0,this.coordsSrs="+proj=longlat +datum=WGS84 +nodefs",this.initialValueUsed=!1,this.browser.config.controlSearchValue&&(this.initialValueUsed=!0,this.input.getElement().value=this.browser.config.controlSearchValue,this.onChange())};f.prototype.onDoNothing=function(e){h.preventDefault(e),h.stopPropagation(e)},f.prototype.processTemplate=function(e,t){return e.replace(/\{([$a-zA-Z0-9][$a-zA-Z0-9]*)\}/g,function(e,i){return i in t?t[i]:e})},f.prototype.showList=function(){this.list.setStyle("display","block")},f.prototype.hideList=function(){this.list.setStyle("display","none")},f.prototype.moveSelector=function(e){this.itemIndex+=e,this.itemIndex>=this.data.length&&(this.itemIndex=this.data.length-1),this.itemIndex<0&&(this.itemIndex=0),this.updateList(this.data)},f.prototype.updateList=function(e){if(Array.isArray(e)){var t,i=e,r="";i=i.slice(0,10),this.data=i;for(var s=0,a=i.length;s<a;s++){t=i[s];var n="";this.coords&&0==s&&(n="location: "),n+=t.title+"<small>",t.region&&t.title!=t.region&&(n+=", "+t.region),t.country&&t.title!=t.country&&t.region!=t.country&&(n+=(t.region?", ":"")+t.country),n+="</small>",this.itemIndex==s?r+='<div id="vts-search-item'+s+'" class="vts-search-listitem-selected">'+n+"</div>":r+='<div id="vts-search-item'+s+'" class="vts-search-listitem">'+n+"</div>"}for(this.list.setHtml(r),s=0,a=i.length;s<a;s++){var o="vts-search-item"+s;t=this.control.getElement(o),t&&(t.on("click",this.onSelectItem.bind(this,s)),t.on("mouseenter",this.onHoverItem.bind(this,s)))}this.initialValueUsed||this.showList()}else this.hideList()},f.prototype.solveSRS=function(e){return-1==e.indexOf("+proj=")&&(e=map.getSrsInfo(e),e=e&&e.srsDef?e.srsDef:this.coordsSrs),e},f.prototype.onSelectItem=function(e){var t=this.browser.getMap();if(t){var i=t.getPosition(),r=t.getReferenceFrame(),s=r.navigationSrs,a=t.getSrsInfo(s),n=r.physicalSrs,o=t.getSrsInfo(n),h=this.browser.getProj4(),c=this.browser.config.controlSearchSrs||this.coordsSrs;c=this.solveSRS(c);var d=h(a.srsDef,c,i.getCoords());i=t.convertPositionHeightMode(i,"float",!0);var p=this.data[e];if(p){var d=[p.lon,p.lat];d=h(c,a.srsDef,d),d[2]=0,i.setCoords(d);var f=6667;if(p.bbox){var g=parseFloat(p.bbox[0]),m=parseFloat(p.bbox[1]),v=parseFloat(p.bbox[2]),y=parseFloat(p.bbox[3]);p.polygon=[[v,g],[.5*(y+v),g],[y,g],[v,.5*(m+g)],[y,.5*(m+g)],[v,m],[.5*(y+v),m],[y,m]]}if(p.polygon&&"continent"!=p.type){var b=p.polygon,x=h(c,o.srsDef,d),w=[-x[0],-x[1],-x[2]];l.normalize(w);for(var S=0,M=b.length;S<M;S++){d=h(c,o.srsDef,[b[S][0],b[S][1],0]);var A=w,C=[d[0]-x[0],d[1]-x[1],d[2]-x[2]],T=[x[0]+w[0],x[1]+w[1],x[2]+w[2]],P=[d[0]-T[0],d[1]-T[1],d[2]-T[2]],F=[0,0,0];l.cross(A,C,F);var L=l.length(P)/l.length(A)*2;L>f&&(f=L)}"projected"!=a.type&&f>1.4*a.a&&(f=1.4*a.a)}else switch(p.type){case"peak":f=2e4;break;case"city":f=3e4;break;case"street":f=4e3;break;case"residential":f=3e3;break;case"continent":f=855e4;break;case"pos":f=15e4}i.setViewExtent(f);var E=[0,-60,0];if("obj"==i.getViewMode()&&a.a){var k=.5*i.getViewExtent()/Math.tan(u.radians(.5*i.getFov())),N=Math.min(k/(.5*a.a),1),B=20+-110*N;E[1]>B&&(E[1]=B),E[1]<-90&&(E[1]=-90)}i.setOrientation(E),t.setPosition(i),this.itemIndex=e,this.lastSearch=p.title;var I=this.input.getElement();I.value=this.lastSearch,I.blur()}this.hideList()}},f.prototype.onHoverItem=function(e){this.itemIndex!=e&&(this.itemIndex=e,this.updateList(this.data))},f.prototype.onListLoaded=function(e,t){var i=this.browser.getMap();if(i&&this.searchCounter==e){var r=i.getPosition(),s=i.getReferenceFrame(),a=s.navigationSrs,n=i.getSrsInfo(a),o=this.browser.getProj4(),h=this.browser.config.controlSearchSrs||this.coordsSrs;h=this.solveSRS(h);var l=o(n.srsDef,h,r.getCoords());if(!(t.data&&Array.isArray(t.data)&&t.header&&"search"==t.header.type))return;t=this.browser.config.controlSearchFilter?d(t.data,l[0],l[1]):p(t.data,l[0],l[1]),this.coords&&t.unshift({title:this.coords[0].toFixed(6)+" "+this.coords[1].toFixed(6),lat:this.coords[0],lon:this.coords[1],type:"pos"}),this.updateList(t)}},f.prototype.onListLoadError=function(){},f.prototype.onFocus=function(){this.lastSearch="",this.input.getElement().value=this.lastSearch,this.hideList()},f.prototype.onKeyPress=function(e){this.onKeyUp(e)},f.prototype.onKeyUp=function(e){switch(e.getKeyCode()){case 38:this.moveSelector(-1),h.preventDefault(e),h.stopPropagation(e);break;case 40:this.moveSelector(1),h.preventDefault(e),h.stopPropagation(e);break;case 9:case 13:this.onSelectItem(Math.max(0,this.itemIndex),null)}},f.prototype.parseLatLon=function(e){if(e.replace(/\d+/,"")==e)return null;e=e.replace(","," "),e=e.replace(/  +/g," ").trim().toLowerCase();var t,i,r,s,a,n,o,h,l,u=e.split(" ");if(2==u.length&&-1==e.indexOf("n")&&-1==e.indexOf("s")&&-1==e.indexOf("w")&&-1==e.indexOf("e"))return s=u[0].charAt(u[0].length-1),a=u[1].charAt(u[1].length-1),n=!1,""!=s&&"'"!=s&&'"'!=s||""!=a&&"'"!=a&&'"'!=a||(u[0]=u[0]+"n",u[1]=u[1]+"e",e=u.join()),n||isNaN(u[0])||isNaN(u[1])||(t=parseFloat(u[0]),i=parseFloat(u[1]),isNaN(t)||isNaN(i))?null:t>90||t<-90?null:i>360||i<-360?null:[t,i];var c=e.split(/['"]+/).join(" ").split(/[^\w\S]+/);t=0,i=0,h=0;var d=!1;for(r in c)o=c[r],isNaN(o)?(l=parseFloat(o),d=!0,s=o.charAt(o.length-1),isNaN(l)||(h++,d=!1),d&&1!=o.length||("w"!=s&&"e"!=s||t++,"n"!=s&&"s"!=s||i++)):h++;if(1!=t||1!=i)return null;var p=[],f=[],g=0,m=0,v=0;for(r in c)if(isNaN(c[r])){var y=c[r];l=parseFloat(c[r]),isNaN(l)||(g+=l/Math.pow(60,m++),y=c[r].replace(l,""),v++),y=y[0],"s"!=y&&"w"!=y||(g*=-1),p[p.length]=y,f[f.length]=g,g=m=0}else l=parseFloat(c[r]),isNaN(l)||(g+=l/Math.pow(60,m++),v++);if(2!=f.length||v<2||isNaN(f[0])||isNaN(f[1]))return null;if("w"==p[0]||"e"==p[0]){var b=f[0];f[0]=f[1],f[1]=b}return f[0]>90||f[0]<-90?null:f[1]>360||f[1]<-360?null:f},f.prototype.onChange=function(){var e=this.input.getElement().value;if((e=e.trim())!=this.lastSearch){this.lastSearch=e,""==e&&this.hideList();var t=this.browser.getMap();if(t){var i=t.getPosition(),r=t.getReferenceFrame(),s=r.navigationSrs,a=t.getSrsInfo(s),n=this.browser.getProj4(),o=this.browser.config.controlSearchSrs||this.coordsSrs;o=this.solveSRS(o);var h=n(a.srsDef,o,i.getCoords());this.coords=this.parseLatLon(e);var l=this.processTemplate(this.browser.config.controlSearchUrl||this.urlTemplate,{value:e,lat:h[1],long:h[0]});this.searchCounter++,this.itemIndex=-1,c.loadJSON(l,this.onListLoaded.bind(this,this.searchCounter),this.onListLoadError.bind(this))}}},f.prototype.onDrag2=function(){this.ignoreDrag=!0},f.prototype.onDrag=function(){if(this.ignoreDrag)return void(this.ignoreDrag=!1);var e=this.input.getElement();e.value=this.lastSearch,e.blur(),this.hideList()},f.prototype.update=function(){this.initialValueUsed&&this.browser.mapLoaded&&(this.initialValueUsed=!1,this.onSelectItem(0))},t.a=f},function(e,t,i){"use strict";var r=i(10),s=i(171),a=r.a,n=s.b,o=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("space",'<div id="vts-space" class="vts-space"><img id="vts-space-2d" class="vts-space-button" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAABqElEQVRIx+2UsWoUURSGv3Nn1sIiaKMBSbD0AdRBdmbdB7DMA0gaSSVRbFRYiGAaUWJhEAQVEey10yacO/gAwqZNSKWwhShs4ew9NtewTDI6sRCE/at7h8P/nfnvuRdmmum/lkxvut1u5pwbAOfNrAMMzWy9LMt3v2qKorCaRwC+A9vApqq+bITkeX4Z+CAiab3IzJa9988bIPXaR977G9Pf3NT6joikZvYmSZL5JElOAPcBRORu3UxVRVVlNBodCyEsmtkAMBFZjQ3va79rETluZl+rqrrpvf8c41t3zt0GFpo6Hw6HP4A9YK0oinlgRUSuAVsHIKqaH8hSJIsR7LQ54KqqNtI0XTGzS01xURuCBeBZhD1pAzGz3Vh/+o+QXq93zjnnReSsmb1W1Y0jTm3yW0ie5xdDCB5YNLMX4/H4KmAtzc/EP/py6MHH8bwAvAfmgDXv/eAo7Xc6nSsxro+HQrIsO2Vmb0VkDrilqg9aert+v39yMpksAfciZLPpMj4UkdUmJ1WVNpcReKyq15viWvrLp8mAb8CnEMLTsixfzV7rmf6dfgKmzKAWE7bqxgAAAABJRU5ErkJggg=="><img id="vts-space-3d" class="vts-space-button" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAB8klEQVRIx+1Uv4sTQRT+3mRygyDInYXFabaxsRNOIiG7mEPQxsJCLQVF8AeiaCNWigrWiniCVfA/0Eo4ONnZ4P4FURAL9yyCEMQfRMzs7LOZk2HZxNgIQr7qzbw373t838wAc8zxX4P8RbvdPimEuMLM+4loAcAmM3eTJLkHgAEgiiIu9SgAfAfwBsCa1rpbJqltBWEYXhBCdAE0HEENwBIRrQZBQFmWvQKAIAhuVwyqAOwGcLzRaOzIsuylXyB+VxKdc+FTY8yyMWZbURSn3N7l8nRaa9Ja03A4XCiKosHMtwAwEV0Lw/BQJYnW+oAxZu9oNLqUpulASrmdiPa49GCS3v1+3/R6vc0kSe4AeOIGPu/XSH+Rpul7J906ER0GAGYeADgzi8F5nj+QUl5k5tZEEk+6fV6sfO+mgZk/uDO7KuUqYcUYswTgGYBFAPf/8tbW/kiitR6kafqZma+7CVdmbL7s6j9VyhVF0QtmbuV5fnDLm/F4rJRSICKehaFerx9zcr2uJGHmn0S0U0r5uNlsnlVKWQCPXG5jSm/R6XQWrbUnANx1JGuTjL/JzEeJ6IhS6qNH/kUIcaPc2X/51lo/9TCO441KT5IkeWetXQWwDuAHgG/M/BxAK47jt9MuFYCvAHpFUZzWWl+d/9Zz/Dv8ApJPyD0fWCwOAAAAAElFTkSuQmCC"> </div>',t,i),this.button2D=this.control.getElement("vts-space-2d"),this.button2D.on("click",this.onSwitch.bind(this)),this.button2D.on("dblclick",this.onDoNothing.bind(this)),this.button3D=this.control.getElement("vts-space-3d"),this.button3D.on("click",this.onSwitch.bind(this)),this.button3D.on("dblclick",this.onDoNothing.bind(this)),this.space3D=!0,this.display3D=this.space3D,this.space3D?(this.button2D.setStyle("display","block"),this.button3D.setStyle("display","none")):(this.button2D.setStyle("display","none"),this.button3D.setStyle("display","block"))};o.prototype.onDoNothing=function(e){a.stopPropagation(e)},o.prototype.onSwitch=function(){this.space3D=!this.space3D;var e=this.browser.getMap();if(e){this.browser.autopilot&&(this.browser.autopilot.setAutorotate(0),this.browser.autopilot.setAutopan(0,0));var t=e.getPosition(),i=t.getOrientation();this.space3D?(i[0]=45,i[1]=-60,t.setOrientation(i)):(i[0]=0,i[1]=-90,t.setOrientation(i)),t=n(this.browser,t),e.setPosition(t),this.update()}},o.prototype.update=function(){var e=this.browser.getMap();if(e){var t=e.getPosition(),i=t.getOrientation(),r=Math.abs(i[1]+90)>.1;r!=this.display3D&&(r?(this.button2D.setStyle("display","block"),this.button3D.setStyle("display","none")):(this.button2D.setStyle("display","none"),this.button3D.setStyle("display","block")),this.space3D=r,this.display3D=r)}},t.a=o},function(e,t,i){"use strict";var r=i(10),s=r.a,a=function(e,t,i){this.ui=e,this.browser=e.browser,this.control=this.ui.addControl("zoom",'<div id="vts-zoom" class="vts-zoom"><div id="vts-zoom-plus" class="vts-zoom-plus"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAASUlEQVRIx+2Tyw0AIAhDq0d2KsMzFFddQBO9+En6rqR5kFBAiBVINpJtJ1NPLCbJe5IyG7j78IMyEwBgZsNcRJQrl6gnkgjxIx12Cg3wDaLBUAAAAABJRU5ErkJggg=="></div><div id="vts-zoom-minus" class="vts-zoom-minus"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAALUlEQVRIx2NgGAWjYBSMAqoCRlwSdnZ2/8kx8NChQxhmMo2G8ygYBaNgFGAHAElYBARpOBYqAAAAAElFTkSuQmCC"></div> </div>',t,i);var r=this.control.getElement("vts-zoom-plus");r.on("click",this.onZoomIn.bind(this)),r.on("dblclick",this.onDoNothing.bind(this));var s=this.control.getElement("vts-zoom-minus");s.on("click",this.onZoomOut.bind(this)),s.on("dblclick",this.onDoNothing.bind(this))};a.prototype.onDoNothing=function(e){s.preventDefault(e),s.stopPropagation(e)},a.prototype.onZoomIn=function(){this.repeat(7,.96,50)},a.prototype.onZoomOut=function(){this.repeat(7,1.04,50)},a.prototype.repeat=function(e,t,i){if(!(e<=0)){if(this.browser.getMap()){this.browser.autopilot&&(this.browser.autopilot.setAutorotate(0),this.browser.autopilot.setAutopan(0,0));var r=this.browser.controlMode.getCurrentController();r.viewExtentDeltas&&r.viewExtentDeltas.push(t),setTimeout(this.repeat.bind(this,--e,t,i),i)}}},t.a=a},function(e,t,i){"use strict";var r=i(173),s=i(10),a=r.a,n=s.a,o=function(e,t){this.control=e,this.ui=this.control.ui,this.element=t,this.events=[],this.dragBeginCall=this.onDragBegin.bind(this,!1),this.dragBeginCallTouch=this.onDragBegin.bind(this,!0),this.dragMoveCall=this.onDragMove.bind(this,!1),this.dragMoveCallTouch=this.onDragMove.bind(this,!0),this.dragEndCall=this.onDragEnd.bind(this,!1),this.dragEndCallTouch=this.onDragEnd.bind(this,!0),this.firstDragDistance=0,this.lastDragDistance=0,this.dragStartPos=[0,0],this.dragCurrentPos=[0,0],this.dragLastPos=[0,0],this.dragAbsMoved=[0,0],this.zoomDrag=!1};o.prototype.setStyle=function(e,t){this.element.style[e]=t},o.prototype.getStyle=function(e){return this.element.style[e]},o.prototype.setClass=function(e){return n.setClass(this.element,e),this},o.prototype.getClass=function(){return n.getClass(this.element),this},o.prototype.hasClass=function(e){return n.hasClass(this.element,e)},o.prototype.addClass=function(e){return n.addClass(this.element,e),this},o.prototype.removeClass=function(e){return n.removeClass(this.element,e),this},o.prototype.getRect=function(){var e=this.element.getBoundingClientRect(),t=this.ui.map.getMapElement().element.getBoundingClientRect(),i=window.pageXOffset||0,r=window.pageYOffset||0;return{left:e.left+i-(t.left+i),top:e.top+r-(t.top+r),fromRight:t.right-(e.left+i-(t.left+i)),fromBottom:t.height-(e.top+r-(t.top+r)),width:e.width,height:e.height}},o.prototype.getPageRect=function(){var e=this.element.getBoundingClientRect(),t=window.pageXOffset||0,i=window.pageYOffset||0;return{left:e.left+t,top:e.top+i,width:e.width,height:e.height}},o.prototype.setHtml=function(e){this.element.innerHTML=e;for(var t=this.element.getElementsByTagName("*"),i=0,r=t.length;i<r;i++){var s=t[i].getAttribute("id");null!==s&&(this.control.elementsById[s]=new o(this,t[i]))}},o.prototype.getHtml=function(){return this.element.innerHTML},o.prototype.getElement=function(){return this.element},o.prototype.on=function(e,t,i){this.addEvent(e,t,i)},o.prototype.once=function(e,t,i){var r=function(){this.removeEvent(e,t,i)}.bind(this),s=function(e){t(e),r()};this.addEvent(e,s,i)},o.prototype.off=function(e,t,i){this.removeEvent(e,t,i)},o.prototype.fire=function(e,t){var i=this.events[e];if(null!=i)for(var r in i)i[r](t)},o.prototype.addEvent=function(e,t,i){var r=e+"-"+n.stamp(t)+(i?"-"+n.stamp(i):""),s=function(i){this.ui.killed||t(new a(e,this,i||window.event))}.bind(this),o=i||this.element;o.addEventListener(this.getEventName(e),s,!1),"mousewheel"==e&&o.addEventListener("DOMMouseScroll",s,!1),this.events[e]=this.events[e]||[],this.events[e][r]=s},o.prototype.removeEvent=function(e,t,i){var r=e+"-"+n.stamp(t)+(i?"-"+n.stamp(i):""),s=this.events[e]&&this.events[e][r];if(null!=s){delete this.events[e][r];(i||this.element).removeEventListener(this.getEventName(e),s,!1)}},o.prototype.getEventName=function(e){return e},o.prototype.setDraggableState=function(e){e?(this.on("mousedown",this.dragBeginCall),this.on("touchstart",this.dragBeginCallTouch)):this.dragable&&(this.off("mousedown",this.dragBeginCall),this.off("mousemove",this.dragMoveCall,document),this.off("mouseup",this.dragEndCall,document),this.off("touchstart",this.dragBeginCallTouch),this.off("touchmove",this.dragMoveCallTouch,document),this.off("touchend",this.dragEndCallTouch,document),this.dragging=!1),this.dragStartPos=[0,0],this.dragCurrentPos=[0,0],this.dragLastPos=[0,0],this.dragAbsMoved=[0,0],this.dragTouchCount=0,this.dragTouches=[],this.dragTouches2=[],this.resetPos=!1,this.dragable=e,this.dragButtons={left:!1,right:!1,middle:!1}},o.prototype.getDraggableState=function(){return this.dragable},o.prototype.getDraggingState=function(){return{dragging:this.dragging,buttonLeft:this.dragButtons.left,buttonRight:this.dragButtons.right,buttonMiddle:this.dragButtons.middle,startPos:this.dragStartPos.slice(),lastPos:this.dragLastPos.slice(),currentPos:this.dragCurrentPos.slice(),absMoved:this.dragAbsMoved.slice()}},o.prototype.onDragBegin=function(e,t){if(this.dragButtons[t.getMouseButton()]=!0,this.dragTouches=[],this.dragTouches2=[],this.dragTouches.push(t.getTouchCoords(0)),this.dragTouches2.push(t.getTouchCoords(1)),e&&(this.resetPos=!0,this.firstDragDistance=0,this.lastDragDistance=0,this.zoomDrag=!1),this.dragging)this.dragLastPos=t.getMouseCoords();else{this.dragging=!0;var i=t.getMouseCoords();this.dragStartPos=[i[0],i[1]],this.dragCurrentPos=[i[0],i[1]],this.dragLastPos=[i[0],i[1]],this.dragAbsMoved=[0,0],this.on("mousemove",this.dragMoveCall,document),this.on("mouseup",this.dragEndCall,document),this.on("touchmove",this.dragMoveCallTouch,document),this.on("touchend",this.dragEndCallTouch,document),n.disableTextSelection(),n.disableImageDrag(),n.preventDefault(t),this.dragLastPos[0]=i[0],this.dragLastPos[1]=i[1],this.fire("dragstart",{clientX:i[0],clientY:i[1],pageX:i[0],pageY:i[1]})}},o.prototype.onDragMove=function(e,t){var i=t.getMouseCoords();-1!=t.getTouchesCount()&&this.updateDragButtonsState(t,!0),n.preventDefault(t);var r="",s=0,a=[0,0],o=0;if(e){var h=t.getTouchesCount();if(h!=this.dragTouchCount&&(this.dragLastPos[0]=i[0],this.dragLastPos[1]=i[1],this.dragTouchCount=h),this.resetPos&&(this.dragCurrentPos=[i[0],i[1]],this.dragLastPos[0]=i[0],this.dragLastPos[1]=i[1],this.resetPos=!1),2==h&&(this.dragTouches.push(t.getTouchCoords(0)),this.dragTouches2.push(t.getTouchCoords(1)),this.dragTouches.length>=7&&(this.dragTouches.shift(),this.dragTouches2.shift()),6==this.dragTouches.length)){var l,u,c=this.dragTouches,d=c[5][0]-c[4][0]+(c[4][0]-c[3][0])+(c[3][0]-c[2][0])+(c[2][0]-c[1][0])+(c[1][0]-c[0][0]),p=c[5][1]-c[4][1]+(c[4][1]-c[3][1])+(c[3][1]-c[2][1])+(c[2][1]-c[1][1])+(c[1][1]-c[0][1]),f=this.dragTouches2,g=f[5][0]-f[4][0]+(f[4][0]-f[3][0])+(f[3][0]-f[2][0])+(f[2][0]-f[1][0])+(f[1][0]-f[0][0]),m=f[5][1]-f[4][1]+(f[4][1]-f[3][1])+(f[3][1]-f[2][1])+(f[2][1]-f[1][1])+(f[1][1]-f[0][1]),v=Math.sqrt(d*d+p*p),y=Math.sqrt(g*g+m*m);if(r="pan",v>5*y||y>5*v){var b,x,w;v>5*y?(b=f[0],x=c[0],w=c[5]):(b=c[0],x=f[0],w=f[5]);var S=[x[0]-b[0],x[1]-b[1]],M=[w[0]-b[0],w[1]-b[1]],A=Math.sqrt(S[0]*S[0]+S[1]*S[1]);S[0]/=A,S[1]/=A,A=Math.sqrt(M[0]*M[0]+M[1]*M[1]),M[0]/=A,M[1]/=A,l=S[0]*M[0]+S[1]*M[1],u=-S[1]*M[0]+S[0]*M[1],s=Math.acos(u)*(180/Math.PI)-90,l>.9999?r="zoom":a=[.5*(d+g),.5*(p+m)]}else if(v>1&&y>1){var C=d/v,T=p/v,P=g/y,F=m/y;l=C*P+T*F,l<.2?r="zoom":a=[.5*(d+g),.5*(p+m)]}c=this.dragTouches,f=this.dragTouches2;var L=f[0][0]-c[0][0],E=f[0][1]-c[0][1];v=Math.sqrt(L*L+E*E),o=0;for(var k=1;k<6;k++)L=f[k][0]-c[k][0],E=f[k][1]-c[k][1],y=Math.sqrt(L*L+E*E),o+=y-v,v=y}}this.fire("drag",{clientX:i[0],clientY:i[1],pageX:i[0],pageY:i[1],deltaX:i[0]-this.dragLastPos[0],deltaY:i[1]-this.dragLastPos[1],left:this.dragButtons.left,right:this.dragButtons.right,middle:this.dragButtons.middle,zoom:0,touchMode:r,touchPanDelta:a,touchRotateDelta:s,touchDistanceDelta:o,touches:e?h:0}),this.dragLastPos=this.dragCurrentPos,this.dragCurrentPos=[i[0],i[1]],this.dragAbsMoved[0]+=Math.abs(i[0]-this.dragLastPos[0]),this.dragAbsMoved[1]+=Math.abs(i[1]-this.dragLastPos[1])},o.prototype.onDragEnd=function(e,t){var i=this.dragButtons.left,r=this.dragButtons.right,s=this.dragButtons.middle;if(this.updateDragButtonsState(t,!1),this.dragTouches=[],this.dragTouches2=[],this.dragTouches.push(t.getTouchCoords(0)),this.dragTouches2.push(t.getTouchCoords(1)),e&&(this.resetPos=!0,this.firstDragDistance=0,this.lastDragDistance=0,this.zoomDrag=!1),this.dragging){var a=t.getMouseCoords();this.dragLastPos=a,this.dragButtons.left||this.dragButtons.right||this.dragButtons.middle||(this.dragging=!1,a=this.dragCurrentPos,this.off("mousemove",this.dragMoveCall,document),this.off("mouseup",this.dragEndCall,document),this.off("touchmove",this.dragMoveCallTouch,document),this.off("touchend",this.dragEndCallTouch,document),n.enableTextSelection(),n.enableImageDrag(),n.preventDefault(t),this.fire("dragend",{clientX:a[0],clientY:a[1],pageX:a[0],pageY:a[1],left:i,right:r,middle:s}))}},o.prototype.updateDragButtonsState=function(e,t){switch(e.getTouchesCount()){case-1:this.dragButtons[e.getMouseButton()]=t;break;case 0:this.dragButtons={left:!1,right:!1,middle:!1};break;case 1:this.dragButtons={left:!0,right:!1,middle:!1};break;case 2:this.dragButtons={left:!1,right:!0,middle:!1};break;case 3:this.dragButtons={left:!1,right:!1,middle:!0}}},t.a=o},function(e,t,i){"use strict";var r=i(10),s=i(2),a=i(192),n=i(196),o=i(187),h=i(188),l=i(190),u=i(202),c=i(201),d=i(200),p=i(194),f=i(191),g=i(193),m=i(189),v=i(198),y=i(195),b=i(172),x=i(197),w=r.a,S=s.a,M=a.a,A=n.a,C=o.a,T=h.a,P=l.a,F=u.a,L=c.a,E=d.a,k=p.a,N=f.a,B=b.a,I=x.a,R=g.a,U=m.a,D=v.a,z=y.a,_=function(e,t){this.browser=e,this.config=e.config,this.rootElement=t,this.element=null,this.controls=[],this.killed=!1,this.init(),this.instanceId=S.instanceCounter++,Object.defineProperty(this,"dom",{get:function(){if(!this.killed)return w}})};_.prototype.init=function(){this.element=document.createElement("div"),this.element.className="vts-browser",this.rootElement.appendChild(this.element),this.map=new A(this);var e=this.config.controlLoading;this.compass=new C(this,!e&&this.config.controlCompass,e),this.credits=new T(this,!e&&this.config.controlCredits,e),this.fullscreen=new P(this,!e&&this.config.controlFullscreen,e),this.zoom=new F(this,!e&&this.config.controlZoom,e),this.space=new L(this,!e&&this.config.controlSpace,e),this.search=new E(this,!e&&this.config.controlSearch,e),this.link=new k(this,!e&&this.config.controlLink,e),this.github=new N(this,!e&&this.config.controlGithub,e),this.measure=new B(this,!e&&this.config.controlMeasure,e),this.measure2=new I(this,!e&&this.config.controlMeasureLite,e),this.layers=new R(this,!e&&this.config.controlLayers,e),this.fallback=new U(this),this.popup=new D(this,!1),this.loading=new z(this,this.config.controlLoading),w.disableContexMenu(this.element)},_.prototype.kill=function(){this.killed=!0;for(var e in this.controls)delete this.controls[e];this.rootElement.removeChild(this.element),delete this.element,this.element=null},_.prototype.addControl=function(e,t,i,r,s){var a=new M(this,t,i,r,s);return this.controls[e]=a,a},_.prototype.removeControl=function(e){null!=this.controls[e]&&delete this.controls[e]},_.prototype.setControlHtml=function(e,t){null!=this.controls[e]&&this.controls[e].setHTML(t)},_.prototype.setControlVisible=function(e,t,i){if(null!=this.controls[e]){void 0!==i&&this.controls[e].setVisibleLock(i);var r=this.browser.getRenderer(),s=r.getMarginFlags();"compass"==e&&(s|=1),"search"==e&&(s|=2),this.config.bigScreenMargins&&(s|=4096),r.setMarginFlags(s),this.controls[e].setVisible(t)}},_.prototype.getControlVisible=function(e){null!=this.controls[e]&&this.controls[e].getVisible()},_.prototype.getControl=function(e){return this.controls[e]},_.prototype.getMapControl=function(){return this.map},_.prototype.getMapElement=function(){return this.map.getMapElement()},_.prototype.setParam=function(e){switch(e){case"controlCompass":this.setControlVisible("compass",this.config.controlCompass);break;case"controlZoom":this.setControlVisible("zoom",this.config.controlZoom);break;case"controlScale":this.setControlVisible("scale",this.config.controlScale);break;case"controlLayers":this.setControlVisible("layers",this.config.controlLayers);break;case"controlSpace":this.setControlVisible("space",this.config.controlSpace);break;case"controlSearch":this.setControlVisible("search",this.config.controlSearch);break;case"controlLink":this.setControlVisible("link",this.config.controlLink);break;case"controlMeasure":this.setControlVisible("measure",this.config.controlMeasure);break;case"controlLogo":this.setControlVisible("logo",this.config.controlLogo);break;case"controlFullscreen":this.setControlVisible("fullscreeen",this.config.controlFullscreen);break;case"controlCredits":this.setControlVisible("credits",this.config.controlCredits)}},_.prototype.tick=function(e){e&&(this.compass.update(),this.space.update(),this.credits.update(),this.link.updateLink(),this.search.update()),this.loading.control.getVisible()&&this.loading.update()},t.a=_}]);